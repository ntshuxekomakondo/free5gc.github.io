{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Home","text":""},{"location":"#what-is-free5gc","title":"What is free5GC?","text":"<p>The free5GC is an open-source project for 5th generation (5G) mobile core networks. The ultimate goal of this project is to implement the 5G core network (5GC) defined in 3GPP Release 15 (R15) and beyond.</p> <p>Currently, the major contributors are from National Yang Ming Chiao Tung University (NYCU). Please refer to our roadmap for the features of each release.</p> <ul> <li>The source code of the latest version of free5GC can be downloaded from here.</li> <li>Follow our LinkedIn page to get the news about free5GC.</li> </ul> <p>Note</p> <p>Thank you very much for your interest in free5GC. The license of free5GC follows Apache 2.0. That is, anyone can use free5GC for commercial purposes for free. </p>"},{"location":"#sponsors","title":"Sponsors","text":""},{"location":"#platinum","title":"Platinum","text":""},{"location":"#gold","title":"Gold","text":""},{"location":"#silver","title":"Silver","text":""},{"location":"#hardware-sponsors","title":"Hardware Sponsors","text":""},{"location":"publication/","title":"Relavent Publications","text":""},{"location":"publication/#publications-using-free5gc","title":"Publications using free5GC","text":""},{"location":"publication/#not-from-nycu","title":"Not from NYCU","text":"<ol> <li>Ralf Kundel, et al., \"User plane hardware acceleration in access networks: Experiences in offloading network functions in real 5g deployments,\" Hawaii International Conference on System Sciences. Computer Society Press, 2022.</li> <li>Taeyun Kim, et al., \"An Implementation Study of Network Data Analytic Function in 5G,\" IEEE International Conference on Consumer Electronics, 2022.</li> <li>Zhou Cong, et al., \"CeUPF: Offloading 5G User Plane Function to Programmable Hardware Base on Co-existence Architecture,\" ACM International Conference on Intelligent Computing and its Emerging Applications, 2021.</li> <li>Gholamreza Ramezan, et al., \"EAP-ZKP: A Zero-Knowledge Proof based Authentication Protocol to Prevent DDoS Attacks at the Edge in Beyond 5G,\" IEEE 4th 5G World Forum, 2021.</li> <li>Ryan Pepito and Ashutosh Dutta, \"Open Source 5G Security Testbed for Edge Computing,\" IEEE 5G World Forum (5GWF), 2021.</li> <li>Robert MacDavid, et al., \"A P4-based 5G User Plane Function,\" 2021.</li> <li>Joe Breen, et al., \"Powder: Platform for Open Wireless Data-driven Experimental Research\",\" Computer Networks, 2021.</li> <li>Endri Goshi, et al,, \"Investigating Inter-NF Dependencies in Cloud-Native 5G Core Network,\" International Conference on Network and Service Management, 2021.</li> <li>Zhi-Li Zhang, et al., \"Towards aSoftware-Defined, Fine-Grained QoS Framework for 5G and Beyond Networks,\" ACM SIGCOMM Workshop on Network-Application Integration, 2021.</li> <li>Zujany Salazar, et al, \"5Greplay: a 5G Network Traffic Fuzzer - Application to Attack Injection,\" International Conference on Availability, Reliability and Security, 2021.</li> <li>M.J. Kim, et al., \"Analysis of Current 5G Open-Source Projects,\" Electronics and Telecommunications Trends, 36(2), p.83-92, 2021.</li> <li>Yang Hu, et al., \"Fuzzing Method Based on Selection Mutation of Partition Weight Table for 5G Core Network NGAP Protocol,\" International Conference on Innovative Mobile and Internet Services in Ubiquitous Computing. Springer, Cham, 2021.</li> <li>Ayoub Bergaoui, et al., \"Demonstration of Orchestration of 5G Core Network Functions with a Satellite Emulator,\" 2021.</li> <li>Dener Kraus, \"Computa\u00e7\u00e3o de borda para ind\u00fastria utilizando a rede 5G,\" 2021.</li> <li>Iria M\u00edguez Gonz\u00e1lez, \"Virtualized cellular networks with native cloud functions,\" Master Thesis, Telecommunications Engineering School, 2021.</li> <li>Cameron MacLeod, \"Kubernetes for the Deployment of Mobile Core Networks,\" 2020.</li> <li>Alireza Hosseini Vasoukolaei, Danish Sattar, and Ashraf Matrawy, \"TLS Performance Evaluation in the Control Plane of a 5G Core Network Slice,\" 2021.</li> <li>Rui Silva, et al., \"A hybrid SDN solution for mobile networks,\" Computer Networks, 2021.</li> <li>Wei-Lun Lin, Chien-Hsuan Chen, and Huai-Sheng Huang, \"Study on the Online Charging System in B5G Era,\" IEEE Asia-Pacific Network Operations and Management Symposium, 2021.</li> <li>David Lake, et al. \", \"Softwarization of 5G Networks \u2013 Implications to Open Platforms and Standardizations,\" IEEE access 9, 2021.</li> <li>Ali Esmaeily, and Katina Kralevska, \"Small-Scale 5G Testbeds for Network Slicing Deployment: A Systematic Review,\" Wireless Communications and Mobile Computing, 2021.</li> <li>Ashok Kumar Murthy, Ranjani Parthasarathi, and V. Vetriselvi, \"Security Testbed for Next Generation Mobile Networks,\" IEEE Third ISEA Conference on Security and Privacy, p.122-129, 2020.</li> <li>Merlin Chlosta, et al., \"5G SUCI-Catchers: Still catching them all?\" Annual International Conference on Mobile Computing and Networking, 2020.</li> <li>\u017diga Ber\u010di\u010d, et al., \"Raziskava in prakti\u010dni preizkus odprtokodnih mobilnih jedrnih sistemov 4G in 5G,\" Diss. Univerza v Ljubljani, Fakulteta za elektrotehniko, 2020.</li> <li>Christian Mailer, \"Plataforma de CORE 5G em nuvem para disponibiliza\u00e7\u00e3o de fun\u00e7\u00f5es de rede como servi\u00e7o,\" 2020.</li> <li>Leonardo Bonati, et al., \"Open, Programmable, and Virtualized 5G Networks: State-of-the-Art and the Road Ahead,\" Computer Networks, 2020.</li> <li>Hung-Yen Weng, Ren-Hung Hwang, and Chin-Feng Lai, \"Live MPEG-DASH video streaming cache management with cognitive mobile edge computing,\" Ambient Intelligence and Humanized Computing p.1-18, 2020.</li> <li>Junaid Jalal, \"Enabling Edge Computing In 5G Via Local Area Data Network: Implementation and Experiments,\" Master Thesis, University of Agder, 2019.</li> <li>David Soldani, \"eBPF: A New Approach to Cloud-Native Observability, Networking and Security for Current (5G) and Future Mobile Networks (6G and Beyond)\"</li> <li>Matan Broner, Sangwoo Lee, Liuyi Jin, and Radu Stoleru, \"Poster: Towards Multi-Radio Access in 5G Networks,\" MobiSys '23: Proceedings of the 21st Annual International Conference on Mobile Systems, Applications and ServicesJune, p.575\u2013576, 2023</li> <li>Francesco Mancini, Leonardo Tamiano, and Giuseppe Bianchi, \"5GShell: a plug-and-play framework for automating the deployment of 5G cellular networks,\" 26th Conference on Innovation in Clouds, Internet and Networks and Workshops (ICIN), 2023</li> <li>Branislava Zivkovic, and Zoran Cica, \"Network Traffic Capturing in Open-Source 5G Core Network Platform,\" 10th International Conference on Electrical, Electronic and Computing Engineering (IcETRAN), 2023</li> <li>Gabriel Lando, Lucas Augusto Fonseca Schierholt, Mateus Paludo Milesi, and Juliano Araujo Wickboldt, \"Evaluating the performance of open source software implementations of the 5G network core,\" NOMS 2023-2023 IEEE/IFIP Network Operations and Management Symposium, 2023</li> <li>Zixu Tian, Rajendra Patil, Mohan Gurusamy, and Joshua McCloud, \"ADSeq-5GCN: Anomaly Detection from Network Traffic Sequences in 5G Core Network Control Plane,\" IEEE 24th International Conference on High Performance Switching and Routing (HPSR), 2023</li> <li>Taeho Park, Hochan Lee, Heewon Kim, Subin Han, Taeyun Kim, and Sangheon Pack, \"Divide and Cache: A Novel Control Plane Framework for Private 5G Networks,\" IEEE 20th Consumer Communications &amp; Networking Conference (CCNC), 2023</li> <li>Seungchan Woo, Jaehyoung Park, Soonhong Kwon, Kyungmin Park, Jonghyun Kim, and Jong-Hyouk Lee, \"Simulation of Data Hijacking Attacks for a 5G-Advanced Core Network,\" Joint European Conference on Networks and Communications &amp; 6G Summit (EuCNC/6G Summit), 2023</li> <li>Zhao Liu, Ping Wang, Yongjing Li, Zhan Xu, and Ming Zhao, \"A Blockchain-based Method for Monitoring Userplane Congestion in Mobile Core Network,\" IEEE 13th International Conference on Electronics Information and Emergency Communication (ICEIEC), 2023</li> <li>Domenico Scotece, Asma Noor, Luca Foschini, and Antonio Corradi, \"5G-Kube: Complex Telco Core Infrastructure Deployment Made Low-Cost,\" IEEE Communications Magazine, p.26-30, ( Volume: 61, Issue: 7, July 2023)</li> <li>Serkut Ayva\u015f\u0131k, Edwin Babaians, Arled Papa, Yash Deshpande, Alba Jano, Wolfgang Kellerer, and Eckehard Steinbach, \"Demo: Remote Robot Control with Haptic Feedback over the Munich 5G Research Hub Testbed,\" IEEE 24th International Symposium on a World of Wireless, Mobile and Multimedia Networks (WoWMoM), 2023</li> <li>Robert Pell, Mohammad Shojafar, Dimitrios Kosmanos, and Sotiris Moschoyiannis, \"Service Classification of Network Traffic in 5G Core Networks using Machine Learning, \"IEEE International Conference on Edge Computing and Communications (EDGE),\" IEEE International Conference on Edge Computing and Communications (EDGE), 2023</li> <li>Nathalie Wehbe, Hyame Assem Alameddine, Makan Pourzandi, and Chadi Assi, \"5GShield: HTTP/2 Anomaly Detection in 5G Service-Based Architecture,\" 2023 IFIP Networking Conference (IFIP Networking), 2023</li> <li>Francesco Mancini, and Giuseppe Bianchi, \"ScasDK - A Development Kit for Security Assurance test in Multi-Network-Function 5G,\" ARES '23: Proceedings of the 18th International Conference on Availability, Reliability and Security, 2023</li> <li>Jiasheng Wu, Yue Gao, Lin Wang, Jingjing Zhang, and Dapeng Oliver Wu, \"How to Allocate Resources in Cloud Native Networks Towards 6G,\" IEEE Network, p.1-7, 2023</li> <li>Koya Ito, and Noboru Izuka, \"Proposal of Client-Server Based Vertical Handover Scheme Using Virtual Routers for Edge Computing in Local 5G Networks and WLANs,\" IEEE 13th Annual Computing and Communication Workshop and Conference (CCWC), 2023</li> <li>Zujany Salazar, Fatiha Za\u00efdi, Huu-Nghia Nguyen, Wissam Mallouli, Ana Rosa Cavalli, and Edgardo Montes De Oca, \"A Network Traffic Mutation Based Ontology, and Its Application to 5G Networks,\" IEEE Access ( Volume: 11), 2023</li> <li>Jon Larrea, Andrew E. Ferguson, and Mahesh K. Marina \"CoreKube: An Efficient, Autoscaling and Resilient Mobile Core System\" ACM MobiCom 2023</li> <li>Ruoting Xiong, Kit-Lun Tong, Yi Ren, Wei Ren, and Gerard Parr, \"From 5G to 6G: It is Time to Sniff the Communications between a Base Station and Core Networks\" ACM MobiCom 2023</li> <li>Bhavishya Sharma, Shwetha Vittal, and A Antony Franklin \"FlexCore: Leveraging XDP-SCTP for Scalable and Resilient Network Slice Service in Future 5G Core\" APNET 2023</li> <li>Francesco Mancini, Giuseppe Bianchi \"ScasDK - A Development Kit for Security Assurance test in Multi-Network-Function 5G\" ARES 2023</li> <li>Endri Goshi, Michael Jarschel, Rastin Pries, Mu He, Wolfgang Kellerer, \"Investigating Inter-NF Dependencies in Cloud-Native 5G Core Networks\" 2021 17th International Conference on Network and Service Management (CNSM) IEEE</li> <li>Weihong Cai, Hongyue Lv, Fanfeng Kong, \"A Concurrent Improvement Design for UDM Architecture in Free5GC\" 2023 8th International Conference on Information Systems Engineering (ICISE) IEEE</li> </ol>"},{"location":"publication/#from-nycu","title":"From NYCU","text":"<ol> <li>V. Jain, H.-T. Chu, S. Qi, C.-A. Lee, H.-C. Chang, C.-Y. Hsieh, K. K. Ramakrishnan, and J.-C. Chen, \"L25GC: A Low Latency 5G Core Network based on High-Performance NFV Platforms,\" full paper, ACM SIGCOMM Conference (SIGCOMM \u201822), (Amsterdam, Netherlands), pp. 143\u2013157, Aug. 2022.</li> <li>C.-Y. Hsieh, Y.-W. Chang, C. Chen, and J.-C. Chen, \"Poster: Design and Implementation of a Generic 5G User Plane Function Development Framework,\" ACM International Conference on Mobile Computing and Networking (MobiCom \u201821), (New Orleans, United States), pp. 846\u2013848, Oct. 2021. (Won second place of the ACM MobiCom 2021 Student Research Competition)</li> <li>Yu-Herng Chai, and Fuchun Joseph Lin, \"Evaluating Dedicated Slices of Different Configurations in 5G Core,\" Computer and Communications, 9(7), p.55-72, 2021.</li> <li>Cheng-Chin Tsai, Fuchun Joseph Lin, and Hiroshige Tanaka, \"Evaluation of 5G Core Slicing on User Plane Function,\" Communications and Network, 13(3), p.79-92, 2021.</li> <li>Wei-Cheng Chang, and Fuchun Joseph Lin, \"Coordinated Management of 5G Core Slices by MANO and OSS/BSS,\" Computer and Communications, 9(6), p.52-72, 2021.</li> <li>Seungjoon Seok, et al, \"Towards Service and Networking Intelligence for Humanity: A Report on APNOMS 2020,\" Network and Systems Management, 29(4), p.1-11, 2021.</li> <li>Yi-Bing Lin, Chien-Chao Tseng, and Ming-Hung Wang, \"Effects of Transport Network Slicing on 5G Applications,\" Future Internet, 13(3), p.69, 2021.</li> <li>Tze-Jie Tan, et al., \"A Reliable Intelligent Routing Mechanism in 5G Core Network (5GC),\" Annual International Conference on Mobile Computing and Networking, 2020.</li> <li>Chia-Wei Liao, Fuchun Joseph Lin, and Yoichi Sato, \"Evaluating NFV-enabled Network Slicing for 5G Core,\" IEEE Asia-Pacific Network Operations and Management Symposium, 2020.</li> <li>Yin-Chi Li, Ping-Tsan Liu, Yi-An Tai, Che-Hung Liu, Man-Hsin Chen, Chi-Yu Li, and Guan-Hua Tu, \"A Runtime Anomaly Detector via Service Communication Proxy for 5G Mobile Networks,\" IEEE INFOCOM 2023</li> <li>Ho-Cheng Lee, Fuchun Joseph Lin, Jyh-Cheng Chen, Chien Chen, and Patrick Wang, \"Enhancing 5G Core with Multi-Access Edge Computing,\" 32nd Wireless and Optical Communications Conference (WOCC), 2023</li> <li>Yi Liu, Qiaoling Li, Qingping Cao, Zhilan Huang, Yangchun Li, Yongbing Fan, \"Evaluation of Free5GC Forwarding Performance on Private and Public Clouds\" 2022 IEEE Cloud Summit</li> <li>Muthuraman Elangovan, Muhammad Shahid Iqbal, Chien Chen, Jyh-Cheng Chen, \"Accelerating free5GC Data Plane Using Programmable Hardware\" 2023 24st Asia-Pacific Network Operations and Management Symposium (APNOMS) IEEE</li> </ol>"},{"location":"videos/","title":"Other Videos","text":""},{"location":"videos/#other-videos-showing-free5gc","title":"Other videos showing free5GC","text":"<ol> <li> <p>Akraino Blueprints: Integrated Cloud Native Private Wireless, The Linux Foundation, October 11, 2021</p> </li> <li> <p>SD Core Techinar July 7 2021, Open Networking Foundation, July 13, 2021</p> </li> <li> <p>Aarna Networks MWC 2021 Demo, Aarna Networks Channel, June 27, 2021</p> </li> <li> <p>OpenStack Tacker Demo, Open Infrastructure Foundation, April 26, 2021</p> </li> <li> <p>OpenNess Tungsten Fabric free5GC demo, Aarna Networks Channel, February 16, 2021</p> </li> <li> <p>5G Core on Diamanti, Diamanti, Inc., February 3, 2021</p> </li> <li> <p>free5GC (5G Core) Orchestration on Kubernetes with Tungsten Fabric CNI and Testing, Aarna Networks Channel, December 2, 2020</p> </li> <li> <p>IoT LoRa (sensors and gateway in hardware), RAN in hardware (SDR) and software, and the free5GC, LABORA Research Group, July 3, 2020</p> </li> <li> <p>UE and eNodeB in Hardware (conventional cell phone + SDR) and free5GC: a pratical approach in 5G, LABORA Research Group, July 3, 2020</p> </li> <li> <p>OpenAirInterface and free5GC: a pratical approach in 5G networks, LABORA Research Group, June 29, 2020</p> </li> </ol>"},{"location":"blog/","title":"Index","text":""},{"location":"blog/#blogs","title":"Blogs","text":""},{"location":"blog/#official","title":"Official","text":"<ul> <li>2024/01/19: Registration Procedures</li> <li>2024/01/10: PacketRusher: A new UE/gNB simulator and CP/UP load tester</li> <li>2024/01/03: UE-initiated PLR Measurement Procedure in PMFP Procedure</li> <li>2023/12/13: Article Sharing: Evaluating Dedicated Slices of Different Configurations in 5G Core</li> <li>2023/12/06: Introduction of IP Multimedia Subsystem Part 2</li> <li>2023/11/29: Basic concept of RCU: Read, Copy, Update</li> <li>2023/11/22: Nephio: a Cloud Native Network Automation Linux Foundation Project</li> <li>2023/11/15: free5GC OAuth2 Procedure</li> <li>2023/11/08: Introduction of IP Multimedia Subsystem Part 1</li> <li>2023/10/18: LTE Authentication Introduction: EPS-AKA'</li> <li>2023/10/4: Introduction of MPTCP</li> <li>2023/9/27: Support of Time Sensitive Communication and Time Synchronization in 5G system - Introduction (Rel-17)</li> <li>2023/9/20: Introduction of gtp5g and some kernel concepts</li> <li>2023/9/13: CHarging Function(CHF) Overview</li> <li>2023/9/6: The role of VNFD and NSD in 5G Network Slicing</li> <li>2023/8/30: Article Sharing: eBPF: A New Approach to Cloud-Native Observability, Networking and Security for Current (5G) and Future Mobile Networks (6G and Beyond)</li> <li>2023/8/23: Web security: CSRF vulnerability in webconsole</li> <li>2023/8/16: Introduce Kubernetes and Deployment free5GC on Kubernetes with helm</li> <li>2023/8/9: Fuzz Testing in Go: Discovering Vulnerabilities and Analyzing a Real Case (CVE-2022-43677)</li> <li>2023/8/2: Authentication Mechanism in NRF: What Is OAuth?</li> <li>2023/7/26: How to deploy free5GC network slice on OpenStack</li> <li>2023/7/19: Network function UDM introduction</li> <li>2023/7/12: Time-Sensitive Networking over 5G system - Introduction (Rel-16)</li> <li>2023/7/5: Use network namespace to separate the 5GC and RAN simulator</li> <li>2023/6/21: 5G SCTP LoadBalancer Using LoxiLB Applying on free5GC</li> </ul>"},{"location":"blog/#external","title":"External","text":"<ul> <li>free5GC 5GC &amp; UERANSIM UE / RAN Sample Configuration - VPP-UPF with DPDK</li> <li>Deploy eBPF-based UPF with free5GC</li> <li>Introduce to 5GC (written in traditional chinese)</li> <li>Deploying 5G core network with Free5GC, Kubernetes and Helm</li> <li>Running Free5GC on Platform9 Managed Kubernetes</li> </ul> <p>Note</p> <p>If you are interested in supporting free5GC, we welcome your donation. Please visit this link for more details.</p>"},{"location":"blog/20230705/1-free5gc-with-namespace/","title":"1 free5gc with namespace","text":""},{"location":"blog/20230705/1-free5gc-with-namespace/#use-network-namespace-to-separate-the-5g-core-5gc-and-ran-simulator","title":"Use network namespace to separate the 5G core (5GC) and RAN simulator","text":"<p>Note</p> <p>Author: Jimmy Chang Date: 2023/7/5</p>"},{"location":"blog/20230705/1-free5gc-with-namespace/#overview","title":"Overview","text":"<p>This technique leverages namespace to run UERANSIM, an opensource 5G-UE and RAN(gNodeB) simulator, and connect to free5GC.  UERANSIM follows the 3GPP specification for developing and can support multiple 5G core (5GC) including free5GC. </p> <p>Why are we using namespace? Well, you can follow ULCL and free5GC compose to set up the environment with VM and docker, but there are limitations for hardware\u2019s capability. With network namespace, you can have different and separate network instances of network  interfaces and routing tables that operate independently. </p> <p>So, what is network namespace? Network namespace makes a copy of network stack with its own routing table, firewall and devices. A named network namespace is an object at <code>/var/run/netns/</code>. The file descriptor resulting from opening <code>/var/run/netns/</code> refers to the specified network namespace. Holding that file descriptor open keeps the network namespace alive. </p> <p>And how to make both namespaces communicating? A virtual Ethernet device (veth) pair provides the abstraction that can be used to create tunnels between network namespaces, and can be used to create bridge to a physical network device in another namespace. Veth pair also be used as standalone network devices. When the namespace freed, veth device which attatch to would be destroyed.</p> <p>The environment is as follow. Suppose you have already installed as well as set up free5GC and UERANSIM properly.</p> <ul> <li>free5GC v3.3.0</li> <li>UERANSIM v3.1.0</li> </ul> <p>Note</p> <p>Namespace free5GC represents host network namespace. And enp0s5 is an ethernet interface connectting to external.</p> <p></p> <pre><code>Each devices as follow\n| Device        | IP             |\n| ------------- | -------------  |\n| veth0         | 10.200.200.1   |\n| veth1         | 10.200.200.2   |\n| br-veth0      | none           |\n| br-veth1      | none           |\n| enp0s5        | 10.211.55.23   |\n\n\nUE information in UERANSIM as follow. Already \n| IMSI             | DNN           |\n| ---------------- | ------------- |\n| 208930000000003  | internet      |\n</code></pre>"},{"location":"blog/20230705/1-free5gc-with-namespace/#configuration-file-of-free5gc-and-ueransim","title":"Configuration file of free5GC and UERANSIM","text":""},{"location":"blog/20230705/1-free5gc-with-namespace/#free5gc","title":"free5GC","text":"<ul> <li>free5gc/config/amfcfg.yaml</li> </ul> <p>Replace ngapIpList IP from <code>127.0.0.18</code> to <code>10.200.200.2</code>:</p> <p><pre><code>info:\n  version: 1.0.9\n  description: AMF initial local configuration\n\nconfiguration:\n  amfName: AMF # the name of this AMF\n  ngapIpList:  # the IP list of N2 interfaces on this AMF\n    - 10.200.200.2 # 127.0.0.18\n  ngapPort: 38412 # the SCTP port listened by NGAP\n  sbi: # Service-based interface information\n    scheme: http # the protocol for sbi (http or https)\n    registerIPv4: 127.0.0.18 # IP used to register to NRF\n    bindingIPv4: 127.0.0.18  # IP used to bind the service\n    port: 8000 # port used to bind the service\n    tls: # the local path of TLS key\n      pem: cert/amf.pem # AMF TLS Certificate\n      key: cert/amf.key # AMF TLS Private key\n  serviceNameList: # the SBI services provided by this AMF, refer to TS 29.518\n    - namf-comm # Namf_Communication service\n    - namf-evts # Namf_EventExposure service\n    - namf-mt   # Namf_MT service\n    - namf-loc  # Namf_Location service\n    - namf-oam  # OAM service\n  servedGuamiList: # Guami (Globally Unique AMF ID) list supported by this AMF\n    # &lt;GUAMI&gt; = &lt;MCC&gt;&lt;MNC&gt;&lt;AMF ID&gt;\n    - plmnId: # Public Land Mobile Network ID, &lt;PLMN ID&gt; = &lt;MCC&gt;&lt;MNC&gt;\n        mcc: 208 # Mobile Country Code (3 digits string, digit: 0~9)\n        mnc: 93 # Mobile Network Code (2 or 3 digits string, digit: 0~9)\n      amfId: cafe00 # AMF identifier (3 bytes hex string, range: 000000~FFFFFF)\n  supportTaiList:  # the TAI (Tracking Area Identifier) list supported by this AMF\n    - plmnId: # Public Land Mobile Network ID, &lt;PLMN ID&gt; = &lt;MCC&gt;&lt;MNC&gt;\n        mcc: 208 # Mobile Country Code (3 digits string, digit: 0~9)\n        mnc: 93 # Mobile Network Code (2 or 3 digits string, digit: 0~9)\n      tac: 000001 # Tracking Area Code (3 bytes hex string, range: 000000~FFFFFF)\n  plmnSupportList: # the PLMNs (Public land mobile network) list supported by this AMF\n    - plmnId: # Public Land Mobile Network ID, &lt;PLMN ID&gt; = &lt;MCC&gt;&lt;MNC&gt;\n        mcc: 208 # Mobile Country Code (3 digits string, digit: 0~9)\n        mnc: 93 # Mobile Network Code (2 or 3 digits string, digit: 0~9)\n      snssaiList: # the S-NSSAI (Single Network Slice Selection Assistance Information) list supported by this AMF\n        - sst: 1 # Slice/Service Type (uinteger, range: 0~255)\n          sd: 010203 # Slice Differentiator (3 bytes hex string, range: 000000~FFFFFF)\n        - sst: 1 # Slice/Service Type (uinteger, range: 0~255)\n          sd: 112233 # Slice Differentiator (3 bytes hex string, range: 000000~FFFFFF)\n  supportDnnList:  # the DNN (Data Network Name) list supported by this AMF\n    - internet\n  nrfUri: http://127.0.0.10:8000 # a valid URI of NRF\n  security:  # NAS security parameters\n    integrityOrder: # the priority of integrity algorithms\n      - NIA2\n      # - NIA0\n    cipheringOrder: # the priority of ciphering algorithms\n      - NEA0\n      # - NEA2\n  networkName:  # the name of this core network\n    full: free5GC\n    short: free\n  ngapIE: # Optional NGAP IEs\n    mobilityRestrictionList: # Mobility Restriction List IE, refer to TS 38.413\n      enable: true # append this IE in related message or not\n    maskedIMEISV: # Masked IMEISV IE, refer to TS 38.413\n      enable: true # append this IE in related message or not\n    redirectionVoiceFallback: # Redirection Voice Fallback IE, refer to TS 38.413\n      enable: false # append this IE in related message or not\n  nasIE: # Optional NAS IEs\n    networkFeatureSupport5GS: # 5gs Network Feature Support IE, refer to TS 24.501\n      enable: true # append this IE in Registration accept or not\n      length: 1 # IE content length (uinteger, range: 1~3)\n      imsVoPS: 0 # IMS voice over PS session indicator (uinteger, range: 0~1)\n      emc: 0 # Emergency service support indicator for 3GPP access (uinteger, range: 0~3)\n      emf: 0 # Emergency service fallback indicator for 3GPP access (uinteger, range: 0~3)\n      iwkN26: 0 # Interworking without N26 interface indicator (uinteger, range: 0~1)\n      mpsi: 0 # MPS indicator (uinteger, range: 0~1)\n      emcN3: 0 # Emergency service support indicator for Non-3GPP access (uinteger, range: 0~1)\n      mcsi: 0 # MCS indicator (uinteger, range: 0~1)\n  t3502Value: 720  # timer value (seconds) at UE side\n  t3512Value: 3600 # timer value (seconds) at UE side\n  non3gppDeregTimerValue: 3240 # timer value (seconds) at UE side\n  # retransmission timer for paging message\n  t3513:\n    enable: true     # true or false\n    expireTime: 6s   # default is 6 seconds\n    maxRetryTimes: 4 # the max number of retransmission\n  # retransmission timer for NAS Deregistration Request message\n  t3522:\n    enable: true     # true or false\n    expireTime: 6s   # default is 6 seconds\n    maxRetryTimes: 4 # the max number of retransmission\n  # retransmission timer for NAS Registration Accept message\n  t3550:\n    enable: true     # true or false\n    expireTime: 6s   # default is 6 seconds\n    maxRetryTimes: 4 # the max number of retransmission\n  # retransmission timer for NAS Authentication Request/Security Mode Command message\n  t3560:\n    enable: true     # true or false\n    expireTime: 6s   # default is 6 seconds\n    maxRetryTimes: 4 # the max number of retransmission\n  # retransmission timer for NAS Notification message\n  t3565:\n    enable: true     # true or false\n    expireTime: 6s   # default is 6 seconds\n    maxRetryTimes: 4 # the max number of retransmission\n  # retransmission timer for NAS Identity Request message\n  t3570:\n    enable: true     # true or false\n    expireTime: 6s   # default is 6 seconds\n    maxRetryTimes: 4 # the max number of retransmission\n  locality: area1 # Name of the location where a set of AMF, SMF, PCF and UPFs are located\n  sctp: # set the sctp server setting &lt;optinal&gt;, once this field is set, please also add maxInputStream, maxOsStream, maxAttempts, maxInitTimeOut\n    numOstreams: 3 # the maximum out streams of each sctp connection\n    maxInstreams: 5 # the maximum in streams of each sctp connection\n    maxAttempts: 2 # the maximum attempts of each sctp connection\n    maxInitTimeout: 2 # the maximum init timeout of each sctp connection\n  defaultUECtxReq: false # the default value of UE Context Request to decide when triggering Initial Context Setup procedure\n\nlogger: # log output setting\n  enable: true # true or false\n  level: info # how detailed to output, value: trace, debug, info, warn, error, fatal, panic\n  reportCaller: false # enable the caller report or not, value: true or false\n</code></pre> - free5gc/config/smfcfg.yaml</p> <p>Replace userplaneInformation / upNodes / UPF / interfaces / endpoints from <code>127.0.0.8</code> to <code>10.200.200.2</code>:</p> <p><pre><code>info:\n  version: 1.0.7\n  description: SMF initial local configuration\n\nconfiguration:\n  smfName: SMF # the name of this SMF\n  sbi: # Service-based interface information\n    scheme: http # the protocol for sbi (http or https)\n    registerIPv4: 127.0.0.2 # IP used to register to NRF\n    bindingIPv4: 127.0.0.2 # IP used to bind the service\n    port: 8000 # Port used to bind the service\n    tls: # the local path of TLS key\n      key: cert/smf.key # SMF TLS Certificate\n      pem: cert/smf.pem # SMF TLS Private key\n  serviceNameList: # the SBI services provided by this SMF, refer to TS 29.502\n    - nsmf-pdusession # Nsmf_PDUSession service\n    - nsmf-event-exposure # Nsmf_EventExposure service\n    - nsmf-oam # OAM service\n  snssaiInfos: # the S-NSSAI (Single Network Slice Selection Assistance Information) list supported by this AMF\n    - sNssai: # S-NSSAI (Single Network Slice Selection Assistance Information)\n        sst: 1 # Slice/Service Type (uinteger, range: 0~255)\n        sd: 010203 # Slice Differentiator (3 bytes hex string, range: 000000~FFFFFF)\n      dnnInfos: # DNN information list\n        - dnn: internet # Data Network Name\n          dns: # the IP address of DNS\n            ipv4: 8.8.8.8\n            ipv6: 2001:4860:4860::8888\n    - sNssai: # S-NSSAI (Single Network Slice Selection Assistance Information)\n        sst: 1 # Slice/Service Type (uinteger, range: 0~255)\n        sd: 112233 # Slice Differentiator (3 bytes hex string, range: 000000~FFFFFF)\n      dnnInfos: # DNN information list\n        - dnn: internet # Data Network Name\n          dns: # the IP address of DNS\n            ipv4: 8.8.8.8\n            ipv6: 2001:4860:4860::8888\n  plmnList: # the list of PLMN IDs that this SMF belongs to (optional, remove this key when unnecessary)\n    - mcc: 208 # Mobile Country Code (3 digits string, digit: 0~9)\n      mnc: 93 # Mobile Network Code (2 or 3 digits string, digit: 0~9)\n  locality: area1 # Name of the location where a set of AMF, SMF, PCF and UPFs are located\n  pfcp: # the IP address of N4 interface on this SMF (PFCP)\n    # addr config is deprecated in smf config v1.0.3, please use the following config\n    nodeID: 127.0.0.1 # the Node ID of this SMF\n    listenAddr: 127.0.0.1 # the IP/FQDN of N4 interface on this SMF (PFCP)\n    externalAddr: 127.0.0.1 # the IP/FQDN of N4 interface on this SMF (PFCP)\n  userplaneInformation: # list of userplane information\n    upNodes: # information of userplane node (AN or UPF)\n      gNB1: # the name of the node\n        type: AN # the type of the node (AN or UPF)\n      UPF: # the name of the node\n        type: UPF # the type of the node (AN or UPF)\n        nodeID: 127.0.0.8 # the Node ID of this UPF\n        addr: 127.0.0.8 # the IP/FQDN of N4 interface on this UPF (PFCP)\n        sNssaiUpfInfos: # S-NSSAI information list for this UPF\n          - sNssai: # S-NSSAI (Single Network Slice Selection Assistance Information)\n              sst: 1 # Slice/Service Type (uinteger, range: 0~255)\n              sd: 010203 # Slice Differentiator (3 bytes hex string, range: 000000~FFFFFF)\n            dnnUpfInfoList: # DNN information list for this S-NSSAI\n              - dnn: internet\n                pools:\n                  - cidr: 10.60.0.0/16\n                staticPools:\n                  - cidr: 10.60.100.0/24\n          - sNssai: # S-NSSAI (Single Network Slice Selection Assistance Information)\n              sst: 1 # Slice/Service Type (uinteger, range: 0~255)\n              sd: 112233 # Slice Differentiator (3 bytes hex string, range: 000000~FFFFFF)\n            dnnUpfInfoList: # DNN information list for this S-NSSAI\n              - dnn: internet\n                pools:\n                  - cidr: 10.61.0.0/16\n                staticPools:\n                  - cidr: 10.61.100.0/24\n        interfaces: # Interface list for this UPF\n          - interfaceType: N3 # the type of the interface (N3 or N9)\n            endpoints: # the IP address of this N3/N9 interface on this UPF\n              - 10.200.200.2 # 127.0.0.8\n            networkInstances:  # Data Network Name (DNN)\n              - internet\n    links: # the topology graph of userplane, A and B represent the two nodes of each link\n      - A: gNB1\n        B: UPF\n  # retransmission timer for pdu session modification command\n  t3591:\n    enable: true     # true or false\n    expireTime: 16s   # default is 6 seconds\n    maxRetryTimes: 3 # the max number of retransmission\n  # retransmission timer for pdu session release command\n  t3592:\n    enable: true     # true or false\n    expireTime: 16s   # default is 6 seconds\n    maxRetryTimes: 3 # the max number of retransmission\n  nrfUri: http://127.0.0.10:8000 # a valid URI of NRF\n  #urrPeriod: 10 # default usage report period in seconds\n  #urrThreshold: 1000 # default usage report threshold in bytes\n\nlogger: # log output setting\n  enable: true # true or false\n  level: info # how detailed to output, value: trace, debug, info, warn, error, fatal, panic\n  reportCaller: false # enable the caller report or not, value: true or false\n</code></pre> - free5gc/config/upfcfg.yaml</p> <p>Replace gtpu from <code>127.0.0.8</code>to <code>10.200.200.2</code>:</p> <pre><code>version: 1.0.3\ndescription: UPF initial local configuration\n\n# The listen IP and nodeID of the N4 interface on this UPF (Can't set to 0.0.0.0)\npfcp:\n  addr: 127.0.0.8   # IP addr for listening\n  nodeID: 127.0.0.8 # External IP or FQDN can be reached\n  retransTimeout: 1s # retransmission timeout\n  maxRetrans: 3 # the max number of retransmission\n\ngtpu:\n  forwarder: gtp5g\n  # The IP list of the N3/N9 interfaces on this UPF\n  # If there are multiple connection, set addr to 0.0.0.0 or list all the addresses\n  ifList:\n    - addr: 10.200.200.2 # 127.0.0.8\n      type: N3\n      # name: upf.5gc.nctu.me\n      # ifname: gtpif\n      # mtu: 1400\n\n# The DNN list supported by UPF\ndnnList:\n  - dnn: internet # Data Network Name\n    cidr: 10.60.0.0/24 # Classless Inter-Domain Routing for assigned IPv4 pool of UE\n    # natifname: eth0\n\nlogger: # log output setting\n  enable: true # true or false\n  level: info # how detailed to output, value: trace, debug, info, warn, error, fatal, panic\n  reportCaller: false # enable the caller report or not, value: true or false\n</code></pre>"},{"location":"blog/20230705/1-free5gc-with-namespace/#ueransim","title":"UERANSIM","text":"<ul> <li> <p>UERANSIM/config/free5gc-gnb.yaml</p> </li> <li> <p>Replace ngapIp from <code>127.0.0.1</code>to <code>10.200.200.1</code></p> </li> <li> <p>Replace gtpIp from <code>127.0.0.1</code>to <code>10.200.200.1</code></p> </li> <li> <p>Replace amfConfigs / address from <code>127.0.0.1</code>to <code>10.200.200.2</code></p> </li> </ul> <p><pre><code>mcc: '208'          # Mobile Country Code value\nmnc: '93'           # Mobile Network Code value (2 or 3 digits)\n\nnci: '0x000000010'  # NR Cell Identity (36-bit)\nidLength: 32        # NR gNB ID length in bits [22...32]\ntac: 1              # Tracking Area Code\n\nlinkIp: 127.0.0.1   # gNB's local IP address for Radio Link Simulation (Usually same with local IP)\nngapIp: 10.200.200.1 # 127.0.0.1   # gNB's local IP address for N2 Interface (Usually same with local IP)\ngtpIp: 10.200.200.1 # 127.0.0.1    # gNB's local IP address for N3 Interface (Usually same with local IP)\n\n# List of AMF address information\namfConfigs:\n  - address: 10.200.200.2 # 127.0.0.1\n    port: 38412\n\n# List of supported S-NSSAIs by this gNB\nslices:\n  - sst: 0x1\n    sd: 0x010203\n\n# Indicates whether or not SCTP stream number errors should be ignored.\nignoreStreamIds: true\n</code></pre> - UERANSIM/config/free5gc-ue.yaml <pre><code># IMSI number of the UE. IMSI = [MCC|MNC|MSISDN] (In total 15 or 16 digits)\nsupi: 'imsi-208930000000003'\n# Mobile Country Code value\nmcc: '208'\n# Mobile Network Code value (2 or 3 digits)\nmnc: '93'\n\n# Permanent subscription key\nkey: '8baf473f2f8fd09487cccbd7097c6862'\n# Operator code (OP or OPC) of the UE\nop: '8e27b6af0e692e750f32667a3b14605d'\n# This value specifies the OP type and it can be either 'OP' or 'OPC'\nopType: 'OP'\n# Authentication Management Field (AMF) value\namf: '8000'\n# IMEI number of the device. It is used if no SUPI is provided\nimei: '356938035643803'\n# IMEISV number of the device. It is used if no SUPI and IMEI is provided\nimeiSv: '4370816125816151'\n\n# List of gNB IP addresses for Radio Link Simulation\ngnbSearchList:\n  - 127.0.0.1\n\n# Initial PDU sessions to be established\nsessions:\n  - type: 'IPv4'\n    apn: 'internet'\n    slice:\n      sst: 0x01\n      sd: 0x010203\n\n# List of requested S-NSSAIs by this UE\nslices:\n  - sst: 0x01\n    sd: 0x010203\n\n# Supported encryption and integrity algorithms by this UE\nintegrity:\n  IA1: true\n  IA2: true\n  IA3: true\nciphering:\n  EA1: true\n  EA2: true\n  EA3: true\n</code></pre></p>"},{"location":"blog/20230705/1-free5gc-with-namespace/#environment-set-up-of-free5gc-and-ueransim","title":"Environment set up of free5GC and UERANSIM","text":"<p>First, create a namespace:</p> <p>Note</p> <p>Assume that you are either running as root, or it behoves you to prepend <code>sudo</code> to commands as necessary.</p> <p><pre><code>ip netns add ueransim\n</code></pre> Next, add the bridge: <pre><code>ip link add free5gc-br type bridge\n</code></pre> Add two pairs of veth: <pre><code>ip link add veth0 type veth peer name br-veth0\nip link add veth1 type veth peer name br-veth1\n</code></pre> Now, it could be like: <pre><code>root@free5gc:~# ip a\n1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet 127.0.0.1/8 scope host lo\n       valid_lft forever preferred_lft forever\n    inet6 ::1/128 scope host\n       valid_lft forever preferred_lft forever\n2: enp0s5: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000\n    link/ether 00:1c:42:b1:ba:f4 brd ff:ff:ff:ff:ff:ff\n    inet 10.211.55.23/24 brd 10.211.55.255 scope global dynamic enp0s5\n       valid_lft 1714sec preferred_lft 1714sec\n    inet6 fdb2:2c26:f4e4:0:21c:42ff:feb1:baf4/64 scope global dynamic mngtmpaddr noprefixroute\n       valid_lft 2591750sec preferred_lft 604550sec\n    inet6 fe80::21c:42ff:feb1:baf4/64 scope link\n       valid_lft forever preferred_lft forever\n3: enp0s6: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000\n    link/ether 00:1c:42:f1:11:c6 brd ff:ff:ff:ff:ff:ff\n    inet 10.37.129.20/24 brd 10.37.129.255 scope global enp0s6\n       valid_lft forever preferred_lft forever\n    inet6 fdb2:2c26:f4e4:1:21c:42ff:fef1:11c6/64 scope global dynamic mngtmpaddr noprefixroute\n       valid_lft 2591750sec preferred_lft 604550sec\n    inet6 fe80::21c:42ff:fef1:11c6/64 scope link\n       valid_lft forever preferred_lft forever\n4: free5gc-br: &lt;BROADCAST,MULTICAST&gt; mtu 1500 qdisc noop state DOWN group default qlen 1000\n    link/ether 4e:f6:d7:9c:50:de brd ff:ff:ff:ff:ff:ff\n5: br-veth0@veth0: &lt;BROADCAST,MULTICAST,M-DOWN&gt; mtu 1500 qdisc noop state DOWN group default qlen 1000\n    link/ether c2:31:0c:5f:45:81 brd ff:ff:ff:ff:ff:ff\n6: veth0@br-veth0: &lt;BROADCAST,MULTICAST,M-DOWN&gt; mtu 1500 qdisc noop state DOWN group default qlen 1000\n    link/ether 4a:0f:1e:80:9b:be brd ff:ff:ff:ff:ff:ff\n7: br-veth1@veth1: &lt;BROADCAST,MULTICAST,M-DOWN&gt; mtu 1500 qdisc noop state DOWN group default qlen 1000\n    link/ether 56:99:b0:82:78:0d brd ff:ff:ff:ff:ff:ff\n8: veth1@br-veth1: &lt;BROADCAST,MULTICAST,M-DOWN&gt; mtu 1500 qdisc noop state DOWN group default qlen 1000\n    link/ether 12:5a:56:00:5b:be brd ff:ff:ff:ff:ff:ff\n</code></pre></p> <p>Next, assign interface to namespace: <pre><code>ip link set dev veth0 netns ueransim\n</code></pre> Set ip address: <pre><code>ip netns exec ueransim ip a add 10.200.200.1/24 dev veth0\n</code></pre> Enable both interface. Don't forget lo: <pre><code>ip netns exec ueransim ip link set lo up\nip netns exec ueransim ip link set veth0 up\n</code></pre> Check with <code>ip a</code>: <pre><code>root@free5gc:~# ip netns exec ueransim ip a\n1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet 127.0.0.1/8 scope host lo\n       valid_lft forever preferred_lft forever\n    inet6 ::1/128 scope host\n       valid_lft forever preferred_lft forever\n6: veth0@if5: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue state LOWERLAYERDOWN group default qlen 1000\n    link/ether 4a:0f:1e:80:9b:be brd ff:ff:ff:ff:ff:ff link-netnsid 0\n    inet 10.200.200.1/24 scope global veth0\n       valid_lft forever preferred_lft forever\n</code></pre> Set for veth1 as well: <pre><code>ip a add 10.200.200.2/24 dev veth1\nip link set veth1 up\n</code></pre> Let two interfaces attatch to bridge: <pre><code>ip link set dev br-veth0 master free5gc-br\nip link set dev br-veth1 master free5gc-br\nip link set br-veth0 up\nip link set br-veth1 up\nip link set free5gc-br up\n</code></pre> Using <code>bridge link</code> to check: <pre><code>root@free5gc:~# bridge link\n5: br-veth0@if6: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 master free5gc-br state forwarding priority 32 cost 2\n7: br-veth1@veth1: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 master free5gc-br state forwarding priority 32 cost 2\n</code></pre> Now it looks like: <pre><code>1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet 127.0.0.1/8 scope host lo\n       valid_lft forever preferred_lft forever\n    inet6 ::1/128 scope host\n       valid_lft forever preferred_lft forever\n2: enp0s5: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000\n    link/ether 00:1c:42:b1:ba:f4 brd ff:ff:ff:ff:ff:ff\n    inet 10.211.55.23/24 brd 10.211.55.255 scope global dynamic enp0s5\n       valid_lft 1000sec preferred_lft 1000sec\n    inet6 fdb2:2c26:f4e4:0:21c:42ff:feb1:baf4/64 scope global dynamic mngtmpaddr noprefixroute\n       valid_lft 2591870sec preferred_lft 604670sec\n    inet6 fe80::21c:42ff:feb1:baf4/64 scope link\n       valid_lft forever preferred_lft forever\n3: enp0s6: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000\n    link/ether 00:1c:42:f1:11:c6 brd ff:ff:ff:ff:ff:ff\n    inet 10.37.129.20/24 brd 10.37.129.255 scope global enp0s6\n       valid_lft forever preferred_lft forever\n    inet6 fdb2:2c26:f4e4:1:21c:42ff:fef1:11c6/64 scope global dynamic mngtmpaddr noprefixroute\n       valid_lft 2591870sec preferred_lft 604670sec\n    inet6 fe80::21c:42ff:fef1:11c6/64 scope link\n       valid_lft forever preferred_lft forever\n4: free5gc-br: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default qlen 1000\n    link/ether 56:99:b0:82:78:0d brd ff:ff:ff:ff:ff:ff\n    inet6 fe80::5499:b0ff:fe82:780d/64 scope link\n       valid_lft forever preferred_lft forever\n5: br-veth0@if6: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master free5gc-br state UP group default qlen 1000\n    link/ether c2:31:0c:5f:45:81 brd ff:ff:ff:ff:ff:ff link-netns ueransim\n    inet6 fe80::c031:cff:fe5f:4581/64 scope link\n       valid_lft forever preferred_lft forever\n7: br-veth1@veth1: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master free5gc-br state UP group default qlen 1000\n    link/ether 56:99:b0:82:78:0d brd ff:ff:ff:ff:ff:ff\n    inet6 fe80::5499:b0ff:fe82:780d/64 scope link\n       valid_lft forever preferred_lft forever\n8: veth1@br-veth1: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default qlen 1000\n    link/ether 12:5a:56:00:5b:be brd ff:ff:ff:ff:ff:ff\n    inet 10.200.200.2/24 scope global veth1\n       valid_lft forever preferred_lft forever\n    inet6 fe80::105a:56ff:fe00:5bbe/64 scope link\n       valid_lft forever preferred_lft forever\n</code></pre> Let's test it:</p> <p>Note</p> <p>You can perform <code>ip netns exec ueransim /bin/bash --rcfile &lt;(echo \"PS1=\\\"ueransim&gt; \\\"\")</code> to enter namespace and modify shell prefix.</p> <p><pre><code>root@free5gc:~# ip netns exec ueransim /bin/bash --rcfile &lt;(echo \"PS1=\\\"ueransim&gt; \\\"\")\nueransim&gt; ping -c2 10.200.200.2\nPING 10.200.200.2 (10.200.200.2) 56(84) bytes of data.\n64 bytes from 10.200.200.2: icmp_seq=1 ttl=64 time=0.089 ms\n64 bytes from 10.200.200.2: icmp_seq=2 ttl=64 time=0.226 ms\n\n--- 10.200.200.2 ping statistics ---\n2 packets transmitted, 2 received, 0% packet loss, time 1020ms\nrtt min/avg/max/mdev = 0.089/0.157/0.226/0.068 ms\n</code></pre> Insert default routing rule: <pre><code>ueransim&gt; ip route add default via 10.200.200.2\nueransim&gt; netstat -rn\nKernel IP routing table\nDestination     Gateway         Genmask         Flags   MSS Window  irtt Iface\n0.0.0.0         10.200.200.2    0.0.0.0         UG        0 0          0 veth0\n10.200.200.0    0.0.0.0         255.255.255.0   U         0 0          0 veth0\n</code></pre> Try to ping 8.8.8.8: <pre><code>ueransim&gt; ping -c2 8.8.8.8\nPING 8.8.8.8 (8.8.8.8) 56(84) bytes of data.\n\n--- 8.8.8.8 ping statistics ---\n2 packets transmitted, 0 received, 100% packet loss, time 1028ms\n</code></pre> It is because the main host must translate the source addresses. Besides, the main host need to forward packet: <pre><code>root@free5gc:~# iptables -t nat -A POSTROUTING -o enp0s5 -j MASQUERADE\nroot@free5gc:~# sysctl -w net.ipv4.ip_forward=1\nroot@free5gc:~# sudo iptables -I FORWARD 1 -j ACCEPT\n</code></pre> And then: <pre><code>ueransim&gt; ping -c2 8.8.8.8\nPING 8.8.8.8 (8.8.8.8) 56(84) bytes of data.\n64 bytes from 8.8.8.8: icmp_seq=1 ttl=127 time=13.9 ms\n64 bytes from 8.8.8.8: icmp_seq=2 ttl=127 time=28.0 ms\n\n--- 8.8.8.8 ping statistics ---\n2 packets transmitted, 2 received, 0% packet loss, time 1002ms\nrtt min/avg/max/mdev = 13.866/20.939/28.012/7.073 ms\n</code></pre></p> <p>After free5GC execute <code>run.sh</code>, it's time for UERANSIM:</p> <p>In terminal 1: <pre><code>ueransim&gt; build/nr-gnb -c config/free5gc-gnb.yaml\nUERANSIM v3.1.0\n[2023-07-05 19:58:26.368] [sctp] [info] Trying to establish SCTP connection... (10.200.200.2:38412)\n[2023-07-05 19:58:26.373] [sctp] [info] SCTP connection established (10.200.200.2:38412)\n[2023-07-05 19:58:26.374] [sctp] [debug] SCTP association setup ascId[3]\n[2023-07-05 19:58:26.375] [ngap] [debug] Sending NG Setup Request\n[2023-07-05 19:58:26.380] [ngap] [debug] NG Setup Response received\n[2023-07-05 19:58:26.380] [ngap] [info] NG Setup procedure is successful\n[2023-07-05 19:58:35.804] [mr] [info] New UE connected to gNB. Total number of UEs is now: 1\n[2023-07-05 19:58:35.806] [rrc] [debug] Sending RRC Setup for UE[3]\n[2023-07-05 19:58:35.807] [ngap] [debug] Initial NAS message received from UE 3\n[2023-07-05 19:58:35.869] [ngap] [debug] Initial Context Setup Request received\n[2023-07-05 19:58:36.108] [ngap] [info] PDU session resource is established for UE[3] count[1]\n</code></pre> In terminal 2: <pre><code>ueransim&gt; sudo build/nr-ue -c config/free5gc-ue.yaml\nUERANSIM v3.1.0\n[2023-07-05 19:58:35.803] [nas] [debug] NAS layer started\n[2023-07-05 19:58:35.803] [rrc] [debug] RRC layer started\n[2023-07-05 19:58:35.804] [nas] [info] UE switches to state: MM-DEREGISTERED/PLMN-SEARCH\n[2023-07-05 19:58:35.804] [nas] [info] UE connected to gNB\n[2023-07-05 19:58:35.804] [nas] [info] UE switches to state: MM-DEREGISTERED/NORMAL-SERVICE\n[2023-07-05 19:58:35.804] [nas] [info] UE switches to state: MM-REGISTERED-INITIATED/NA\n[2023-07-05 19:58:35.805] [rrc] [debug] Sending RRC Setup Request\n[2023-07-05 19:58:35.806] [rrc] [info] RRC connection established\n[2023-07-05 19:58:35.806] [nas] [info] UE switches to state: CM-CONNECTED\n[2023-07-05 19:58:35.838] [nas] [debug] Received rand[61262F32A617D0BAD716603B1CBDA477] autn[44778026F4238000FC14B59D68855328]\n[2023-07-05 19:58:35.838] [nas] [debug] Calculated res[47759045F5ACEA59] ck[1C559301F29EF49572F5D150B3B99288] ik[D223317F752F233CE4C7AA253644D882] ak[528433D1FBE6] mac_a[FC14B59D68855328]\n[2023-07-05 19:58:35.838] [nas] [debug] Used snn[5G:mnc093.mcc208.3gppnetwork.org] sqn[16F3B3F70FC5]\n[2023-07-05 19:58:35.838] [nas] [debug] Derived kSeaf[7FC8B7FB1B141B6579B9C0FAEB9CCF1312FE9F9634868E234756DE49FD67C5F1] kAusf[FA0402A892E6046D52F4DECACA40B2A75B698FCEAD5EB320139FC69B77BD4C46] kAmf[3D4AD68E153B9642ACBECC67AD399015F7CB578F9DF4C88A35EED99C72C9B95B]\n[2023-07-05 19:58:35.843] [nas] [debug] Derived kNasEnc[1F829EB2BA238DD0226C3484E6A79D1F] kNasInt[251C0412B1BAD88A9DD0008F32D6F216]\n[2023-07-05 19:58:35.843] [nas] [debug] Selected integrity[2] ciphering[0]\n[2023-07-05 19:58:35.869] [nas] [debug] T3512 started with int[3600]\n[2023-07-05 19:58:35.869] [nas] [info] UE switches to state: MM-REGISTERED/NORMAL-SERVICE\n[2023-07-05 19:58:35.869] [nas] [info] Initial Registration is successful\n[2023-07-05 19:58:35.869] [nas] [info] Initial PDU sessions are establishing [1#]\n[2023-07-05 19:58:35.869] [nas] [debug] Sending PDU session establishment request\n[2023-07-05 19:58:36.108] [nas] [info] PDU Session establishment is successful PSI[1]\n[2023-07-05 19:58:36.113] [app] [info] Connection setup for PDU session[1] is successful, TUN interface[uesimtun0, 10.60.0.1] is up.\n</code></pre> In terminal 3: <pre><code>ueransim&gt; ip a\n1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet 127.0.0.1/8 scope host lo\n       valid_lft forever preferred_lft forever\n    inet6 ::1/128 scope host\n       valid_lft forever preferred_lft forever\n2: uesimtun0: &lt;POINTOPOINT,MULTICAST,NOARP,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UNKNOWN group default qlen 500\n    link/none\n    inet 10.60.0.1/32 scope global uesimtun0\n       valid_lft forever preferred_lft forever\n    inet6 fe80::b5ef:5b4:e3f6:af64/64 scope link stable-privacy\n       valid_lft forever preferred_lft forever\n6: veth0@if5: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default qlen 1000\n    link/ether 4a:0f:1e:80:9b:be brd ff:ff:ff:ff:ff:ff link-netnsid 0\n    inet 10.200.200.1/24 scope global veth0\n       valid_lft forever preferred_lft forever\n    inet6 fe80::480f:1eff:fe80:9bbe/64 scope link\n       valid_lft forever preferred_lft forever\nueransim&gt; ping -c2 -I uesimtun0 8.8.8.8\nPING 8.8.8.8 (8.8.8.8) from 10.60.0.1 uesimtun0: 56(84) bytes of data.\n64 bytes from 8.8.8.8: icmp_seq=1 ttl=127 time=19.5 ms\n64 bytes from 8.8.8.8: icmp_seq=2 ttl=127 time=33.2 ms\n\n--- 8.8.8.8 ping statistics ---\n2 packets transmitted, 2 received, 0% packet loss, time 1006ms\nrtt min/avg/max/mdev = 19.478/26.348/33.219/6.870 ms\n</code></pre> Also ping to google.com: <pre><code>ueransim&gt; ping -c2 -I uesimtun0 google.com\nPING google.com (172.217.160.110) from 10.60.0.1 uesimtun0: 56(84) bytes of data.\n64 bytes from tsa03s06-in-f14.1e100.net (172.217.160.110): icmp_seq=1 ttl=127 time=17.3 ms\n64 bytes from tsa03s06-in-f14.1e100.net (172.217.160.110): icmp_seq=2 ttl=127 time=29.5 ms\n\n--- google.com ping statistics ---\n2 packets transmitted, 2 received, 0% packet loss, time 1005ms\nrtt min/avg/max/mdev = 17.295/23.385/29.476/6.090 ms\n</code></pre></p>"},{"location":"blog/20230705/1-free5gc-with-namespace/#what-if-two-ueransims-with-two-namespaces","title":"What if two UERANSIMs with two namespaces?","text":"<p>Same as before, you should create another namespace for UERANSIM, called it ueransim2: <pre><code>root@free5gc:~# ip netns ls\nueransim2 (id: 1)\nueransim (id: 0)\n</code></pre> And then: <pre><code>ip link add veth2 type veth peer name br-veth2\nip link set dev veth2 netns ueransim2\nip link set br-veth2 master free5gc-br\nip link set br-veth2 up\nip netns exec ueransim2 ip a add 10.200.200.3/24 dev veth2\nip netns exec ueransim2 ip link set lo up\nip netns exec ueransim2 ip link set veth2 up\nip netns exec ueransim2 ip route add default via 10.200.200.2\n</code></pre></p> <p>Copy UERANSIM/config/free5gc-gnb.yaml and UERANSIM/config/free5gc-ue.yaml to free5gc-gnb2.yaml and free5gc-ue2.yaml, modify:</p> <p>free5gc-gnb2.yaml</p> <ul> <li>Replace ngapIp from <code>127.0.0.1</code> to <code>10.200.200.3</code></li> <li>Replace gtpIp from <code>127.0.0.1</code> to <code>10.200.200.3</code></li> </ul> <p><pre><code>...\nngapIp: 10.200.200.3 # 127.0.0.1   # gNB's local IP address for N2 Interface (Usually same with local IP)\ngtpIp: 10.200.200.3 # 127.0.0.1    # gNB's local IP address for N3 Interface (Usually same with local IP)\n\n# List of AMF address information\namfConfigs:\n  - address: 10.200.200.2 # 127.0.0.1\n    port: 38412\n...\n</code></pre> free5gc-ue2.yaml</p> <p><code>supi</code> change to <code>imsi-208930000000004</code></p> <pre><code>...\n# IMSI number of the UE. IMSI = [MCC|MNC|MSISDN] (In total 15 or 16 digits)\nsupi: 'imsi-208930000000004'\n...\n</code></pre> <p>Note</p> <p>Should register ue to webconsole first.</p> <p>The result: <pre><code>ueransim&gt; ip a\n1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet 127.0.0.1/8 scope host lo\n       valid_lft forever preferred_lft forever\n    inet6 ::1/128 scope host\n       valid_lft forever preferred_lft forever\n6: veth0@if5: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default qlen 1000\n    link/ether 4a:0f:1e:80:9b:be brd ff:ff:ff:ff:ff:ff link-netnsid 0\n    inet 10.200.200.1/24 scope global veth0\n       valid_lft forever preferred_lft forever\n    inet6 fe80::480f:1eff:fe80:9bbe/64 scope link\n       valid_lft forever preferred_lft forever\n7: uesimtun0: &lt;POINTOPOINT,MULTICAST,NOARP,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UNKNOWN group default qlen 500\n    link/none\n    inet 10.60.0.1/32 scope global uesimtun0\n       valid_lft forever preferred_lft forever\n    inet6 fe80::f6d7:dd81:fe7f:496a/64 scope link stable-privacy\n       valid_lft forever preferred_lft forever\nueransim&gt; ping -c2 -I uesimtun0 google.com\nPING google.com (172.217.160.110) from 10.60.0.1 uesimtun0: 56(84) bytes of data.\n64 bytes from tsa03s06-in-f14.1e100.net (172.217.160.110): icmp_seq=1 ttl=127 time=17.2 ms\n64 bytes from tsa03s06-in-f14.1e100.net (172.217.160.110): icmp_seq=2 ttl=127 time=28.5 ms\n\n--- google.com ping statistics ---\n2 packets transmitted, 2 received, 0% packet loss, time 1003ms\nrtt min/avg/max/mdev = 17.200/22.863/28.527/5.663 ms\n</code></pre></p> <pre><code>ueransim2&gt; ip a\n1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet 127.0.0.1/8 scope host lo\n       valid_lft forever preferred_lft forever\n    inet6 ::1/128 scope host \n       valid_lft forever preferred_lft forever\n5: uesimtun0: &lt;POINTOPOINT,MULTICAST,NOARP,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UNKNOWN group default qlen 500\n    link/none \n    inet 10.60.0.2/32 scope global uesimtun0\n       valid_lft forever preferred_lft forever\n    inet6 fe80::16a4:523a:a86:bf83/64 scope link stable-privacy \n       valid_lft forever preferred_lft forever\n12: veth2@if11: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default qlen 1000\n    link/ether fa:12:bb:9c:fa:40 brd ff:ff:ff:ff:ff:ff link-netnsid 0\n    inet 10.200.200.3/24 scope global veth2\n       valid_lft forever preferred_lft forever\n    inet6 fe80::f812:bbff:fe9c:fa40/64 scope link \n       valid_lft forever preferred_lft forever\nueransim2&gt; ping -c2 -I uesimtun0 google.com\nPING google.com (172.217.160.110) from 10.60.0.2 uesimtun0: 56(84) bytes of data.\n64 bytes from tsa03s06-in-f14.1e100.net (172.217.160.110): icmp_seq=1 ttl=127 time=18.9 ms\n64 bytes from tsa03s06-in-f14.1e100.net (172.217.160.110): icmp_seq=2 ttl=127 time=15.8 ms\n\n--- google.com ping statistics ---\n2 packets transmitted, 2 received, 0% packet loss, time 1002ms\nrtt min/avg/max/mdev = 15.786/17.353/18.921/1.567 ms\n</code></pre>"},{"location":"blog/20230705/1-free5gc-with-namespace/#about","title":"About","text":"<p>Hi, my name is Jimmy Chang. The current research topic is 5G LAN with a focus on the 5G Data Plane. Any questions or errors in the article are welcome for correction. Please feel free to send an email to provide feedback.</p> <ul> <li>Graduate student major in 5GC Research</li> <li>LinkedIn</li> </ul>"},{"location":"blog/20230705/1-free5gc-with-namespace/#reference","title":"Reference","text":"<ul> <li>https://github.com/s5uishida/free5gc_ueransim_ulcl_sample_config</li> <li>https://github.com/free5gc/free5gc/blob/main/test_ulcl.sh</li> <li>https://blog.scottlowe.org/2013/09/04/introducing-linux-network-namespaces/</li> <li>https://man7.org/linux/man-pages/man7/namespaces.7.html</li> <li>https://linux.die.net/man/8/iptables</li> </ul> <p>Note</p> <p>If you are interested in supporting free5GC, we welcome your donation. Please visit this link for more details.</p>"},{"location":"blog/20230712/TSN/","title":"Time-Sensitive Networking over 5G system - Introduction (Rel-16)","text":"<p>Note</p> <p>Author: Ya-shih Tseng Date: 2023/7/12</p> <p>This blog focuses on the role of the 5G system in 3GPP Release 16 TSN (Time-Sensitive Networking).</p>"},{"location":"blog/20230712/TSN/#what-is-time-sensitive-network-tsn","title":"What is Time-Sensitive Network (TSN)","text":"<p>Traditional Ethernet technology can only achieve \"best-effort\" communication and cannot meet the high reliability and low latency requirements of industrial manufacturing applications. Therefore, in the context of industrial automation, there is a need to upgrade the traditional \"best-effort\" Ethernet to provide \"deterministic\" services.</p> <p>Time Sensitive Networking (TSN) brings determinism and real-time communication to standard Ethernet through mechanisms and protocols defined by the IEEE 802.1 standard, which is used by Audio Video Bridging (AVB) and TSN. It offers reliable message delivery, minimized jitter, and guaranteed delivery through central management, time scheduling, and other key features. The introduction of TSN technology holds great potential and benefits for real-time applications in industrial control, automation, and other fields. </p> <p>TSN_OSI_layer</p>"},{"location":"blog/20230712/TSN/#tsn-standard","title":"TSN Standard","text":"<p>There are a lot of standards that TSN task group has completed or ongoing projects. Here are some base standards.</p> Standard Title IEEE 1588 V2 Precision Clock Synchronization Protocol for Networked Measurement and Control Systems IEEE 802.1Q-2022 Bridges and Bridged Networks IEEE 802.1AB-2016 Station and Media Access Control Connectivity Discovery (specifies the Link Layer Discovery Protocol (LLDP)) IEEE 802.1AS-2020 Timing and Synchronization for Time-Sensitive Applications IEEE 802.1AX-2020 Link Aggregation IEEE 802.1CB-2017 Frame Replication and Elimination for Reliability IEEE 802.1CS-2020 Link-local Registration Protocol"},{"location":"blog/20230712/TSN/#the-role-of-5g-system-in-tsn","title":"The role of 5G system in TSN","text":"<p>With the increasing demands for wireless control in applications such as industrial automation, remote surgical operations, smart grid distribution automation, transportation safety, autonomous driving, and more, there is a growing need to meet the low-latency requirements of these applications while achieving management, scheduling, and traffic planning. Time synchronization becomes a critical aspect. The following will explain how the interaction between TSN and 5G systems enables time synchronization.</p>"},{"location":"blog/20230712/TSN/#time-synchronization","title":"Time Synchronization","text":"<p>To achieve time synchronization between TSN and 5G systems, TSN utilizes the time synchronization method defined in IEEE 802.1AS, which is the generalized Precision Time Protocol (gPTP). gPTP supports time synchronization for Time-aware end stations and Time-aware Bridges in Layer 2.  In the 3GPP TS23.501 release 16 specification, the 5G system plays the role of a \"Time-aware system\" as defined in IEEE 802.1AS and is designated as a Logical bridge, connecting TSN system end stations.</p> <p>Note</p> <p>gPTP is an extended version of PTP (Precision Time Protocol) that primarily expands support for second-layer network devices.</p> <p>How can we synchronize the time of two end stations into the same time domain?</p> <p>First, the time synchronization architecture includes Master clocks and Slave clocks. The Master regularly sends sync messages to allow the Slave to obtain the Master's time. The Slave, in turn, periodically sends peer delay requests to exchange messages with the Master, obtaining the delay time between the two devices for time correction. Additionally, the resident time, which is the message propagation delay introduced by bridges, should also be taken into account. By considering all these factors, the time synchronization of both sides can be achieved within the TSN time domain. </p> <p>Time Synchronization process of gPTP</p> <p>Check the link for more detail about how PTP works.</p>"},{"location":"blog/20230712/TSN/#intergration-of-tsn-and-5g","title":"Intergration of TSN and 5G","text":"<p>By now, I believe you have gained an understanding of the time synchronization mechanism in TSN. Let's briefly explain how the 5G system supports TSN as a logical TSN bridge.  The 3GPP has defined new functionalities such as NW-TT, DS-TT, and TSN-AF, as well as TSN control nodes like CUC and CNC. Please check TS 23.501 Release 16 for more details. </p> <p>System architecture of 5G support TSN</p>"},{"location":"blog/20230712/TSN/#support-ethernet-type-pdu-session","title":"Support Ethernet type PDU session","text":"<p>To archive the intergration, 5G system should support ingress port and egress port pair via an Ethernet Type PDU session between the corresponding UE and UPF. As mentioned above, gPTP supports layer 2 (Ethernet) only.</p>"},{"location":"blog/20230712/TSN/#ds-tt-and-nw-tt","title":"DS-TT and NW-TT","text":"<p>In the 5G system, DS-TT (Device-side TSN translator) and NW-TT (Network-side TSN translator) serve as TSN translators. DS-TT is responsible for connecting TSN Slave endpoints with the UE, while NW-TT connects TSN Master endpoints with the UPF.</p> <p>When the sync message generated by the Master clock reaches the bridge, NW-TT captures its Ingress Timestamp and measures the delay between NW-TT and the Master clock. These timestamps are then embedded within the sync message and transmitted to the UE. Once the UE receives the sync message, DS-TT calculates the resident time by subtracting the Ingress Timestamp provided in the sync message, from the Egress Timestamp which represents the time of sync message reception. The resident time is added to the delay time mentioned in the sync message to determine the corrected time. Through the assistance of the TSN translators, the Slave endpoint receives the message and obtains information about time deviation and other relevant data for further adjustment.</p> <p>Note</p> <p>DS-TT and NW-TT enable the 5G system to function as a virtual bridge. The bridge is also called \"Transparent clock\" which is definded in IEEE 1588 and required in IEEE 802.1AS. You can say that Master and Slaver don't know the exist of the 5G TSN bridge, since it's logical transparent.</p> <p>\"Transparent clocks are used to route timing messages within a network. Used when: Ethernet timing must pass through switches.\" - different type of clocks</p>"},{"location":"blog/20230712/TSN/#tsn-af","title":"TSN-AF","text":"<p>With TSN-AF, CNC can manage the 5G system functioning as a logical bridge and achieve the integration of the 5G TSN bridge with the TSN network in collaboration with NW-TT and DS-TT. Additionally, TSN-AF gathers information and capability lists of the 5G TSN Bridge and transmits them to CNC.</p>"},{"location":"blog/20230712/TSN/#tsn-control-nodes","title":"TSN control nodes","text":"<p>To meet the requirements of application services and control TSN, there are two key functions utilized in the TSN system. CNC (Centralized Network Controller), as the central controller in the TSN system, receives the information from CUC (Centralized User Configuration) and performs scheduling and planning tasks. It calculates the optimal transmission schedule for the TSN traffic based on factors such as bandwidth requirements, latency constraints, and network conditions. Once the transmission schedule is computed and confirmed, CNC proceeds to deploy the necessary network resource configuration on the TSN switches. This ensures that the TSN network operates efficiently and effectively in delivering the required QoS (Quality of Service) for the application services.</p>"},{"location":"blog/20230712/TSN/#reference","title":"Reference","text":"<ul> <li>IEEE Std 802.1AS-2020: \u201cIEEE Standard for Local and metropolitan area networks--Timing and Synchronization for Time-Sensitive Applications\u201d.</li> <li>IEEE Std 1588: \u201cIEEE Standard for a Precision Clock Synchronization Protocol for Networked Measurement and Control Systems\u201d, Edition 2019.</li> <li>3GPP TS 23.501 Release 16</li> <li>Time-Sensitive Networking - Wikipedia</li> <li>Time-Sensitive Networking (TSN) Task Group | - IEEE 802.1</li> </ul>"},{"location":"blog/20230712/TSN/#about","title":"About","text":"<p>Hi, This is Ya-shih Tseng. I am currently researching the implementation of 5G TSN (Time-Sensitive Networking) as part of my master's studies. In the future, I will introduce more information about TSN. Hope you enjoy it.</p> <p>Note</p> <p>If you are interested in supporting free5GC, we welcome your donation. Please visit this link for more details.</p>"},{"location":"blog/20230719/UDM_introduce/","title":"Network function UDM introduction","text":"<p>Note</p> <p>Author: \u5f35\u54f2\u777f Date: 2023/7/19</p>"},{"location":"blog/20230719/UDM_introduce/#overview","title":"Overview","text":"<p>In this article, I will introduce UDM and its three services that will be used in the general UE registration procedure (Nudm_UECM service, Nudm_SubscriberDataManagement Service, and Nudm_UEAuthentication service) to let everyone understand UDM more clearly.</p>"},{"location":"blog/20230719/UDM_introduce/#udm","title":"UDM","text":"<p>Unified Data Management is responsible for managing information related to UE. When other NFs need to use the UE subscription information, they will obtain it from UDM through the SBI of UDM.</p>"},{"location":"blog/20230719/UDM_introduce/#nudm_ueauthentication-service","title":"Nudm_UEAuthentication Service","text":"<p>This service is used by AUSF to retrieve authentication-related information and, after authentication, confirm the result.</p> <p></p> <p>3GPP TS33.501 v15.2.0</p> <p>In Authentication, AUSF uses the GET operation to retrieve authentication information for the UE. The request contains the UE\u2019s identity (supi or suci) and the serving network name. The serving network name is used in the derivation of the anchor key, which is used by subsensual authentication. UE\u2019s identity will be contained in the URI, and the serving network name will be contained in the request body.</p> <p>Upon reception of the Nudm_UEAuthentication_Get Request, the UDM shall de-conceal SUCI to gain SUPI if SUCI is received. At this time, UDM will query the authentication subscription data from UDR. Then, UDM shall select the authentication method based on SUPI, and if required (e.g., 5G-AKA), UDM will calculate the authentication vector and pass it to AUSF.</p> <ul> <li>SUPI: A globally unique 5G Subscription Permanent Identifier, used to identify UE.</li> <li>SUCI: Subscription concealed identifier, obtained by encrypting supi through the Home Network Public Key so that supi will not be obtained by a third party on the network.</li> </ul> <pre><code>logger.UeauLog.Traceln(\"In GenerateAuthDataProcedure\")\n\nresponse = &amp;models.AuthenticationInfoResult{}\nrand.Seed(time.Now().UnixNano())\nsupi, err := suci.ToSupi(supiOrSuci, udm_context.Getself().SuciProfiles)\nif err != nil {\n    problemDetails = &amp;models.ProblemDetails{\n        Status: http.StatusForbidden,\n        Cause:  authenticationRejected,\n        Detail: err.Error(),\n    }\n\n    logger.UeauLog.Errorln(\"suciToSupi error: \", err.Error())\n    return nil, problemDetails\n}\n\nlogger.UeauLog.Tracef(\"supi conversion =&gt; [%s]\", supi)\n\nclient, err := createUDMClientToUDR(supi)\nif err != nil {\n    return nil, openapi.ProblemDetailsSystemFailure(err.Error())\n}\nauthSubs, res, err := client.AuthenticationDataDocumentApi.QueryAuthSubsData(context.Background(), supi, nil)\n\n//in the udm/internal/sbi/producer/generate_auth_data.go, GenerateAuthDataProcedure function.\n</code></pre> <p>From the code, we can see UDM first de-conceal SUCI (line 5), then use QueryAuthSubsData to get authSub from UDR. After that, UDM uses this information to create the authentication vector.</p> <p>Then we record the packet sent in the registration process and find the packet according to the URI specified by the specification. We can find the packet corresponding to this service.</p> <p></p> <p>Open the response packet, and we can see the response body matches the AuthenticationInfoResult data type.</p> <p></p> <p></p> <p>3GPP TS29.503 v15.2.1</p> <p>After AUSF authenticates the UE, it will confirm the result with UDM. These details will be used in linking authentication confirmation to the Nudm_UECM_Registration procedure from AMF.</p> <pre><code>func communicateWithUDM(ue *context.AmfUe, accessType models.AccessType) error {\n    ue.GmmLog.Debugln(\"communicateWithUDM\")\n    amfSelf := context.GetSelf()\n\n    // UDM selection described in TS 23.501 6.3.8\n    // TODO: consider udm group id, Routing ID part of SUCI, GPSI or External Group ID (e.g., by the NEF)\n    param := Nnrf_NFDiscovery.SearchNFInstancesParamOpts{\n        Supi: optional.NewString(ue.Supi),\n    }\n    resp, err := consumer.SendSearchNFInstances(amfSelf.NrfUri, models.NfType_UDM, models.NfType_AMF, &amp;param)\n    if err != nil {\n        return errors.Errorf(\"AMF can not select an UDM by NRF: SendSearchNFInstances failed\")\n    }\n\n    var uecmUri, sdmUri string\n    for _, nfProfile := range resp.NfInstances {\n        ue.UdmId = nfProfile.NfInstanceId\n        uecmUri = util.SearchNFServiceUri(nfProfile, models.ServiceName_NUDM_UECM, models.NfServiceStatus_REGISTERED)\n        sdmUri = util.SearchNFServiceUri(nfProfile, models.ServiceName_NUDM_SDM, models.NfServiceStatus_REGISTERED)\n        if uecmUri != \"\" &amp;&amp; sdmUri != \"\" {\n            break\n        }\n    }\n    ue.NudmUECMUri = uecmUri\n    ue.NudmSDMUri = sdmUri\n    if ue.NudmUECMUri == \"\" || ue.NudmSDMUri == \"\" {\n        return errors.Errorf(\"AMF can not select an UDM by NRF: SearchNFServiceUri failed\")\n    }\n\n    problemDetails, err := consumer.UeCmRegistration(ue, accessType, true)\n    if problemDetails != nil {\n        return errors.Errorf(problemDetails.Cause)\n    } else if err != nil {\n        return errors.Wrap(err, \"UECM_Registration Error\")\n    }\n\n    // TS 23.502 4.2.2.2.1 14a-c.\n    // \"After a successful response is received, the AMF subscribes to be notified\n    //      using Nudm_SDM_Subscribe when the data requested is modified\"\n    problemDetails, err = consumer.SDMGetAmData(ue)\n    if problemDetails != nil {\n        return errors.Errorf(problemDetails.Cause)\n    } else if err != nil {\n        return errors.Wrap(err, \"SDM_Get AmData Error\")\n    }\n\n    problemDetails, err = consumer.SDMGetSmfSelectData(ue)\n    if problemDetails != nil {\n        return errors.Errorf(problemDetails.Cause)\n    } else if err != nil {\n        return errors.Wrap(err, \"SDM_Get SmfSelectData Error\")\n    }\n\n    problemDetails, err = consumer.SDMGetUeContextInSmfData(ue)\n    if problemDetails != nil {\n        return errors.Errorf(problemDetails.Cause)\n    } else if err != nil {\n        return errors.Wrap(err, \"SDM_Get UeContextInSmfData Error\")\n    }\n\n    problemDetails, err = consumer.SDMSubscribe(ue)\n    if problemDetails != nil {\n        return errors.Errorf(problemDetails.Cause)\n    } else if err != nil {\n        return errors.Wrap(err, \"SDM Subscribe Error\")\n    }\n    ue.ContextValid = true\n    return nil\n}\n\n\n//in the amf/internal/gmm/handler.go.\n</code></pre> <p>Next, let's take a look at this function. It is called in HandleInitialRegistration, which handles UE's initial registration. UeCmRegistration will use the Nudm_UECM (UECM) service to store related UE Context Management information in UDM. In lines 40, 47, and 54, AMF uses the Nudm_SubscriberDataManagement (SDM) Service to get some subscribe data.</p>"},{"location":"blog/20230719/UDM_introduce/#nudm_uecontextmanagement-service","title":"Nudm_UEContextManagement Service","text":"<p>In the UeCmRegistration function, AMF registers as UE's serving NF on UDM and stores related UE Context Management information in UDM. Looking at the packet, you can see that the request body contains <code>amfInstanceId</code> and <code>guami</code>, representing the amf identity, and <code>ratType</code>, representing the radio access technology type used by UE.</p> <p></p> <pre><code>// TS 29.503 5.3.2.2.2\nfunc RegistrationAmf3gppAccessProcedure(registerRequest models.Amf3GppAccessRegistration, ueID string) (\n    header http.Header, response *models.Amf3GppAccessRegistration, problemDetails *models.ProblemDetails,\n) {\n    // TODO: EPS interworking with N26 is not supported yet in this stage\n    var oldAmf3GppAccessRegContext *models.Amf3GppAccessRegistration\n    if udm_context.Getself().UdmAmf3gppRegContextExists(ueID) {\n        ue, _ := udm_context.Getself().UdmUeFindBySupi(ueID)\n        oldAmf3GppAccessRegContext = ue.Amf3GppAccessRegistration\n    }\n\n    udm_context.Getself().CreateAmf3gppRegContext(ueID, registerRequest)\n\n    clientAPI, err := createUDMClientToUDR(ueID)\n    if err != nil {\n        return nil, nil, openapi.ProblemDetailsSystemFailure(err.Error())\n    }\n\n    var createAmfContext3gppParamOpts Nudr_DataRepository.CreateAmfContext3gppParamOpts\n    optInterface := optional.NewInterface(registerRequest)\n    createAmfContext3gppParamOpts.Amf3GppAccessRegistration = optInterface\n    resp, err := clientAPI.AMF3GPPAccessRegistrationDocumentApi.CreateAmfContext3gpp(context.Background(),\n        ueID, &amp;createAmfContext3gppParamOpts)\n    if err != nil {\n        logger.UecmLog.Errorln(\"CreateAmfContext3gpp error : \", err)\n        problemDetails = &amp;models.ProblemDetails{\n            Status: int32(resp.StatusCode),\n            Cause:  err.(openapi.GenericOpenAPIError).Model().(models.ProblemDetails).Cause,\n            Detail: err.Error(),\n        }\n        return nil, nil, problemDetails\n    }\n    defer func() {\n        if rspCloseErr := resp.Body.Close(); rspCloseErr != nil {\n            logger.UecmLog.Errorf(\"CreateAmfContext3gpp response body cannot close: %+v\", rspCloseErr)\n        }\n    }()\n\n    // TS 23.502 4.2.2.2.2 14d: UDM initiate a Nudm_UECM_DeregistrationNotification to the old AMF\n    // corresponding to the same (e.g. 3GPP) access, if one exists\n    if oldAmf3GppAccessRegContext != nil {\n        deregistData := models.DeregistrationData{\n            DeregReason: models.DeregistrationReason_SUBSCRIPTION_WITHDRAWN,\n            AccessType:  models.AccessType__3_GPP_ACCESS,\n        }\n        callback.SendOnDeregistrationNotification(ueID, oldAmf3GppAccessRegContext.DeregCallbackUri,\n            deregistData) // Deregistration Notify Triggered\n\n        return nil, nil, nil\n    } else {\n        header = make(http.Header)\n        udmUe, _ := udm_context.Getself().UdmUeFindBySupi(ueID)\n        header.Set(\"Location\", udmUe.GetLocationURI(udm_context.LocationUriAmf3GppAccessRegistration))\n        return header, &amp;registerRequest, nil\n    }\n}\n\n//in the udm/internal/sbi/producer/ue_context_management.go\n</code></pre> <p>In the RegistrationAmf3gppAccessProcedure function, UDM first checks whether the context has been established for that UE; if UDM has such a context, it initiates a Nudm_UECM_DeregistrationNotification to the old AMF later. UDM used the received information to create context and stored it in UDR.</p>"},{"location":"blog/20230719/UDM_introduce/#nudm_subscriberdatamanagement-sdm-service","title":"Nudm_SubscriberDataManagement (SDM) Service","text":"<p>The SDM service is used to retrieve the UE's individual subscription data relevant to the consumer's NF from the UDM. In the SDMGetAmData function, AMF gets subscription data used in registration and mobility management. In the response packet, AMF got <code>gpsis</code>, <code>subscribedUeAmbr</code>, and <code>nssai</code>.</p> <p></p> <p>The GPSI (Generic Public Subscription Identifier) is used to address a 3GPP subscription in data networks outside the realms of a 3GPP system. It contains either an External ID or an MSISDN \uff08Mobile Subscriber ISDN Number\uff09.The <code>subscribedUeAmbr</code> is The Maximum Aggregated uplink and downlink MBRs (max. bit rate) to be shared across all Non-GBR (non-guaranteed Bit Rate) QoS Flows according to the subscription of the user.</p> <p></p> <p>In the SDMGetSmfSelectData function, AMF gets subscribed S-NSSAIs (Single Network Slice Selection Assistance Information) and Data Network Names for these S-NSSAIs. AMF will use this information to select an SMF that manages the PDU Session.</p> <pre><code>func HandleInitialRegistration(ue *context.AmfUe, anType models.AccessType) error {\n    ue.GmmLog.Infoln(\"Handle InitialRegistration\")\n\n    amfSelf := context.GetSelf()\n\n    // update Kgnb/Kn3iwf\n    ue.UpdateSecurityContext(anType)\n\n    // Registration with AMF re-allocation (TS 23.502 4.2.2.2.3)\n    if len(ue.SubscribedNssai) == 0 {\n        getSubscribedNssai(ue)\n    }\n\n    if err := handleRequestedNssai(ue, anType); err != nil {\n        return err\n    }\n\n//in the amf/internal/gmm/handler.go.\n</code></pre> <p>In the initialization of HandleInitialRegistration, AMF sends a request to the UDM to receive the UE's NSSAI (Network Slice Selection Assistance Information). After receiving subscribed NSSAI, AMF will compare it to UE's requested NSSAI. If there is a S-NSSAI that has not been subscribed before, AMF will request NSSF for Allowed NSSAI.</p> <pre><code>func handleRequestedNssai(ue *context.AmfUe, anType models.AccessType) error {\n    amfSelf := context.GetSelf()\n\n    if ue.RegistrationRequest.RequestedNSSAI != nil {\n        requestedNssai, err := nasConvert.RequestedNssaiToModels(ue.RegistrationRequest.RequestedNSSAI)\n        if err != nil {\n            return fmt.Errorf(\"Decode failed at RequestedNSSAI[%s]\", err)\n        }\n\n        needSliceSelection := false\n        for _, requestedSnssai := range requestedNssai {\n            ue.GmmLog.Infof(\"RequestedNssai - ServingSnssai: %+v, HomeSnssai: %+v\",\n                requestedSnssai.ServingSnssai, requestedSnssai.HomeSnssai)\n            if ue.InSubscribedNssai(*requestedSnssai.ServingSnssai) {\n                allowedSnssai := models.AllowedSnssai{\n                    AllowedSnssai: &amp;models.Snssai{\n                        Sst: requestedSnssai.ServingSnssai.Sst,\n                        Sd:  requestedSnssai.ServingSnssai.Sd,\n                    },\n                    MappedHomeSnssai: requestedSnssai.HomeSnssai,\n                }\n                if !ue.InAllowedNssai(*allowedSnssai.AllowedSnssai, anType) {\n                    ue.AllowedNssai[anType] = append(ue.AllowedNssai[anType], allowedSnssai)\n                }\n            } else {\n                needSliceSelection = true\n                break\n            }\n        }\n\n        if needSliceSelection {\n            if ue.NssfUri == \"\" {\n                for {\n                    err := consumer.SearchNssfNSSelectionInstance(ue, amfSelf.NrfUri, models.NfType_NSSF, models.NfType_AMF, nil)\n                    if err != nil {\n                        ue.GmmLog.Errorf(\"AMF can not select an NSSF Instance by NRF[Error: %+v]\", err)\n                        time.Sleep(2 * time.Second)\n                    } else {\n                        break\n                    }\n                }\n            }\n\n            // Step 4\n            problemDetails, err := consumer.NSSelectionGetForRegistration(ue, requestedNssai)\n            if problemDetails != nil {\n                ue.GmmLog.Errorf(\"NSSelection Get Failed Problem[%+v]\", problemDetails)\n                gmm_message.SendRegistrationReject(ue.RanUe[anType], nasMessage.Cause5GMMProtocolErrorUnspecified, \"\")\n                return fmt.Errorf(\"Handle Requested Nssai of UE failed\")\n            } else if err != nil {\n                ue.GmmLog.Errorf(\"NSSelection Get Error[%+v]\", err)\n                gmm_message.SendRegistrationReject(ue.RanUe[anType], nasMessage.Cause5GMMProtocolErrorUnspecified, \"\")\n                return fmt.Errorf(\"Handle Requested Nssai of UE failed\")\n            }\n\n//in the amf/internal/gmm/handler.go.\n</code></pre> <pre><code>if param.SliceInfoRequestForRegistration.RequestedNssai != nil &amp;&amp;\n    len(param.SliceInfoRequestForRegistration.RequestedNssai) != 0 {\n    // Requested NSSAI is provided\n    // Verify which S-NSSAI(s) in the Requested NSSAI are permitted based on comparing the Subscribed S-NSSAI(s)\n    if param.Tai != nil &amp;&amp;\n        !util.CheckSupportedNssaiInPlmn(param.SliceInfoRequestForRegistration.RequestedNssai, *param.Tai.PlmnId) {\n        // Return ProblemDetails indicating S-NSSAI is not supported\n        // TODO: Based on TS 23.501 V15.2.0, if the Requested NSSAI includes an S-NSSAI that is not valid in the\n        //       Serving PLMN, the NSSF may derive the Configured NSSAI for Serving PLMN\n        *problemDetails = models.ProblemDetails{\n            Title:  util.UNSUPPORTED_RESOURCE,\n            Status: http.StatusForbidden,\n            Detail: \"S-NSSAI in Requested NSSAI is not supported in PLMN\",\n            Cause:  \"SNSSAI_NOT_SUPPORTED\",\n        }\n\n        status = http.StatusForbidden\n        return status\n    }\n\n    // Check if any Requested S-NSSAIs is present in Subscribed S-NSSAIs\n    checkIfRequestAllowed := false\n\n    for _, requestedSnssai := range param.SliceInfoRequestForRegistration.RequestedNssai {\n        if param.Tai != nil &amp;&amp; !util.CheckSupportedSnssaiInTa(requestedSnssai, *param.Tai) {\n            // Requested S-NSSAI does not supported in UE's current TA\n            // Add it to Rejected NSSAI in TA\n            authorizedNetworkSliceInfo.RejectedNssaiInTa = append(\n                authorizedNetworkSliceInfo.RejectedNssaiInTa,\n                requestedSnssai)\n            continue\n        }\n\n        var mappingOfRequestedSnssai models.Snssai\n        // TODO: Compared with Restricted S-NSSAI list in configuration under roaming scenario\n        if param.HomePlmnId != nil &amp;&amp; !util.CheckStandardSnssai(requestedSnssai) {\n            // Standard S-NSSAIs are supported to be commonly decided by all roaming partners\n            // Only non-standard S-NSSAIs are required to find mappings\n            targetMapping, found := util.FindMappingWithServingSnssai(requestedSnssai,\n                param.SliceInfoRequestForRegistration.MappingOfNssai)\n\n            if !found {\n                // No mapping of Requested S-NSSAI to HPLMN S-NSSAI is provided by UE\n                // TODO: Search for local configuration if there is no provided mapping from UE, and update UE's\n                //       Configured NSSAI\n                checkInvalidRequestedNssai = true\n                authorizedNetworkSliceInfo.RejectedNssaiInPlmn = append(\n                    authorizedNetworkSliceInfo.RejectedNssaiInPlmn,\n                    requestedSnssai)\n                continue\n            } else {\n                // TODO: Check if mappings of S-NSSAIs are correct\n                //       If not, update UE's Configured NSSAI\n                mappingOfRequestedSnssai = *targetMapping.HomeSnssai\n            }\n        } else {\n            mappingOfRequestedSnssai = requestedSnssai\n        }\n\n        hitSubscription := false\n        for _, subscribedSnssai := range param.SliceInfoRequestForRegistration.SubscribedNssai {\n            if mappingOfRequestedSnssai == *subscribedSnssai.SubscribedSnssai {\n                // Requested S-NSSAI matches one of Subscribed S-NSSAI\n                // Add it to Allowed NSSAI list\n                hitSubscription = true\n\n                var allowedSnssaiElement models.AllowedSnssai\n                allowedSnssaiElement.AllowedSnssai = new(models.Snssai)\n                *allowedSnssaiElement.AllowedSnssai = requestedSnssai\n                nsiInformationList := util.GetNsiInformationListFromConfig(requestedSnssai)\n                if nsiInformationList != nil {\n                    // TODO: `NsiInformationList` should be slice in `AllowedSnssai` instead of pointer of slice\n                    allowedSnssaiElement.NsiInformationList = append(\n                        allowedSnssaiElement.NsiInformationList,\n                        nsiInformationList...)\n                }\n                if param.HomePlmnId != nil &amp;&amp; !util.CheckStandardSnssai(requestedSnssai) {\n                    allowedSnssaiElement.MappedHomeSnssai = new(models.Snssai)\n                    *allowedSnssaiElement.MappedHomeSnssai = *subscribedSnssai.SubscribedSnssai\n                }\n\n                // Default Access Type is set to 3GPP Access if no TAI is provided\n                // TODO: Depend on operator implementation, it may also return S-NSSAIs in all valid Access Type if\n                //       UE's Access Type could not be identified\n                var accessType models.AccessType = models.AccessType__3_GPP_ACCESS\n                if param.Tai != nil {\n                    accessType = util.GetAccessTypeFromConfig(*param.Tai)\n                }\n\n                util.AddAllowedSnssai(allowedSnssaiElement, accessType, authorizedNetworkSliceInfo)\n\n                checkIfRequestAllowed = true\n                break\n            }\n        }\n\n        if !hitSubscription {\n            // Requested S-NSSAI does not match any Subscribed S-NSSAI\n            // Add it to Rejected NSSAI in PLMN\n            checkInvalidRequestedNssai = true\n            authorizedNetworkSliceInfo.RejectedNssaiInPlmn = append(\n                authorizedNetworkSliceInfo.RejectedNssaiInPlmn,\n                requestedSnssai)\n        }\n    }\n\n    if !checkIfRequestAllowed {\n        // No S-NSSAI from Requested NSSAI is present in Subscribed S-NSSAIs\n        // Subscribed S-NSSAIs marked as default are used\n        useDefaultSubscribedSnssai(param, authorizedNetworkSliceInfo)\n    }\n} else {\n    // No Requested NSSAI is provided\n    // Subscribed S-NSSAIs marked as default are used\n    checkInvalidRequestedNssai = true\n    useDefaultSubscribedSnssai(param, authorizedNetworkSliceInfo)\n}\n\n//in the nssf/internal/sbi/producer/nsselection_for_registration.go, nsselectionForRegistration funcion.\n</code></pre> <p>If NSSF needs to select S-NSSAI, it first finds the mapping of requested NSSAI to configured NSSAI for the HPLMN and converts requested S-NSSAI to S-NSSAI in configured NSSAI for the HPLMN. Then compare these S-NSSAIs with Subscribed S-NSSAIs; if NSSF find one match, set it as <code>AllowedSnssai</code>. If NSSF can't find such a mapping or no S-NSSAI in the mapping matches subscribed S-NSSAIs, it will use default subscribed S-NSSAIs.</p>"},{"location":"blog/20230719/UDM_introduce/#reference","title":"Reference","text":"<ul> <li>3GPP TS29.503 v15.2.1</li> <li>3GPP TS23.502 v15.2.0</li> <li>3GPP TS23.501 v15.2.0</li> <li>3GPP TS33.501 v15.2.0</li> <li>free5GC v3.3.0</li> </ul>"},{"location":"blog/20230719/UDM_introduce/#about","title":"About","text":"<p>Hello! My name is \u5f35\u54f2\u777f, and my current research topic is ATSSS (Access Traffic Steering, Switching and Splitting), I will continue to write articles related to 5G networks in the future. If you find any mistakes in my articles or have any topics you want to know about, please contact me.</p> <ul> <li>Linkedln</li> </ul> <p>Note</p> <p>If you are interested in supporting free5GC, we welcome your donation. Please visit this link for more details.</p>"},{"location":"blog/20230726/network_slice/","title":"How to deploy a free5GC network slice on OpenStack","text":"<p>Note</p> <p>Author: Daniel Hsieh Date: 2023/7/26</p>"},{"location":"blog/20230726/network_slice/#whats-network-slicing","title":"What's Network Slicing","text":"<p>Network slicing allows for the creation of multiple logical, isolated, and independent virtual networks that can coexist within a shared physical infrastructure. Each network slice provides dedicated and customized network resources to meet the specific requirements of different services The main elements of a network slice include:</p> <ul> <li> <p>Virtualized Network Functions (VNFs): Each network slice can include a set of virtualized network functions that provide specific network capabilities and services. These VNFs can include functions like routing, switching, firewalling, load balancing, or any other network service required by the slice.</p> </li> <li> <p>Isolation and Resource Allocation: Network slicing ensures the isolation of resources between slices, preventing interference and conflicts. It allows for the allocation of dedicated and optimized resources such as bandwidth, processing power, and storage to each slice based on its specific needs.</p> </li> <li> <p>Orchestration and Management: Network slice orchestration involves the creation, provisioning, and management of network slices. It involves configuring the appropriate VNFs, assigning resources, and establishing connectivity between the different components of a slice. </p> </li> </ul> <p></p> <p>NFV Enabling Network Slicing for 5G</p> <p>Take Figure 1 as an example. The first slice is designed for mobile devices such as smartphones. Such slice requires a huge diversity of VNFs, and virtual links with high speed and low latency to support the broadband service of smartphones. In 5G network, Those slices are referred to as eMBB (enhanced mobile broadband) slices.</p> <p>The second slice is designed for autonomous driving. In such scenario, extremely low latency and high reliability are paramount to ensure the vehicles' operability, smoothness and safety. To achieve low latency, some of the NFs should be deployed close to the access node,i.e. on edge cloud. To achieve high reliability, a NF should have multiple instances on available physical resources to make the slice more fault tolerant. Such slice is referred to as URLLC (Ultra-Reliable Low-Latency Communications) slice. </p> <p>The third slice is designed for massive IoT. IoT devices are expected to not move and send very small amount of data intermittently. Due to the nature of such devices, functions that handle mobiltiy and always-on connections are not needed. Such slices are referred to as mIoT (massive IoT) slices.</p>"},{"location":"blog/20230726/network_slice/#mano-architecture","title":"MANO Architecture","text":"<p>In this article, we utilize MANO network function virtualization (NFV) architecture to deploy virtual network function (VNF). It plays the role of creating, deploying, and managing VNFs. MANO consists of three main functional components: NFV Orchestrator (NFVO), Virtualized Infrastructure Manager (VIM), and Virtual Network Function Manager (VNFM).</p> <p></p> <p>NFV MANO Architecture</p> <ul> <li> <p>NFVO manages the underlying resource by coordinating VIM and VNFM. It handles tasks such as receiving requests, service instantiation, scaling, termination, and monitoring.</p> </li> <li> <p>VNFM manages the lifecycle of VNF instances. It interacts with the VIM to instantiate, configure, monitor, and terminate VNF instances.</p> </li> <li> <p>VIM is responsible for managing the underlying virtualized infrastructure that hosts the VNFs. It abstracts the physical resources, such as compute, storage, and networking, and provides a unified view to the NFVO. The VIM handles tasks like resource allocation, performance monitoring, fault management, and virtualization management.</p> </li> </ul> <p>For VIM, we use OpenStack, an open-source software that provides IaaS, to utilize the physical resources. For VNFM and NFVO, we use Tacker, a service component of OpenStack, to manage VNFs.</p>"},{"location":"blog/20230726/network_slice/#openstack","title":"OpenStack","text":"<p>OpenStack is an open-source cloud computing platform that provides a set of software tools for building and managing customized clouds. OpenStack offers a infrastructure-as-a-service (IaaS) solution, enabling organizations to create and manage virtualized resources in a cloud environment. It is designed to be modular and consists of various components that work together to deliver a comprehensive cloud computing platform. Some of the key components include:</p> <ul> <li> <p>Nova: Nova is the computing component of OpenStack and serves as the main compute engine. It manages the creation, scheduling, and management of virtual machines (VMs) and provides APIs for controlling and interacting with the compute resources.</p> </li> <li> <p>Cinder: Cinder is the block storage component of OpenStack. It provides persistent storage for virtual machines. With Cinder, users can create and manage volumes that can be attached to instances, allowing for flexible and scalable storage options.</p> </li> <li> <p>Neutron: Neutron is the networking component of OpenStack. It provides a networking-as-a-service (NaaS) solution, allowing users to define and manage network resources. Neutron supports virtual LANs, software-defined networking (SDN), and network function virtualization (NFV), etc.</p> </li> <li> <p>Keystone: Keystone is the identity service component of OpenStack. It provides authentication and authorization services, enabling users to securely access and manage resources within the cloud. Keystone supports multiple authentication mechanisms, including username/password, token-based, and external identity providers.</p> </li> <li> <p>Horizon: Horizon is the web-based dashboard for OpenStack. It provides a user-friendly interface for managing and monitoring the cloud infrastructure. With Horizon, users can perform various tasks, such as launching instances, managing storage resources, and configuring networking options.</p> </li> </ul> <p></p> <p>OpenStack Architecture</p> <p>OpenStack is highly flexible and customizable, allowing organizations to tailor the cloud infrastructure to their specific needs. It supports multiple hypervisors, including KVM, VMware, and Hyper-V.</p>"},{"location":"blog/20230726/network_slice/#tacker","title":"Tacker","text":"<p>To enable NFV, we need another service component of OpenStack called Tacker. Tacker is designed to simplify the deployment and lifecycle management of VNFs and network service functions (NSFs) in a cloud infrastructure. It leverages OpenStack's existing components, such as Nova, Neutron, and Heat, to provide a comprehensive solution for network service orchestration. Tacker provides several key features and functionalities:</p> <ul> <li> <p>Service Templates: Tacker uses service templates to define the composition and behavior of network services. These templates describe the VNFs and NSFs involved, their interconnections, resource requirements, etc. Service templates are written using the TOSCA (Topology and Orchestration Specification for Cloud Applications) standard.</p> </li> <li> <p>Lifecycle Management: Tacker automates the entire lifecycle of network services, including provisioning, scaling, healing, and termination. It leverages Heat, OpenStack's orchestration service, to manage the underlying infrastructure resources required by the services and handle dynamic scaling of VNFs based on traffic demands.</p> </li> <li> <p>VNF Manager: Tacker includes a VNF Manager component responsible for managing the lifecycle of VNFs. It interacts with OpenStack's compute and networking services, to instantiate and manage VNF instances.</p> </li> <li> <p>Multi-VIM Support: Tacker supports multiple virtual infrastructure managers  to accommodate different cloud platforms and environments. It can interact with OpenStack, VMware vSphere and Kubernetes and so on, enabling operators to deploy network services across heterogeneous infrastructure environments.</p> </li> </ul> <p></p> <p>Tacker Architecture</p>"},{"location":"blog/20230726/network_slice/#deploy-a-free5gc-network-slice","title":"Deploy a free5GC Network Slice","text":"<ol> <li> <p>In our implementation, we install OpenStack and Tacker on two different virtual machines for resource utilization reasons, but in fact, they can be installed on the same virtual machine. </p> </li> <li> <p>we need to install OpenStack on a virtual machine. Specific details and corresponding compatibility can be found on OpenStack official website. Using devstack scripts for installation enables operators to customize the environment based on their needs, such as extra plugins (softwares that extends the functionality of OpenStack environment) and overcommit (allows deploying NFs that require more resource than existing physical resourcce) functionality. Upon completion, a web UI enabled by Horizon can be used  to access and operate on your own personalized OpenStack cloud. </p> </li> <li> <p>Install Tacker on another virtual machine, which requires four OpenStack service components, Keystone, Mistral, Barbican and Horizon. Once the installation is completed, we can register our OpenStack VIM on Tacker using <code>openstack vim register</code>command.</p> </li> <li> <p>Create two instances that will be used as images (one for control plane VNFs, one for UPF) for the VNFs that we will create. Then, <code>ssh</code> into those instances to set up the configurations for the VNFs, such as, installing required packages (go language, mongodb, libtool, etc.) and <code>git clone</code> free5GC source code. Once all the configurations are done, use OpenStack dashboard to take snapshots of these instances, which will be used as the images for VNFs. </p> </li> <li> <p>Import all the VNF descriptors (VNFD) of the VNFs we need by using <code>openstack vnf descriptor create</code> command. VNFDs should be written in accordance with TOSCA format. TOSCA format allows you to define the virtual links (a virtual network VNFs will be running in) and virtual deployment unit (operation unit of a VNF).      Below is an example of UPF VNFD: <pre><code>tosca_definitions_version: tosca_simple_profile_for_nfv_1_0_0\ndescription: description\nnode_types:\n  tosca.nodes.nfv.VNF11:\n    requirements:\n    - virtualLink1:\n        type: tosca.nodes.nfv.VL\n        required: true\nmetadata:\n  template_name: free5GCSetup\ntopology_template:\n  substitution_mappings:\n    node_type: tosca.nodes.nfv.VNF11\n  node_templates:\n    VDU1:\n      type: tosca.nodes.nfv.VDU.Tacker\n      properties:\n        name: free5gc-upf1-VNF\n        image: stage3-up\n        flavor: free5gc\n        availability_zone: nova\n        mgmt_driver: noop\n        key_name: free5gc\n        user_data_format: RAW\n        user_data: |\n          #!/bin/sh\n          cd /home/ubuntu/free5gc/src/upf/build \n          cat &gt; config/upfcfg.yaml &lt;&lt;- EOM\n          info:\n            version: 1.0.0\n            description: UPF configuration\n\n          configuration:\n            # debugLevel: panic|fatal|error|warn|info|debug|trace\n            debugLevel: info\n\n            pfcp:\n              - addr: 192.168.2.111\n\n            gtpu:\n              - addr: 192.168.2.111\n              # [optional] gtpu.name\n              # - name: upf.5gc.nctu.me\n              # [optional] gtpu.ifname\n              # - ifname: gtpif\n\n            apn_list:\n              - apn: internet\n                cidr: 60.60.0.0/24\n                # [optional] apn_list[*].natifname\n                # natifname: eth0\n          EOM\n          #sudo ./bin/free5gc-upfd -f config/upfcfg.yaml\n\n    CP1:\n      type: tosca.nodes.nfv.CP.Tacker\n      properties:\n        ip_address: 192.168.2.111\n        management: true\n      requirements:\n      - virtualLink:\n          node: VL1\n      - virtualBinding:\n          node: VDU1\n    VL1:\n      type: tosca.nodes.nfv.VL\n      properties:\n        network_name: 5GC\n        vendor: Tacker\n    FIP1:\n      type: tosca.nodes.network.FloatingIP\n      properties:\n        floating_network: public\n        floating_ip_address: 172.24.4.111\n      requirements:\n      - link:\n          node: CP1\n</code></pre></p> </li> <li>Import the network service descriptor (NSD) using <code>openstack ns descriptor create</code> command. The NSD should also be written in accordance with TOSCA format. Once all the VNFDs and NSD are all successfully imported, we can use <code>openstack ns create</code> to deploy the network slice. The VNFs specified in the NSD will also be instantiated along with the network slice. Their instances can be viewed on OpenStack dashboard enabled by Horizon or just use <code>openstack vnf list</code> to check the status of the VNFs.     Below is an example of NSD <pre><code>tosca_definitions_version: tosca_simple_profile_for_nfv_1_0_0\ndescription: Import Common Slice VNFDs (already on-boarded)\nimports:\n  - mongo\n  - nrf\n  - amf\n  - smf\n  - udr\n  - pcf\n  - udm\n  - nssf\n  - ausf\ntopology_template:\n  node_templates:\n    VNF0:\n      type: tosca.nodes.nfv.VNF0\n    VNF1:\n      type: tosca.nodes.nfv.VNF1\n    VNF2:\n      type: tosca.nodes.nfv.VNF2\n    VNF3:\n      type: tosca.nodes.nfv.VNF3\n    VNF4:\n      type: tosca.nodes.nfv.VNF4\n    VNF5:\n      type: tosca.nodes.nfv.VNF5\n    VNF6:\n      type: tosca.nodes.nfv.VNF6\n    VNF7:\n      type: tosca.nodes.nfv.VNF7\n    VNF8:\n      type: tosca.nodes.nfv.VNF8\n</code></pre></li> <li><code>ssh</code> into the VNF instances to make the necessary configuration for each VNF and start the free5GC VNF.</li> <li>Voila! Now we have a fully functional free5GC network slice.</li> </ol> <p>There are many other ways to set up a network slice. For example, we can deploy VNFs of the same network slice on different VIMs, or we can deploy all the network slices on the same VIM, as long as it is specified in the VNFDs. </p>"},{"location":"blog/20230726/network_slice/#about","title":"About","text":"<p>Hi, my name is Daniel Hsieh. I am a CS major graduate student. My research field is network slicing. If there are any questions about the article, please feel free to contact.</p> <ul> <li>email: e657shai@gmail.com</li> </ul>"},{"location":"blog/20230726/network_slice/#reference","title":"Reference","text":"<ul> <li> <p>https://www.acecloudhosting.com/blog/openstack-the-catalyst-of-the-public-cloud-market/</p> </li> <li> <p>https://telcocloudbridge.com/blog/a-beginners-guide-to-nfv-management-orchestration-mano/</p> </li> <li> <p>https://wiki.openstack.org/wiki/Tacker</p> </li> <li> <p>B. Chatras, U. S. Tsang Kwong and N. Bihannic, \"NFV enabling network slicing for 5G,\" 2017 20th Conference on Innovations in Clouds, Internet and Networks (ICIN), Paris, France, 2017, pp. 219-225, doi: 10.1109/ICIN.2017.7899415.</p> </li> </ul> <p>Note</p> <p>If you are interested in supporting free5GC, we welcome your donation. Please visit this link for more details.</p>"},{"location":"blog/20230802/20230802/","title":"Authentication Mechanism in NRF: What Is OAuth?","text":"<p>Note</p> <p>Author: Wilson Date: 2023/8/2</p>"},{"location":"blog/20230802/20230802/#abstract","title":"Abstract","text":"<p>Regarding the theme this time, I will briefly introduce OAuth. OAuth 2.0 defines four types of authorization flows. I choose the Client Credentials Flow to explain because the authentication mechanism in NRF is closely related to the Client Credentials Flow.</p> <p>Next, I will explain how to apply the concept of the Client Credentials Flow to NRF and introduce <code>Nnrf_AccessToken Service</code>, because <code>Nnrf_AccessToken Service</code> is closely related to the Client Credentials Flow. </p> <p>Finally, I will make a simple experiment of the authentication mechanism in NRF and share the environment settings and methods of operation.</p>"},{"location":"blog/20230802/20230802/#oauth","title":"OAuth","text":"<p>Before explaining the authentication mechanism in NRF, I will introduce OAuth. Regarding the OAuth flow, we can log in to the account through the platform before accessing an application. After logging in, we agree that an application can limitedly obtain the information of the user on the platform. The application can be LinkedIn, YouTube, etc. The platform can be Google, Facebook, etc.</p> <p>The full English name of OAuth is Open standard Authorization. OAuth is an open standard, and it's used to deal with authorization-related behaviors. OAuth 2.0 defines four types of authorization flows. The four types of the authorization flows are:</p> <ul> <li>Authorization Code</li> <li>Implicit</li> <li>Resource Owner Password Credentials</li> <li>Client Credentials</li> </ul> <p>This article explains the entire authorization of the Client Credentials Flow only, because the authentication mechanism in NRF adopts the Client Credentials. </p> <p>If you're interested in how authorization mechanism works, please refer to this article for more details.</p>"},{"location":"blog/20230802/20230802/#client-credentials-flow","title":"Client Credentials Flow","text":"<p> Figure 1. Client Credentials Flow</p> <p>Referring to the Figure 1, the Client Credentials Flow is mainly composed of:</p> <ul> <li>Client</li> <li>Authorization Server</li> <li>Resource Server</li> </ul> <p>The entire authorization of the Client Credentials Flow can be devided into 3 steps:</p> <ul> <li>First, the Client provdies Client ID, Client Secret Token, Scope, and Grant Type to the Authorization Server.</li> <li>Second, the Authorization Server verifies the information provided by the Client. After the Authorization Server verifies the information, it signs with the private key and sends the Access Token to the Client.</li> <li>Third, the Client obtains resources from the Resource Server with the Access Token.</li> </ul> <p>In addition, the Client and the Authorization Server have their own Scope list. The Scope list records a series of the actions. The Client or the Authorization Server is permitted to do the actions for obtaining the user\u2019s name, deleting posts, etc.</p> <p>Below I will explain how to apply the Client Credentials Flow to NRF after talking about the Client Credentials Flow.</p>"},{"location":"blog/20230802/20230802/#client-credentials-flow-in-nrf","title":"Client Credentials Flow in NRF","text":"<p>The Figure 2 and the Figure 3 originate from the Figure 13.4.1.1-1 and the Figure 13.4.1.1-2 of the TS 33.501. </p> <p> Figure 2. NF Service Consumer Obtaining Access Token before NF Service Access</p> <p>The entire flow in Figure 2 is the same as Step 1 and Step 2 in the Figure 1. The role of the Client is played by the NF Service Consumer, and the role of the Authorization Server is played by the NRF.</p> <p>First, the NF Service Consumer registers with NRF. Then the NF Service Consumer sends the <code>Nnrf_AccessToken_Get Request</code> to NRF. The <code>Nnrf_AccessToken_Get Request</code> includes:</p> <ul> <li>Consumer NF Type</li> <li>Expected NF Type</li> <li>Expected NF Service Name</li> <li>Client ID</li> </ul> <p>The NF Type can be AMF, SMF, etc. , and the NF Service Name can be <code>namf-comm</code>, <code>nsmf-pdusession</code>, etc. </p> <p>NRF verifies the information provided by the NF Service Consumer after it receives the <code>Nnrf_AccessToken_Get Request</code>. NRF generates an Access Token and uses the NRF private key to sign on the Access Token after the verification is successful.</p> <p>Finally, NRF returns the <code>Nnrf_AccessToken_Get Response</code> to the NF Service Consumer. The NF Service Consumer stores the Access Token within the validity period after it gets the Access Token. The services provided by the NF Service Producer are in the Expected NF Service Name. The NF Service Consumer doesn\u2019t need to verify again when it wants to use the services provided by the NF Service Producer.</p> <p> Figure 3. NF Service Consumer Requesting Service Access with an Access Token</p> <p>The entire flow in Figure 3 is the same as Step 3 in the Figure 1. The role of the Client is played by the NF Service Consumer, and the role of the Resource Server is played by the NF Service Producer. </p> <p>First, the NF Service Consumer sends the <code>NF Service Request</code> to the NF Service Producer with the Access Token. Simply put, the NF Service Consumer wants to consume the service provided by the NF Service Producer.</p> <p>The NF Service Producer uses the NRF public key to verify the signed Access Token after it receives the <code>NF Service Request</code>. If the verification is successful, the NF Service Producer will send the <code>NF Service Response</code> to the NF Service Consumer.</p> <p>Now I will talk about the <code>Nnrf_AccessToken Service</code> after explaining how to apply the Client Credentials Flow to NRF.</p>"},{"location":"blog/20230802/20230802/#nnrf_accesstoken-service","title":"Nnrf_AccessToken Service","text":"<p> Figure 4. Access Token Request</p> <p>The Figure 4 originates from the Figure 5.4.2.2.1-1 of the TS 29.510.</p> <p>First, the NF Service Consumer sends the POST <code>/oauth2/token</code> to NRF, and the data is stored in the <code>AccessTokenReq</code>. The attribute name, the data type, and the formulation rule of the <code>AccessTokenReq</code> are shown in the Table 1. The Table 1 originates from the Table 6.3.5.2.2-1 of the TS 29.510.</p> <p> Table 1. Definition of Type AccessTokenReq</p> <p>Definition of type <code>AccessTokenReq</code>:</p> <ul> <li><code>grant_type</code>: The value must be set to the client_credentials, and it is checked in the Snippet 1.</li> <li><code>nfInstanceId</code>: The value stores the ID of the NF Service Consumer.</li> <li><code>targetNfInstanceId</code>: The value stores the ID of the NF Service Producer.</li> <li><code>nfType</code>: The value stores the network function name of the NF Service Consumer. The network function name can be the AMF, SMF, etc. </li> <li><code>targetNfType</code>: The value stores the network function name of the NF Service Producer.</li> <li><code>scope</code>: It stores the services. The services can be the <code>namf-comm</code>, <code>nsmf-pdusession</code>, etc. When the NF Service Consumer requests the services. The services will be provided by the NF Service Producer.</li> <li><code>requesterPlmn</code>: It is mainly used in the roaming.</li> <li><code>targetPlmn</code>: It is mainly used in the roaming.</li> </ul> <p><pre><code>if reqGrantType != \"client_credentials\" {\n    return &amp;models.AccessTokenErr{\n        Error: \"unsupported_grant_type\",\n    }\n}\n</code></pre> Snippet 1. Grant Type Value Checking</p> <p>NRF sends <code>AccessTokenRsp</code> to the NF Service Consumer in the Step 2a of the Figure 4. The attribute name, the data type, and the formulation rule of the <code>AccessTokenRsp</code> are shown in the Table 2. The Table 2 originates from the Table 6.3.5.2.3-1 of the TS 29.510.</p> <p> Table 2. Definition of Type AccessTokenRsp</p> <p>The <code>AccessTokenRsp</code> contains four attribute names. The four attribute names are:</p> <ul> <li><code>access_token</code>: It stores all the attribute names and values of the AccessTokenClaims in the Table 3. The Table 3 originates form the Table 6.3.5.2.4-1 of the TS 29.510. </li> <li><code>token_type</code>: It must be set to the Bearer and can be seen in the Snippet 2.</li> <li><code>expires_in</code>: It stores information related to the expiration date.</li> <li><code>scope</code>: The NF Service Consumer and the NF Service Producer have their own scope list. The scope in the <code>AccessTokenRsp</code> has a series of these services, and the NF Service Producer is permitted to consume these services.</li> </ul> <p> Table 3. Definition of Type AccessTokenClaims</p> <p>Definition of Type <code>AccessTokenClaims</code>:</p> <ul> <li><code>iss</code>: It is called issuer, and the content usually stores the ID of NRF.</li> <li><code>sub</code>: It is called subject, and the content stores the ID of the NF Service Consumer.</li> <li><code>aud</code>: It is called audience, and the content stores the ID of the NF Service Producer.</li> <li><code>scope</code>: The scope in the <code>AccessTokenClaims</code> has a series of these services, and the NF Service Consumer is authorized by the NF Service Producer and permitted to consume these services.</li> <li><code>exp</code>: It stores information related to the validity period.</li> </ul> <p><pre><code>func AccessTokenProcedure(request models.AccessTokenReq) (\n    *models.AccessTokenRsp, *models.AccessTokenErr,\n) {\n    logger.AccTokenLog.Infoln(\"In AccessTokenProcedure\")\n\n    var expiration int32 = 1000\n    scope := request.Scope\n    tokenType := \"Bearer\"\n    now := int32(time.Now().Unix())\n\n    errResponse := AccessTokenScopeCheck(request)\n    if errResponse != nil {\n        return nil, errResponse\n    }\n\n    // Create AccessToken\n    nrfCtx := nrf_context.GetSelf()\n    accessTokenClaims := models.AccessTokenClaims{\n        Iss:            nrfCtx.Nrf_NfInstanceID,    // NF instance id of the NRF\n        Sub:            request.NfInstanceId,       // nfInstanceId of service consumer\n        Aud:            request.TargetNfInstanceId, // nfInstanceId of service producer\n        Scope:          request.Scope,              // TODO: the name of the NF services for which the\n        Exp:            now + expiration,           // access_token is authorized for use\n        StandardClaims: jwt.StandardClaims{},\n    }\n    accessTokenClaims.IssuedAt = int64(now)\n\n    // Use NRF private key to sign AccessToken\n    token := jwt.NewWithClaims(jwt.GetSigningMethod(\"RS512\"), accessTokenClaims)\n    accessToken, err := token.SignedString(nrfCtx.NrfPrivKey)\n    if err != nil {\n        logger.AccTokenLog.Warnln(\"Signed string error: \", err)\n        return nil, &amp;models.AccessTokenErr{\n            Error: \"invalid_request\",\n        }\n    }\n\n    response := &amp;models.AccessTokenRsp{\n        AccessToken: accessToken,\n        TokenType:   tokenType,\n        ExpiresIn:   expiration,\n        Scope:       scope,\n    }\n    return response, nil\n}\n</code></pre> Snippet 2. AccessTokenProcedure Function</p> <p>The Snippet 2 is the <code>AccessTokenProcedure()</code> function. The function is executed in NRF.</p> <p>The function mainly processes:</p> <ol> <li>The NRF receives the <code>AccessTokenReq</code> sent by the NF Service Consumer.</li> <li>The function calls the <code>AccessTokenScopeCheck()</code> function. The <code>AccessTokenScopeCheck()</code> function checks whether the content of the attribute name in the <code>AccessTokenReq</code> complies with the requirements of the TS 29.510. If not, the <code>AccessTokenProcedure()</code> function immediately returns the <code>AccessTokenErr</code> to the NF Service Consumer.</li> <li>The function starts to create the Access Token. The Access Token is stored in the <code>AccessTokenRsp</code>. The <code>AccessTokenRsp</code> is sent back to the NF Service Consumer. The <code>Iss</code> in the AccessToken obtains its own ID in NRF. The <code>Sub</code> and <code>Aud</code> are obtained from the <code>NfInstancedId</code> and the <code>TargetNfInstanceId</code> in the <code>AccessTokenReq</code> respectively. The <code>Scope</code> is obtained from the <code>scope</code> in the <code>AccessTokenReq</code>. The expiration is set to the 1000 in the Snippet 2. Therefore, the value of the <code>exp</code> is the current time + 1000.</li> <li>After the Access Token is created, the function uses the NRF private key to sign on the Access Token. After signing, the function checks whether there is an error. If so, the function immediately sends the <code>AccessTokenErr</code> to the NF Service Consumer.</li> <li>The function puts the signed Access Token into the <code>AccessTokenRsp</code>. The value of the <code>TokenType</code> is set to the Bearer by the function. The function sets the <code>ExprieIn</code> and the <code>Scope</code> in the Snippet 2.</li> </ol> <p>Finally, I make a simple experiment about the Access Token and share the environment setting and method of operation with you.</p>"},{"location":"blog/20230802/20230802/#experiment","title":"Experiment","text":"<p>The Table 4 is my environment setting. I provide the Table 4 for you. You can refer it.</p> <p> Table 4. Environment</p> <p>Remove the part of the <code>tls</code> and add the content of the <code>cert</code>, <code>rootcert</code> and <code>oauth</code> under <code>sbi</code> in the <code>nrfcfg.yaml</code> before implementing about the Access Token.</p> <p><pre><code>info:\n  version: 1.0.2\n  description: NRF initial local configuration\n\nconfiguration:\n  MongoDBName: free5gc # database name in MongoDB\n  MongoDBUrl: mongodb://127.0.0.1:27017 # a valid URL of the mongodb\n  sbi: # Service-based interface information\n    scheme: http # the protocol for sbi (http or https)\n    registerIPv4: 127.0.0.10 # IP used to serve NFs or register to another NRF\n    bindingIPv4: 127.0.0.10  # IP used to bind the service\n    port: 8000 # port used to bind the service\n    cert:\n      pem: cert/nrf.pem\n      key: cert/nrf.key\n    rootcert:\n      pem: cert/nrf.pem\n      key: cert/nrf.key\n    oauth: true\n  DefaultPlmnId:\n    mcc: 208 # Mobile Country Code (3 digits string, digit: 0~9)\n    mnc: 93 # Mobile Network Code (2 or 3 digits string, digit: 0~9)\n  serviceNameList: # the SBI services provided by this NRF, refer to TS 29.510\n    - nnrf-nfm # Nnrf_NFManagement service\n    - nnrf-disc # Nnrf_NFDiscovery service\n\nlogger: # log output setting\n  enable: true # true or false\n  level: info # how detailed to output, value: trace, debug, info, warn, error, fatal, panic\n  reportCaller: false # enable the caller report or not, value: true or false\n</code></pre> nrfcfg.yaml</p> <p>Find the <code>http://127.0.0.10:8000/nnrf-nfm/v1/nf-instances/8f7891b4-b127-4f59-9ec2-b5e6aade5531</code> in the NRF log, and you will get the <code>8f7891b4-b127-4f59-9ec2-b5e6aade5531</code>. The <code>8f7891b4-b127-4f59-9ec2-b5e6aade5531</code> is the <code>nfInstanceID</code>.</p> <pre><code>2023-08-02T20:07:43.300826205Z [INFO][NRF][NFM] Handle NFRegisterRequest\n2023-08-02T20:07:43.308259291Z [INFO][NRF][NFM] urilist create\n2023-08-02T20:07:43.311674255Z [INFO][NRF][NFM] Create NF Profile\n2023-08-02T20:07:43.318192771Z [INFO][NRF][NFM] Location header:  http://127.0.0.10:8000/nnrf-nfm/v1/nf-instances/8f7891b4-b127-4f59-9ec2-b5e6aade5531\n2023-08-02T20:07:43.325073275Z [INFO][NRF][GIN] | 201 |       127.0.0.1 | PUT     | /nnrf-nfm/v1/nf-instances/8f7891b4-b127-4f59-9ec2-b5e6aade5531 |\n</code></pre> <p>Execute <code>$ curl -X GET {apiRoot}/nnrf-nfm/v1/nf-instances/{nfInstanceID}</code>, and you will obtain the detail information about the <code>nfInstanceID</code>. You can see the <code>nfType</code> of the <code>nfInstanceID</code> is NSSF, and the information about the <code>nfInstanceID</code> is used when you implement the Access Token.</p> <pre><code>ubuntu@free5GC:~/free5gc/NFs/nrf$ curl -X GET http://127.0.0.10:8000/nnrf-nfm/v1/nf-instances/8f7891b4-b127-4f59-9ec2-b5e6aade5531\n{\"ipv4Addresses\":[\"127.0.0.31\"],\"nfInstanceId\":\"8f7891b4-b127-4f59-9ec2-b5e6aade5531\",\"nfServices\":[{\"apiPrefix\":\"http://127.0.0.31:8000\",\"ipEndPoints\":[{\"ipv4Address\":\"127.0.0.31\",\"port\":8000,\"transport\":\"TCP\"}],\"nfServiceStatus\":\"REGISTERED\",\"scheme\":\"http\",\"serviceInstanceId\":\"0\",\"serviceName\":\"nnssf-nsselection\",\"versions\":[{\"apiFullVersion\":\"1.0.2\",\"apiVersionInUri\":\"v1\"}]},{\"apiPrefix\":\"http://127.0.0.31:8000\",\"ipEndPoints\":[{\"ipv4Address\":\"127.0.0.31\",\"port\":8000,\"transport\":\"TCP\"}],\"nfServiceStatus\":\"REGISTERED\",\"scheme\":\"http\",\"serviceInstanceId\":\"1\",\"serviceName\":\"nnssf-nssaiavailability\",\"versions\":[{\"apiFullVersion\":\"1.0.2\",\"apiVersionInUri\":\"v1\"}]}],\"nfStatus\":\"REGISTERED\",\"nfType\":\"NSSF\",\"plmnList\":[{\"mcc\":\"208\",\"mnc\":\"93\"}]}\n</code></pre> <p>Then you execute this command, see below. <pre><code>$ curl -X POST -H \"Content-Type: application/json\" -d '{\"nfInstanceId\": {nfInstanceID}, \"grant_type\": \"client_credentials\", \"nfType\": {nfType}, \"targetNfType\": \"UDR\", \"scope\": \"nudr-dr\"}' {apiRoot}/oauth2/token\n</code></pre> You will get the long symbols. The long symbols is that the Access Token is encrypted by the private key of NRF and stored in the <code>AccessTokenRsp</code>.</p> <pre><code>ubuntu@free5GC:~/free5gc/NFs/nrf$ curl -X POST -H \"Content-Type: application/json\" -d '{\"nfInstanceId\": \"8f7891b4-b127-4f59-9ec2-b5e6aade5531\", \"grant_type\": \"client_credentials\", \"nfType\": \"NSSF\", \"targetNfType\": \"UDR\", \"scope\": \"nudr-dr\"}' http://127.0.0.10:8000/oauth2/token\n\"eyJhY2Nlc3NfdG9rZW4iOiJleUpoYkdjaU9pSlNVelV4TWlJc0luUjVjQ0k2SWtwWFZDSjkuZXlKcGMzTWlPaUlpTENKemRXSWlPaUk0WmpjNE9URmlOQzFpTVRJM0xUUm1OVGt0T1dWak1pMWlOV1UyWVdGa1pUVTFNekVpTENKaGRXUWlPaUlpTENKelkyOXdaU0k2SW01MVpISXRaSElpTENKbGVIQWlPakUyT1RFd01EZzBPRGdzSW1saGRDSTZNVFk1TVRBd056UTRPSDAuY3VHSkkwTndfV280S2lQbS1fZEZVdnVTQWM1WVEwMmRKYk5PTUhmMV9IOHdIZ2JKWFhUam9xU1Y2OTNYSmFKemkweGIxdC1DMW14TWhVZkZjbXpNMC1Nd2oxTXZYaWhyTTktdDFRUFItSFcxQlBlN0tHMUxBV3d5MEJfcXpIalltRlR6eGhONVlyNkpURDhBbkMxaFJFeEh4WHBjV1NqbV9vZnV0NVhfUFRFRkZtaHZrbmtVbU8waWFrTmdRWElRVTc1NnlvZ29ZTlFDRnJvSmRWamJMdnpFdkJLYTVFN0hQeXc3RkRDRHpTZU5WT2t2WTlobU11eldYZ3dOVmRIT3c1c2lNbmppbTlmTVZ0RTFxS1hjWDlScXlUdXlsWjM2ZlJ1QjdVZ2hkLU15Q19xd2VJRE41ZFdYOWZqdnA3VUNZZ01mVHhSLUI2M3d5OWFjQ183eThRIiwidG9rZW5fdHlwZSI6IkJlYXJlciIsImV4cGlyZXNfaW4iOjEwMDAsInNjb3BlIjoibnVkci1kciJ9\"\n</code></pre> <p>NSSF sends the <code>AccessTokenReq</code> to NRF after you execute the above command. In the <code>AccessTokenReq</code>, the <code>nfInstanceId</code> is set to <code>8f7891b4-b127-4f59-9ec2-b5e6aade5531</code>. The <code>grant_type</code> is set to the client_credentials. The <code>nfType</code> is set to NSSF. The <code>targetNfType</code> is set to UDR. The <code>scope</code> is set to <code>nudr-dr</code>. The information is shown in the NRF log. The value of the <code>targetNfInstanceId</code>, <code>requesterPlmn</code>, and <code>targetPlmn</code> is empty because they are not set.</p> <pre><code>2023-08-02T20:18:08.127557565Z [INFO][NRF][Token] In AccessTokenProcedure\n2023-08-02T20:18:08.127586736Z [INFO][NRF][Token] Access Token Request\n2023-08-02T20:18:08.127611885Z [INFO][NRF][Token] Grant Type: client_credentials\n2023-08-02T20:18:08.127637480Z [INFO][NRF][Token] NF Instance ID: 8f7891b4-b127-4f59-9ec2-b5e6aade5531\n2023-08-02T20:18:08.127664415Z [INFO][NRF][Token] Target NF Instance ID:\n2023-08-02T20:18:08.127689792Z [INFO][NRF][Token] NF Type: NSSF\n2023-08-02T20:18:08.127712916Z [INFO][NRF][Token] Target NF Type: UDR\n2023-08-02T20:18:08.127734827Z [INFO][NRF][Token] Scope: nudr-dr\n2023-08-02T20:18:08.127758317Z [INFO][NRF][Token] Requester PLMN: &lt;nil&gt;\n2023-08-02T20:18:08.127781052Z [INFO][NRF][Token] Target PLMN: &lt;nil&gt;\n</code></pre> <p>Next, you can see the Access Token in the NRF log. The value of the <code>Sub</code> is <code>8f7891b4-b127-4f59-9ec2-b5e6aade5531</code>. The <code>Sub</code> represents NSSF, and NSSF belongs to the NF Service Consumer. The value of the <code>Scope</code> is the <code>nudr-dr</code>. The value of the <code>Exp</code> is 1691008488.</p> <pre><code>2023-08-02T20:18:08.134096785Z [INFO][NRF][Token] Access Token Claims\n2023-08-02T20:18:08.138100978Z [INFO][NRF][Token] Iss:\n2023-08-02T20:18:08.138185972Z [INFO][NRF][Token] Sub: 8f7891b4-b127-4f59-9ec2-b5e6aade5531\n2023-08-02T20:18:08.138228925Z [INFO][NRF][Token] Aud:\n2023-08-02T20:18:08.138264519Z [INFO][NRF][Token] Scope: nudr-dr\n2023-08-02T20:18:08.138298628Z [INFO][NRF][Token] Exp: 1691008488\n</code></pre> <p>Next, you can see the <code>AccessTokenRsp</code>. You can see that the Access Token has become the long symbols. The value of the <code>Token Type</code> is set to the Bearer. The value of the <code>ExpiresIn</code> is set to 1000. The value of the <code>Scope</code> is set to <code>nudr-dr</code>.</p> <pre><code>2023-08-02T20:18:08.149587382Z [INFO][NRF][Token] Access Token Response\n2023-08-02T20:18:08.150006665Z [INFO][NRF][Token] Access Token: eyJhbGciOiJSUzUxMiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiIiLCJzdWIiOiI4Zjc4OTFiNC1iMTI3LTRmNTktOWVjMi1iNWU2YWFkZTU1MzEiLCJhdWQiOiIiLCJzY29wZSI6Im51ZHItZHIiLCJleHAiOjE2OTEwMDg0ODgsImlhdCI6MTY5MTAwNzQ4OH0.cuGJI0Nw_Wo4KiPm-_dFUvuSAc5YQ02dJbNOMHf1_H8wHgbJXXTjoqSV693XJaJzi0xb1t-C1mxMhUfFcmzM0-Mwj1MvXihrM9-t1QPR-HW1BPe7KG1LAWwy0B_qzHjYmFTzxhN5Yr6JTD8AnC1hRExHxXpcWSjm_ofut5X_PTEFFmhvknkUmO0iakNgQXIQU756yogoYNQCFroJdVjbLvzEvBKa5E7HPyw7FDCDzSeNVOkvY9hmMuzWXgwNVdHOw5siMnjim9fMVtE1qKXcX9RqyTuylZ36fRuB7Ughd-MyC_qweIDN5dWX9fjvp7UCYgMfTxR-B63wy9acC_7y8Q\n2023-08-02T20:18:08.150094277Z [INFO][NRF][Token] Token Type: Bearer\n2023-08-02T20:18:08.150133189Z [INFO][NRF][Token] Expires In: 1000\n2023-08-02T20:18:08.150167371Z [INFO][NRF][Token] Scope: nudr-dr\n</code></pre> <p>Finally, you can see 200. 200 means that AUSF sends the <code>AccessTokenReq</code> to NRF. NRF successfully sends to AUSF after verification.</p> <pre><code>2023-08-02T20:18:08.150302345Z [INFO][NRF][GIN] | 200 |       127.0.0.1 | POST    | /oauth2/token |\n</code></pre>"},{"location":"blog/20230802/20230802/#reference","title":"Reference","text":"<ul> <li>TS 29.510</li> <li>TS 33.501</li> <li>[Notes] Understanding OAuth 2.0: Understand the differences of each role and each type of process at one time</li> <li>https://blog.techbridge.cc/2019/02/01/linux-curl-command-tutorial/</li> <li>https://github.com/free5gc/free5gc/issues/434</li> </ul>"},{"location":"blog/20230802/20230802/#about","title":"About","text":"<p>Hi, my name is Wilson. I am a master\u2019s student. My main area of research is network slicing. In the future, I will introduce more information about 5G. Hope you enjoy it.</p> <p>Note</p> <p>If you are interested in supporting free5GC, we welcome your donation. Please visit this link for more details.</p>"},{"location":"blog/20230809/main/","title":"Fuzz Testing in Go: Discovering Vulnerabilities and Analyzing a Real Case (CVE-2022-43677)","text":"<p>Note</p> <p>Author: Yu-Sheng Liu Date: 2023/8/9</p>"},{"location":"blog/20230809/main/#overview","title":"Overview","text":"<p>In this article, we begin by introducing the concept of fuzz testing and its significance in software testing. Subsequently, we present Go Fuzzing as an illustrative example to demonstrate how to implement fuzz testing in Go. Lastly, we showcase a practical case, CVE-2022-43677, to exemplify how we conduct fuzz testing on the free5GC system.</p>"},{"location":"blog/20230809/main/#fuzz-testing","title":"Fuzz Testing","text":""},{"location":"blog/20230809/main/#what-is-fuzz-testing-fuzzing","title":"What is Fuzz Testing (Fuzzing)?","text":"<p>Fuzz testing, commonly known as fuzzing, is an automated software testing technique used to uncover vulnerabilities, defects, and unexpected behavior in computer systems, applications, and networks. The primary objective of fuzzing is to identify security flaws, crashes, or abnormal program behavior caused by invalid or unexpected inputs.</p>"},{"location":"blog/20230809/main/#how-fuzz-testing-works","title":"How Fuzz Testing Works","text":"<p>Fuzz testing involves subjecting the target software or system to a large number of inputs, including random or malformed data, to see how it handles them.  The idea is to explore edge cases and input combinations that may not have been adequately tested during traditional software testing. Here's how the fuzzing process typically works:</p> <ol> <li> <p>Test Input Generation:</p> <ul> <li>Fuzzing tools generate test inputs based on various techniques, which can be broadly categorized as:<ul> <li>Random Fuzzing: The simplest approach where random data is generated as input.</li> <li>Mutation-Based Fuzzing: Starting with valid inputs, the tool applies mutations to create variations of the original data.</li> <li>Grammar-Based Fuzzing: Using a predefined grammar or structure to generate valid and invalid inputs.</li> <li>Seed Corpus: Using existing inputs (e.g., files, network packets) as the starting set for mutation.</li> </ul> </li> </ul> </li> <li> <p>Test Execution:</p> <ul> <li>The generated inputs are provided as input to the target application, component, or system.</li> <li>The application is executed with each input, and its behavior is monitored during runtime.</li> </ul> </li> <li> <p>Monitoring and Analysis:</p> <ul> <li>The fuzzer observes the application's behavior, including any crashes, exceptions, hangs, or memory-related issues.</li> <li>Code coverage analysis is often performed to determine which parts of the code were exercised during the testing.</li> </ul> </li> <li> <p>Feedback and Iteration:</p> <ul> <li>Fuzzing tools use feedback mechanisms to prioritize and select inputs that lead to new code paths or unique behavior.</li> <li>The process is iterated with refined inputs to continue exploring deeper into the application.</li> </ul> </li> </ol>"},{"location":"blog/20230809/main/#types-of-fuzz-testing","title":"Types of Fuzz Testing","text":"<ol> <li> <p>Black Box Fuzzing:</p> <ul> <li>The tester has no access to the application's internal code or design.</li> <li>Random or mutated inputs are provided to the application to observe its behavior.</li> <li>Suitable for testing closed-source software or systems where the tester has limited knowledge.</li> </ul> </li> <li> <p>White Box Fuzzing:</p> <ul> <li>The tester has access to the application's source code and can leverage this knowledge for targeted testing.</li> <li>Inputs can be intelligently crafted to explore specific code paths and functions.</li> <li>Provides more in-depth coverage but requires access to the application's code.</li> </ul> </li> <li> <p>Grey Box Fuzzing:</p> <ul> <li>A combination of black box and white box approaches.</li> <li>The tester has partial knowledge of the application, such as certain APIs or protocols, but not complete access to the source code.</li> <li>Offers a balance between targeted testing and exploration of unknown behaviors.</li> </ul> </li> </ol>"},{"location":"blog/20230809/main/#advantages-of-fuzz-testing","title":"Advantages of Fuzz Testing","text":"<ol> <li> <p>Bug and Vulnerability Discovery:</p> <ul> <li>Fuzzing can uncover previously unknown security vulnerabilities and software defects, including memory corruption errors and input validation issues.</li> </ul> </li> <li> <p>Automation and Efficiency:</p> <ul> <li>Fuzzing is an automated testing process, which allows it to scale and test large codebases quickly and efficiently.</li> </ul> </li> <li> <p>Diverse Test Inputs:</p> <ul> <li>Fuzzing generates a wide range of test inputs, exploring various edge cases that might not be covered by manual testing.</li> </ul> </li> <li> <p>Early Vulnerability Detection:</p> <ul> <li>Fuzzing can be integrated into the development process, enabling early detection and mitigation of vulnerabilities before deployment.</li> </ul> </li> </ol>"},{"location":"blog/20230809/main/#conclusion-for-fuzz-testing","title":"Conclusion for fuzz testing","text":"<p>Fuzz testing, or fuzzing, is a powerful and essential technique in the realm of software security testing.  By providing a diverse set of inputs and exploring uncharted code paths, fuzz testing uncovers vulnerabilities and defects that might otherwise remain hidden.</p> <p>Next, we will use Go fuzzing as an example to introduce how to develop a fuzzing in Go.</p>"},{"location":"blog/20230809/main/#go-fuzzing","title":"Go Fuzzing","text":"<p>Go officially supports fuzzing starting from Go 1.18, and its official figure provides a brief and clear summary of the fuzzing function components. </p> <p>Similar to Go's unit test functions, the fuzzing function in Go must follow the naming convention <code>FuzzXxx</code> and take an argument of type <code>*testing.F</code>. This argument has two main functions, <code>Add</code> and <code>Fuzz</code>.</p> <ol> <li> <p><code>Add</code> Function:</p> <ul> <li>You can use the <code>Add</code> function to add your own test data to the seed corpus for fuzz testing. The seed corpus is the initial set of inputs that <code>go-fuzz</code> will use to start the fuzzing process.</li> </ul> </li> <li> <p><code>Fuzz</code> Function:</p> <ul> <li>The <code>Fuzz</code> function will be the target function that you want to test using fuzzing. It must have <code>*testing.T</code> as its first argument, similar to regular unit tests.</li> <li>Additionally, the <code>Fuzz</code> function supports variadic arguments with the following basic data types:<ul> <li><code>string</code>, <code>[]byte</code></li> <li><code>int</code>, <code>int8</code>, <code>int16</code>, <code>int32/rune</code>, <code>int64</code></li> <li><code>uint</code>, <code>uint8/byte</code>, <code>uint16</code>, <code>uint32</code>, <code>uint64</code></li> <li><code>float32</code>, <code>float64</code></li> <li><code>bool</code></li> </ul> </li> </ul> </li> </ol> <p>These data types represent the different kinds of input data that can be passed to the <code>Fuzz</code> function during the fuzzing process. The fuzzer will generate and mutate inputs of these types to explore different code paths and uncover bugs or unexpected behavior in the target function.</p> <p>In summary, when writing fuzzing functions in Go, remember to use the <code>FuzzXxx</code> naming pattern, accept <code>*testing.F</code> as an argument, utilize the <code>Add</code> function to customize the seed corpus, and use the <code>Fuzz</code> function with supported basic data types to perform fuzz testing on your target functions.</p> <p>You can use the command to execute the fuzz testing: <pre><code>go test -fuzz=&lt;regex&gt; -fuzztime=&lt;duration or times&gt;\n\n# Execute the fuzz testing until it crashs or finding some errors\ngo test -fuzz=Fuzz\n\n# Execute the fuzz testing ten iterations\ngo test -fuzz=Fuzz -fuzztime=10x\n\n# Execute the fuzz testing twenty seconds\ngo test -fuzz=Fuzz -fuzztime=20s\n</code></pre></p>"},{"location":"blog/20230809/main/#simple-example-division","title":"Simple Example - Division","text":"<p>We have developed a very simple function called <code>Division</code> that accepts two arguments, <code>dividend</code> and <code>divisor</code>, and then returns two results: <code>quotient</code> and <code>remainder</code>.</p> <pre><code>func Division(dividend, divisor int32) (\n    quotient, remainder int32,\n) {\n    quotient = dividend / divisor\n    remainder = dividend % divisor\n\n    return\n}\n</code></pre> <p>In the <code>FuzzDivision</code> function, we utilize the data generated by the Go fuzzer to test our <code>Division</code> function.</p> <pre><code>func FuzzDivision(f *testing.F) {\n    f.Fuzz(func(t *testing.T,\n        n1, n2 int32,\n    ) {\n        q, r := Division(n1, n2)\n\n        require.Equal(t, n1, n2*q+r)\n    })\n}\n</code></pre> <p>We expected to see: <pre><code>n1 / n2 = q ... r\nn1 = n2 * q + r\n</code></pre></p> <p>There should not be any problems with this implementation.</p> <p>Then we can use the following command to start the fuzz testing.</p> <pre><code>go test -fuzz=^FuzzDivision$\n</code></pre> <p>The fuzz testing reports the error \"integer divide by zero\".</p> <p></p> <p>As a normal user, we understand that the divisor cannot be zero. However, the input data may not always be as expected. This is precisely why we use fuzz testing\u2014to help us find edge cases and uncover unexpected behavior.</p> <p>Go stores the data that caused the fuzz testing to fail. You can check them using the following command.     * Note: The file name, <code>29bf8459dc5d452f64d41eb8a253f6a672939b146b07fcced0b17e99729e9b91</code>, may not be the same.</p> <pre><code>cat testdata/fuzz/FuzzDivision/29bf8459dc5d452f64d41eb8a253f6a672939b146b07fcced0b17e99729e9b91\n</code></pre> <p>The content of the file is as follows: <pre><code>go test fuzz v1\nint32(-7)\nrune('\\x00')\n</code></pre></p> <p>The first line indicates the encoding version, and the subsequent lines represent the argument values that triggered the error during the fuzz testing.</p> <p>Now we can modify our <code>Division</code> function to check the <code>divisor</code> if it is zero.</p> <pre><code>var ErrorDivideByZero = fmt.Errorf(\"integer divide by zero\")\n\nfunc Division(dividend, divisor int32) (\n    quotient, remainder int32, err error,\n) {\n    if divisor == 0 {\n        err = ErrorDivideByZero\n        return\n    }\n\n    quotient = dividend / divisor\n    remainder = dividend % divisor\n\n    return\n}\n</code></pre> <p>Similarly, the <code>FuzzDivision</code> fuzzing function now checks for the presence of the <code>ErrorDivideByZero</code> error.</p> <pre><code>func FuzzDivision(f *testing.F) {\n    f.Add(int32(67), int32(3))\n\n    f.Fuzz(func(t *testing.T,\n        n1, n2 int32,\n    ) {\n        if q, r, err := Division(n1, n2); err != ErrorDivideByZero {\n            require.Equal(t, n1, n2*q+r)\n        }\n    })\n}\n</code></pre> <p>Now, we can use the following command to re-test the failing case.</p> <pre><code>go test -run=FuzzDivision/29bf8459dc5d452f64d41eb8a253f6a672939b146b07fcced0b17e99729e9b91\n</code></pre>"},{"location":"blog/20230809/main/#conclusion-for-go-fuzzing","title":"Conclusion for Go Fuzzing","text":"<p>We have used a simple example to describe how to develop a fuzzing function in Go and how to leverage the Go command-line tool to execute fuzz testing.</p> <p>Next, we will examine a real case, CVE-2022-43677, and demonstrate the process of developing a fuzzing function to identify edge cases.</p>"},{"location":"blog/20230809/main/#cve-2022-43677","title":"CVE-2022-43677","text":"<p>Accroding to the descriptoin:</p> <p>In free5GC 3.2.1, a malformed NGAP message can crash the AMF and NGAP decoders via an index-out-of-range panic in aper.GetBitString.</p> <p>In response to this vulnerability, we have developed a fuzzing function to test the NGAP decoder. The function utilizes two approaches: modifying the NGAP message's content under a valid template or adjusting its format by changing the Information Elements (IEs) with variable lengths.</p> <pre><code>// Put the code under the free5gc/test\nfunc FuzzNgapDecode(f *testing.F) {\n    f.Fuzz(func(t *testing.T,\n        modifyWhat uint8,\n        changeIe0, changeIe1, changeIe2, changeIe3, changeIe4 bool,\n        valueIe0A uint32,\n        valueIe2ACellId uint64, valueIe2ATac uint32,\n        valueIe3A uint64,\n        valueIe4A uint64,\n        valueIePlmn uint32,\n    ) {\n        var idx, n int\n        var sendMsg []byte\n        var registrationRequest []byte\n        var bs []byte\n        var err error\n        var ngapPdu ngapType.NGAPPDU\n        var mobileIdentity5GS nasType.MobileIdentity5GS\n        var ue *test.RanUeContext\n\n        // New UE\n        ue = test.NewRanUeContext(\"imsi-2089300007487\", 1, security.AlgCiphering128NEA0, security.AlgIntegrity128NIA2,\n            models.AccessType__3_GPP_ACCESS)\n        ue.AmfUeNgapId = 1\n        ue.AuthenticationSubs = test.GetAuthSubscription(TestGenAuthData.MilenageTestSet19.K,\n            TestGenAuthData.MilenageTestSet19.OPC,\n            TestGenAuthData.MilenageTestSet19.OP)\n\n        mobileIdentity5GS = nasType.MobileIdentity5GS{\n            Len:    12, // suci\n            Buffer: []uint8{0x01, 0x02, 0xf8, 0x39, 0xf0, 0xff, 0x00, 0x00, 0x00, 0x00, 0x47, 0x78},\n        }\n\n        if modifyWhat%2 == DoModifyContent {\n            if changeIe0 {\n                // RAN UE NGAP ID\n                ue.RanUeNgapId = int64(valueIe0A)\n            }\n\n            registrationRequest = nasTestpacket.GetRegistrationRequest(\n                nasMessage.RegistrationType5GSInitialRegistration, mobileIdentity5GS, nil, ue.GetUESecurityCapability(), nil, nil, nil)\n            ngapPdu = ngapTestpacket.BuildInitialUEMessage(ue.RanUeNgapId, registrationRequest, \"\")\n\n            if changeIe2 {\n                // User Location Information\n                for _, ie := range ngapPdu.InitiatingMessage.Value.InitialUEMessage.ProtocolIEs.List {\n                    if ie.Id.Value == ngapType.ProtocolIEIDUserLocationInformation {\n                        bs = make([]byte, 4)\n                        valueIePlmn &amp;= uint32(PlmnMask)\n                        binary.LittleEndian.PutUint32(bs, valueIePlmn)\n\n                        NgRan := ie.Value.UserLocationInformation.UserLocationInformationNR\n                        NgRan.NRCGI.PLMNIdentity.Value = bs[:PlmnByteLen]\n                        NgRan.TAI.PLMNIdentity.Value = bs[:PlmnByteLen]\n\n                        bs = make([]byte, 8)\n                        valueIe2ACellId &amp;= uint64(CellIdMask)\n                        binary.LittleEndian.PutUint64(bs, valueIe2ACellId)\n                        NgRan.NRCGI.NRCellIdentity.Value.Bytes = bs[:CellIdByteLen]\n\n                        bs = make([]byte, 4)\n                        valueIe2ATac &amp;= uint32(TacMask)\n                        binary.LittleEndian.PutUint32(bs, valueIe2ATac)\n                        NgRan.TAI.TAC.Value = bs[:TacByteLen]\n                    }\n                }\n            }\n            if changeIe3 {\n                // RRC Establishment Cause\n                for _, ie := range ngapPdu.InitiatingMessage.Value.InitialUEMessage.ProtocolIEs.List {\n                    if ie.Id.Value == ngapType.ProtocolIEIDRRCEstablishmentCause {\n                        ie.Value.RRCEstablishmentCause.Value = aper.Enumerated(valueIe3A)\n                    }\n                }\n            }\n            if changeIe4 {\n                // UE Context Request\n                for _, ie := range ngapPdu.InitiatingMessage.Value.InitialUEMessage.ProtocolIEs.List {\n                    if ie.Id.Value == ngapType.ProtocolIEIDUEContextRequest {\n                        ie.Value.UEContextRequest.Value = aper.Enumerated(valueIe4A)\n                    }\n                }\n            }\n            sendMsg, err = ngap.Encoder(ngapPdu)\n        } else if modifyWhat%2 == DoModifyFormat {\n            registrationRequest = nasTestpacket.GetRegistrationRequest(\n                nasMessage.RegistrationType5GSInitialRegistration, mobileIdentity5GS, nil, ue.GetUESecurityCapability(), nil, nil, nil)\n\n            if changeIe1 {\n                registrationRequest[3] += 1\n                registrationRequest = append(registrationRequest, registrationRequest[len(registrationRequest)-1])\n            } else {\n                registrationRequest[3] -= 1\n                registrationRequest = registrationRequest[:len(registrationRequest)-1]\n            }\n\n            ngapPdu = ngapTestpacket.BuildInitialUEMessage(ue.RanUeNgapId, registrationRequest, \"\")\n            sendMsg, err = ngap.Encoder(ngapPdu)\n            require.Nil(t, err, \"Error: %v\", err)\n            require.Equal(t, int(sendMsg[3]), len(sendMsg[4:]), \"%v\", sendMsg)\n\n            idx = bytes.Index(sendMsg, []byte(\"\\x00\\x70\\x40\"))\n            assert.NotEqual(t, idx, -1, \"Can not find UE context Request\")\n            if idx != -1 {\n                if valueIe4A%8 == 0 || valueIe4A%8 == 1 {\n                    n = 2\n                } else {\n                    n = int(valueIe4A % 8)\n                }\n                sendMsg[idx+3] = uint8(n)\n                sendMsg = sendMsg[:idx+4]\n                bs = make([]byte, 8)\n                binary.LittleEndian.PutUint64(bs, valueIe4A)\n\n                for i := 0; i &lt; n; i++ {\n                    sendMsg = append(sendMsg, bs[i])\n                }\n\n                sendMsg[3] += uint8(n - 1) // total length\n            }\n        }\n        require.Equal(t, int(sendMsg[3]), len(sendMsg[4:]), \"%v\", sendMsg)\n\n        _, err = ngap.Decoder(sendMsg)\n    })\n}\n</code></pre> <p>We can use the following command to execute the fuzz testing.</p> <pre><code>go test -fuzz=^FuzzNgapDecode$ -run=^FuzzNgapDecode$\n</code></pre> <p>The test resulted in a crash, which confirms the presence of the vulnerability as described in CVE-2022-43677.</p> <p></p> <p>The bug was found in the package aper at version v1.0.4. Fortunately, the latest version of the package has already fixed this issue. To verify the fix, we can update the aper package to the latest commit using the following commands:</p> <pre><code># Update package aper to the latest commit\ngo get github.com/free5gc/aper@main\n</code></pre> <p>After updating the aper package, we can test it again with the fuzzing function:</p> <p><pre><code>go test -fuzz=^FuzzNgapDecode$ -run=^FuzzNgapDecode$\n</code></pre> </p> <pre><code># Alternatively, re-testing the failing case\ngo test -run=FuzzNgapDecode/87af855bbc381c8d510af5ce897fcdd7f9154574e61c0413223f7e31769c2767\n</code></pre> <p></p>"},{"location":"blog/20230809/main/#conclusion","title":"Conclusion","text":"<p>Fuzz testing is a powerful technique for improving the security and reliability of software systems. By subjecting programs to a wide range of inputs, fuzzing can uncover vulnerabilities and defects that might not be found through traditional testing methods. It automates the testing process, making it efficient and scalable for large codebases.</p> <p>In the context of Go programming, Go fuzzing is well-supported and integrates seamlessly with the standard testing framework. Developers can create fuzzing functions to target specific functions and uncover potential issues using random or mutated inputs.</p> <p>To demonstrate the effectiveness of fuzz testing, we presented a real case, CVE-2022-43677, which affected free5GC version 3.2.1. By developing a fuzzing function for the NGAP decoder, we were able to identify a vulnerability that caused a crash. </p> <p>In conclusion, fuzz testing is a critical practice in software development, enabling developers to proactively discover and resolve bugs and vulnerabilities. It empowers them to deliver more secure and robust software systems, providing users with a higher level of confidence in the applications they use. By incorporating fuzz testing as part of the software development lifecycle, developers can significantly enhance the quality and security of their software products.</p>"},{"location":"blog/20230809/main/#reference","title":"Reference","text":"<ul> <li>Go Fuzzing</li> <li>CVE-2022-43677</li> </ul>"},{"location":"blog/20230809/main/#about","title":"About","text":"<p>I'm Yu-Sheng Liu, a master's student at National Yang Ming Chiao Tung University. My research topic focuses on improving the performance of the 5G core network, such as reducing the latency of message propagation in SBI. If you have any questions, please don't hesitate to contact me!</p> <ul> <li>LinkedIn</li> </ul> <p>Note</p> <p>If you are interested in supporting free5GC, we welcome your donation. Please visit this link for more details.</p>"},{"location":"blog/20230816/main/","title":"Introduce Kubernetes and Deploy free5GC on Kubernetes with helm","text":"<p>Note</p> <p>Author: Elisa Lee Date: 2023/8/16</p>"},{"location":"blog/20230816/main/#abstract","title":"Abstract","text":"<p>In the initial section of the article, I will provide an introduction to Kubernetes. Moving on to the subsequent part, I will delve into the utilization of Kubernetes for facilitating the deployment of free5GC. Lastly, in the final segment of the article, I will elaborate on the effective utilization of Kubernetes for monitoring services.</p>"},{"location":"blog/20230816/main/#introduce-kubernetes","title":"Introduce Kubernetes","text":"<p>Do you know why Kubernetes is called k8s?</p> <p>It's due to a shorthand notation that uses the first letter \"k,\" followed by the number \"8,\" and ending with the last letter \"s\" to represent the full name.  Kubernetes,stands as an open-source container orchestration platform that bestows organizations with the capacity to adeptly govern, deploy, and expand containerized applications. Initially conceived by Google and presently overseen by the Cloud Native Computing Foundation (CNCF), Kubernetes has ascended to become a pivotal technological underpinning within the realm of contemporary cloud-native computing.</p> <p>For those who find themselves unacquainted with the intricacies of Kubernetes, let us embark on an exploration of its architectural framework.</p> <p> I understand that the image presented above might appear intricate at first glance. However, there's no need for concern. Allow me to guide you through each component step by step.</p>"},{"location":"blog/20230816/main/#pods","title":"Pods","text":"<p>A \"Pod\" stands as the most diminutive executable entity within the Kubernetes ecosystem. It possesses the capability to encompass either an individual container or a collective assembly of containers. The subsequent enumeration outlines several salient distinctions that set it apart from the act of directly launching a standalone container.</p> <p>Notably, a Pod possesses its dedicated network interface, affording all enclosed containers the ability to intercommunicate seamlessly by interfacing with the \"localhost.\" Furthermore, connectivity to other Pods is conveniently established through direct usage of their respective IP addresses within the Kubernetes environment.</p> <p>The Pod's inherent duplicability and capacity for effortless restarts, even from the point of its most recent execution, distinguish it. Additionally, the versatility of including a functioning container within its initial state further characterizes its nature.</p> <p>Collectively, these attributes contribute to the refinement and streamlined nature of networking within the Kubernetes ecosystem. Such qualities not only facilitate smoother scalability but also offer enhanced capabilities for restarting services with utmost ease.</p>"},{"location":"blog/20230816/main/#nodes","title":"Nodes","text":"<p>Consider a \"node\" as a tangible computing entity akin to a physical machine. Analogous to our personal machines, these nodes possess the capacity to concurrently execute multiple tasks, akin to the pods referenced earlier. The orchestration of nodes is overseen by a pivotal component known as the Kubernetes control plane, which, in an automated fashion, allocates pods across the available nodes. Within each node, a minimum of two services operate in tandem.</p> <ol> <li> <p>Kubelet: This crucial service undertakes the responsibility of facilitating seamless communication between the Kubernetes control plane and the individual node. It serves as the intermediary that relays instructions and status updates, ensuring synchronization and cooperation.</p> </li> <li> <p>Container Runtime: Operating in tandem with Kubelet, the container runtime undertakes pivotal functions. These encompass retrieving container images from registries, the unpacking of containers, and the actual execution of applications. A prime example of such a container runtime is Docker, renowned for its role in enabling containerization.</p> </li> </ol> <p>In essence, this intricate interplay of nodes, services, and orchestration elements underscores the dynamism and efficiency inherent to the Kubernetes ecosystem. Through these interlocking mechanisms, the platform optimizes resource utilization, ensures effective communication, and enables the seamless execution of applications across a distributed infrastructure.</p>"},{"location":"blog/20230816/main/#master-nodes","title":"Master Nodes","text":"<p>We've now explored all the scalable components and the task runner. Undoubtedly, to orchestrate and oversee everything, a central command hub is necessary \u2013 this is referred to as the master node. Although direct intervention within these nodes isn't typically required to ensure the seamless operation of the entire system, it's still beneficial for you to grasp a basic understanding of its functionality.</p>"},{"location":"blog/20230816/main/#api-server","title":"API server","text":"<p>It determines which interface among all nodes can be externally accessed. Any subsequent commands you execute will be channeled through this service to the designated node or pod. Furthermore, essential cluster information can also be obtained from this service.</p>"},{"location":"blog/20230816/main/#scheduler","title":"Scheduler","text":"<p>Similar to an airport's control tower, its function is akin to orchestrating the deployment of pods on specific nodes based on the rules you've established and the data obtained from the API server. The effectiveness of these rules is pivotal, as they often determine the system's overall efficiency.</p>"},{"location":"blog/20230816/main/#controller-manager","title":"Controller Manager","text":"<p>When the need arises to enact concrete modifications on a pod, such as terminating or pausing its operation, a fundamental prerequisite is pinpointing the pod's process location and establishing the means to interact with it. This is precisely the role fulfilled by the controller manager. Additionally, this manager oversees vital components, including accounts, services, and more.</p>"},{"location":"blog/20230816/main/#etcd","title":"Etcd","text":"<p>For a simplified understanding, we can view this as essentially a comprehensive backup of the entire cluster.</p>"},{"location":"blog/20230816/main/#service","title":"Service","text":"<p>In Kubernetes, a \"service\" is an abstraction that enables communication between different sets of pods, usually to provide a stable network endpoint for accessing a specific group of pods. Pods in Kubernetes are ephemeral and can be created, terminated, or scaled dynamically, which makes their IP addresses and lifecycles unpredictable. Services provide a way to decouple the frontend of an application from the backend pods, making it easier for other components or users to access the application without having to know the exact locations or IP addresses of the pods.</p> <p>A service can be defined in Kubernetes using a YAML or JSON configuration file, and it is associated with a set of pods based on a label selector. The service acts as a load balancer, distributing incoming network traffic among the pods that match the specified selector. This distribution ensures that even if pods are scaled up or down, the service remains available and reachable.</p> <p>There are different types of services in Kubernetes:</p> <ol> <li> <p>ClusterIP: This is the default service type, and it exposes the service on a cluster-internal IP address. It is accessible only within the cluster.</p> </li> <li> <p>NodePort: This type exposes the service on each node's IP address at a static port. It allows external access to the service using the node's IP and the specified static port.</p> </li> <li> <p>LoadBalancer: This type automatically provisions a cloud provider load balancer to expose the service externally. It works in environments that support external load balancers.</p> </li> <li> <p>ExternalName: This type provides an alias for an external service by returning a CNAME record with the configured DNS name.</p> </li> </ol> <p>Services are a fundamental concept in Kubernetes and play a crucial role in enabling communication and load balancing between pods and external clients. They provide a stable and abstracted network endpoint that allows applications to scale and be more resilient without disrupting access from users or other components.</p> <p>In the upcoming section, I will delve into the process of deploying free5GC on Kubernetes.</p>"},{"location":"blog/20230816/main/#deploying-5g-core-network-with-free5gc","title":"Deploying 5G core network with free5GC","text":"<p>Now I'm going to introduce how to implement free5GC on Kubernetes with helm</p>"},{"location":"blog/20230816/main/#install-require-packages","title":"Install require packages","text":"<pre><code>sudo apt update -y\nsudo apt upgrade -y\n</code></pre>"},{"location":"blog/20230816/main/#install-apt-transport-https","title":"Install apt-transport-https","text":"<p>\"apt-transport-https\" is a crucial package that equips your system with the essential tools and libraries required to seamlessly integrate the HTTPS protocol. This integration ensures secure and encrypted communication when connecting to package repositories while utilizing the Advanced Package Tool (APT) for effective package management. <pre><code>sudo apt install -y curl wget apt-transport-https\n</code></pre></p>"},{"location":"blog/20230816/main/#install-gtp5g","title":"Install gtp5g","text":"<p>\"gtp5g\" refers to a customized Linux kernel module specifically designed to handle packets by PFCP (Packet Forwarding Control Protocol) Information Elements (IEs) such as PDR (Packet Detection Rule) and FAR (Forwarding Action Rule). For comprehensive insights, you can delve into the 3GPP specifications TS 29.281 and TS 29.244. To employ the UPF (User Plane Function) component effectively, it's imperative to operate on either the 5.0.0-23-generic or 5.4.x version of the Linux kernel. This ensures optimal compatibility and seamless integration with the necessary functionalities. <pre><code>sudo apt install gcc\nsudo apt install make\ngit clone -b v0.8.1 https://github.com/free5gc/gtp5g.git\ncd gtp5g\nmake\nsudo make install\n</code></pre></p>"},{"location":"blog/20230816/main/#install-docker","title":"Install docker","text":"<p>\"docker\" is a platform that enables developers to build, package, and distribute applications as containers. Containers are lightweight, portable, and self-sufficient units that encapsulate everything an application needs to run, including the code, runtime, system tools, system libraries, and settings. Docker provides a consistent environment across different development and deployment stages, from local development to testing and production. <pre><code>for pkg in docker.io docker-doc docker-compose podman-docker containerd runc; do sudo apt-get remove $pkg; done\nsudo apt-get update\nsudo apt-get install ca-certificates curl gnupg\nsudo install -m 0755 -d /etc/apt/keyrings\ncurl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg\nsudo chmod a+r /etc/apt/keyrings/docker.gpg\necho \\\n  \"deb [arch=\"$(dpkg --print-architecture)\" signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu \\\n  \"$(. /etc/os-release &amp;&amp; echo \"$VERSION_CODENAME\")\" stable\" | \\\n  sudo tee /etc/apt/sources.list.d/docker.list &gt; /dev/null\n  sudo apt-get update\n  sudo apt-get install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin\n</code></pre></p>"},{"location":"blog/20230816/main/#install-minikube","title":"Install minikube","text":"<p>\"minikube\" is an open-source tool that enables developers to set up and run a single-node Kubernetes cluster locally on their own computer. It's particularly useful for learning, development, and testing purposes. Minikube provides an easy way to experience Kubernetes without needing access to a full-scale cluster, making it a great tool for getting familiar with Kubernetes concepts and features. <pre><code>wget https://storage.googleapis.com/minikube/releases/latest/minikube-linux-amd64\nsudo cp minikube-linux-amd64 /usr/local/bin/minikube\nsudo chmod +x /usr/local/bin/minikube\n</code></pre></p>"},{"location":"blog/20230816/main/#install-kubectl","title":"Install kubectl","text":"<p>\"kubectl\" is the command-line tool used to interact with and manage Kubernetes clusters. It is an essential component for working with Kubernetes, allowing users to perform various tasks and operations on Kubernetes clusters directly from the terminal. <pre><code>curl -LO https://storage.googleapis.com/kubernetes-release/release/`curl -s https://storage.googleapis.com/kubernetes-release/release/stable.txt`/bin/linux/amd64/kubectl\nchmod +x kubectl\nsudo mv kubectl /usr/local/bin/\n</code></pre></p>"},{"location":"blog/20230816/main/#install-helm","title":"Install helm","text":"<p>\"helm\" is a package manager for Kubernetes that simplifies the deployment and management of applications and services on a Kubernetes cluster. It allows you to define, install, and upgrade complex applications using pre-configured templates called \"charts.\" These charts encapsulate all the necessary resources, configurations, and dependencies required to run an application. <pre><code>curl -fsSL -o get_helm.sh https://raw.githubusercontent.com/helm/helm/master/scripts/get-helm-3\nchmod 700 get_helm.sh\n./get_helm.sh\nhelm list -A\n</code></pre> </p>"},{"location":"blog/20230816/main/#install-multus-cni","title":"Install multus-cni","text":"<p>\"multus-cni\" is a project that provides a Kubernetes network plugin, specifically a \"Container Network Interface\" (CNI) plugin, which enables the attachment of multiple network interfaces to pods in a Kubernetes cluster. <pre><code>git clone https://github.com/k8snetworkplumbingwg/multus-cni.git \n</code></pre></p>"},{"location":"blog/20230816/main/#deploy-free5gc","title":"Deploy free5GC","text":""},{"location":"blog/20230816/main/#useful-kubectl-command","title":"Useful kubectl command","text":"<p>Now, I will proceed to introduce a selection of kubectl command that can be employed during the deployment of free5GC.</p> <p>\"kubectl get pods\" retrieves a list of running pods in the current namespace along with their names, statuses, and other relevant information. <pre><code>kubectl get pods \n</code></pre> \"kubectl describe pod\" is used to get detailed information about a specific pod, including its status, events, labels, and more.</p> <p><pre><code>kubectl describe pod [pod-name]\n</code></pre> \"kubectl logs\" fetches the logs of a specific pod, helping you troubleshoot issues and monitor application output.</p> <p><pre><code>kubectl logs [pod-name]\n</code></pre> \"kubectl exec -it\" allows you to execute a command inside a running pod. The <code>-it</code> flag enables interactive terminal access. <pre><code>kubectl exec -it [pod-name] -- [command]\n</code></pre> \"kubectl apply -f \" deploys resources defined in a YAML file, such as pods, services, or deployments, to your cluster. <pre><code>kubectl apply -f [yaml-file]\n</code></pre> \"kubectl delete\" deletes a specific resource by specifying its type and name, freeing up resources and cleaning the cluster. <pre><code>kubectl delete [resource-type] [resource-name]\n</code></pre> \"kubectl expose deployment\" creates a new service, typically of type LoadBalancer, to expose a deployment's pods to external network traffic. <pre><code>kubectl expose deployment [deployment-name] --type=LoadBalancer --port=[port]\n</code></pre></p> <p>\"kubectl get services\" lists all services running in the current namespace along with their details, including ClusterIP, external IP (if applicable), and ports. <pre><code>kubectl get services\n</code></pre> \"kubectl get nodes\" retrieves information about the worker nodes in the cluster, displaying their statuses, roles, and other essential data. <pre><code>kubectl get nodes\n</code></pre> \"kubectl describe node\" provides detailed information about a specific node, including its capacity, allocated resources, and conditions. <pre><code>kubectl describe node [node-name]\n</code></pre> \"kubectl get namespaces\" displays all available namespaces in the cluster, which are used to isolate resources and manage multi-tenancy. <pre><code>kubectl get namespaces\n</code></pre> \"kubectl create namespace\" creates a new namespace, allowing you to logically separate and organize resources.  <pre><code>kubectl create namespace [namespace-name]\n</code></pre> \"kubectl port-forward\" enables you to create a network tunnel between your local machine and a specific pod running within a Kubernetes cluster. This allows you to access services or applications running inside the pod as if they were running on your local machine. The command forwards traffic from a specified local port to a port on the selected pod. <pre><code>kubectl port-forward [pod-name] [local-port]:[remote-port]\n</code></pre></p>"},{"location":"blog/20230816/main/#start-minikube","title":"Start minikube","text":"<p>Use flannel as cni plugin to start minikue. Flannel is a popular \"Container Network Interface\" (CNI) plugin used for networking in Kubernetes and other container orchestration platforms. It provides a simple and lightweight network fabric designed to facilitate communication between containers and pods in a distributed environment, such as a Kubernetes cluster. <pre><code>sudo usermod -aG docker $USER &amp;&amp; newgrp docker\nminikube start --driver=docker --cpus=4 --memory=8g --disk-size=20g --cni=flannel\n## verify minikube installation\nminikube status \n</code></pre> </p>"},{"location":"blog/20230816/main/#enable-multus-cni-plugin","title":"Enable Multus-CNI Plugin","text":"<pre><code>cd multus-cni\ncat ./deployments/multus-daemonset.yml | kubectl apply -f -\n</code></pre>"},{"location":"blog/20230816/main/#install-free5gc-and-ueransim","title":"Install free5GC and UERANSIM","text":"<p>If you have only one interface on each Kubernetes node and its name is <code>toto</code>. Then you have to set these parameters to <code>toto</code>: <code>global.n2network.masterIf</code> <code>global.n3network.masterIf</code> <code>global.n4network.masterIf</code> <code>global.n6network.masterIf</code> <code>global.n9network.masterIf</code></p> <p><pre><code>kubectl create ns free5gc\ngit clone https://github.com/Orange-OpenSource/towards5gs-helm.git\ncd towards5gs-helm/charts/\nhelm -n free5gc install free5gc-v1 ./free5gc/\nhelm -n free5gc install ueransim-v1 ./ueransim/\nwatch kubectl get pods -n free5gc\n</code></pre> </p>"},{"location":"blog/20230816/main/#start-webconsole","title":"Start WebConsole","text":"<p>free5GC offers a user-friendly web tool called WebConsole, designed to facilitate the creation and management of User Equipment (UE) registrations. This tool serves as a valuable resource for multiple 5G network functions (NFs), streamlining the process of handling UE registrations and associated tasks. <pre><code>kubectl port-forward --namespace free5gc svc/webui-service 5000:5000\n</code></pre> Execute the following command in your local machine's terminal, and subsequently, you will be able to access the WebConsole via localhost:5000. You can login with username <code>admin</code> and password <code>free5gc</code>. <pre><code>ssh -L localhost:5000:localhost:5000 ubuntu@[VM ip]\n</code></pre> </p>"},{"location":"blog/20230816/main/#service-monitoring","title":"Service Monitoring","text":""},{"location":"blog/20230816/main/#install-prometheusgrafana-services","title":"install Prometheus/Grafana services","text":"<p>For monitoring Kubernetes, I utilized Prometheus and Grafana. The installation of Prometheus and Grafana services is facilitated through the Helm chart provided by the prometheus-community. <pre><code>helm repo add prometheus-community https://prometheus-community.github.io/helm-charts\nhelm repo update\nkubectl create namespace prometheus\nhelm install prometheus prometheus-community/kube-prometheus-stack -n prometheus\nwatch kubectl get pods -n prometheus\n</code></pre> </p> <p><pre><code>kubectl port-forward -n prometheus svc/prometheus-grafana 8080:80\n</code></pre> Execute the following command in your local machine's terminal, and subsequently, you will be able to access the WebConsole via localhost:8080. <pre><code>ssh -L localhost:8080:localhost:8080 ubuntu@[VM ip]\n</code></pre>  A variety of dashboards are available, offering different perspectives for those who are interested. Below is a snapshot of one such dashboard option.</p> <p></p>"},{"location":"blog/20230816/main/#reference","title":"Reference","text":"<p>https://free5gc.org/</p> <p>https://medium.com/rahasak/deploying-5g-core-network-with-free5gc-kubernets-and-helm-charts-29741cea3922</p> <p>https://github.com/Orange-OpenSource/towards5gs-helm</p> <p>https://github.com/k8snetworkplumbingwg/multus-cni</p>"},{"location":"blog/20230816/main/#about","title":"About","text":"<p>Hello, I am Elisa Lee. My ongoing research revolves around VoNR (Voice over New Radio). I encourage any inquiries or identification of errors within the article, as they are welcomed for correction. Your feedback is invaluable, so please don't hesitate to reach out via email to share your insights.</p> <p>Note</p> <p>If you are interested in supporting free5GC, we welcome your donation. Please visit this link for more details.</p>"},{"location":"blog/20230823/20230823/","title":"Web security: CSRF vulnerability in webconsole","text":"<p>Note</p> <p>Author: Brian Chen (\u9673\u715c\u76db)  Date: 2023/8/23</p>"},{"location":"blog/20230823/20230823/#abstract","title":"Abstract","text":"<p>This article is intended for individuals who possess an interest in free5gc/webconsole and hold concerns regarding security matters. It aims to provide a concise introduction to the webconsole, followed by an exposition of a significant security concern along with our corresponding solution. Within webconsole v1.2.0, aligning with the most recent iteration of free5gc v3.3.0, certain vulnerabilities have been identified that could potentially lead to the exposure of subscriber data. It is my responsibility to address and rectify these vulnerabilities, enhancing the webconsole's resilience against cyber attacks.</p>"},{"location":"blog/20230823/20230823/#webconsole-overview","title":"Webconsole Overview","text":"<p>The Webconsole serves as a web-based tool designed to manage User Equipment (UE) subscription data. It plays a crucial role in aiding the free5GC Core Network manager by facilitating the configuration of UEs and providing the ability to monitor the status of activated UEs.</p>"},{"location":"blog/20230823/20230823/#environment","title":"Environment","text":"<ul> <li>Frontend<ul> <li>React v17.0.2</li> <li>node.js v20.2.0</li> <li>yarn v1.22.19</li> </ul> </li> <li>Backend<ul> <li>Golang v1.17</li> <li>Gin v1.9.0</li> <li>MongoDB v3.6.8</li> </ul> </li> </ul>"},{"location":"blog/20230823/20230823/#install-run-webconsole","title":"Install &amp; Run webconsole","text":"<p>Prior to building webconsole, install nodejs and yarn package first:</p> <pre><code>sudo apt remove cmdtest\nsudo apt remove yarn\ncurl -sS https://dl.yarnpkg.com/debian/pubkey.gpg | sudo apt-key add -\necho \"deb https://dl.yarnpkg.com/debian/ stable main\" | sudo tee /etc/apt/sources.list.d/yarn.list\nsudo apt-get update\nsudo apt-get install -y nodejs yarn\n</code></pre> <p>To run free5GC webconsole server. The following steps are to be considered.</p> <pre><code>git clone https://github.com/free5gc/webconsole.git\ncd frontend\nyarn install\nyarn build\nrm -rf ../public\ncp -R build ../public\ncd ..\ngo run server.go\n</code></pre> <p>Default account and password is <code>admin/free5gc</code></p> <p></p>"},{"location":"blog/20230823/20230823/#pages","title":"Pages","text":""},{"location":"blog/20230823/20230823/#subscribers","title":"SUBSCRIBERS","text":"<p>Creation/deletion/editing the subscriber's data:</p> <p></p> <p>A Subscriber data contains these informations:</p> <ul> <li>PLMN ID</li> <li>SUPI (UE ID)</li> <li>AKA parameters</li> <li>S-NSSAI Configurations<ul> <li>Sst/Sd</li> <li>DNN<ul> <li>Name</li> <li>AMBR</li> <li>Flow Rules<ul> <li>IP Filter</li> <li>Precedence</li> <li>5QI</li> <li>GBR</li> <li>MBR</li> </ul> </li> </ul> </li> </ul> </li> </ul> <p></p>"},{"location":"blog/20230823/20230823/#tenant-and-user","title":"TENANT AND USER","text":"<p>The Webconsole also allows for the creation, deletion, and editing of tenants. A tenant functions as an access control group, delineating specific permissions and boundaries. In this setup, if you do not possess admin privileges, you are unable to access subscriber data generated by other tenants, ensuring data privacy and security.</p> <p></p> <p>Furthermore, the capability to incorporate users within a tenant is available. To illustrate, by selecting the brian1 tenant and clicking on the New User option, it becomes possible to introduce a new user. As an example, a user with the email address aaabbb@gmail.com can be added through this process.</p> <p></p> <p>The data within MongoDB can be accessed and reviewed using the MongoDBCompass tool.</p> <p></p>"},{"location":"blog/20230823/20230823/#csrf-cross-site-request-forgery-vulnerability","title":"CSRF (Cross-Site Request Forgery) Vulnerability","text":"<p>The vulnerability was discovered by INCIBE, and they promptly notified the free5GC team via email. </p> <p>The corresponding issue related to this vulnerability is also documented in the free5gc repository. Despite the typical deployment of the webconsole within LAN or Docker environments, it's essential to exercise caution regarding users who operate this service on a public IP or within an insecure network environment.</p> <p>In a nutshell, an attacker can gain unauthorized access to the database by merely setting the token to the term 'admin'. <pre><code>$ curl '&lt;webconsole's IP&gt;:5000/api/subscriber' -H 'User-Agent: Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:103.0) Gecko/20100101 Firefox/103.0' -H 'Accept: application/json' -H 'Accept-Language: en-US,en;q=0.5' -H 'Accept-Encoding: gzip, deflate' -H 'Referer: http://&lt;webconsole's IP&gt;:5000/' -H 'Connection: keep-alive' -H 'X-Requested-With: XMLHttpRequest' -H 'Token: admin' -H 'Pragma: no-cache' -H 'Cache-Control: no-cache'\n</code></pre></p> <p>Subsequently, they can directly retrieve subscriber information from the server's MongoDB. <pre><code>[{\"plmnID\":\"20893\",\"ueId\":\"imsi-208930000000003\"}]\n</code></pre></p> <p>Undoubtedly, this vulnerability is of significant concern since the intended safeguard, allowing access solely to admin, has been compromised, thereby enabling easy access for anyone.</p>"},{"location":"blog/20230823/20230823/#trace-code","title":"Trace Code","text":""},{"location":"blog/20230823/20230823/#frontend","title":"Frontend","text":"<p>In <code>webconsole/frontend/src/util/AuthHelper.js</code></p> <ul> <li>In scenarios where the default username and password (admin/free5gc) are employed, the <code>ApiHelper.login()</code> function remains untouched. This practice might expedite agile development, but it comes at the cost of compromising security.</li> </ul> <p></p>"},{"location":"blog/20230823/20230823/#backend","title":"Backend","text":"<p>In <code>webconsole/frontend/WebUI/api_webui.go</code> - In situations where a webconsole client configures the <code>tokenStr</code> as 'admin', the backend process will omit the execution of <code>ParseJWT()</code>.</p> <p></p>"},{"location":"blog/20230823/20230823/#json-web-token-jwt","title":"JSON Web Token (JWT)","text":"<p>The Webconsole relies on JSON Web Token (JWT) as its authentication mechanism, a specification outlined in RFC 7519. </p> <p>JSON Web Token (JWT) is a compact, URL-safe means of representing claims to be transferred between two parties.  The claims in a JWT are encoded as a JSON object that is used as the payload of a JSON Web Signature (JWS) structure or as the plaintext of a JSON Web Encryption (JWE) structure, enabling the claims to be digitally signed or integrity protected with a Message Authentication Code (MAC) and/or encrypted.</p> <p>When a client employs a web browser to initiate a login via the HTTP(s) protocol, the Web server is expected to furnish the client with a JWT token in response. Subsequently, the client employs this JWT token to interact with resources by sending requests through the RESTful API (such as GET, POST, PUT, etc.).</p> <p>A JSON Web Token (JWT) consists of three distinct parts. In the context of the webconsole backend, the following fields are relevant:</p> <ul> <li>Header: This section contains information about the type of token and the signing algorithm used. It often includes the \"alg\" (algorithm) and \"typ\" (type) fields.</li> <li>Payload: The payload holds the actual claims or data that are being conveyed by the token. For the webconsole backend, specific fields within this section could include:<ul> <li>Claim (JSON object)<ul> <li><code>sub</code>: identifies the principal that is the subject of the JWT.</li> <li><code>iat</code>: identifies the time at which the JWT was issued.</li> <li><code>exp</code>: identifies the expiration time onor after which the JWT MUST NOT be accepted for processing.</li> <li><code>email</code></li> <li><code>tenantId</code></li> <li>...(you can design the attribute yourself)</li> </ul> </li> </ul> </li> <li>Signature: This component is created by combining the encoded header and payload with a secret key (or a public/private key pair) to ensure the token's integrity and authenticity. The signature allows the recipient to verify that the token hasn't been tampered with.</li> </ul> <p>The JWT Claims Set represents a JSON object whose members are the claims conveyed by the JWT.  The Claim Names within a JWT Claims Set MUST be unique; JWT parsers MUST either reject JWTs with duplicate Claim Names or use a JSON parser that returns only the lexically last duplicate member name</p> <p>The image depicted below illustrates the process of using jwt.io to both encode and decode JWT tokens. These tokens are segmented into distinct sections denoted by the red, purple and blue divisions, separated by periods dots.</p> <p></p> <p>Given that the Payload can be decoded using the algorithm specified in the Header, it's essential to refrain from including sensitive details like passwords or credit card numbers within it. Instead, the Payload typically holds claims and application-specific metadata.</p> <p>To maintain the security of the process, the server retains a confidential key used to validate the signature. In situations where a client endeavors to access a resource using a JWT token that possesses an incorrect Verify Signature, an error response will be generated. This stringent signature verification mechanism ensures that the authenticity and integrity of both the token and its enclosed data are upheld.</p>"},{"location":"blog/20230823/20230823/#trace-code-cont","title":"Trace Code (Cont.)","text":"<p>In <code>webconsole/frontend/WebUI/api_webui.go</code>, we can find the implementation of JWT.</p> <ul> <li><code>JWT()</code> is for encoding: <pre><code>func JWT(email, userId, tenantId string) string {\n    token := jwt.New(jwt.SigningMethodHS256)\n\n    claims := token.Claims.(jwt.MapClaims)\n    claims[\"sub\"] = userId\n    claims[\"iat\"] = time.Now()\n    claims[\"exp\"] = time.Now().Add(time.Hour * 24).Unix()\n    claims[\"email\"] = email\n    claims[\"tenantId\"] = tenantId\n\n    if jwtKey == \"\" {\n        return \"\"\n    }\n\n    tokenString, err := token.SignedString([]byte(jwtKey))\n    if err != nil {\n        logger.ProcLog.Errorf(\"JWT err: %+v\", err)\n        return \"\"\n    }\n\n    return tokenString\n}\n</code></pre></li> <li><code>ParseJWT()</code> is for decoding: <pre><code>func ParseJWT(tokenStr string) (jwt.MapClaims, error) {\n    token, err := jwt.Parse(tokenStr, func(token *jwt.Token) (interface{}, error) {\n        return []byte(jwtKey), nil\n    })\n    if err != nil {\n        return nil, errors.Wrap(err, \"ParseJWT error\")\n    }\n\n    claims, _ := token.Claims.(jwt.MapClaims)\n\n    return claims, nil\n}\n</code></pre></li> <li>The function <code>CheckAuth()</code> serves the purpose of determining whether a user possesses the authorization to access a particular resource.</li> </ul> <pre><code>func CheckAuth(c *gin.Context) bool {\n    tokenStr := c.GetHeader(\"Token\")\n    if tokenStr == \"admin\" {\n        return true\n    } else {\n        return false\n    }\n}\n</code></pre> <p>Warning</p> <ul> <li> <p>The secret key utilized for signature verification is obtained through <code>os.Getenv(\"SIGNINGKEY\")</code>. However, there's a possibility that <code>SIGNINGKEY</code> might not be exported as an environment variable, leading to a potential return of an empty value. Under such circumstances, an implication arises: an admin in Webconsole A could potentially gain access to subscriber data within Webconsole B.</p> </li> <li> <p>Within the <code>CheckAuth()</code> function, if the client sets the JWT token to 'admin', the function will evaluate to true, effectively allowing the check to be passed.</p> </li> </ul>"},{"location":"blog/20230823/20230823/#implementation","title":"Implementation","text":""},{"location":"blog/20230823/20230823/#check-authentication","title":"Check Authentication","text":"<p>Initially, I have revised the design of the <code>CheckAuth()</code> function to ensure the mandatory execution of <code>ParseJWT()</code>. <pre><code>func CheckAuth(c *gin.Context) bool {\n    tokenStr := c.GetHeader(\"Token\")\n    claims, err := ParseJWT(tokenStr)\n\n    if err == nil &amp;&amp; claims[\"email\"] == \"admin\" {\n        return true\n    } else {\n        return false\n    }\n}\n</code></pre> Furthermore, I've implemented a second change where, considering that the webconsole v1.2.0 doesn't inherently establish a tenant named 'admin' or a user named 'admin', I propose a more effective approach. During the initialization of the webconsole backend, it is recommended to generate an 'admin' tenant and user. This means that executing <code>go run server.go</code> within the <code>webconsole/</code> directory should consistently generate an admin user, thereby fulfilling the initial login requirement.</p> <p></p> <p>Certainly, in the <code>backend/WebUI/api_webui.go</code> file, I propose the addition of a function named <code>SetAdmin()</code>. To streamline the process and maintain consistency with the rest of the free5GC project, it is recommended to leverage the <code>mongoapi</code> module established within the <code>free5gc/util</code> repository. Given the project's heavy reliance on MongoDB, employing <code>mongoapi</code> over frequent calls to <code>mongo-driver</code> is essential to ensure efficiency and coherence.</p> <pre><code>func SetAdmin() {\n    err := mongoapi.RestfulAPIDeleteOne(\"tenantData\", bson.M{\"tenantName\": \"admin\"})\n    if err != nil {\n        logger.InitLog.Errorf(\"RestfulAPIDeleteOne err: %+v\", err)\n    }\n    err = mongoapi.RestfulAPIDeleteOne(\"userData\", bson.M{\"email\": \"admin\"})\n    if err != nil {\n        logger.InitLog.Errorf(\"RestfulAPIDeleteOne err: %+v\", err)\n    }\n\n    // Create Admin tenant\n    logger.InitLog.Infoln(\"Create tenant: admin\")\n\n    adminTenantData := bson.M{\n        \"tenantId\":   uuid.Must(uuid.NewRandom()).String(),\n        \"tenantName\": \"admin\",\n    }\n\n    _, err = mongoapi.RestfulAPIPutOne(\"tenantData\", bson.M{\"tenantName\": \"admin\"}, adminTenantData)\n    if err != nil {\n        logger.InitLog.Errorf(\"RestfulAPIPutOne err: %+v\", err)\n    }\n\n    AmdinTenant, err := mongoapi.RestfulAPIGetOne(\"tenantData\", bson.M{\"tenantName\": \"admin\"})\n    if err != nil {\n        logger.InitLog.Errorf(\"RestfulAPIGetOne err: %+v\", err)\n    }\n\n    // Create Admin user\n    logger.InitLog.Infoln(\"Create user: admin\")\n\n    hash, err := bcrypt.GenerateFromPassword([]byte(\"free5gc\"), 12)\n    if err != nil {\n        logger.InitLog.Errorf(\"GenerateFromPassword err: %+v\", err)\n    }\n\n    adminUserData := bson.M{\n        \"userId\":            uuid.Must(uuid.NewRandom()).String(),\n        \"tenantId\":          AmdinTenant[\"tenantId\"],\n        \"email\":             \"admin\",\n        \"encryptedPassword\": string(hash),\n    }\n\n    _, err = mongoapi.RestfulAPIPutOne(\"userData\", bson.M{\"email\": \"admin\"}, adminUserData)\n    if err != nil {\n        logger.InitLog.Errorf(\"RestfulAPIPutOne err: %+v\", err)\n    }\n}\n</code></pre>"},{"location":"blog/20230823/20230823/#jwt-verify-signature","title":"JWT Verify Signature","text":"<p>Certainly, within the <code>backend/WebUI/api_webui.go</code> file, I recommend introducing a string variable named <code>jwtKey</code> to serve as the private key for JWT Verify Signature. Although the length of jwtKey is specified as 256 bytes, it's worth noting that the distinction between 256 bytes and 256 bits is inconsequential in this context. The jwt module will adeptly transform the key to a 256-bit form. For further insights, you can refer to issue 28.</p> <pre><code>var jwtKey = \"\" // for generating JWT\n\n/* ... */\n\nfunc InitJwtKey() error {\n    randomBytes := make([]byte, 256)\n    _, err := rand.Read(randomBytes)\n    if err != nil {\n        return errors.Wrap(err, \"Init JWT key error\")\n    } else {\n        jwtKey = string(randomBytes)\n    }\n    return nil\n}\n</code></pre>"},{"location":"blog/20230823/20230823/#backend-initialization","title":"Backend Initialization","text":"<p>In <code>backend/webui_service/webui_init.go</code>:</p> <pre><code>func (a *WebuiApp) Start(tlsKeyLogPath string) {\n    /* ... */\n    WebUI.SetAdmin()\n    if err := WebUI.InitJwtKey(); err != nil {\n        logger.InitLog.Errorln(err)\n        return\n    }\n    /* ... */\n}\n</code></pre>"},{"location":"blog/20230823/20230823/#frontend-login","title":"Frontend Login","text":"<p>Certainly, in the <code>frontend/src/util/AuthHelper.js</code> file, it is advised to remove the section of code that could be considered a \"cheating snippet.\" To ensure a robust authentication process, all users should be required to successfully pass through the <code>ApiHelper.login</code> function and receive a response code of 200. This approach ensures a consistent and legitimate authentication mechanism.</p> <pre><code>static async login(username, password) {\n    let response = await ApiHelper.login({username: username, password: password});\n\n    if (response !== undefined &amp;&amp; response.status === 200) {\n      var user = null\n      if (username == \"admin\") {\n        user = new User(username, \"System Administrator\", response.data.access_token);\n      } else {\n        user = new User(username, \"User\", response.data.access_token);\n      }\n      LocalStorageHelper.setUserInfo(user);\n      store.dispatch(authActions.setUser(user));\n      return true;\n    } else {\n      return false;\n    }\n  }\n</code></pre>"},{"location":"blog/20230823/20230823/#conclusion","title":"Conclusion","text":"<p>In this endeavor, we've successfully addressed the CSRF vulnerability issue, as highlighted in issue #387 and acknowledged by INCIBE. Furthermore, I've introduced the concept of JWT tokens in this article, detailing their implementation and the corresponding adjustments made within the webconsole. You can locate the detailed implementation in the merged PR #44 of the webconsole repository. I'd like to extend my gratitude to the contributors kishiguro and LaumiH for their significant role in refactoring the webconsole. As a result of their efforts, the webconsole UI has been notably enhanced. Our upcoming focus involves the integration of the charging function, which we are actively pursuing.</p>"},{"location":"blog/20230823/20230823/#reference","title":"Reference","text":"<p>free5gc/webconsole merged PR #44 free5gc issue #387 free5gc issue #28 JSON Token RFC 7519 MongoDBCompass</p>"},{"location":"blog/20230823/20230823/#about","title":"About","text":"<p>Hello everyone,</p> <p>I'm Brian Chen (\u9673\u715c\u76db), and I've been immersed in the realm of 5G Core Network technologies. Over the course of seven months, I've had the privilege of serving as an intern at Saviah. In this role, my responsibilities encompass a spectrum of tasks including maintenance, development, and rigorous testing of the free5GC project.</p> <p>Should any inquiries, questions, or bug reports regarding free5GC arise, I encourage you to reach out by creating an issue in the free5gc repository or by participating in discussions on the forum. I'm here to assist and collaborate with the community as we navigate the intricacies of this project.</p> <p>Warm regards, Brian Chen (\u9673\u715c\u76db)</p> <ul> <li>Github</li> <li>LinkedIn</li> </ul> <p>Note</p> <p>If you are interested in supporting free5GC, we welcome your donation. Please visit this link for more details.</p>"},{"location":"blog/20230830/20230830/","title":"Article Sharing: eBPF: A New Approach to Cloud-Native Observability, Networking and Security for Current (5G) and Future Mobile Networks (6G and Beyond)","text":"<p>Note</p> <p>Author: Lin Poyi Date: 2023/8/30</p> <p>Original Paper: eBPF: A New Approach to Cloud-Native Observability, Networking and Security for Current (5G) and Future Mobile Networks (6G and Beyond)</p>"},{"location":"blog/20230830/20230830/#overview","title":"Overview","text":"<p>This article shows why extended Berkeley Packet Filter (eBPF) is a powerful tool to use on cloud-native platforms. Using specific eBPF programs to improve network observability and runtime security. Also, present a platform named Sauron to demonstrate how eBPF allows us to write custom code and dynamically load eBPF programs into the kernel. These programs can be used to derive performance counters and gauges for transport networks, 5G applications, and non-access stratum protocols.</p>"},{"location":"blog/20230830/20230830/#layout-of-ebpf","title":"Layout of eBPF","text":"<ul> <li>eBPF programs: run in the kernel to react to events.</li> <li>User space programs: load eBPF programs to the kernel and interact with them.</li> <li>eBPF Maps: allow data storage and information sharing between eBPF/User space programs.<ul> <li>There are different types of eBPF Maps, for example: Hash, Array, etc. A special type of eBPF Maps is called per-CPU map, since it is only accessed by one CPU and the eBPF process cannot be preempted, there's no lock needed. As a result, the performance is better.</li> </ul> </li> </ul> <p>Development phase:</p> <ol> <li>A program is compiled into an object Executable and Linkable Format (ELF) file. Using compiler suites like clang/LLVM to compile it into eBPF bytecode.</li> <li>The ELF file is loaded into the kernel using a monolithic approach enabled by bpf system calls.</li> <li>Maps are created in the kernel space. The eBPF programs can utilize eBPF maps to share data and preserve the state.</li> </ol> <p>Runtime phase:</p> <ol> <li>The eBPF program is loaded into the kernel to be verified by eBPF verifier and to be compiled by JIT Compiler into native instructions.</li> <li>The eBPF program is attached to selected events (injected in the desired kernel hooks). The eBPF program is executed once the event has occurred.</li> </ol> <p>Higher-level networking constructs can be created by combining the hooks below:</p> <ul> <li>Express Data Path (XDP): XDP BPF hook can be attached to the networking driver. The eBPF program is triggered when a packet arrives in the driver.</li> <li>Traffic Control ingress/egress: hooking eBPF programs to the traffic control ingress/egress. The eBPF program is triggered after the initial packet processing.</li> <li>Socket operations</li> </ul>"},{"location":"blog/20230830/20230830/#ebpfs-for-kubernetes","title":"eBPF's for Kubernetes","text":""},{"location":"blog/20230830/20230830/#container-networking","title":"Container Networking","text":"<p>In K8s, the kernel typically runs a networking stack for each pod. The data path is convoluted, as shown in a). eBPF can simplify the networking stack in the kernel, and connect pods as endpoints.</p> <p></p> <p>This is an example of load balancing between four replicated pods on two worker nodes. Using eBPF service (svc) Map to replace the iptables rules. This allows operators to transport data directly from inbound sockets to outbound sockets, which enables super-fast service load balancing with eBPF.</p>"},{"location":"blog/20230830/20230830/#service-mesh","title":"Service Mesh","text":"<p>A Service Mesh is a dedicated infrastructure layer that can be added to applications or Cloud-Native Network Function (CNF) micro-services. Provides connectivity between applications at the service level, and offers features such as observability, security, and traffic management.</p> <p></p> <p>The traditional approach (left) was to use a Service Mesh Library. It requires the Service Mesh Library to be written in the application's language framework.</p> <p>Then Service Mesh was achieved by implementing a cloud-native Sidecar Model (middle). With the Service Mesh Sidecar run as a proxy outside of the application, there's no limit to the language being used. And there's no modification needed to be done in the application code.</p> <p>Service Mesh which utilizes eBPF (right) has fewer resources used since duplicate copies of state configuration information within each pod are no longer needed. Also, there's no pod configuration to be modified. In addition, eBPF is aware of all activities carried out on that node, which can provide extra security.</p>"},{"location":"blog/20230830/20230830/#sauron-concept-and-architecture","title":"Sauron concept and architecture","text":"<p>The proposed eBPF platform, named Sauron, includes a Node Agent, a Controller to handle the Node Agents (NAs) deployed in the clusters, and three eBPF modules for observability, security, and networking use cases. There's no installation of any specific K8s plug-in needed.</p>"},{"location":"blog/20230830/20230830/#sauron-ebpf-module-for-transport","title":"Sauron eBPF module for transport","text":""},{"location":"blog/20230830/20230830/#ebpf-solutions-for-latency-calculation","title":"eBPF solutions for latency calculation","text":"<p>By leveraging the XDP hook, the programs can inspect or modify the content of the packets, but they can also decide whether to redirect or drop them. Moreover, through eBPF helpers, they can perform more advanced actions such as timestamping.</p> <p></p> <p>The eBPF program utilizes an XDP feature that allows it to redirect the synthetic packet through the same interface at which it was received. The program also adds a timestamp of each action (send or receive) to the packet payload. The packet will bounce between the receiving device and the original sender for a fixed number of times. After the final iteration, the original sender passes the packet to the Sauron Agent through the socket interface. The Sauron Agent then uses the collected timestamps to calculate both One-way and Two-way latency. Once the calculation is done, the data can be exported to a remote collector for processing and visualization.</p>"},{"location":"blog/20230830/20230830/#sauron-module-for-network-observability","title":"Sauron module for network observability","text":"<p>The Sauron Agent configures the necessary eBPF programs and collects the messages using a Ring buffer or throughout eBPF Maps. It also detects containers and pods of the 5GC network by querying the API server. The Agent can be configured to collect information from all parts of the network (radio access and core domains) with minimal overhead.</p>"},{"location":"blog/20230830/20230830/#sauron-ebpf-module-for-security","title":"Sauron eBPF module for security","text":"<p>eBPF Traffic Control Programs are used to implement network security. The primary job is to detect policy violations and enforce configured rules on unwanted traffic. Unwanted traffic could be:</p> <ol> <li>Traffic directed to or coming from entities that are not allowed to communicate with the object pod.</li> <li>Malicious traffic directed to or coming from sources that are allowed to communicate with the object pod but not authorized to perform certain tasks.</li> <li>Malicious traffic that insists on a disallowed communication path.</li> </ol> <p>eBPF tracepoints programs are attached to static markers defined by kernel developers in the kernel code. Tracepoints can be used to track events related to multiple subsystems, including sched, netlink, and system call (only syscall is shown in the graph). Static markers implementing the hook points guarantee the Application Binary Interface for tracepoints to be more stable than the one available for kprobes.</p> <p>Even though kprobes are not as effective or stable as tracepoints, they allow the implementation of an additional layer of defense. By tapping deeper into the system calls implementation, it is possible to solve the well-known Time-Of-Check Time-Of-Use vulnerability of tracepoints.</p> <p>eBPF Linux Security Module (LSM) programs also add an additional layer of security to the kernel. They can detect malicious behaviors and deny the access and permission directly in the kernel. By doing this, they provide faster response than tracepoint and kprobe programs.</p> <p>The agent in user space provides all rules for detecting malicious behavior to eBPF programs via eBPF maps. The eBPF programs in kernel space sent three kinds of data to the Agent: samples of normal events, suspicious events, and malicious events. Suspicious events will be classified in the agent. Then all collected data will be sent to a cluster-wide events collector, which can build an AI/ML model using the collected events to enforce rules in each agent or provide a plugin-based interface to a third-party system.</p>"},{"location":"blog/20230830/20230830/#ebpf-for-performance-monitoring-of-5g-protocols","title":"eBPF for performance monitoring of 5G protocols","text":""},{"location":"blog/20230830/20230830/#ngap-and-nas-performance-monitoring","title":"NGAP and NAS performance monitoring","text":"<p>NAS messages are encapsulated into NGAP messages and NGAP relies on the SCTP of the 5G transport network layer. To extract information from NGAP messages, we need to parse SCTP packets containing multiple data chunks that can be fragmented. Since XDP and TC hooks are at the packet level, they're not suitable for handling NGAP messages. To have direct access to messages, using tracepoint hooks is the way to go.</p> <p>Examples of NGAP and NAS metrics:</p> <ul> <li>NGAP Initial Context Setup Counters</li> <li>NGAP Setup Success Ratio</li> <li>NGAP Setup Time (ms)</li> <li>NGAP Procedure Duration (ms)</li> <li>NGAP Failed Procedures Cause Code</li> <li>PDU Session Establishment Attempts</li> </ul>"},{"location":"blog/20230830/20230830/#packet-capturing-and-forwarding","title":"Packet capturing and forwarding","text":"<ol> <li>A libpcap probe is installed on the interface.</li> <li>Packets pass through the BPF filter installed on the interface.</li> <li>Matching packets flow to the agent.</li> <li>The agent encodes incoming packets in PCAPNG format.</li> <li>Send them to the processing probe.</li> </ol>"},{"location":"blog/20230830/20230830/#ebpf-for-estimating-energy-consumption","title":"eBPF for estimating energy consumption","text":""},{"location":"blog/20230830/20230830/#conclusion","title":"Conclusion","text":"<p>Using eBPF is hard. The way of implementation also changes based on what version of kernel is used. There's no easy packaging solution. Developers need to be familiar with not only the eBPF library but also the kernel they're working with.</p> <p>Although the development of eBPF might be challenging, it can be used to provide great observability, security, and networking in a cloud-native environment. Allow developers to dynamically program the kernel in a safe, performant, and scalable way. By leveraging the benefit of low overhead monitoring and close-to-source data processing, eBPF will be handy for real-time monitoring 5GC, or even boost the performance of K8s deployments.</p>"},{"location":"blog/20230830/20230830/#about","title":"About","text":"<p>Poyi Lin</p> <ul> <li>Graduate student majoring in 5GC Research</li> </ul>"},{"location":"blog/20230830/20230830/#reference","title":"Reference","text":"<ul> <li>eBPF: A New Approach to Cloud-Native Observability, Networking and Security for Current (5G) and Future Mobile Networks (6G and Beyond)</li> </ul> <p>Note</p> <p>If you are interested in supporting free5GC, we welcome your donation. Please visit this link for more details.</p>"},{"location":"blog/20230906/0905-2023blog/","title":"The role of VNFD and NSD in 5G Network Slicing","text":"<p>Note</p> <p>Author: Leon Sawada(\u6fa4\u7530\u535a\u4e45) Date: 2023/09/05</p>"},{"location":"blog/20230906/0905-2023blog/#overview","title":"Overview","text":"<p>Before you read this blog article, I highly recommend you read this blog article first:  How to deploy a free5GC network slice on OpenStack. This blog article was written by my friend Daniel Hsieh, and in his article, he went through the entire process of how to deploy a free5GC network slice on OpenStack. He also introduced some architectures we need to know when we are deploying the free5GC network slice. However, there are still some details remaining, so in this blog article, I will explore more information and what role these components play in the overall experiment. Daniel used 8 steps to explain how to [deploy a free5GC Network Slice].In this article, I am going to focus on VNFD and NSD, which appear in steps No.5 and No.6, these two most important concepts while we are creating the network slice. By this article, you will understand more about the 5G network slicing. </p>"},{"location":"blog/20230906/0905-2023blog/#vnfd","title":"VNFD","text":"<p>VNFD, You may have seen this word a few times in Daniel\u2019s blog posts already, but what exactly is VNFD? Before I tell you the answer directly, there is something I want you to know first.</p> <p>We know that network slicing is a technology that allows network operators to divide physical network infrastructure into multiple customized virtual network slices, and each of the slices can meet specific requirements for specific use cases.  One of the most important functions of 5G network slicing is the virtual network function (VNF). VNF is a virtualized network service running on an open computing platform. In this free5GC network slicing experiment, the VNF in our experiment is our NF in free5GC, such as UPF, NSSF, UDM... etc. When you load all your VNFs into OpenStack, it should be like this:</p> <p></p> <p>So what is VNFD? What is the connection between it and VNF? VNFD's full name is Virtual Network Function Descriptor. A VNFD is a deployment template that describes a VNF in terms of deployment and operational behavior requirements. It also contains connectivity, interface, and virtualized resource requirements. The VNFD conforms to the GS NFV-SOL 001 specifications and standards specified by ETSI. The Virtual Network Function Descriptor (VNFD) file describes the instantiation parameters and operational behaviors of the VNFs. It contains KPIs and other key requirements that can be used in the process of onboarding and managing the lifecycle of a VNF. Each VNFD template has the following fields:</p> <p></p> <p>In the deployment of free5GC network slicing experiment, if you onboard all your VNFs successfully, then your VNFD should also be like this:</p> <p></p> <p>As you can see, every VNFD is matched with its represented VNF and its IP address, VNFD acts as a blueprint or template for VNF. Also be aware that The VNFD is a static description file, not a dynamic configuration file. The metadata description in the VNFD is not changed during the whole VNF lifecycle. Some VNF parameters described in the VNFD can be declared to be configurable during the VNF design phase, and further be configured by the VNFM during or after VNF instantiation. </p>"},{"location":"blog/20230906/0905-2023blog/#vnfd-architecture-and-details","title":"VNFD Architecture And Details","text":"<p>The UML representation of the VNFD high-level structure is shown in the figure below.</p> <p></p> <p>The ETSI released a specification that defines the requirements for the structure and format of a VNFD. As you can see, this graph illustrates the high\u2010level structure of a VNFD. The VNFD is composed of one or many virtual deployment units (VDUs) that describe the deployment resources and operation behavior of a VNF component (VNFC). Virtual Deployment Unit(VDU) is a basic part of VNF. It is the VM that hosts the network function. They are virtual machines that host the VNF or parts of it. Each part of the VNF is a VNFC and can be deployed on one or more VDUs. Each VDU is characterized, among other elements, by the software image loaded on it and the resources needed to deploy it. That is the flavor of Nova in OpenStack, which can set Disk, Memory, CPU, etc. An NS(Network Service) might contain different VNF. A VNF might also contain different VDU. Each level puts constraints on the subsequent levels, information in a lower level does not appear in a higher level. This is a complex and flexible architecture, very beautiful, very powerful. </p> <p>The following graph shows the composition of the virtual deployment unit in a VNFD: </p> <p></p> <p>This graph illustrates a VDU deployment view. A VDU describes mainly the virtual compute (VC), virtual storage (VS), and virtual memory (VM) resources that are necessary for deploying a VNFC, and it could be linked via connection points (CPD) to other VDUs or to external VDUs that belong to other VNFs via external CPD. Virtual links in the VNFD indicate how the VDUs are connected and via which CPD. This means that different VDUs can be connected to each other through the CPD. However, in free5GC network slicing, things might be different. For 5G's NS (network slice), since there are already many VNFs in 5G, under the 5G network slice architecture, an NS contains many VNFs, but a VNF always contains one and only VDU. We use AMF as an example, (AMF is an NF in free5GC) AMF is an important and complete function and we didn't break it into more pieces. Therefore, there are not many examples in our 5G of a VNF having many VDUs. Each VNF contains one VDU only, and the via connection points (CPD) function will no longer be used in 5G network slicing, although it is a powerful and convenient function.</p>"},{"location":"blog/20230906/0905-2023blog/#nsd","title":"NSD","text":"<p>NSD is a template file, whose parameters follow the ETSI MANO specification, used by the NFV Orchestrator (NFVO) for deploying network services (as a combination of multiple VNFs). Which consists of information used by the NFV Orchestrator (NFVO) for the life cycle management of an NS. Just like VNFD,  NSD is also a static configuration file.</p> <p>An NS is a composition of Network Functions (NF) arranged as a set of functions with unspecified connectivity between them or according to one or more forwarding graphs. As the following figure shows, the description of an NS as used by the NFV Management and Orchestration (MANO) functions to deploy an NS instance includes or references the descriptors of its constituent objects:</p> <p></p> <p>As the specification mentioned in ETSI GS NFV-IFA 014 V3.3.1, an NSD references at least one VNFD or one nested NSD, just like this graph has shown. Here is an example code if today we want to instantiate VNF1 and VNF2 in the experiment.  </p> <pre><code>tosca_definitions_version: tosca_simple_profile_for_nfv_1_0_0\nimports:\n  - VNFD1\n  - VNFD2\ntopology_template:\n  node_templates:\n    VNF1:\n      type: tosca.nodes.nfv.VNF1\n      requirements:\n        - virtualLink1: VL1\n        - virtualLink2: VL2\n    VNF2:\n      type: tosca.nodes.nfv.VNF2\n    VL1:\n      type: tosca.nodes.nfv.VL\n      properties:\n      network_name: net0\n      vendor: tacker\n    VL2:\n      type: tosca.nodes.nfv.VL\n      properties:\n          network_name: net_mgmt\n          vendor: tacker\n</code></pre> <p>In the above NSD template, VL1 and VL2 are substituting the virtual links of VNF1. If we want to apply the NFs we have in free5GC, just import these NFs into the VNF to which they belong. </p> <p>To onboard the above NSD:</p> <pre><code>tacker nsd-create \u2013nsd-file &lt;nsd file&gt; &lt;nsd name&gt;\n</code></pre> <p>This is also how we can use NSD to import all the VNFs we want to create network slices. It is very easy and convenient to create free5GC network slice that we want, the step was mentioned in Dainel's blog article. </p>"},{"location":"blog/20230906/0905-2023blog/#deployment-flavor","title":"Deployment flavor","text":"<p>Please go back to the VNFD high-level structure, On the right side we can see the DnfDf, which stands for VNF deployment flavor. Deployment flavor is a very important concept in NSD and VNFD, therefore it needs to be explained separately. Since VNFD and NSD are not dynamic configuration files but static configuration files. Even static configuration file has their own advantages, however, they are irreversible and lack of flexibility. To overcome this problem, we have a concept called deployment flavor. While we are using these static configuration files, we can have different deployment flavors, therefore when we are deploying these static configuration files, we can have different ways to deploy them. For example, when we deploy them, we use the 10 MB memory, and we use 100 MB memory to deploy another one. In this example, while we are deploying our deployment parameters are different, then we can define it into deployment flavor. Deployment flavor helps NSD and VNFD to increase their flexibility as a static configuration file. Make sure it's not 100% unchangeable. We can deploy different types of Deployment_Flavor that case needs, like Deployment_Flavor#2, Deployment_Flavor#3, and Deployment_Flavor#4. Therefore, we can deploy different NS and VNF for different specific needs. Add some deployment flexibility as much as possible under the limitation that they are static configuration files.</p> <p></p> <p>That's it, I hope this blog article can help you learn more about 5G network slicing, even if you go back and read this previous blog post How \u200b\u200bto deploy free5GC network slicing on OpenStack now, I think you will have a clearer idea of \u200b\u200bhow the whole experiment works. Learning the theory behind the scenes will always help you further your studies.</p>"},{"location":"blog/20230906/0905-2023blog/#reference","title":"Reference","text":"<p>https://docs.openstack.org/tacker/latest/contributor/vnfd_template_description.html</p> <p>https://docs.openstack.org/tacker/ocata/devref/nsd_usage_guide.html</p> <p>Atoui, Wassim &amp; Assy, Nour &amp; Gaaloul, Walid &amp; Grida Ben Yahia, Imen. (2020). Configurable Deployment Descriptor Model in NFV. Journal of Network and Systems Management. 28. 10.1007/s10922-020-09531-2. </p> <p>Automated Network Service Scaling in NFV: Concepts, Mechanisms and Scaling Workflow</p> <p>ETSI GS NFV-IFA 011 V2.4.1</p> <p>ETSI GS NFV-IFA 014 V3.3.1</p>"},{"location":"blog/20230906/0905-2023blog/#about","title":"About","text":"<p>Greetings everyone, my name is Leon Sawada, I am a 2nd-year master's student in NYCU Wireless Internet Research and Engineering (WIRE) Laboratory. My research field is network slicing, and I will be very grateful if this blog article helps you understand more about these components in network slicing. Best wishes.</p> <p>Note</p> <p>If you are interested in supporting free5GC, we welcome your donation. Please visit this link for more details.</p>"},{"location":"blog/20230913/20230913/","title":"CHarging Function(CHF) Overview","text":"<p>Note</p> <p>Author: Benson Hsu Date: 2023/9/13</p> <p>The <code>charging function</code> is a crucial component of the 5G core network responsible for tasks such as <code>traffic calculation and quota management</code>. For network providers and administrators, it is one of the most critical network elements. This article will explain the fundamental concepts and mechanisms of charging, as well as highlight the differences between 4G and 5G charging. Finally, we will include information about the CHF implementation developed by the free5GC team. </p>"},{"location":"blog/20230913/20230913/#charging-mechanisms","title":"Charging Mechanisms","text":"<p>The charging system can be divided into three main types: offline charging, online charging, and converged charging:</p> <ul> <li> <p>Offline Charging:</p> <ul> <li>After network resource usage, charging information is transmitted from the network to the Billing Domain (BD).</li> <li>The Billing Domain is responsible for performing cost calculations and data statistics.</li> </ul> </li> <li> <p>Online Charging:</p> <ul> <li>Before network resource usage, the network sends an authentication request to the Online Charging System (OCS).</li> <li>The OCS queries the subscriber's account information to determine whether the usage of these resources is allowed.</li> <li>After receiving authentication from the OCS, resource usage is monitored, and related account information is stored in the OCS.</li> </ul> </li> <li> <p>Converged Charging:</p> <ul> <li>Converged charging is a mechanism that combines both online and offline charging.</li> <li>For example, the CHF (Converged Charging Function) architecture in the 5G core system is an example of converged charging.</li> <li>In other service systems, if the charging system includes both offline and online charging functionalities, it can also be referred to as converged charging.</li> </ul> </li> </ul> <p>Typical triggers for charging related to network resource usage include:</p> <ul> <li>A voice call of a certain duration.</li> <li>The transport of a certain volume of data.</li> <li>The submission of a multimedia message (MM) of a certain size.</li> </ul> <p>Resource usage requests can be triggered by the UE  or by the core network. Furthermore, for the same chargeable event, both offline and online charging can occur simultaneously and independently.</p>"},{"location":"blog/20230913/20230913/#high-level-common-architecture","title":"High Level Common Architecture","text":"<p>The diagram below is from 3GPP TS32.240-V15.5.0, which illustrates the architectural differences among the three charging systems and indicates through which reference points data is transmitted for each Network Element (NE). </p>"},{"location":"blog/20230913/20230913/#offline-charging-function","title":"Offline Charging Function","text":"<p>The Offline Charging Function primarily consists of three components: CTF (Charging Trigger Function), CDF (Charging Data Function), and CGF (Charging Gateway Function). Here's an overview of the roles of each function and how data flows between them:</p> <ol> <li>CTF (Charging Trigger Function):</li> <li>Role: CTF is responsible for generating charging events by observing network resource usage.</li> <li>Data Flow: It collects information about trigger conditions, information elements to be collected, and which service events, signaling, or user traffic to monitor.</li> <li> <p>Data Transfer: CTF forwards generated charging events to CDF.</p> </li> <li> <p>CDF (Charging Data Function):</p> </li> <li>Role: CDF receives charging events from CTF and processes them.</li> <li>Data Flow: It processes and stores charging data, potentially performing reformatting to comply with specific formats.</li> <li> <p>Data Transfer: CDF sends the processed Charging Data Records (CDRs) to CGF.</p> </li> <li> <p>CGF (Charging Gateway Function):</p> </li> <li>Role: CGF is responsible for persistent CDR storage, preparing CDR files, and transferring them to the Billing Domain (BD).</li> <li>Data Flow: It provides storage for CDRs and manages the routing of CDR files.</li> <li>Data Transfer: CGF transfers CDR files to the Billing Domain via the Bx reference point.</li> </ol> <p>These functions work together to collect, process, and store charging data in the offline charging system.</p>"},{"location":"blog/20230913/20230913/#online-charging-functionsocf","title":"Online Charging Functions(OCF)","text":"<p> The Online Charging Function primarily consists of four components: CTF (Charging Trigger Function), OCF (Online Charging Function), ABMF (Account Balance Management Function), and RF (Rating Function). Here's an overview of the roles of each function and how data flows between them:</p> <p>1. CTF (Charging Trigger Function):    * Role: CTF observes network resource usage to generate charging events.    * Data Flow: It collects information about trigger conditions, information elements to be collected, and the monitoring of service events, signaling, or user traffic.    * Data Transfer: CTF forwards generated charging events to the OCF.</p> <p>2. OCF (Online Charging Function):    * Role: OCF is responsible for real-time charging and authorization of resource usage.    * Data Flow: It evaluates charging events, determines the value of requested resource usage, and authorizes it.    * Data Transfer: OCF sends authorization information to the network element, which then executes the resource usage.</p> <p>3. ABMF (Account Balance Management Function):    * Role: ABMF manages subscriber account balances and credit control.    * Data Flow: It keeps track of subscriber account balances and interacts with OCF for authorization and debiting.    * Data Transfer: ABMF communicates with OCF to manage subscriber balances during resource usage.</p> <p>4. RF (Rating Function):    * Role: RF determines the value or amount of actual network resource usage for OCF (according to OCF from charging event)    * Data Flow: The OCF provides the RF with essential data extracted from the charging event. Then RF returns the rating results, which can be in the form of monetary or non-monetary units.    * Data Transfer: OCF send charging event to RF, and RF return rating results in specific unit</p> <p>These functions collaborate to enable real-time online charging, authorization, and account management for subscribers in the online charging system.</p>"},{"location":"blog/20230913/20230913/#converged-charging-functions","title":"Converged Charging Functions","text":"<p> The Converged Charging Functions consist of various components, each with specific roles and data flow within the system. Here's an overview of the roles of each function and how data flows between them:</p> <p>1. CTF (Charging Trigger Function):    * Role: CTF is mostly integrated into network functions like PCF, SMSF, and SMF. These network functions monitor charging information and transform it into charging events, which are then forwarded to the CHF for further processing.    * Data Flow: It collects information on trigger conditions, information elements to be captured, and monitors service events, signaling, or user traffic.    * Data Transfer: The CTF forwards the generated charging events to the CHF via an SBI (Service-Based Interface) located within the core network's control plane.</p> <p>2. CHF (CHarging Function):    * Role: CHF is responsible for facilitating communication among all functions within the Converged Charging System(CCS). Its role includes receiving charging events and generating CDRs (Charging Data Records). Importantly, it can simultaneously handle both online and offline charging functions.    * Data Flow: It evaluates charging events, determines the value of requested resource usage, authorizes it, and manages subscriber account balances.    * Data Transfer: CHF and its associated functions engage in data exchanges involving various types of information. These data exchanges include charging events, user count balances, CDRs (Charging Data Records), and rating information.</p> <p>The remaining functions mentioned earlier in the descriptions of offline and online charging serve the same purposes and functions, so we won't go into further detail here.</p>"},{"location":"blog/20230913/20230913/#the-differences-between-4g-and-5g-charging","title":"The Differences between 4G and 5G Charging","text":"<p>In the 4G era, various concepts and functions for online and offline charging were already established. When defining the 5G standards, it was recognized that there was a need to support various charging methods. Therefore, a new function called CHF (Charging Function) was introduced, and other functions such as ABMF, CGF, and RF from different systems were integrated into the Converged Charging System. This addition expanded the capabilities of 5G Core (5GC) charging.</p> <p></p> <p>The differences between 4G and 5G charging can be summarized as follows:</p> <p>1. Network Architecture:    * 4G: In 4G networks, charging functions are typically less integrated and may involve multiple separate components.    * 5G: 5G introduces a more integrated and converged charging system where various charging functions are unified within the Converged Charging System (CHF), allowing for more flexibility and efficiency.</p> <p>2. Charging Flexibility:    * 4G: 4G networks may have limitations in terms of charging flexibility, especially when it comes to handling different charging scenarios and services.    * 5G: 5G charging is designed to be more versatile and adaptable, capable of handling various charging models, both online and offline, for a wide range of services and use cases.</p> <p>3. Service Support:    * 4G: 4G charging systems are primarily designed for traditional mobile services like voice and data.    * 5G: 5G charging systems are built to support a broader range of services, including enhanced mobile broadband (eMBB), massive machine-type communications (mMTC), and ultra-reliable low-latency communications (URLLC), making them more suitable for diverse 5G applications.</p> <p>4. Convergence:    * 4G: Converged charging in 4G networks is often limited, and different charging models may not be as seamlessly integrated.    * 5G: 5G emphasizes the convergence of charging functions, allowing for greater consistency and interoperability across various charging scenarios and services.</p> <p>5. Charging Efficiency:    * 4G: Charging efficiency in 4G networks may vary depending on the specific implementation and the level of integration between charging components.    * 5G: 5G charging systems aim to improve efficiency by streamlining charging processes and reducing redundancy, thanks to the unified CHF.</p> <p>Overall, the key difference between 4G and 5G charging lies in the level of integration, flexibility, and support for a broader range of services and use cases in 5G networks. The introduction of the CHF in 5G brings greater convergence and efficiency to charging operations.</p>"},{"location":"blog/20230913/20230913/#chf-implementation","title":"CHF Implementation","text":"<p>Hello everyone, we are the free5gc development team. We have recently added CHF (Charging Function) to enhance the functionality of 5G Core (5GC). We invite anyone interested in CHF to check out how we have implemented the charging function. Below is the relevant link, and thank you for your interest.</p> <p></p> <ul> <li>Ref: https://github.com/free5gc/chf</li> </ul>"},{"location":"blog/20230913/20230913/#reference","title":"Reference","text":"<ul> <li>3GPP TS32.240 v15 spec(offline)</li> <li>3GPP TS32.240 v15 spec(online)</li> <li>https://devopedia.org/5g-service-based-architecture</li> <li>https://free5gc.org/</li> </ul> <p>Note</p> <p>If you are interested in supporting free5GC, we welcome your donation. Please visit this link for more details.</p>"},{"location":"blog/20230920/Introduction_of_gtp5g_and_some_kernel_concepts/","title":"Introduction of gtp5g and some kernel concepts","text":"<p>Note</p> <p>Author: Jimmy Date: 2023/9/20</p>"},{"location":"blog/20230920/Introduction_of_gtp5g_and_some_kernel_concepts/#overview","title":"Overview","text":"<p>GTP (General Packet Radio System Tunneling Protocol) is a group of IP-based communication protocols used to transport General Packet Radio Services (GPRS) within LTE, 5G NR, and other networks. GTP can be broken down into several components: GTP-C, GTP-U, and GTP prime. GTP-C and GTP-U are responsible for the control plane and user plane, respectively, while GTP prime is utilized for transmitting charging data through the Ga interface as defined in the 3GPP GPRS Core Network.</p> <p>In the context of free5GC, the UPF network function combines the GTP-C control part to correctly instruct the routing path for any packet passing through the core network. GTP-U, on the other hand, is managed by gtp5g, which transports packets using kernel modules generated by gtp5g. This article will introduce how gtp5g assists free5GC in handling packets and some kernel-related concepts.</p> <p>Let's start the journey!</p> <p>Additional information:</p> <ul> <li>Linux kernel version is 5.4.0-159-generic in article. According to other versions, some of content would be different, but the main concept is the same.</li> <li>Gtp5g version is v0.8.2</li> <li>UPF version is v1.2.0</li> </ul>"},{"location":"blog/20230920/Introduction_of_gtp5g_and_some_kernel_concepts/#netlink-generic-netlink-and-rtnetlink","title":"Netlink, Generic Netlink and Rtnetlink","text":""},{"location":"blog/20230920/Introduction_of_gtp5g_and_some_kernel_concepts/#netlink","title":"Netlink","text":"<p>Before we continue, I need to introduce Netlink first. What is Netlink? Netlink is an IPC (Inter Process Communication) protocol which can connect kernel space and user space processes by socket.  Traditionally, it used three methods: Ioctl, sysfs, or procfs, to facilitate communication between the kernel and user space. However, it can only be initiated from user space, not from kernel space. Netlink can support not only initiated from kernel and user space but also:</p> <ul> <li>Bidirectional transmission, asynchronous communication.</li> <li>Standard socket API used in user space.</li> <li>Specialized API used in kernel space.</li> <li>Support for multicast.</li> <li>Support for 32 protocol types.</li> </ul> <p>There are servel usages define in include/uapi/linux/netlink.h <pre><code>#define NETLINK_ROUTE       0   /* Routing/device hook              */\n#define NETLINK_UNUSED      1   /* Unused number                */\n#define NETLINK_USERSOCK    2   /* Reserved for user mode socket protocols  */\n#define NETLINK_FIREWALL    3   /* Unused number, formerly ip_queue     */\n#define NETLINK_SOCK_DIAG   4   /* socket monitoring                */\n#define NETLINK_NFLOG       5   /* netfilter/iptables ULOG */\n#define NETLINK_XFRM        6   /* ipsec */\n#define NETLINK_SELINUX     7   /* SELinux event notifications */\n#define NETLINK_ISCSI       8   /* Open-iSCSI */\n#define NETLINK_AUDIT       9   /* auditing */\n#define NETLINK_FIB_LOOKUP  10  \n#define NETLINK_CONNECTOR   11\n#define NETLINK_NETFILTER   12  /* netfilter subsystem */\n#define NETLINK_IP6_FW      13\n#define NETLINK_DNRTMSG     14  /* DECnet routing messages */\n#define NETLINK_KOBJECT_UEVENT  15  /* Kernel messages to userspace */\n#define NETLINK_GENERIC     16\n/* leave room for NETLINK_DM (DM Events) */\n#define NETLINK_SCSITRANSPORT   18  /* SCSI Transports */\n#define NETLINK_ECRYPTFS    19\n#define NETLINK_RDMA        20\n#define NETLINK_CRYPTO      21  /* Crypto layer */\n#define NETLINK_SMC     22  /* SMC monitoring */\n\n#define NETLINK_INET_DIAG   NETLINK_SOCK_DIAG\n\n#define MAX_LINKS 32\n</code></pre></p> <p>These are Linux system pre-defined Netlink protocols. Therefore, if users want to define their own Netlink protocol, they would need to modify the Linux kernel files to meet their requirements. However, the kernel must be protected from modification. Additionally, the maximum protocol number allowed is 32, can't exceed it.</p>"},{"location":"blog/20230920/Introduction_of_gtp5g_and_some_kernel_concepts/#generic-netlink","title":"Generic Netlink","text":"<p>Due to the shortage of protocol numbers and the need to prevent kernel modification, kernel developers extended Netlink and introduced Generic Netlink. Generic Netlink supports 1023 protocols, addressing the protocol number limitation, and it allocates protocol IDs automatically.</p> <p>The following figure is Generic Netlink structure:</p> <pre><code>graph TD\nA1[Application_1] --- B[Kernel_Socket_API] \nA2[Application_2] --- B[Kernel_Socket_API]\n\nB[Kernel_Socket_API] --- C[Netlink_Subsystem]\nB[Kernel_Socket_API] --- C[Netlink_Subsystem]\n\nC[Netlink_Subsystem] --- D[Generic_Netlink_Bus]\n\nD[Generic_Netlink_Bus] --- E1[Controller]\nD[Generic_Netlink_Bus] --- E2[Kernel_User_1]\nD[Generic_Netlink_Bus] --- E3[Kernel_User_2]\n</code></pre> <ul> <li>The Generic Netlink users application_1 and application_2 could communicate both user space and kernel space endpoint through Kernel_socket_API. </li> <li>The Netlink subsystem which serves as the underlying transport layer for all of the Generic Netlink communications.</li> <li>The Generic Netlink bus which is implemented inside the kernel, but which is available to userspace through the socket API and inside the kernel via the normal Netlink and Generic Netlink APIs.</li> <li>The Generic Netlink users who communicate with each other over the Generic Netlink bus; users can exist both in kernel and user space.</li> <li>The Generic Netlink controller which is part of the kernel and is responsible for dynamically allocating Generic Netlink communication channels and other management tasks. The Generic Netlink controller is implemented as a standard Generic Netlink kernel user, however, it listens on a special, pre-allocated Generic Netlink channel.</li> <li>The kernel socket API. Generic Netlink sockets are created with the PF_NETLINK domain and the NETLINK_GENERIC protocol values.</li> </ul>"},{"location":"blog/20230920/Introduction_of_gtp5g_and_some_kernel_concepts/#rtnetlink","title":"RtNetlink","text":"<p>The last one is rtnetlink, it also known as Netlink protocol type NETLINK_ROUTE, user space program could read and alter kernel's routing table or create new network device.</p>"},{"location":"blog/20230920/Introduction_of_gtp5g_and_some_kernel_concepts/#free5gc-upf","title":"free5GC UPF","text":"<p>Since gtp5g is part of UPF logically, article also covers part of UPF.</p> <p>The Driver provides functions to communicate with gtp5g (the functions are one-to-one match to gtp5g_genl_ops[] in genl.c). So, when UPF receives a PFCP message, it parses the content and then uses various functions of the Driver to instruct gtp5g to take regarding rules. <pre><code>// internel/forwarder/driver.go\ntype Driver interface {\n    Close()\n\n    CreatePDR(uint64, *ie.IE) error\n    UpdatePDR(uint64, *ie.IE) error\n    RemovePDR(uint64, *ie.IE) error\n\n    CreateFAR(uint64, *ie.IE) error\n    UpdateFAR(uint64, *ie.IE) error\n    RemoveFAR(uint64, *ie.IE) error\n\n    CreateQER(uint64, *ie.IE) error\n    UpdateQER(uint64, *ie.IE) error\n    RemoveQER(uint64, *ie.IE) error\n\n    CreateURR(uint64, *ie.IE) error\n    UpdateURR(uint64, *ie.IE) ([]report.USAReport, error)\n    RemoveURR(uint64, *ie.IE) ([]report.USAReport, error)\n    QueryURR(uint64, uint32) ([]report.USAReport, error)\n\n    CreateBAR(uint64, *ie.IE) error\n    UpdateBAR(uint64, *ie.IE) error\n    RemoveBAR(uint64, *ie.IE) error\n\n    HandleReport(report.Handler)\n}\n</code></pre></p> <p>UPF use rtnl to create device (interface) named <code>upfgtp</code>. User can observe it while executing run.sh. <pre><code>func OpenGtp5gLink(mux *nl.Mux, addr string, mtu uint32, log *logrus.Entry) (*Gtp5gLink, error) {\n    g := &amp;Gtp5gLink{\n        log: log,\n    }\n\n    g.mux = mux\n\n    rtconn, err := nl.Open(syscall.NETLINK_ROUTE)\n    if err != nil {\n        return nil, errors.Wrap(err, \"open\")\n    }\n    g.rtconn = rtconn\n    g.client = nl.NewClient(rtconn, mux)\n\n    laddr, err := net.ResolveUDPAddr(\"udp4\", addr)\n    if err != nil {\n        g.Close()\n        return nil, errors.Wrap(err, \"resolve addr\")\n    }\n    conn, err := net.ListenUDP(\"udp4\", laddr)\n    if err != nil {\n        g.Close()\n        return nil, errors.Wrap(err, \"listen\")\n    }\n    g.conn = conn\n\n    // TODO: Duplicate fd\n    f, err := conn.File()\n    if err != nil {\n        g.Close()\n        return nil, errors.Wrap(err, \"file\")\n    }\n    g.f = f\n\n    linkinfo := &amp;nl.Attr{\n        Type: syscall.IFLA_LINKINFO,\n        Value: nl.AttrList{\n            {\n                Type:  rtnllink.IFLA_INFO_KIND,\n                Value: nl.AttrString(\"gtp5g\"),\n            },\n            {\n                Type: rtnllink.IFLA_INFO_DATA,\n                Value: nl.AttrList{\n                    {\n                        Type:  gtp5gnl.IFLA_FD1,\n                        Value: nl.AttrU32(f.Fd()),\n                    },\n                    {\n                        Type:  gtp5gnl.IFLA_HASHSIZE,\n                        Value: nl.AttrU32(131072),\n                    },\n                },\n            },\n        },\n    }\n    attrs := []*nl.Attr{linkinfo}\n\n    if mtu != 0 {\n        attrs = append(attrs, &amp;nl.Attr{\n            Type:  syscall.IFLA_MTU,\n            Value: nl.AttrU32(mtu),\n        })\n    }\n\n    err = rtnllink.Create(g.client, \"upfgtp\", attrs...)\n    if err != nil {\n        g.Close()\n        return nil, errors.Wrap(err, \"create\")\n    }\n    err = rtnllink.Up(g.client, \"upfgtp\")\n    if err != nil {\n        g.Close()\n        return nil, errors.Wrap(err, \"up\")\n    }\n    link, err := gtp5gnl.GetLink(\"upfgtp\")\n    if err != nil {\n        g.Close()\n        return nil, errors.Wrap(err, \"get link\")\n    }\n    g.link = link\n    return g, nil\n}\n</code></pre></p> <p>Connect UPF Driver functions and <code>gtp5g_genl_ops</code>. <pre><code>// internl/forwarder/buffnetlink/server.go\nfunc OpenServer(wg *sync.WaitGroup, client *nl.Client, mux *nl.Mux) (*Server, error) {\n    s := &amp;Server{\n        client: client,\n        mux:    mux,\n    }\n\n    f, err := genl.GetFamily(s.client, \"gtp5g\")\n    if err != nil {\n        return nil, errors.Wrap(err, \"get family\")\n    }\n\n    s.conn, err = nl.Open(syscall.NETLINK_GENERIC, int(f.Groups[gtp5gnl.GENL_MCGRP].ID))\n    if err != nil {\n        return nil, errors.Wrap(err, \"open netlink\")\n    }\n\n    err = s.mux.PushHandler(s.conn, s)\n    if err != nil {\n        return nil, errors.Wrap(err, \"push handler\")\n    }\n\n    logger.BuffLog.Infof(\"buff netlink server started\")\n\n    // wg.Add(1)\n    return s, nil\n}\n</code></pre></p>"},{"location":"blog/20230920/Introduction_of_gtp5g_and_some_kernel_concepts/#gtp5g","title":"GTP5G","text":"<ul> <li>Gtp5g utilizes a Linux kernel module to manage packet traffic. A Linux kernel module can be thought of as a small piece of code that is inserted into the Linux kernel, allowing users to customize the program according to the current hardware device</li> <li>In gtp5g, the primary function is gtp5g_init in gtp5g.c; it exposes most of the components and techniques provided by gtp5g. This article will choose the following concepts to investigate further:</li> <li>Network device -&gt; <code>net_device_ops</code></li> <li>Rtnetlink -&gt; <code>gtp5g_link_ops</code></li> <li>Generic Netlink -&gt; <code>gtp5g_genl_family</code></li> <li>Additionally, the article will present two functions in detail:</li> <li><code>rtnl_link_register()</code></li> <li><code>genl_register_family()</code></li> </ul> <pre><code>// src/gtp5g.c\nstatic int __init gtp5g_init(void)\n{\n    int err;\n\n    GTP5G_LOG(NULL, \"Gtp5g Module initialization Ver: %s\\n\", DRV_VERSION);\n\n    init_proc_gtp5g_dev_list();\n\n    // set hash initial value\n    get_random_bytes(&amp;gtp5g_h_initval, sizeof(gtp5g_h_initval));\n\n    err = rtnl_link_register(&amp;gtp5g_link_ops);\n    if (err &lt; 0) {\n        GTP5G_ERR(NULL, \"Failed to register rtnl\\n\");\n        goto error_out;\n    }\n\n    err = genl_register_family(&amp;gtp5g_genl_family);\n    if (err &lt; 0) {\n        GTP5G_ERR(NULL, \"Failed to register generic\\n\");\n        goto unreg_rtnl_link;\n    }\n\n    err = register_pernet_subsys(&amp;gtp5g_net_ops);\n    if (err &lt; 0) {\n        GTP5G_ERR(NULL, \"Failed to register namespace\\n\");\n        goto unreg_genl_family;\n    }\n\n    err = create_proc();\n    if (err &lt; 0) {\n        goto unreg_pernet;\n    }\n    GTP5G_LOG(NULL, \"5G GTP module loaded\\n\");\n\n    return 0;\n    ...\n}\n</code></pre>"},{"location":"blog/20230920/Introduction_of_gtp5g_and_some_kernel_concepts/#net_device_ops","title":"<code>net_device_ops</code>","text":"<p>It is defined in dev.h and referenced in dev.c. The structure net_device_ops encompasses all operations related to network device, and free5GC inherits some of these operations to implement self-made netdev ops. <pre><code>// include/dev.h\nextern const struct net_device_ops gtp5g_netdev_ops;\n</code></pre></p> <p><pre><code>// src/gtpu/dev.c\nconst struct net_device_ops gtp5g_netdev_ops = {\n    .ndo_init           = gtp5g_dev_init,\n    .ndo_uninit         = gtp5g_dev_uninit,\n    .ndo_start_xmit     = gtp5g_dev_xmit,\n#if LINUX_VERSION_CODE &gt;= KERNEL_VERSION(5, 11, 0)\n    .ndo_get_stats64    = dev_get_tstats64,\n#else\n    .ndo_get_stats64    = ip_tunnel_get_stats64,\n#endif\n};\n</code></pre> According to /include/linux/netdevice.h, you can find the definition of hooks of net_device_ops:</p> <ul> <li><code>.ndo_init</code>: This function is called once when a network device is registered. The network device can use this for any late stage initialization or semantic validation. It can fail with an error code which will be propagated back to register_netdev.</li> <li><code>.ndo_uninit</code>: This function is called when device is unregistered or when registration fails. It is not called if init fails.</li> <li><code>.ndo_start_xmit</code>: Called when a packet needs to be transmitted. Returns NETDEV_TX_OK. Can return NETDEV_TX_BUSY, but you should stop the queue before that can happen; it's for obsolete devices and weird corner cases, but the stack really does a non-trivial amount of useless work if you return NETDEV_TX_BUSY. Required; cannot be NULL. <pre><code>struct net_device_ops {\n  int           (*ndo_init)(struct net_device *dev);\n  void          (*ndo_uninit)(struct net_device *dev);\n  netdev_tx_t       (*ndo_start_xmit)(struct sk_buff *skb,\n                      struct net_device *dev);\n...\n}\n</code></pre> Gtp5g self-made structure: <pre><code>// include/dev.h\nstruct gtp5g_dev {\n    struct list_head list;\n    struct sock *sk1u; // UDP socket from user space\n    struct net_device *dev;\n    unsigned int role;\n    unsigned int hash_size;\n    struct hlist_head *pdr_id_hash;\n    struct hlist_head *far_id_hash;\n    struct hlist_head *qer_id_hash;\n    struct hlist_head *bar_id_hash;\n    struct hlist_head *urr_id_hash;\n\n    struct hlist_head *i_teid_hash; // Used for GTP-U packet detect\n    struct hlist_head *addr_hash;   // Used for IPv4 packet detect\n\n    /* IEs list related to PDR */\n    struct hlist_head *related_far_hash; // PDR list waiting the FAR to handle\n    struct hlist_head *related_qer_hash; // PDR list waiting the QER to handle\n    struct hlist_head *related_bar_hash;\n    struct hlist_head *related_urr_hash;\n\n    /* Used by proc interface */\n    struct list_head proc_list;\n};\n</code></pre></li> </ul> <p>It would find the private data address in network device by netdev_priv() and allocate the device statistics space for each CPU by netdev_alloc_pcpu_stats(): <pre><code>// src/gtpu/dev.c\nstatic int gtp5g_dev_init(struct net_device *dev)\n{\n    struct gtp5g_dev *gtp = netdev_priv(dev);\n\n    gtp-&gt;dev = dev;\n\n    dev-&gt;tstats = netdev_alloc_pcpu_stats(struct pcpu_sw_netstats);\n    if (!dev-&gt;tstats) {\n        return -ENOMEM;\n    }\n\n    return 0;\n}\n</code></pre></p> <p>From /include/linux/netdevice.h, the return value would be times of 32: <pre><code>static inline void *netdev_priv(const struct net_device *dev)\n{\n    return (char *)dev + ALIGN(sizeof(struct net_device), NETDEV_ALIGN);\n}\n</code></pre></p> <p>Close the udp socket (sk1u) is used to receive uplink (N3) packet:  <pre><code>// src/gtpu/dev.c\nstatic void gtp5g_dev_uninit(struct net_device *dev)\n{\n    struct gtp5g_dev *gtp = netdev_priv(dev);\n\n    gtp5g_encap_disable(gtp-&gt;sk1u);\n    free_percpu(dev-&gt;tstats);\n}\n</code></pre></p> <p>Utilized for the reception of downlink (N6) packets by a network device: <pre><code>// src/gtpu/dev.c\nstatic netdev_tx_t gtp5g_dev_xmit(struct sk_buff *skb, struct net_device *dev)\n{\n    unsigned int proto = ntohs(skb-&gt;protocol);\n    struct gtp5g_pktinfo pktinfo;\n    int ret = 0;\n\n    /* Ensure there is sufficient headroom */\n    if (skb_cow_head(skb, dev-&gt;needed_headroom)) {\n        goto tx_err;\n    }\n\n    skb_reset_inner_headers(skb);\n\n    /* PDR lookups in gtp5g_build_skb_*() need rcu read-side lock. \n     * */\n    rcu_read_lock();\n    switch (proto) {\n    case ETH_P_IP:\n        ret = gtp5g_handle_skb_ipv4(skb, dev, &amp;pktinfo);\n        break;\n    default:\n        ret = -EOPNOTSUPP;\n    }\n    rcu_read_unlock();\n\n    if (ret &lt; 0)\n        goto tx_err;\n\n    if (ret == FAR_ACTION_FORW)\n        gtp5g_xmit_skb_ipv4(skb, &amp;pktinfo);\n\n    return NETDEV_TX_OK;\n    ...\n}\n</code></pre></p>"},{"location":"blog/20230920/Introduction_of_gtp5g_and_some_kernel_concepts/#gtp5g_link_ops","title":"<code>gtp5g_link_ops</code>","text":"<p>Ignore headder file here, structure defines Rtnetlink operations.</p> <pre><code>// src/gtpu/link.c\nstruct rtnl_link_ops gtp5g_link_ops __read_mostly = {\n    .kind         = \"gtp5g\",\n    .maxtype      = IFLA_GTP5G_MAX,\n    .policy       = gtp5g_policy,\n    .priv_size    = sizeof(struct gtp5g_dev),\n    .setup        = gtp5g_link_setup,\n    .validate     = gtp5g_validate,\n    .newlink      = gtp5g_newlink,\n    .dellink      = gtp5g_dellink,\n    .get_size     = gtp5g_get_size,\n    .fill_info    = gtp5g_fill_info,\n};\n</code></pre> <p>Definition is in /include/net/rtnetlink.h: - <code>.kind</code>: Identifier - <code>.maxtype</code>: Highest device specific netlink attribute number - <code>.policy</code>: Netlink policy for device specific attribute validation - <code>.priv_size</code>: sizeof net_device private space - <code>.setup</code>: net_device setup function - <code>.validate</code>: Optional validation function for netlink/changelink parameters - <code>.newlink</code>: Function for configuring and registering a new device - <code>.dellink</code>: Function to remove a device - <code>.get_size</code>: Function to calculate required room for dumping device specific netlink attributes - <code>.fill_info</code>: Function to dump device specific netlink attributes</p> <pre><code>struct rtnl_link_ops {\n    struct list_head    list;\n\n    const char      *kind;\n\n    size_t          priv_size;\n    void            (*setup)(struct net_device *dev);\n\n    unsigned int        maxtype;\n    const struct nla_policy *policy;\n    int         (*validate)(struct nlattr *tb[],\n                        struct nlattr *data[],\n                        struct netlink_ext_ack *extack);\n\n    int         (*newlink)(struct net *src_net,\n                       struct net_device *dev,\n                       struct nlattr *tb[],\n                       struct nlattr *data[],\n                       struct netlink_ext_ack *extack);\n    int         (*changelink)(struct net_device *dev,\n                          struct nlattr *tb[],\n                          struct nlattr *data[],\n                          struct netlink_ext_ack *extack);\n    void            (*dellink)(struct net_device *dev,\n                       struct list_head *head);\n\n    size_t          (*get_size)(const struct net_device *dev);\n    int         (*fill_info)(struct sk_buff *skb,\n                         const struct net_device *dev);\n\n    size_t          (*get_xstats_size)(const struct net_device *dev);\n    int         (*fill_xstats)(struct sk_buff *skb,\n                           const struct net_device *dev);\n    unsigned int        (*get_num_tx_queues)(void);\n    unsigned int        (*get_num_rx_queues)(void);\n\n    unsigned int        slave_maxtype;\n    const struct nla_policy *slave_policy;\n    int         (*slave_changelink)(struct net_device *dev,\n                            struct net_device *slave_dev,\n                            struct nlattr *tb[],\n                            struct nlattr *data[],\n                            struct netlink_ext_ack *extack);\n    size_t          (*get_slave_size)(const struct net_device *dev,\n                          const struct net_device *slave_dev);\n    int         (*fill_slave_info)(struct sk_buff *skb,\n                           const struct net_device *dev,\n                           const struct net_device *slave_dev);\n    struct net      *(*get_link_net)(const struct net_device *dev);\n    size_t          (*get_linkxstats_size)(const struct net_device *dev,\n                               int attr);\n    int         (*fill_linkxstats)(struct sk_buff *skb,\n                           const struct net_device *dev,\n                           int *prividx, int attr);\n};\n</code></pre> <p>Once rtnl link setting up, gtp5g would assign net_device_ops to device. <pre><code>static void gtp5g_link_setup(struct net_device *dev)\n{\n    dev-&gt;netdev_ops = &amp;gtp5g_netdev_ops;   &lt;---- network device assignment\n    dev-&gt;needs_free_netdev = true;\n\n    dev-&gt;hard_header_len = 0;\n    dev-&gt;addr_len = 0;\n    dev-&gt;mtu = ETH_DATA_LEN -\n        (sizeof(struct iphdr) +\n         sizeof(struct udphdr) +\n         sizeof(struct gtpv1_hdr));\n\n    /* Zero header length. */\n    dev-&gt;type = ARPHRD_NONE;\n    dev-&gt;flags = IFF_POINTOPOINT | IFF_NOARP | IFF_MULTICAST;\n\n    dev-&gt;priv_flags |= IFF_NO_QUEUE;\n    dev-&gt;features |= NETIF_F_LLTX;\n    netif_keep_dst(dev);\n\n    /* TODO: Modify the headroom size based on\n     * what are the extension header going to support\n     * */\n    dev-&gt;needed_headroom = LL_MAX_HEADER +\n        sizeof(struct iphdr) +\n        sizeof(struct udphdr) +\n        sizeof(struct gtpv1_hdr);\n}\n</code></pre></p>"},{"location":"blog/20230920/Introduction_of_gtp5g_and_some_kernel_concepts/#rtnl_link_register","title":"<code>rtnl_link_register()</code>","text":"<ul> <li>Definition is in /net/core/rtnetlink.c</li> <li>This function should be used by drivers that create devices during module initialization. It must be called before registering the devices</li> <li>Using the kind property of rtnl_link_ops to search for the existence of ops in link_ops. If ops do not exist, then inserted it at the end of link_ops</li> <li>Once register sucess, UPF can create new network device (interface) using Rtnetlink socket <pre><code>int __rtnl_link_register(struct rtnl_link_ops *ops)\n{\n    if (rtnl_link_ops_get(ops-&gt;kind))\n        return -EEXIST;\n\n    /* The check for setup is here because if ops\n     * does not have that filled up, it is not possible\n     * to use the ops for creating device. So do not\n     * fill up dellink as well. That disables rtnl_dellink.\n     */\n    if (ops-&gt;setup &amp;&amp; !ops-&gt;dellink)\n        ops-&gt;dellink = unregister_netdevice_queue;\n\n    list_add_tail(&amp;ops-&gt;list, &amp;link_ops);\n    return 0;\n}\nEXPORT_SYMBOL_GPL(__rtnl_link_register);\n</code></pre></li> </ul>"},{"location":"blog/20230920/Introduction_of_gtp5g_and_some_kernel_concepts/#gtp5g_genl_family","title":"gtp5g_genl_family","text":"<p>Gtp5g defines the genl (Generic Netlink) interface to facilitate communication between user and kernel space after register 'family'. As mentioned earlier, there is a Generic Netlink Controller responsible for bus allocation and dynamically assigns tunnel based on genl family id (name). </p> <p><pre><code>// src/genl/genl.c\nstruct genl_family gtp5g_genl_family __ro_after_init = {\n    .name       = \"gtp5g\",\n    .version    = 0,\n    .hdrsize    = 0,\n    .maxattr    = GTP5G_ATTR_MAX,\n    .netnsok    = true,\n    .module     = THIS_MODULE,\n    .ops        = gtp5g_genl_ops,\n    .n_ops      = ARRAY_SIZE(gtp5g_genl_ops),\n    .mcgrps     = gtp5g_genl_mcgrps,\n    .n_mcgrps   = ARRAY_SIZE(gtp5g_genl_mcgrps),\n};\n</code></pre> Definition is in /include/net/genetlink.h: - <code>.name</code>: name of family (exclusive) - <code>.version</code>: protocol version (usually is 1) - <code>.hdrsize</code>: length of user specific header in bytes - <code>.maxattr</code>: maximum number of attributes supported - <code>.netnsok</code>: set to true if the family can handle network namespaces and should be presented in all of them - <code>.ops</code>: the operations supported by this family - <code>.n_ops</code>: number of operations supported by this family - <code>.mcgrps</code>: multicast groups used by this family - <code>.n_mcgrps</code>: number of multicast groups</p> <pre><code>struct genl_family {\n    int         id;     /* private */\n    unsigned int        hdrsize;\n    char            name[GENL_NAMSIZ];\n    unsigned int        version;\n    unsigned int        maxattr;\n    bool            netnsok;\n    bool            parallel_ops;\n    const struct nla_policy *policy;\n    int         (*pre_doit)(const struct genl_ops *ops,\n                        struct sk_buff *skb,\n                        struct genl_info *info);\n    void            (*post_doit)(const struct genl_ops *ops,\n                         struct sk_buff *skb,\n                         struct genl_info *info);\n    struct nlattr **    attrbuf;    /* private */\n    const struct genl_ops * ops;\n    const struct genl_multicast_group *mcgrps;\n    unsigned int        n_ops;\n    unsigned int        n_mcgrps;\n    unsigned int        mcgrp_offset;   /* private */\n    struct module       *module;\n};\n</code></pre> <p>Gtp5g defines <code>gtp5g_genl_ops</code>, all operations are one-to-one match to Driver functions in UPF part: <pre><code>// src/genl/genl.c\nstatic const struct genl_ops gtp5g_genl_ops[] = {\n    {\n        .cmd = GTP5G_CMD_ADD_PDR,\n        // .validate = GENL_DONT_VALIDATE_STRICT | GENL_DONT_VALIDATE_DUMP,\n        .doit = gtp5g_genl_add_pdr,\n        // .policy = gtp5g_genl_pdr_policy,\n        .flags = GENL_ADMIN_PERM,\n    },\n    {\n        .cmd = GTP5G_CMD_DEL_PDR,\n        // .validate = GENL_DONT_VALIDATE_STRICT | GENL_DONT_VALIDATE_DUMP,\n        .doit = gtp5g_genl_del_pdr,\n        // .policy = gtp5g_genl_pdr_policy,\n        .flags = GENL_ADMIN_PERM,\n    },\n    {\n        .cmd = GTP5G_CMD_GET_PDR,\n        // .validate = GENL_DONT_VALIDATE_STRICT | GENL_DONT_VALIDATE_DUMP,\n        .doit = gtp5g_genl_get_pdr,\n        .dumpit = gtp5g_genl_dump_pdr,\n        // .policy = gtp5g_genl_pdr_policy,\n        .flags = GENL_ADMIN_PERM,\n    },\n    ...\n}\n</code></pre></p>"},{"location":"blog/20230920/Introduction_of_gtp5g_and_some_kernel_concepts/#genl_register_family","title":"<code>genl_register_family()</code>","text":"<ul> <li>Definition is in /net/netlink/genetlink.c</li> <li>Registers the specified family after validating it first. Only one family may be registered with the same family name or identifier. The family's ops, multicast groups and module pointer must already be assigned. Return 0 on success or a negative error code</li> <li>Three functions within this method hold greater significance (all of them in /net/netlink/genetlink.c):</li> <li><code>genl_validate_ops()</code></li> <li><code>genl_family_find_byname()</code></li> <li><code>genl_validate_assign_mc_groups()</code></li> </ul> <pre><code>int genl_register_family(struct genl_family *family)\n{\n    int err, i;\n    int start = GENL_START_ALLOC, end = GENL_MAX_ID;\n\n    err = genl_validate_ops(family);\n    if (err)\n        return err;\n\n    genl_lock_all();\n\n    if (genl_family_find_byname(family-&gt;name)) {\n        err = -EEXIST;\n        goto errout_locked;\n    }\n\n    if (family == &amp;genl_ctrl) {\n        start = end = GENL_ID_CTRL;\n    } else if (strcmp(family-&gt;name, \"pmcraid\") == 0) {\n        start = end = GENL_ID_PMCRAID;\n    } else if (strcmp(family-&gt;name, \"VFS_DQUOT\") == 0) {\n        start = end = GENL_ID_VFS_DQUOT;\n    }\n\n    if (family-&gt;maxattr &amp;&amp; !family-&gt;parallel_ops) {\n        family-&gt;attrbuf = kmalloc_array(family-&gt;maxattr + 1,\n                        sizeof(struct nlattr *),\n                        GFP_KERNEL);\n        if (family-&gt;attrbuf == NULL) {\n            err = -ENOMEM;\n            goto errout_locked;\n        }\n    } else\n        family-&gt;attrbuf = NULL;\n\n    family-&gt;id = idr_alloc_cyclic(&amp;genl_fam_idr, family,\n                      start, end + 1, GFP_KERNEL);\n    if (family-&gt;id &lt; 0) {\n        err = family-&gt;id;\n        goto errout_free;\n    }\n\n    err = genl_validate_assign_mc_groups(family);\n    if (err)\n        goto errout_remove;\n\n    genl_unlock_all();\n\n    /* send all events */\n    genl_ctrl_event(CTRL_CMD_NEWFAMILY, family, NULL, 0);\n    for (i = 0; i &lt; family-&gt;n_mcgrps; i++)\n        genl_ctrl_event(CTRL_CMD_NEWMCAST_GRP, family,\n                &amp;family-&gt;mcgrps[i], family-&gt;mcgrp_offset + i);\n\n    return 0;\n\nerrout_remove:\n    idr_remove(&amp;genl_fam_idr, family-&gt;id);\nerrout_free:\n    kfree(family-&gt;attrbuf);\nerrout_locked:\n    genl_unlock_all();\n    return err;\n}\nEXPORT_SYMBOL(genl_register_family);\n</code></pre>"},{"location":"blog/20230920/Introduction_of_gtp5g_and_some_kernel_concepts/#genl_validate_ops","title":"<code>genl_validate_ops()</code>","text":"<p>This function will verify if there is defined function for the operations and will also compare whether any operation is reused by a command. Using gtp5g as an example, command can be considered as action such as add, del, modify PDR rules. <pre><code>static int genl_validate_ops(const struct genl_family *family)\n{\n    const struct genl_ops *ops = family-&gt;ops;\n    unsigned int n_ops = family-&gt;n_ops;\n    int i, j;\n\n    if (WARN_ON(n_ops &amp;&amp; !ops))\n        return -EINVAL;\n\n    if (!n_ops)\n        return 0;\n\n    for (i = 0; i &lt; n_ops; i++) {\n        if (ops[i].dumpit == NULL &amp;&amp; ops[i].doit == NULL)\n            return -EINVAL;\n        for (j = i + 1; j &lt; n_ops; j++)\n            if (ops[i].cmd == ops[j].cmd)\n                return -EINVAL;\n    }\n\n    return 0;\n}\n</code></pre></p>"},{"location":"blog/20230920/Introduction_of_gtp5g_and_some_kernel_concepts/#genl_family_find_byname","title":"<code>genl_family_find_byname()</code>","text":"<p>Function would check every entry in genl_fam_idr whether exists the same family name.</p> <pre><code>static const struct genl_family *genl_family_find_byname(char *name)\n{\n    const struct genl_family *family;\n    unsigned int id;\n\n    idr_for_each_entry(&amp;genl_fam_idr, family, id)\n        if (strcmp(family-&gt;name, name) == 0)\n            return family;\n\n    return NULL;\n}\n</code></pre> <p>Here is the macro of <code>idr_for_each_entry()</code>: <pre><code>#define idr_for_each_entry(idr, entry, id)          \\\n    for (id = 0; ((entry) = idr_get_next(idr, &amp;(id))) != NULL; id += 1U)\n</code></pre></p>"},{"location":"blog/20230920/Introduction_of_gtp5g_and_some_kernel_concepts/#genl_validate_assign_mc_groups","title":"<code>genl_validate_assign_mc_groups()</code>","text":"<p>This changes the number of multicast groups that are available when ntensok is ture:</p> <pre><code>static int genl_validate_assign_mc_groups(struct genl_family *family)\n{\n    int first_id;\n    int n_groups = family-&gt;n_mcgrps;\n    int err = 0, i;\n    bool groups_allocated = false;\n\n    if (!n_groups)\n        return 0;\n\n    for (i = 0; i &lt; n_groups; i++) {\n        const struct genl_multicast_group *grp = &amp;family-&gt;mcgrps[i];\n\n        if (WARN_ON(grp-&gt;name[0] == '\\0'))\n            return -EINVAL;\n        if (WARN_ON(memchr(grp-&gt;name, '\\0', GENL_NAMSIZ) == NULL))\n            return -EINVAL;\n    }\n\n    /* special-case our own group and hacks */\n    if (family == &amp;genl_ctrl) {\n        first_id = GENL_ID_CTRL;\n        BUG_ON(n_groups != 1);\n    } else if (strcmp(family-&gt;name, \"NET_DM\") == 0) {\n        first_id = 1;\n        BUG_ON(n_groups != 1);\n    } else if (family-&gt;id == GENL_ID_VFS_DQUOT) {\n        first_id = GENL_ID_VFS_DQUOT;\n        BUG_ON(n_groups != 1);\n    } else if (family-&gt;id == GENL_ID_PMCRAID) {\n        first_id = GENL_ID_PMCRAID;\n        BUG_ON(n_groups != 1);\n    } else {\n        groups_allocated = true;\n        err = genl_allocate_reserve_groups(n_groups, &amp;first_id);\n        if (err)\n            return err;\n    }\n\n    family-&gt;mcgrp_offset = first_id;\n\n    /* if still initializing, can't and don't need to to realloc bitmaps */\n    if (!init_net.genl_sock)\n        return 0;\n\n    if (family-&gt;netnsok) {\n        struct net *net;\n\n        netlink_table_grab();\n        rcu_read_lock();\n        for_each_net_rcu(net) {\n            err = __netlink_change_ngroups(net-&gt;genl_sock,\n                    mc_groups_longs * BITS_PER_LONG);\n            if (err) {\n                /*\n                 * No need to roll back, can only fail if\n                 * memory allocation fails and then the\n                 * number of _possible_ groups has been\n                 * increased on some sockets which is ok.\n                 */\n                break;\n            }\n        }\n        rcu_read_unlock();\n        netlink_table_ungrab();\n    } else {\n        err = netlink_change_ngroups(init_net.genl_sock,\n                         mc_groups_longs * BITS_PER_LONG);\n    }\n\n    if (groups_allocated &amp;&amp; err) {\n        for (i = 0; i &lt; family-&gt;n_mcgrps; i++)\n            clear_bit(family-&gt;mcgrp_offset + i, mc_groups);\n    }\n\n    return err;\n}\n</code></pre>"},{"location":"blog/20230920/Introduction_of_gtp5g_and_some_kernel_concepts/#about","title":"About","text":"<ul> <li>Jimmy Chang<ul> <li>Graduate student majoring in 5GC Research</li> <li>As I am a beginner in the Linux kernel, please feel free to send me an email if you find any errors.</li> <li>mail</li> <li>Linkin</li> </ul> </li> </ul>"},{"location":"blog/20230920/Introduction_of_gtp5g_and_some_kernel_concepts/#reference","title":"Reference","text":"<ul> <li>https://bootlin.com</li> <li>https://www.linuxjournal.com/article/8498</li> <li>https://wiki.linuxfoundation.org/networking/generic_netlink_howto</li> <li>https://www.kernel.org/doc/html/latest/driver-api/driver-model/overview.html</li> <li>https://www.cnblogs.com/ssyfj/p/16230540.html</li> <li>https://www.twblogs.net/a/5b81e5852b71772165aedd7a</li> <li>https://www.cnblogs.com/ssyfj/p/16230540.html</li> <li>IT blog by Ian Chen</li> <li>IT blog by 0xff07</li> </ul> <p>Note</p> <p>If you are interested in supporting free5GC, we welcome your donation. Please visit this link for more details.</p>"},{"location":"blog/20230927/Support_of_Time_Sensitive_Communication_and_Time_Synchronization_in_5G_system_-_Introduction_%28Rel-17%29/","title":"Support of Time Sensitive Communication and Time Synchronization in 5G system - Introduction (Rel-17)","text":"<p>Note</p> <p>Author: Ya-shih Tseng Date: 2023/9/27</p> <p>Before you read the article, I suggest you to read  Time-Sensitive Networking over 5G system - Introduction (Rel-16). </p>"},{"location":"blog/20230927/Support_of_Time_Sensitive_Communication_and_Time_Synchronization_in_5G_system_-_Introduction_%28Rel-17%29/#overview","title":"Overview","text":"<p>This article will introduce TSN enhancements in 3GPP Release 17. We will start by discussing the new roles introduced in 5GS and their applicable scenarios. The architecture has been modified to accommodate a wider range of applications, and additional network functions have been added to offer a broader range of services. </p> <p></p> <p>Architcture to enable time sensitive communication and time synchronization</p>"},{"location":"blog/20230927/Support_of_Time_Sensitive_Communication_and_Time_Synchronization_in_5G_system_-_Introduction_%28Rel-17%29/#5gs-can-be-as-boundary-clock-and-transparent-clock","title":"5GS can be as Boundary Clock and Transparent Clock","text":"<p>Time Synchronization: describes how 5GS can operate as a PTP Relay (IEEE 802.1AS), as a Boundary Clock or as Transparent Clock (IEEE 1588) for PDU Session type Ethernet and IP.</p> <p>According to 3GPP TS 23.501 Release 17, 5GS's role in TSN goes beyond just acting as a bridge. It now extends to UDP/IP applications. In addition to its original support for Ethernet through IEEE 802.1AS Time-Aware System, it has been updated to include four types of PTP instances described in IEEE 1588.</p>"},{"location":"blog/20230927/Support_of_Time_Sensitive_Communication_and_Time_Synchronization_in_5G_system_-_Introduction_%28Rel-17%29/#what-is-bc-and-tc","title":"What is BC and TC?","text":"<p>Difference types of PTP instances (clocks).</p> <ul> <li>For the BC, you can have a GM as a time source, and it can also act as a time source itself, allowing other slave clocks to synchronize their time with it.</li> <li>For the TC, it doesn't need to synchronize its time with other clocks. Its role is to receive time from one end, potentially adjust it, and then forward it to the next clock</li> </ul> <p>For more detail about PTP instance / Clock types, please check IEEE 1588v2 PTP Support.</p> <p>To support above applications, DS-TT and NW-TT have expanded their functionalities.</p>"},{"location":"blog/20230927/Support_of_Time_Sensitive_Communication_and_Time_Synchronization_in_5G_system_-_Introduction_%28Rel-17%29/#capability-of-ds-tt-and-nw-tt","title":"Capability of DS-TT and NW-TT","text":"<p>With release 17 now supporting for the scenarios when Master clock is behind the UE (uplink time sync, UE \u2013 UE time sync), behind the network (downlink time sync) and support for multiple (g)PTP domains. </p> <p>Note</p> <p>In release 16, the roles of 5GS, DS-TT, and NW-TT are fixed. The Data Network side follows the TSN master, while the UE side follows the slave. When a packet enters, the entry time is first recorded in NW-TT, and the exit time is recorded in DS-TT. The difference between these two times determines the packet's resident time.</p> <p>In general case, when receiving PTP event messages from upstream PTP instances, the ingress TT (NW-TT or DS-TT) records an ingress timestamp (TSi) for each PTP event, such as Sync messages. Then, NW-TT determines whether to forward messages to DS-TT or discard it.</p> <p>Subsequently, the egress TT creates an egress timestamp (TSe) for PTP events (i.e., Sync messages) in the external PTP network and modifies the payload of the PTP message to add/update the resident time.</p> <ul> <li>As for 5GS operates as BC, NW-TT and DS-TT should support generate Sync, Follow_Up and Announce message. If DS-TT doesn't support it, NW-TT will take over.</li> </ul>"},{"location":"blog/20230927/Support_of_Time_Sensitive_Communication_and_Time_Synchronization_in_5G_system_-_Introduction_%28Rel-17%29/#ptp-transparent","title":"PTP transparent","text":"<p>TTs can support the following PTP transport modes described in IEEE 1588:</p> <ul> <li>over UDP/IPv4</li> <li>over UDP/IPv6</li> <li>over IEEE 802.3 (Ethernet)</li> </ul>"},{"location":"blog/20230927/Support_of_Time_Sensitive_Communication_and_Time_Synchronization_in_5G_system_-_Introduction_%28Rel-17%29/#delay-measurements","title":"Delay measurements","text":"<p>Different PTP instances have different measurements of path delay due to hardware limitations.</p> <p>TTs should support the following delay measurements as described in IEEE 1588:</p> <ul> <li>Delay request-response mechanism</li> <li>Peer-to-peer delay mechanism</li> <li>which we talked about it in previous article.</li> </ul> <p>Let's see what's the diference between them. </p> <p>Difference measurements of path delay</p> <ul> <li>For E2E (End-to-End) slaves send delay requests to the Master, passing through other devices in the network. Each TC (Transparent Clock) modifies the request to update the time it has spent locally. Finally, it reaches the Master, so the E2E measured delay represents the total time taken along the entire path.</li> <li>For P2P (Point-to-Point) devices, they send requests to nearby neighbors to measure the delay time between each other.</li> </ul> <p>By now, We introduce few supports for PTP instances. Then, How should these functionalities be managed?</p>"},{"location":"blog/20230927/Support_of_Time_Sensitive_Communication_and_Time_Synchronization_in_5G_system_-_Introduction_%28Rel-17%29/#time-sensitive-communication-and-time-synchronization-function","title":"Time Sensitive Communication and Time Synchronization Function","text":"<p>In release 16, TSN AF is used for exchanging messages to manage TSN bridges in conjunction with centralized network configuration (CNC). This means that TSN AF is responsible for managing the ports of DS-TT and NW-TT. Additionally, in release 17, TSCTSF is a new component introduced between PCF and NEF. To support AF requests related to time-sensitive communication.</p> <p>TSCTSF can check the PTP functionalities supported by DS-TT and NW-TT by retrieving the following port management information or user plane node management information:</p> <ul> <li>Supported PTP instance types;</li> <li>Supported transport types;</li> <li>Supported PTP delay mechanisms;</li> <li>Grandmaster capability;</li> <li>Supported PTP profiles;</li> <li>Number of supported PTP instances.</li> </ul> <p>AF can obtain the required services directly or indirectly through TSCTSF</p> <ul> <li>e.g. AF can provide traffic pattern parameters to NEF. NEF will forward the received traffic pattern parameters to TSCTSF.</li> <li>e.g. AF trusted by the operator can directly provide such traffic pattern parameters to TSCTSF.</li> </ul> <p>TSCTSF may support AF to</p> <ul> <li>Activate and deactivate the time syncgronization services</li> <li>Control the time synchronization service for target UE.</li> <li>Configure the TTs to operate on AF-selected method</li> <li>Managing the DS-TT and NW-TT via exchange of PMIC and UMIC</li> <li>Provide specific QoS traffic pattern</li> <li>Creating the TSC Assistance Container based on individual traffic pattern parameters from the NEF/AF and providing it to the PCF.</li> </ul>"},{"location":"blog/20230927/Support_of_Time_Sensitive_Communication_and_Time_Synchronization_in_5G_system_-_Introduction_%28Rel-17%29/#abbreviation","title":"Abbreviation","text":"TSN Time-Sensitive network TT TSN Translator NW-TT Network-Side TSN Translator DS-TT Device-Side TSN Translator PTP Precision Time Protocol BC Boundary Clock E2E-TC End-to-End Transparent Clock P2P-TC Peer-to-Peer Transparent Clock GM Grand Master AF Application Function TSCTSF Time Sensitive Communication and Time Synchronization Function PMIC Port Management Information Container UMIC User Plane Node Management Information Container"},{"location":"blog/20230927/Support_of_Time_Sensitive_Communication_and_Time_Synchronization_in_5G_system_-_Introduction_%28Rel-17%29/#conclusion","title":"Conclusion","text":"<p>Release 17 expanded and improved the integration with IEEE TSN. This included enabling uplink synchronization through the 5G System (5GS), enhancing End-to-End Quality of Service (QoS) across multiple clock domains, and facilitating direct communication between UE within the 5GS network.</p>"},{"location":"blog/20230927/Support_of_Time_Sensitive_Communication_and_Time_Synchronization_in_5G_system_-_Introduction_%28Rel-17%29/#reference","title":"Reference","text":"<ul> <li>IEEE Std 802.1AS-2020: \u201cIEEE Standard for Local and metropolitan area networks--Timing and Synchronization for Time-Sensitive Applications\u201d.</li> <li>IEEE Std 1588: \u201cIEEE Standard for a Precision Clock Synchronization Protocol for Networked Measurement and Control Systems\u201d, Edition 2019.</li> <li>3GPP TS 23.501 v16.6.0: \"System Architecture for the 5G System\"</li> <li>3GPP TS 23.501 v17.8.0: \"System Architecture for the 5G System\"</li> <li>3GPP TS 23.502 v17.4.0: \"Procedures for the 5G System\"</li> <li>Time-Sensitive Networking (TSN) Task Group | - IEEE 802.1</li> </ul>"},{"location":"blog/20230927/Support_of_Time_Sensitive_Communication_and_Time_Synchronization_in_5G_system_-_Introduction_%28Rel-17%29/#about","title":"About","text":"<p>Hi, This is Ya-shih Tseng. I am currently researching the implementation of 5G TSN as part of my master's studies. Feel free to discuss with me.</p> <ul> <li>Here is my linkedin profile</li> </ul> <p>Note</p> <p>If you are interested in supporting free5GC, we welcome your donation. Please visit this link for more details.</p>"},{"location":"blog/20231004/20231004/","title":"Introduction of MPTCP","text":"<p>Note</p> <p>Author: \u5f35\u54f2\u777f (Jerry) Date: 2023/10/04</p> <p>MPTCP (multipath TCP) is a set of extensions to regular TCP that allows a connection to use many paths to transport data simultaneously. The simultaneous use of these multiple paths for a TCP/IP session would improve resource usage within the network, and if one path is blocked, it can use another path to transport data, improving resilience to network failure. A common use of mptcp is: Most mobile phones today have the ability to connect to wifi or mobile networks (4G/5G), but regular TCP can't use two network resources simultaneously, and if the network we were originally using (for example, wifi) is disconnected, it cannot automatically switch to using the mobile network. Therefore, the connection at the application layer will also be disconnected. In this article, I will introduce MPTCP, including how to establish an MPTCP connection, how to start a new subflow, the ack mechanism, and the congestion control algorithm it uses. </p>"},{"location":"blog/20231004/20231004/#initiating-an-mptcp-connection","title":"Initiating an MPTCP Connection","text":"<p>MPTCP implements multi-path transmission by creating multiple subflows; each subflow is similar to a general TCP connection. Use the 3-way handshaking to establish the connection. But instead of a separate connection, the subflow is bound into an existing MPTCP session. MPTCP uses SYN, SYN/ACK, and ACK packets to establish connections. But these sockets also carry the MP_CAPABLE option (in the optional field of the tcp header), which is used to verify whether the remote host supports MPTCP and exchange some information to authenticate the establishment of additional subflows.</p> <p></p> <p>RFC8684 3.1</p> <p>The above figure shows the structure of MP_CAPABLE. First, the initiator sends only 4 octets. If the listener also supports MPTCP v1, it will respond SYN/ACK, and the listener's key will be included in MP_CAPABLE. Then the initiator replies ACK, which contains the sender's key and the receiver's key. These keys are used to authenticate the addition of future subflows to this connection; all future subflows will identify the connection using a 32-bit \"token\". This token is a cryptographic hash of this key. The use of flags in the fourth octets are as follow:</p> <ul> <li>A: Indicate \"Checksum required\".</li> <li>B: It is an extensibility flag, must be set to 0.</li> <li>C: Indicate that the sender of this option will not accept additional MPTCP subflows to the source address and port.</li> <li>D through H: The flags D through H, are used for crypto algorithm negotiation. In MPTCP v1, only the rightmost bit, labeled H, is assigned. Bit H indicates the use of HMAC-SHA256.</li> </ul>"},{"location":"blog/20231004/20231004/#starting-a-new-subflow","title":"Starting a New Subflow","text":"<p>Once an MPTCP connection has begun with the MP_CAPABLE exchange, further subflows can be added to the connection. A new subflow is started as a normal TCP SYN/ACK exchange. But these packets contain the Join Connection option. </p> <p></p> <p>RFC8684 3.2</p> <p>This is the first Join Connection (MP_join) Option for the initial SYN. The token is a cryptographic hash of the receiver's key. The MP_join also contains an \"Address ID\", which is used to identify the source address of this packet. This mechanism allows addresses to be removed even if they are changed by NAT. The last bit of the third byte (flag B) indicates that the sender (1) wishes this subflow to be used as a backup path (B=1) in the event of failure of other paths or (2) wants the subflow to be used as part of the connection immediately. MP_JOIN also contains a random number to prevent replay attacks. If MP_JOIN contains a valid token, the recipient will respond with a SYN/ACK also containing an MP_JOIN option containing a random number and a truncated (leftmost 64-bit) HMAC. Transport HMAC is to have previously exchanged random data (in the first two SYN packets) that is used as the \"message\".</p> <p></p> <p>RFC8684 3.2</p> <p>If the HMAC in SYN/ACK is valid, then the initiator will send its authentication in the third packet (ACK). This data needs to be sent reliably since it is the only time this HMAC is sent. Therefore, receipt of this packet triggers a regular TCP ACK in response, and the packet will be retransmitted if this ACK is not received.</p> <p></p> <p>RFC8684 3.2</p> <p></p> <p>RFC8684 3.2</p> <p>This is total handshake procedure.</p>"},{"location":"blog/20231004/20231004/#mptcp-operation-and-data-transfer","title":"MPTCP Operation and Data Transfer","text":"<p>MPTCP takes one input data stream and splits it into subflows. It then uses a 64-bit data sequence number to number all the data and let the data be reassembled at the receiver. Each subflow has its own 32-bit sequence number space, utilizing the regular TCP sequence number header, and an MPTCP option (Data Sequence Signal optional) maps the subflow sequence space to the data sequence space. MPTCP uses the Data Sequence Signal optional to carry the Data Sequence Mapping, which consists of the subflow sequence number, data sequence number, and length for which this mapping is valid. The Data Sequence Number is the starting sequence number for the subflow, and the Subflow Sequence Number is the sequence number only relevant to the subflow. The Data Ack in the Data Sequence Signal optional is used to ACK for the connection, indicating how much data has been successfully received.</p> <p></p> <p>RFC8684 3.3</p>"},{"location":"blog/20231004/20231004/#coupled-congestion-control-algorithm","title":"Coupled Congestion Control Algorithm","text":"<p>There are two goals that MPTCP congestion control needs to meet: 1.   A multipath flow should perform at least as well as a single-path flow would on the best of the paths available to it. 2.   A multipath flow should take no more capacity on any path or collection of paths than if it were a single-path TCP flow using the best of those paths.</p> <p>The second goal is to prevent MPTCP traffic from occupying too many resources and harming other TCP flows on the bottleneck link. So if we combine the first goal and the second goal, it means that the total capacity that MPTCP occupies should equal the capacity that the best path can transport. (In the situation where there is some competitive TCP flow, if there is no other competitive flow, then MPTCP will occupy all the capacity it can use.)</p> <p>The algorithm rule: * Each ACK on subflow r, increase the window  by . * Each loss on subflow r, decrease the window  by .</p> <p> </p> <p>  is the current window size on path r,  is equilibrium window size on path r, and similarly for the total window size.</p> <p>And how  derived? Here I write down some of my thoughts after reading the paper. There may be errors. If you find any, please tell me directly. First, we assume that , so if the transmission speed of subflow r is slower than tcp, then the increments of the window size r is . Because the increase and decrease of the window in the equilibrium state are equal to each other, so we have the fallowing equation.</p> <p> </p> <p>  is the loss rate of subflow r.Then we assume loss rate is small.</p> <p> </p> <p>Now assume that there is tcp on this subflow, then we have:</p> <p> </p> <p>p is the loss rate. Here, assume p is equal to .(But actually, they would not be equal if there was no other competitive flow.  is smaller, so we measure a better tcp performence.) Substitute  with p, then we have:</p> <p> </p> <p>And we want the total capacity MPTCP occupies to equal the capacity that the best path can transport using TCP. So we have the equation:</p> <p> </p> <p>Window size divide by RTT is the traffic send on path per second.</p> <p> </p> <p> </p> <p>Finally, we can derive . </p> <p> </p> <p>Because tcp performance on path r is measured by loss rate , if there is no competitive flow, mptcp can use more resources, and the increments of the window finally bounded by . So if we only run mptcp on many paths, it's like we have many TCP connecion, the total traffic is sum of every subflow's max transmission capability.</p>"},{"location":"blog/20231004/20231004/#how-to-use-mptcp","title":"How to use MPTCP","text":"<p>As for how to use mptcp under Linux system, you can refer to this article. It describes how to use mptcpize to change the original tcp connection to mptcp.</p>"},{"location":"blog/20231004/20231004/#about","title":"About","text":"<p>Hello! My name is \u5f35\u54f2\u777f, and my current research topic is ATSSS (Access Traffic Steering, Switching and Splitting).  If you find any mistakes in my articles, please contact me.</p> <ul> <li>Linkedln</li> </ul>"},{"location":"blog/20231004/20231004/#reference","title":"Reference","text":"<ul> <li>RFC 8684</li> <li>RFC 6356</li> <li>Coupled Congestion Control Algorithm</li> <li>MPTCP congestion control</li> <li>How to use MPTCP</li> </ul> <p>Note</p> <p>If you are interested in supporting free5GC, we welcome your donation. Please visit this link for more details.</p>"},{"location":"blog/20231018/20231018/","title":"LTE Authentication Introduction: EPS-AKA'","text":"<p>Note</p> <p>Author: Wilson Date: 2023/10/18</p>"},{"location":"blog/20231018/20231018/#abstract","title":"Abstract","text":"<p>In this article, I will delve into the topic of EPS-AKA', a subject closely related to 4G network security. The article is structured as follows:</p> <ol> <li>An introduction to EPS-AKA'.</li> <li>An explanation of the concept of authentication.</li> <li>An exploration of key hierarchy generation in the 4G network, emphasizing its relevance to the EPS-AKA' procedure.</li> <li>A detailed examination of the EPS-AKA' procedure.</li> <li>A comparison between 4G AKA and 5G AKA, highlighting both their similarities and differences.</li> </ol>"},{"location":"blog/20231018/20231018/#introduction","title":"Introduction","text":"<p>Every day, people use apps like Line to send messages, watch videos on YouTube, and send emails via Gmail. To do any these activities, a connection to the Internet must be established. However, once a connection is made, the data packets transmitted are at risk of being intercepted. To ensure the confidentiality of the data and to verify its integrity, the LTE Security Procedure is initiated whenever a mobile phone goes online or sends a message.</p> <p>The LTE Security Procedure is categorized into three stages :</p> <ul> <li>EPS-AKA'</li> <li>NAS Security</li> <li>AS Security</li> </ul> <p>EPS-AKA' stands for \"Evolved Packet System-Authentication and Key Agreement\". As suggested by its full name, AKA primarily involves two key actions:</p> <ul> <li>Authentication</li> <li>Key Agreement</li> </ul> <p>The focus of this article will be on EPS-AKA', which is further divided into two main steps:</p> <ol> <li>In the first step, the network generate an authentication vector. Some of the information within this vector is used for authentication.</li> <li>The second step involves mutual authentication between the user and the network.</li> </ol>"},{"location":"blog/20231018/20231018/#understanding-the-definition-of-authentication","title":"Understanding the Definition of Authentication","text":"<p>Most people have come across the term \"authentication\", and its definition varies depending on context and interpretation. For the purposes of this article, and based on my own understanding, I'll use an everyday analogy to explain the concept of authentication.</p> <p>Imagine during summer of winter vacation, your family decides to travel abroad. Before you board the plane, you must clear customs. The customs officier determines if you can proceed by examining your passport. This procedure resembles the process of authentication. As illustrated in Figure 1, a traveler presents their passport to a customs officer who then compares the passport details with information on their computer. If the passport's contents match the computer's records, you are granted passage. At the heart of authentication is this act of verification.</p> <p>In the context of the EPS-AKA' procedure, authentication occurs twice:</p> <ol> <li>Initially, the HSS provides the  to the UE. The UE then compares the received  whith its . If the  mathes the , it indicates sucessful authentication. This step verifies the authenticity of the HSS and, by extension, the network.</li> <li>In the second instance, the UE forwards the RES to the MME. The MME then compares the provided RES with the XRES. If the RES aligns with the XRES, authentication is successful. This stage confirms the authenticity of the UE.</li> </ol> <p> Figure 1. The Definition of Authentication</p>"},{"location":"blog/20231018/20231018/#key-hierarchy-generation-in-4g","title":"Key Hierarchy Generation in 4G","text":"<p>The Figure 2 is the key hierarchy generation in 4G. When an UE is generated, the <code>IMSI</code> and <code>K</code> value are stored in the USIM card, and the <code>IMSI</code> and <code>K</code> value are regarded as the permanent value. When an UE subscribes to the operator's network, the HSS will get the permanent value of the UE's <code>IMSI</code> and <code>K</code>.</p> <p>The USIM and HSS use the <code>K</code> as the base to generate the <code>CK</code> and <code>IK</code> in the EPS-AKA' stage of the LTE Security Procedure. The HSS uses the <code>CK</code> and <code>IK</code> as the base to generate the  and transmits the  to the MME. The USIM transmits the <code>CK</code> and <code>IK</code> to the UE, and UE uses the <code>CK</code> and <code>IK</code> as the base to generate the .</p> <p>The UE and MME use the  as the base and generate separately three keys in the NAS Security stage of the LTE Security Procedure. Three keys are the , , and . The  and  are used in the NAS Security stage, and the  is transmitted to the eNodeB.</p> <p>The UE and eNodeB use the  as the base and generate separately three keys in the AS Security stage of the LTE Security Procedure. Three keys are the , , and .</p> <p> Figure 2. Key Hierarchy Generation in 4G</p>"},{"location":"blog/20231018/20231018/#eps-aka-procedure","title":"EPS-AKA' Procedure","text":"<p> Figure 3. EPS-AKA' Procedure</p>"},{"location":"blog/20231018/20231018/#the-ue-sends-the-attach-request-to-the-mme","title":"The UE sends the <code>Attach Request</code> to the MME","text":"<p>The Figure 3 shows the entire EPS-AKA' procedure. The UE sends the <code>Attach Request</code> to the MME. The <code>Attach Request</code> contains the <code>IMSI</code>, <code>UE Network Capability</code>, and . The <code>IMSI</code> is like the ID number of this UE. The <code>UE Network Capability</code> is what encryption and integrity protection algorithms the UE supports. The UE sends <code>UE Network Capability</code> to tell MME. The content of <code>UE Network Capability</code> is like EEA0=on, EEA1=on, EEA2=off, ..., EIA1=on, EIA2=on, ... The on and off symbols are represented by one bit. The  represents the number corresponding to the . The  is represented by 3 bits. The value of  is 7, which means that the UE does not have the  yet.</p>"},{"location":"blog/20231018/20231018/#the-mme-sends-the-authentication-information-request-to-the-hss","title":"The MME sends the <code>Authentication Information Request</code> to the HSS","text":"<p>The MME sends the <code>Authentication Information Request</code> to the HSS after receiving the <code>Attach Request</code>. The <code>Authentication Information Request</code> contains the <code>IMSI</code>, <code>SN ID</code>, <code>n</code>, and <code>Network Type</code>. The full English name of <code>SN ID</code> is Serving Network ID, which refers to the network that the user wants to connect to. The value of <code>SN ID</code> is usually composed of the MCC and MNC (PLMN ID). The <code>n</code> represents how many verifcation vectors are sent to the HSS. The <code>Network Type</code> is what kind of wireless network the user wants to connect to the Internet from my understanding.</p>"},{"location":"blog/20231018/20231018/#the-hss-sends-the-authentication-information-answer-to-the-mme","title":"The HSS sends the <code>Authentication Information Answer</code> to the MME","text":"<p>The HSS automatically generates the <code>RAND</code> and <code>SQN</code> after receiving the <code>Authentication Information Request</code>. The HSS inputs the <code>K</code>, <code>SQN</code>, and <code>RAND</code> into the Cryptographic Function. The Cryptographic Function uses the EPS AKA algorithm and outputs the <code>XRES</code>, , <code>CK</code>, and <code>IK</code>. The HSS inputs the <code>CK</code>, <code>IK</code>, <code>SQN</code>, and <code>SN ID</code> into the KDF (Key Derivation Function). The KDF outputs . Then, the <code>RAND</code> that is generated by the HSS itself, the  and <code>XRES</code> that are generated by the Cryptographic Function, and the  that is generated by KDF are combined into the AV. The <code>Authentication Information Answer</code> includes AV and is sent to the MME.</p>"},{"location":"blog/20231018/20231018/#the-mme-sends-the-authentication-request-to-the-ue","title":"The MME sends the <code>Authentication Request</code> to the UE","text":"<p>The MME selects an AV among multiple AVs and sends the <code>Authentication Request</code> to the UE after receiving the <code>Authentication Information Answer</code>. The <code>Authentication Request</code> contains the <code>RAND</code>, , and .</p>"},{"location":"blog/20231018/20231018/#the-ue-sends-the-authentication-response-to-the-mme","title":"The UE sends the <code>Authentication Response</code> to the MME","text":"<p>The UE receives the <code>Authentication Request</code>. Why do you see the <code>SQN</code> is generated by the HSS in the Figure 3? The  carries the <code>SQN</code>. The UE can find the <code>SQN</code> in the . The USIM inputs the <code>K</code>, <code>SQN</code>, and <code>RAND</code> into the Cryptographic Function. The Cryptographic Function uses the EPS AKA algorithm and outputs the <code>RES</code>, , <code>CK</code>, and <code>IK</code>. When the UE gets , it compares the  with the . If the authentication is successful, the UE will generate the <code>RES</code>. The <code>Authentication Response</code> contains the <code>RES</code> and is returned to the MME.</p>"},{"location":"blog/20231018/20231018/#the-mme-receives-the-authentication-response","title":"The MME receives the <code>Authentication Response</code>","text":"<p>The MME compares the <code>XRES</code> with <code>RES</code> after receiving the <code>Authentication Response</code>. If the content of the <code>XRES</code> and <code>RES</code> are the same, it means that the authentication is successful. The authentication stage has come to an end.</p> <p>Finally, the UE inputs the <code>CK</code>, <code>IK</code>, <code>SQN</code>, and <code>SN ID</code> into the KDF. The KDF outputs . The UE and MME have the same . The  doesn't be transmitted between the UE and MME. The  is transmitted in the form of the  to prevent the  from being stolen by a third party.</p>"},{"location":"blog/20231018/20231018/#4g-vs-5g-aka-a-comparison","title":"4G vs. 5G AKA: A Comparison","text":"<p>Similarities:</p> <ol> <li>Both 4G and 5G UEs utilize the same Universal Subscriber Identity Module (USIM).</li> <li>Both systems rely on shared symmetric keys for authentication.</li> </ol> <p>Differences:</p> <ol> <li> <p>Authentication Mechanism:</p> <ul> <li>4G: EPS-AKA'</li> <li>5G: 5G-AKA and EAP-AKA'</li> </ul> </li> <li> <p>Serving Network:</p> <ul> <li>4G: MME</li> <li>5G: SEAF</li> </ul> </li> <li> <p>Home Network:</p> <ul> <li>4G: HSS</li> <li>5G: AUSF, UDM, ARPF, and SIDF</li> </ul> </li> <li> <p>Network Function for Authentication Vector Generation:</p> <ul> <li>4G: HSS</li> <li>5G: UDM and ARPF</li> </ul> </li> <li> <p>Network Function to Verify UE Identity:</p> <ul> <li>4G: MME</li> <li>5G<ul> <li>5G-AKA: SEAF and AUSF</li> <li>EAP-AKA': AUSF</li> </ul> </li> </ul> </li> <li> <p>Key Hierarchy Generation:</p> <ul> <li>4G: K -&gt; CK + IK -&gt;  </li> <li>5G<ul> <li>5G-AKA: K -&gt; CK + IK -&gt;  -&gt;  </li> <li>EAP-AKA': K -&gt; CK + IK -&gt; CK' + IK' -&gt;  -&gt;  </li> </ul> </li> </ul> </li> </ol>"},{"location":"blog/20231018/20231018/#reference","title":"Reference","text":"<ul> <li>LTE Security I: Concept and Authentication</li> <li>LTE Security II: NAS and AS Security</li> <li>https://kknews.cc/zh-tw/code/65y6x9l.html</li> <li>https://nccnews.com.tw/202010/ch4.html</li> </ul>"},{"location":"blog/20231018/20231018/#about","title":"About","text":"<p>Hi, my name is Wilson. I am a master\u2019s student. My main area of research is network slicing. In the future, I will introduce more information about 5G. Hope you enjoy it.</p> <p>Note</p> <p>If you are interested in supporting free5GC, we welcome your donation. Please visit this link for more details.</p>"},{"location":"blog/20231108/20231108/","title":"Introduction of IP Multimedia Subsystem Part 1","text":"<p>Note</p> <p>Author: Elisa Lee Date: 2023/11/08</p> <p>The IMS is a framework for delivering multimedia and voice services over IP networks. It plays a crucial role in enabling communication services like voice, video, and messaging to be delivered in a converged, efficient, and scalable manner. </p>"},{"location":"blog/20231108/20231108/#definition-and-overview-of-ims","title":"Definition and Overview of IMS","text":""},{"location":"blog/20231108/20231108/#introduction-to-ims","title":"Introduction to IMS","text":"<p>A standardized, open architectural framework that allows multimedia services to be delivered over IP networks. It is defined by the 3GPP (3rd Generation Partnership Project) and widely used in mobile networks.</p>"},{"location":"blog/20231108/20231108/#purpose-and-significance-of-ims","title":"Purpose and Significance of IMS","text":""},{"location":"blog/20231108/20231108/#purpose-of-ims","title":"Purpose of IMS","text":""},{"location":"blog/20231108/20231108/#multimedia-services","title":"Multimedia Services","text":"<p>IMS is designed to support a wide range of multimedia services such as voice, video, messaging, and data services over IP networks.</p>"},{"location":"blog/20231108/20231108/#interoperability","title":"Interoperability","text":"<p>It provides a standardized architecture that allows different network elements and applications from various vendors to work together seamlessly. This promotes interoperability, which is vital in a diverse telecommunications ecosystem.</p>"},{"location":"blog/20231108/20231108/#service-convergence","title":"Service Convergence","text":"<p>IMS allows the convergence of various services like voice, video, and data onto a single IP network. This makes it possible for users to access multiple services through a unified interface.</p>"},{"location":"blog/20231108/20231108/#quality-of-service-qos","title":"Quality of Service (QoS)","text":"<p>IMS enables network operators to prioritize and manage different types of traffic, ensuring that services like voice and video receive the necessary bandwidth and low latency for a high-quality user experience.</p>"},{"location":"blog/20231108/20231108/#session-management","title":"Session Management","text":"<p>It manages sessions for different types of services, ensuring that sessions are established, maintained, and terminated appropriately.</p>"},{"location":"blog/20231108/20231108/#mobility-management","title":"Mobility Management","text":"<p>IMS allows for seamless mobility across different access networks (e.g., Wi-Fi, LTE, 5G), ensuring continuity of services as users move between different coverage areas.</p>"},{"location":"blog/20231108/20231108/#security","title":"Security","text":"<p>IMS incorporates security features and protocols to protect the confidentiality, integrity, and authenticity of communication sessions.</p>"},{"location":"blog/20231108/20231108/#billing-and-charging","title":"Billing and Charging","text":"<p>It supports real-time charging and billing capabilities, allowing operators to accurately charge users for the services they consume.</p>"},{"location":"blog/20231108/20231108/#significance-of-ims","title":"Significance of IMS","text":""},{"location":"blog/20231108/20231108/#transition-to-all-ip-networks","title":"Transition to All-IP Networks","text":"<p>IMS is a key enabler in the shift from traditional circuit-switched networks to all-IP networks. This transition is essential for supporting advanced multimedia services.</p>"},{"location":"blog/20231108/20231108/#facilitates-4g-and-5g-technologies","title":"Facilitates 4G and 5G Technologies","text":"<p>IMS is a critical component for the deployment and operation of 4G LTE and 5G networks, providing the infrastructure for delivering high-speed data services and advanced multimedia applications.</p>"},{"location":"blog/20231108/20231108/#enhances-user-experience","title":"Enhances User Experience","text":"<p>By enabling the delivery of high-quality multimedia services, IMS significantly enhances the user experience, particularly for applications like video calling, streaming, and real-time gaming.</p>"},{"location":"blog/20231108/20231108/#enables-next-generation-services","title":"Enables Next-Generation Services","text":"<p>IMS is foundational for emerging technologies like IoT (Internet of Things) and Industry 4.0, enabling a wide range of applications and services across various industries.</p>"},{"location":"blog/20231108/20231108/#promotes-innovation","title":"Promotes Innovation","text":"<p>IMS's standardized architecture encourages innovation by allowing developers to create new services and applications that can run on IMS-enabled networks.</p>"},{"location":"blog/20231108/20231108/#global-standardization","title":"Global Standardization","text":"<p>IMS is based on international standards defined by organizations like 3GPP and ETSI (European Telecommunications Standards Institute), ensuring global compatibility and uniformity in telecommunications networks.</p>"},{"location":"blog/20231108/20231108/#key-components-of-ims","title":"Key Components of IMS","text":""},{"location":"blog/20231108/20231108/#sip-session-initiation-protocol","title":"SIP (Session Initiation Protocol)","text":"<p>SIP is a signaling protocol used for initiating, maintaining, modifying, and terminating real-time sessions that involve video, voice, messaging, and other communications applications and services over the internet. It operates at the application layer of the OSI model and is widely used for VoIP (Voice over Internet Protocol) and other multimedia communication applications.</p>"},{"location":"blog/20231108/20231108/#role-of-sip-in-ims","title":"Role of SIP in IMS","text":"<p>In the context of IMS, SIP serves as the primary signaling protocol. </p>"},{"location":"blog/20231108/20231108/#session-establishment","title":"Session Establishment","text":"<p>SIP is used to initiate communication sessions between devices or applications. When a user wants to make a call, send a message, or establish a multimedia session, SIP is responsible for setting up the connection.</p>"},{"location":"blog/20231108/20231108/#user-location-and-registration","title":"User Location and Registration","text":"<p>SIP allows devices to register their location on the network. This information is crucial for routing calls and messages to the correct destination.</p>"},{"location":"blog/20231108/20231108/#call-control","title":"Call Control","text":"<p>SIP handles the signaling for call control functions such as call setup, call hold, call transfer, and call release. It defines how these operations should be communicated between endpoints.</p>"},{"location":"blog/20231108/20231108/#service-invocation","title":"Service Invocation","text":"<p>It enables the invocation of various services within IMS, like call forwarding, call waiting, and supplementary services.</p>"},{"location":"blog/20231108/20231108/#session-modification-and-termination","title":"Session Modification and Termination","text":"<p>SIP is also responsible for modifying existing sessions (e.g., adding participants to a call) and terminating sessions when the user ends the communication.</p>"},{"location":"blog/20231108/20231108/#media-negotiation","title":"Media Negotiation","text":"<p>While SIP is responsible for signaling, it doesn't handle the actual media (audio, video, etc.) transfer. It works in conjunction with protocols like RTP (Real-time Transport Protocol) for media transmission.</p>"},{"location":"blog/20231108/20231108/#signaling-for-establishing-modifying-and-terminating-sessions","title":"Signaling for establishing, modifying, and terminating sessions","text":""},{"location":"blog/20231108/20231108/#session-establishment_1","title":"Session Establishment:","text":"<ul> <li> <p>Caller's Request:  The caller's device sends a SIP INVITE message to the SIP server, indicating the intention to establish a session with the callee.</p> </li> <li> <p>SIP Server Processing:  The SIP server processes the INVITE message. It checks the user's location and forwards the request to the recipient's SIP server.</p> </li> <li> <p>Recipient's Response:  The recipient's SIP server delivers the INVITE message to the callee's device. If the recipient is available and agrees to the session, their device sends a SIP 200 OK response back.</p> </li> <li> <p>Session Establishment:  Once the caller's device receives the 200 OK response, it acknowledges the establishment of the session. The media streams (audio, video, etc.) can then begin.</p> </li> </ul>"},{"location":"blog/20231108/20231108/#session-modification","title":"Session Modification","text":"<p>If a user wants to modify an ongoing session, such as adding another participant to a call, the SIP signaling is used to send an UPDATE request. This request is processed by the SIP servers and communicated to the affected parties.</p>"},{"location":"blog/20231108/20231108/#session-termination","title":"Session Termination","text":"<p>When a user decides to end a session, their device sends a SIP BYE message. This message is processed by the SIP servers, and the appropriate responses are sent to indicate the termination of the session. It's important to note that SIP is a text-based protocol, and it uses URLs similar to those used on the web to identify users and services. This makes it versatile and easy to integrate into existing internet infrastructure.</p>"},{"location":"blog/20231108/20231108/#sdp-session-description-protocol","title":"SDP (Session Description Protocol)","text":"<p>The SDP is a protocol used in multimedia communications to negotiate and describe sessions between participants. It provides a concise and human-readable way to convey information about the characteristics of a multimedia session.</p>"},{"location":"blog/20231108/20231108/#role-of-sdp-in-session-negotiation-and-description","title":"Role of SDP in session negotiation and description","text":""},{"location":"blog/20231108/20231108/#session-negotiation","title":"Session Negotiation","text":"<ul> <li> <p>Media Types:  This includes information about the type of media (e.g., audio, video, application data) that will be exchanged during the session.</p> </li> <li> <p>Codecs and Formats:  SDP specifies which codecs (compression/decompression algorithms) and formats will be used for media encoding and decoding.</p> </li> <li> <p>Transport Protocols:  It describes the transport protocol and ports that will be used for sending and receiving media packets.</p> </li> <li> <p>Network Addresses:  SDP provides information about the IP addresses and ports where media should be sent.</p> </li> <li> <p>Timing and Synchronization:  SDP can include information about timing aspects like session start and end times, as well as synchronization of different media streams.</p> </li> </ul>"},{"location":"blog/20231108/20231108/#session-description","title":"Session Description","text":"<p>SDP accomplishes session description by providing a structured text-based format that includes information about the session parameters mentioned above. This description is typically conveyed in the form of an SDP message.</p>"},{"location":"blog/20231108/20231108/#negotiating-capabilities","title":"Negotiating Capabilities","text":"<ul> <li> <p>Establishing Media Streams: SDP is crucial for establishing media streams. It specifies how media should be encoded, transported, and synchronized between participants. This ensures that audio, video, and other data are transmitted and received correctly.</p> </li> <li> <p>Interoperability: SDP is a standardized format, allowing devices and applications from different vendors to communicate effectively. This promotes interoperability, which is crucial in diverse multimedia environments.</p> </li> <li> <p>Dynamic Adaptation: SDP can be updated dynamically during a session. For example, if network conditions change, SDP can be used to renegotiate parameters like codecs or bitrates to ensure the best possible quality.</p> </li> </ul>"},{"location":"blog/20231108/20231108/#hss-home-subscriber-server","title":"HSS (Home Subscriber Server)","text":"<p>The HSS is a crucial component within the IMS architecture. It serves as a central database that stores and manages subscriber-related information for users in a telecommunications network.</p>"},{"location":"blog/20231108/20231108/#definition-and-function-of-hss-in-ims","title":"Definition and function of HSS in IMS","text":""},{"location":"blog/20231108/20231108/#definition","title":"Definition","text":"<p>The HSS is a core network element in the IMS architecture. It is a centralized database that contains essential information about subscribers, including their identities, services, and authentication credentials. The HSS plays a pivotal role in facilitating various services and functions within IMS.</p>"},{"location":"blog/20231108/20231108/#function-of-hss-in-ims","title":"Function of HSS in IMS","text":"<ul> <li> <p>Subscriber Profile Management:  The HSS stores detailed information about each subscriber, including their IMS public user identity, contact information, allocated services, and preferences. This data is used for session setup, authorization, and routing decisions.</p> </li> <li> <p>Authentication and Authorization:  HSS is responsible for authenticating users when they attempt to access IMS services. It verifies the subscriber's credentials (such as username and password) before granting access. Additionally, it provides information about the services and capabilities available to each subscriber.</p> </li> <li> <p>Subscriber Location:  It keeps track of the location of subscribers within the network. This information is crucial for routing calls and messages to the appropriate serving network element.</p> </li> <li> <p>Security Functions:  The HSS plays a role in the security architecture of IMS. It stores security-related keys and information necessary for secure communication between the subscriber's device and the IMS network.</p> </li> <li> <p>Policy and Charging Control (PCC):  HSS may also be involved in policy control and charging decisions. It provides information about the subscriber's subscription and policy rules that dictate how services are delivered and charged.</p> </li> </ul>"},{"location":"blog/20231108/20231108/#managing-subscriber-data-and-authentication","title":"Managing subscriber data and authentication","text":""},{"location":"blog/20231108/20231108/#managing-subscriber-data","title":"Managing Subscriber Data","text":"<ul> <li> <p>Subscriber Registration:  When a subscriber logs into the network, the HSS is involved in the registration process. It verifies the subscriber's identity and allocates necessary resources and services.</p> </li> <li> <p>Profile Updates:  The HSS is responsible for updating subscriber profiles. This includes adding or removing services, updating contact information, or changing authentication credentials.</p> </li> <li> <p>Roaming Support:  In the case of roaming, the HSS plays a key role in managing the subscriber's information, ensuring that services can be delivered seamlessly across different networks.</p> </li> </ul>"},{"location":"blog/20231108/20231108/#authentication","title":"Authentication","text":"<ul> <li> <p>Challenge-Response Mechanism:  When a subscriber attempts to access IMS services, the HSS challenges the subscriber's device for authentication credentials.</p> </li> <li> <p>Verifying Credentials:  The HSS verifies the subscriber's credentials using authentication algorithms and keys. This ensures that only authorized users can access the network.</p> </li> <li> <p>Generating Security Tokens:  After successful authentication, the HSS generates security tokens that are used to secure the communication sessions between the subscriber's device and the network.</p> </li> <li> <p>Subscriber Privacy and Security:  The authentication process ensures that subscriber information and communication sessions are protected from unauthorized access and interception.</p> </li> </ul>"},{"location":"blog/20231108/20231108/#cscf-call-session-control-function","title":"CSCF (Call Session Control Function)","text":"<p>The CSCF is a crucial element in the IMS architecture, responsible for handling call/session control and routing within the network. There are three types of CSCFs, each serving specific roles in the IMS framework.</p>"},{"location":"blog/20231108/20231108/#proxy-cscf-p-cscf","title":"Proxy CSCF (P-CSCF)","text":"<p>The P-CSCF is a vital component within the IMS architecture. It serves as the initial point of contact for UE (User Equipment) when establishing communication sessions. The P-CSCF behaves as a proxy, managing incoming requests by either processing them internally or forwarding them to appropriate destinations. It does not modify the Request URI in the SIP INVITE message. In certain scenarios, the P-CSCF may also act as a User Agent, independently generating SIP transactions. Additionally, the P-CSCF's address is discovered by UEs following PDP context activation, allowing for seamless initiation of sessions.</p>"},{"location":"blog/20231108/20231108/#key-functions","title":"Key Functions","text":"<ul> <li> <p>Forwarding SIP register requests from the UE to the appropriate I-CSCF based on the UE's home domain.</p> </li> <li> <p>Relaying SIP messages received from the UE to the designated SIP server (e.g., S-CSCF) obtained during the registration process.</p> </li> <li> <p>Forwarding SIP requests or responses to the UE.</p> </li> <li> <p>Detecting and handling emergency session establishment requests according to specified error handling procedures.</p> </li> <li> <p>Generating Call Detail Records for transaction records.</p> </li> <li> <p>Establishing and maintaining Security Associations with each UE.</p> </li> <li> <p>Performing SIP message compression and decompression.</p> </li> <li> <p>Authorizing bearer resources and managing QoS</p> </li> </ul>"},{"location":"blog/20231108/20231108/#interrogating-cscf-i-cscf","title":"Interrogating CSCF (I-CSCF)","text":"<p>The I-CSCF functions as the initial entry point within an operator's network for all incoming connections directed to a user of that network operator or to a roaming user currently situated within the operator's service area. An operator's network may incorporate multiple I-CSCFs to manage these incoming connections effectively.</p>"},{"location":"blog/20231108/20231108/#key-functions_1","title":"Key Functions","text":"<ul> <li>Assigning a Serving-CSCF (S-CSCF) to a user during the SIP registration process.</li> <li>Routing SIP requests received from other networks to the appropriate S-CSCF.</li> <li>Retrieving the S-CSCF address from the HSS.</li> <li>Forwarding SIP requests or responses to the determined S-CSCF.</li> <li>Generating Call Detail Records to maintain transaction records.</li> </ul>"},{"location":"blog/20231108/20231108/#serving-cscf-s-cscf","title":"Serving CSCF (S-CSCF)","text":"<p>The S-CSCF is a pivotal component in the IMS architecture. Its primary role involves providing session control services for the UE. The S-CSCF maintains a session state essential for supporting various services as required by the network operator. It's worth noting that different S-CSCFs within an operator's network may have varying functionalities tailored to specific requirements.</p>"},{"location":"blog/20231108/20231108/#key-functions_2","title":"Key Functions","text":"<ul> <li>May act as a Registrar, accepting registration requests and making its information available through the location server (e.g., HSS).</li> <li>Controls sessions for registered endpoints, including rejecting IMS communication to/from barred public user identities.</li> <li>May behave as a Proxy Server, handling requests internally or forwarding them.</li> <li>May behave as a User Agent, capable of terminating and independently generating SIP transactions.</li> <li>Provides endpoints with service event-related information, such as notification of tones/announcements and location of additional media resources, along with billing notifications.</li> <li>Obtains the Address of the I-CSCF for the network operator serving the destination user and forwards SIP requests/responses accordingly.</li> <li>Routes SIP requests/responses based on the type of procedure.</li> </ul>"},{"location":"blog/20231108/20231108/#cscfs-role-in-callsession-control-and-routing","title":"CSCFs Role in Call/Session Control and Routing","text":""},{"location":"blog/20231108/20231108/#session-setup-and-control","title":"Session Setup and Control","text":"<ul> <li> <p>P-CSCF: Acts as the first point of contact for UE and handles initial session signaling. It forwards requests to the appropriate destination, facilitating session establishment.</p> </li> <li> <p>I-CSCF: Serves as the entry point within the operator's network for connections directed to a user. It assigns a S-CSCF during SIP registration and routes requests/responses accordingly.</p> </li> <li> <p>S-CSCF: Manages session control services for the UE. It maintains a session state as required by the network operator and controls sessions for registered endpoints.</p> </li> </ul>"},{"location":"blog/20231108/20231108/#authentication-and-authorization","title":"Authentication and Authorization","text":"<ul> <li> <p>P-CSCF: May perform Registrar functions, accepting registration requests from the UE and making information available through the location server (e.g., HSS).</p> </li> <li> <p>S-CSCF: Manages authentication and authorization for the UE, ensuring secure access to network services.</p> </li> </ul>"},{"location":"blog/20231108/20231108/#routing-and-interrogation","title":"Routing and Interrogation","text":"<ul> <li>I-CSCF: Routes SIP requests received from other networks towards the appropriate S-CSCF. It retrieves the S-CSCF address from the HSS and forwards requests/responses accordingly.</li> </ul>"},{"location":"blog/20231108/20231108/#service-enforcement","title":"Service Enforcement","text":"<ul> <li>S-CSCF: Enforces services by providing endpoints with service event-related information, such as notification of tones/announcements, location of additional media resources, and billing notifications.</li> </ul>"},{"location":"blog/20231108/20231108/#interworking-with-other-networks","title":"Interworking with Other Networks","text":"<ul> <li>S-CSCF: Depending on operator policy, may forward SIP requests or responses to SIP servers located within an ISP domain outside of the IMS Core Network. It can also forward requests for call routing to the PSTN or CS Domain.</li> </ul>"},{"location":"blog/20231108/20231108/#architecture-and-interfaces-of-ims","title":"Architecture and Interfaces of IMS","text":""},{"location":"blog/20231108/20231108/#architecture-of-ims","title":"Architecture of IMS","text":""},{"location":"blog/20231108/20231108/#mgcfmedia-gateway-control-function","title":"MGCF(Media Gateway Control Function)","text":"<p>The MGCF is a crucial component within the IMS architecture. Its primary role is to facilitate the interconnection between the IMS network and circuit-switched networks, such as the Public Switched Telephone Network (PSTN) or the Circuit-Switched domain.</p>"},{"location":"blog/20231108/20231108/#asapplication-server","title":"AS(Application Server)","text":"<p>An AS in the context of the IMS is a critical component responsible for providing various value-added services to users within the IMS network. The AS hosts and executes applications that deliver a wide range of services, enriching the user experience with multimedia capabilities.</p>"},{"location":"blog/20231108/20231108/#tas-telephony-application-server","title":"TAS (Telephony Application Server)","text":"<p>The TAS is a critical component within the IMS architecture. It plays a key role in delivering advanced telephony services and features in a multimedia-rich environment. The TAS is responsible for the provisioning, execution, and control of telephony-related applications and services within the IMS network.</p>"},{"location":"blog/20231108/20231108/#p-cscf","title":"P-CSCF","text":"<p>As described above.   </p>"},{"location":"blog/20231108/20231108/#i-cscf","title":"I-CSCF","text":"<p>As described above.</p>"},{"location":"blog/20231108/20231108/#s-cscf","title":"S-CSCF","text":"<p>As described above.</p>"},{"location":"blog/20231108/20231108/#hss","title":"HSS","text":"<p>As described above.</p>"},{"location":"blog/20231108/20231108/#interfaces-of-ims","title":"Interfaces of IMS","text":""},{"location":"blog/20231108/20231108/#gm-interface","title":"Gm Interface","text":"<ul> <li>Description: The Gm Interface plays a pivotal role in all user-based communications. It serves as the link between the UE and the P-CSCF, facilitating various functions such as registration, de-registration, handling incoming and outgoing calls, managing SIP signaling, and enabling any form of communication between the user and the IMS network. To ensure security, the Gm and Mw Interfaces are physically isolated. This interface is responsible for authentication, encryption, and comprehensive session control. Gm utilizes SIP and SDP protocols.</li> <li>Function: Facilitates connectivity between the UE and the IMS network for tasks including registration, authentication, encryption, and session control.</li> </ul>"},{"location":"blog/20231108/20231108/#mw-interface","title":"Mw Interface","text":"<ul> <li>Description: The Mw Interface facilitates communication between CSCF nodes within the IMS core network. Usually, the Session Border Controller (SBC) hosts the P-CSCF, establishing a connection to the I/S-CSCF through the Mw Protocol. Mw employs SIP and SDP Protocols to enable this connectivity.</li> <li>Function: Facilitates message exchange between CSCFs (e.g., from P-CSCF to S-CSCF)</li> </ul>"},{"location":"blog/20231108/20231108/#isc-interface","title":"ISC Interface","text":"<ul> <li>Description: The ISC interface establishes connectivity between the S-CSCF and TAS (Telephony Application Server). This interface engages with the MMTel supplementary services deployed on the TAS, utilizing the IMS Service Control Interface to request services. Additionally, it accommodates TAS-initiated requests to the IMS.</li> <li>Function: The S-CSCF interacts with the MMTel supplementary services integrated into the TAS.</li> </ul>"},{"location":"blog/20231108/20231108/#sh-interface","title":"Sh Interface","text":"<ul> <li>Description: The Sh Interface is employed between the TAS and HSS to facilitate the exchange of User Profile information, encompassing service-related details, user location information, and charging function data. It enables the transmission of service and subscriber-related information from the HSS to the TAS. This operation is akin to a Location Update between the HSS and TAS. Sh operates using the Diameter protocol.</li> <li>Function: The TAS retrieves user profiles from the HSS and activates services for the user.</li> </ul>"},{"location":"blog/20231108/20231108/#cx-interfaces","title":"Cx Interfaces","text":"<ul> <li>Description:The Cx Interface is utilized between the I/S-CSCF and HSS to download subscriber data from the HSS to the S-CSCF. It enables IMS registration and the transfer of subscriber data to the S-CSCF. Cx operates on the Diameter protocol.</li> <li>Function: The I/S-CSCF communicates with the HSS to retrieve user profiles, assisting in user registration and authentication.</li> </ul>"},{"location":"blog/20231108/20231108/#rx-interface","title":"Rx Interface","text":"<ul> <li>Description: The Rx interface serves as a bridge between the IMS Network and the Packet Core. It operates between the P-CSCF and the PCRF, enabling the request of an appropriate policy for session establishment, including both incoming and outgoing voice calls. The Rx Interface plays a crucial role in controlling the setup of various call types, thereby authorizing and managing resource usage in the access networks. It operates on the Diameter protocol.</li> <li>Function: Establishing a suitable policy for incoming or outgoing calls on the network through PCRF.</li> </ul>"},{"location":"blog/20231108/20231108/#mg-interface","title":"Mg Interface","text":"<ul> <li>Description: The Mg Interface facilitates the transmission of SIP messages between an S/I-CSCF and an MGCF for signaling purposes. It is utilized for the exchange of signaling between the CSCF and Media Gateway for calls coming and going towards circuit core networks.</li> <li>Function: Facilitates interworking with the circuit-switched network for the CSCF.</li> </ul>"},{"location":"blog/20231108/20231108/#reference","title":"Reference","text":"<p>3GPP TS 29 163: \"Interworking between the IP Multimedia (IM) Core Network (CN) subsystem and Circuit Switched (CS) networks\"</p> <p>3GPP TS 22.228: \"Service requirements for the Internet Protocol (IP) multimedia core network subsystem (IMS) - Stage 1\"</p> <p>3GPP TS 23.218: \"IP Multimedia (IM) session handling; IM call model; Stage 2\"</p> <p>3GPP TS 23.228: \"IP Multimedia Subsystem (IMS) - Stage 2\"</p> <p>3GPP TS 24.229: \"IP multimedia call control protocol based on Session Initiation Protocol (SIP) and Session Description Protocol (SDP) - Stage 3\"</p> <p>3GPP TS 29.228: \"IP Multimedia (IM) Subsystem Cx and Dx Interfaces; Signalling flows and message contents\"</p>"},{"location":"blog/20231108/20231108/#about","title":"About","text":"<p>Hello, I am Elisa Lee. My ongoing research revolves around VoNR (Voice over New Radio). I encourage any inquiries or identification of errors within the article, as they are welcomed for correction. Your feedback is invaluable, so please don't hesitate to reach out via email to share your insights.</p> <p>Note</p> <p>If you are interested in supporting free5GC, we welcome your donation. Please visit this link for more details.</p>"},{"location":"blog/20231115/free5GC_OAuth2_Procedure/","title":"Introduction to free5GC OAuth2 Procedure","text":"<p>Note</p> <p>Author: Andy Chen (CTFang)  Date: 2023/11/15</p> <p></p> <p>Description </p> <p>[0-0]. NF_Registration: See TS 29.510 Section5.2.2.2 NFRegister for more details. </p> <p>[0-1]. When an NF registers with NRF using NFProfile, NRF adds <code>CustomInfo.oauth2=true</code> to NFProfile and replies to NF upon successful registration. (See TS29.510 for more detailed information about CustomInfo.)</p> <p>[1]. The <code>GetTokenCtx()</code> function generates a context and inserts the access token into the request header.</p> <p>[2]. If the token has expired, the NF would use <code>SendAccTokenReq()</code> to obtain a new token from NRF.</p> <p>[3]. NRF would verify the request NFType and the requested service for authorization, and issue the token if authorized.</p>"},{"location":"blog/20231115/free5GC_OAuth2_Procedure/#note","title":"Note","text":"<p>The OAuth2 functions are under development in free5GC. They will be released after thorough testing. Furthermore, there may be a more detailed workflow article related to this topic.</p>"},{"location":"blog/20231115/free5GC_OAuth2_Procedure/#in-progress","title":"In Progress","text":"<ul> <li>free5gc/NRF PR#27</li> <li>free5gc/openapi PR#17</li> <li>There would be related Pull Request for each NF. </li> </ul>"},{"location":"blog/20231115/free5GC_OAuth2_Procedure/#future-work","title":"Future Work","text":"<ul> <li> <p><code>allowedNfTypes</code>: TS 29.510 Section6.1.6.2.2 Definition of type NFProfile</p> <p>When NRF verifies the scope during the AccessTokenRequest, it checks the target NF's NFProfile allowedNfTypes to determine whether the NF consumer is in the allowedNfType or not.</p> </li> <li> <p>TLS Mutual Authentication: TS 33.501 Section13.3.1 Authentication &amp; Authorization between NF and NRF</p> <p>Authentication and authorization between NF and NRF are completed if PLMN uses protection at the transport layer with mutual authentication.</p> </li> </ul>"},{"location":"blog/20231115/free5GC_OAuth2_Procedure/#about","title":"About","text":"<p>Hello, I am Andy Chen. I have just started making contributions to the free5GC core network. This post is my first blog, so if there are any inquiries or identification of errors within, we welcome discussion and correction. Your feedback is invaluable, so please don't hesitate to reach out via email to share your insights.</p>"},{"location":"blog/20231115/free5GC_OAuth2_Procedure/#connect-with-me","title":"Connect with Me","text":"<ul> <li> <p>Linkedin: https://www.linkedin.com/in/tsung-fang-chen-437a71191/</p> </li> <li> <p>Github: https://github.com/andy89923</p> </li> </ul>"},{"location":"blog/20231115/free5GC_OAuth2_Procedure/#appendix","title":"Appendix","text":"<p>Additionally, I have provided the graph with a dark background.</p> <p></p> <p>Note</p> <p>If you are interested in supporting free5GC, we welcome your donation. Please visit this link for more details.</p>"},{"location":"blog/20231122/20231122/","title":"Nephio: a Cloud Native Network Automation Linux Foundation Project","text":"<p>Note</p> <p>Author: Brian Chen (\u9673\u715c\u76db) Date: 2023/11/08</p> <p>As a free5GC maintainer, I'm excited to see a Linux Foundation project that utilizes our open-source software. Let's explore what Nephio can do. I will briefly introduce what is Nephio and then demonstrate how to install the free5gc-operator.</p>"},{"location":"blog/20231122/20231122/#nephios-goal","title":"Nephio's Goal","text":"<p>Nephio delivers carrier-grade, simple, open, Kubernetes-based cloud native intent automation and common automation templates that materially simplify the deployment and management of multi-vendor cloud infrastructure and network functions across large-scale edge deployments. It brings zero-touch provisioning of cloud infrastructure and network functions, which can offer increased network availability and resiliency while reducing maintenance downtime.</p>"},{"location":"blog/20231122/20231122/#what-problem-does-nephio-solve","title":"What Problem Does Nephio Solve?","text":"<p>Distributed cloud technologies facilitate edge access through on-demand, API-driven mechanisms. Regrettably, prevailing imperative, fragile, and fire-and-forget orchestration techniques face challenges in fully exploiting the dynamic capabilities inherent in these innovative infrastructure platforms. To achieve success in this domain, Nephio employs novel methodologies capable of navigating the intricacies associated with provisioning and overseeing a distributed, multi-vendor, multi-site deployment of interconnected network functions within on-demand distributed cloud environments.</p> <p>The objective of the solution is to handle the initial provisioning of network functions and the underlying cloud infrastructure. Additionally, it incorporates Kubernetes-enabled reconciliation to ensure network resilience amid failures, scaling occurrences, and alterations within the distributed cloud.</p>"},{"location":"blog/20231122/20231122/#benefits-of-kubernetes-based-cloud-native-automation","title":"Benefits of Kubernetes Based Cloud Native Automation","text":"<p>It enables multi-vendor support, faster onboarding, easier lifecycle management, embedded control-loop, active reconciliation, and service assurance, reducing costs through efficiency and agility. A common cloud-based automation framework, based on well-proven Kubernetes technology, minimizes the need for custom automation solutions for each application. Multi-vendor integration is enabled, improving customer experience.</p>"},{"location":"blog/20231122/20231122/#kubernetes-as-a-uniform-automation-control-plane","title":"Kubernetes as a Uniform Automation Control Plane","text":"<p>We can broadly think of three layers in the stack:</p> <ol> <li> <p>cloud infrastructure Nephio releases Custom Resource Definitions (CRDs) and operators built on Kubernetes for automation in both public and private cloud infrastructures, aligning with industry standards like the O-RAN O2 interface. These CRDs and operators have the capability to leverage established projects within the Kubernetes ecosystem as interchangeable southbound interfaces (such as Google Config Connector, AWS Controllers for Kubernetes, and Azure Service Operator). This establishes an open integration point, ensuring a more consistent approach to automation across various service providers.</p> </li> <li> <p>workload (network function) resources It covers configuring the provisioning of network function containers and the associated requirements for nodes and network fabric. This encompasses native Kubernetes primitives and industry extensions like multi-network Pods, SR-IOV, and similar technologies.  Currently, efficient utilization of these features demands intricate Infrastructure-as-Code templates tailored to specific network functions. Nephio aims to simplify this process by adopting a Configuration-as-Data approach, utilizing Kubernetes CRDs and well-structured schemas to enable robust, standards-based automation for network function configuration.</p> </li> <li> <p>workload (network function) configuration. Nephio starts by offering tools and libraries to support vendors in merging their current Yang and other industry models with Nephio, complying with standards (e.g., 01, 3GPP interface specs). To completely grasp the advantages of cloud-native automation, these models must transition to Kubernetes CRDs since these configurations are closely linked to those elucidated in (2). Nephio furnishes identical tooling across each stratum, facilitating the automation of interconnected configurations amidst these layers.</p> </li> </ol> <p></p> <p>Configuration Layers</p>"},{"location":"blog/20231122/20231122/#nephio-release-1","title":"Nephio Release 1","text":"<p>Project Nephio announced the availability of Release 1 (R1) on August, 2023.</p> <p>Nephio R1 brings revolutionary advancements in deployment, life cycle management and scaling of telecom cloud infrastructure and network functions by using Kubernetes cloud native technologies and intent-based automation.</p> <p>For more details, see Learning Nephio R1.</p> <p>Release 1 highlights:</p> <ul> <li>A framework to orchestrate cloud native network functions (CNF), infrastructure, and cross-domain lifecycle management</li> <li>Core Nephio principles and Kubernetes integration with custom resource definitions (CRDs).</li> <li>Enhanced user experience and sandbox environment.</li> </ul>"},{"location":"blog/20231122/20231122/#prove-of-concept-free5gc-operator","title":"Prove-of-Concept: free5gc-operator","text":"<p>You can refer to the PowerPoint presentations and YouTube videos they have posted to fully grasp the entire concept and architecture. Here, I attach some architectural diagrams of free5gc-operator below, but for more detailed information, I recommend watching the videos. </p> <p></p> <p>Nephio project utilizes KPT, a toolkit develop by Google, which help you manage, manipulate, customize, and apply Kubernetes Resource configuration data files. KPT supports management of Configuration as Data, which is an approach to management of configuration which</p> <ul> <li>makes configuration data the source of truth, stored separately from the live state</li> <li>uses a uniform, serializable data model to represent configuration</li> <li>separates code that acts on the configuration from the data and from packages / bundles of the data</li> <li>abstracts configuration file structure and storage from operations that act upon the configuration data; clients manipulating configuration data don't need to directly interact with storage (git, container images)</li> </ul> <p></p> <p></p>"},{"location":"blog/20231122/20231122/#what-does-nephio-free5gc-operator-do","title":"What does Nephio free5gc-operator do?","text":"<ol> <li>Reconciles {AMF,SMF,UPF}Deployment CustomResources (CRs)</li> <li>For all three NFs, they each have a Deployment and a ConfigMap Kubernetes object, and for AMF and SMF, they also have a Service resource<ul> <li>Determines resource needs based on capacity input</li> <li>Builds these K8s objects with XXXDeployment CRs fields as input</li> </ul> </li> <li>Manages dependencies<ul> <li>Ensures that the corresponding NADs exist in namespace</li> <li>Creates ConfigMap before applying Deployment</li> </ul> </li> <li>Associates objects with CR</li> <li>Updates status for XXXDeployment</li> <li>Ensures ConfigMap updates will lead to Deployment update</li> </ol>"},{"location":"blog/20231122/20231122/#environment-setup","title":"Environment Setup","text":"<p>Before cloning and launching a free5gc-operator, you need to setup an environment which matches the official demonstration. The official recommendation includes two installation methods: </p> <ul> <li>through the Google Compute Engine (GCE) to set up the environment with an account of Google Cloud Platform, </li> <li>directly preparing a Pre-Provisioned VM to set up the environment required for free5gc-operator.</li> </ul> <p>Warning</p> <p>Due to the mandatory hardware resource requirements set by the official guidelines, which include an 8-core CPU, 16 GB of memory, 200 GB disk, the resources needed are quite &gt;substantial. If you operate on the Google Cloud Native platform, you may incur significant charges on your credit card. Therefore, I recommend installing the environment on a virtual &gt;machine (VM) on your local machine for follow-on exercises.</p>"},{"location":"blog/20231122/20231122/#installation-on-pre-provisioned-vm","title":"Installation on Pre-Provisioned VM","text":"<p>After completing the Ubuntu 20.04 focal installation, you need to get a sudo passwordless permissions. Edit <code>/etc/sudoers</code>: <pre><code>$ sudo vim /etc/sudoers\n</code></pre></p> <p>Add 2 lines:</p> <pre><code>&lt;linux username&gt;   ALL=(ALL:ALL) NOPASSWD:ALL\nsudo    ALL=(ALL:ALL) NOPASSWD:ALL\n</code></pre>"},{"location":"blog/20231122/20231122/#kick-off-an-installation-on-vm","title":"Kick Off an Installation on VM:","text":"<p><pre><code>wget -O - https://raw.githubusercontent.com/nephio-project/test-infra/v1.0.1/e2e/provision/init.sh |  \\\nsudo NEPHIO_DEBUG=false   \\\n     NEPHIO_BRANCH=v1.0.1 \\\n     NEPHIO_USER=&lt;linux username&gt;   \\\n     bash\n</code></pre> The next step is to wait for Ansible to automatically set up the environment. The entire process may take approximately 10 minutes, so please be patient. Once it is completed, ssh in and port forward the port to the UI (7007) and to Gitea's HTTP interface, if desired (3000):</p> <p><pre><code>ssh &lt;user&gt;@&lt;vm-address&gt; \\\n                -L 7007:localhost:7007 \\\n                -L 3000:172.18.0.200:3000 \\\n                kubectl port-forward --namespace=nephio-webui svc/nephio-webui 7007\n</code></pre> You can now navigate to:</p> <ul> <li> <p>http://localhost:7007/config-as-data to browse the Nephio Web UI </p> </li> <li> <p>http://localhost:3000/nephio to browse the Gitea UI </p> </li> </ul>"},{"location":"blog/20231122/20231122/#free5gc-amfsmfupf-deployments-prerequisite-automatically-done-in-environment-setup","title":"free5GC AMF/SMF/UPF Deployment's Prerequisite (automatically done in environment setup)","text":"<ol> <li>Install multus</li> <li>Install CNI binary (macvlan) on all hosts that can possibly run free5gc AMF, SMF, or UPF</li> <li>Install gtp5g on nodes that could run UPF</li> <li>Install sctp on nodes that could run AMF</li> <li>Connectivity:     a. IP address allocation and reachability</li> <li>Network Attachment Definitions (NADs) for all the secondary interfaces</li> <li>3GPP related configs (PLMN, S-NSSAI info)</li> <li>free5gc SMF config requires connected UPF information</li> <li>Client (such as UERANSIM) set up with corresponding IP addresses and 3GPP info</li> </ol>"},{"location":"blog/20231122/20231122/#quick-start-exercises","title":"Quick Start Exercises","text":"<p>You can follow the tutorial steps in this page. I won't show all detail in this article. I only list the action of all steps:</p> <ul> <li>Step 1: Create the Regional cluster</li> <li>Step 2: Check the Regional cluster installation</li> <li>Step 3: Deploy two Edge clusters</li> <li>Step 4: Deploy Free5GC Control Plane Functions</li> <li>Step 5: Deploy Free5GC Operator in the Workload clusters</li> <li>Step 6: Check Free5GC Operator Deployment</li> <li>Step 7: Deploy the AMF, SMF and UPF NFs</li> <li>Step 8: Deploy UERANSIM</li> <li>Step 9: Change the Capacities of the UPF and SMF NFs</li> </ul>"},{"location":"blog/20231122/20231122/#reference","title":"Reference","text":"<ul> <li>https://nephio.org/</li> <li>https://nephio.org/about/</li> <li>https://github.com/nephio-project/docs/blob/main/install-guide/README.md#demonstration-environment-installation</li> <li>https://github.com/nephio-project/docs/blob/main/user-guide/exercises.md</li> <li>https://pkg.go.dev/github.com/GoogleContainerTools/kpt#section-readme</li> </ul>"},{"location":"blog/20231122/20231122/#about","title":"About","text":"<p>Hello everyone, I'm Brian Chen (\u9673\u715c\u76db). Currently, I am pursuing a master's degree and have been interning at Saviah for 10 months. My current role involves maintaining free5GC and reviewing issues and PR. Additionally, I am researching Kubernetes with the aim of improving the efficiency of deployment experiences for free5GC. There is still a lot of knowledge for me to acquire, so please feel free to contact me if you have any questions or would like to discuss anything.</p> <ul> <li>My GitHub</li> <li>LinkedIn</li> </ul> <p>Note</p> <p>If you are interested in supporting free5GC, we welcome your donation. Please visit this link for more details.</p>"},{"location":"blog/20231129/20231129/","title":"Basic concept of RCU: Read, Copy, Update","text":"<p>Note</p> <p>Author: Lin Poyi Date: 2023/11/29</p>"},{"location":"blog/20231129/20231129/#what-is-rcu","title":"What is RCU","text":"<p>RCU is a lock-free synchronization mechanism in Linux kernel, and we use it in gtp5g. RCU is a way of making changes to data structures that are mostly read by many threads but rarely updated by a few threads. RCU stands for \u201cRead, Copy, Update\u201d, which means that the updater thread first makes a copy of the data item, modifies the copy, and then replaces the original with the copy. It works very well and has great scalability under read-heavy use cases. Compared with Reader-Writer lock (RWlock) and other lock-based approaches, RCU is a lot faster but does not provide strong consistency over data.</p> <p>In RCU, there's nothing blocking readers from entering the critical section. The reader can access the protected data at all times. Also, the updater can modify the data whenever it wants (assume only 1 updater) no matter if there are still readers using the data.</p>"},{"location":"blog/20231129/20231129/#drawbacks-of-reader-writer-lock-rwlock","title":"Drawbacks of Reader-Writer lock (RWlock)","text":"<ol> <li>It is expensive and complex to implement, especially for fine-grained locking of individual data items.</li> <li>It can cause contention and scalability issues, especially when the number of readers is large or the lock is held for a long time.</li> <li>It can introduce deadlocks and livelocks, especially when the locking order is not well-defined or the lock is nested or reentrant.</li> </ol>"},{"location":"blog/20231129/20231129/#benefits-of-rcu","title":"benefits of RCU","text":"<ol> <li>It is faster and more scalable for read-intensive workloads because the readers do not need to wait for the updaters or contend for shared resources.</li> <li>It is simpler and more reliable for avoiding deadlocks because the readers do not need to acquire any locks or follow any ordering rules.</li> <li>It is more flexible and adaptable for different scenarios because there are many variants of RCU that can handle different types of updates and readers.</li> </ol>"},{"location":"blog/20231129/20231129/#how-to-use-rcu","title":"How to use RCU","text":"<p>While using RCU, there are some rules to be followed: 1. You need to mark the sections of code where you access the RCU-protected data structures as \u201cRCU read-side critical sections\u201d, using the appropriate RCU primitives, such as rcu_read_lock() and rcu_read_unlock(). 2. You need to mark the sections of code where you modify the RCU-protected data structures as \u201cRCU update-side critical sections\u201d, using the appropriate RCU primitives, such as call_rcu() and synchronize_rcu(). 3. You need to ensure that the RCU read-side critical sections are short and do not block, switch to user mode, or enter the idle loop unless you use a special variant of RCU that allows blocking, such as SRCU or preemptible RCU. 4. You need to ensure that the RCU update-side critical sections wait for a \u201cgrace period\u201d to elapse before freeing or reusing the old versions of the data items and that the grace period is long enough that all the readers have finished accessing the old versions.</p> <p>Note</p> <p>Grace period is the time between the data being changed by the updater and the time when all readers are using the new data. During the grace period, some readers may be using the old data, some may be using the new data.  </p>"},{"location":"blog/20231129/20231129/#main-rcu-apis","title":"main RCU APIs","text":"<ol> <li>rcu_read_lock(): Inform others the reader is entering the critical section, does not actually block anyone from entering the critical section.</li> <li>rcu_read_unlock(): Inform others the reader has exit critical section.</li> <li>rcu_assign_pointer(): Using this API instead of directly assign pointer with \"=\" can avoid pointer been assigned before the update_data() been done due to CPU's out-of-order execution.</li> <li>syncronize_rcu(): Wait for readers who are already in the critical section and haven't left yet. Used after updating the data and before the old data has been released.</li> <li>call_rcu(): this function is the asyncronized version of syncronize_rcu(), it will return right after it scedules a handler (clean up the old data) to be performed after all previous readers left C.S.(critical section) We use this instead of the syncronized version in gtp5g. </li> </ol>"},{"location":"blog/20231129/20231129/#pseudo-code-for-reader-and-updater","title":"pseudo code for reader and updater","text":"<p><pre><code>void Reader(){\n    rcu_read_lock();    //enter C.S. (critical section)\n    item *data = Item_A;\n    access_data(data);\n    rcu_read_unlock();  //leave C.S.\n    return;\n}\n</code></pre> <pre><code>void Updater(){\n    item *old_data = Item_A;  //save the old location\n    item *new_data = new(item);    //make a new item\n    update_data(new_data);   //modify the data in new item\n    rcu_assign_pointer(Item_A, new_data);   //now the global pointer points to the new item\n    syncronize_rcu();   //wait for all readers using old_data to leave C.S.\n    kfree(old_data);  //now we can safely release the old_data\n    return;\n}\n</code></pre> </p>"},{"location":"blog/20231129/20231129/#another-version-of-updater-with-call_rcu","title":"another version of Updater with call_rcu()","text":"<p><pre><code>void item_free(item *data){\n    kfree(data);\n    return;\n}\nvoid Updater(){\n    item *old_data = Item_A;  //save the old location\n    item *new_data = new(item);    //make a new item\n    update_data(new_data);   //modify the data in new item\n    rcu_assign_pointer(Item_A, new_data);   //now the global pointer points to the new item\n    call_rcu(old_data, item_free);   //schedule item_free(old_data) to be performed after all previous readers left C.S. and return immediately\n    return;\n}\n</code></pre> </p> <p>When the updater tries to update the data, the data doesn't get replaced instantly. The pointer will point to new data, but the old data still exists in the memory. This method prevents readers who are still accessing the old data from accessing the released memory and also allows updates before all readers leave the critical section.</p>"},{"location":"blog/20231129/20231129/#comparison-between-rcu-and-rwlock","title":"Comparison between RCU and RWlock","text":"<p>scalability of RWlock and RCU </p> <p>The graph above shows that RCU not only has better scalability with CPUs but also has better overall performance, which is not surprising when we look at the CPU utilization difference between RWlock and RCU in the graph shown below. But keep in mind that RCU does not guarantee that all readers running simultaneously have the same version of data, but RWlock does. Also if there's more than one updater, you might need some locks to prevent multiple updates been performed at the same time.</p> <p>What it might look like in the CPUs while running these two methods </p>"},{"location":"blog/20231129/20231129/#reference","title":"Reference","text":"<p>https://www.kernel.org/doc/html/next/RCU/whatisRCU.html</p> <p>https://hackmd.io/@cccccs100203/So-What-Has-RCU-Done-Lately</p> <p>Linux kernel design: RCU synchronization mechanism</p> <p>So What Has RCU Done Lately?</p> <p>Note</p> <p>If you are interested in supporting free5GC, we welcome your donation. Please visit this link for more details.</p>"},{"location":"blog/20231206/20231206/","title":"Introduction of IP Multimedia Subsystem Part 2","text":"<p>Note</p> <p>Author: TzuChieh Huang Date: 2023/12/06</p> <p>In the rapidly evolving landscape of telecommunications, the IP Multimedia Subsystem (IMS) stands as a linchpin for delivering advanced multimedia and voice services over IP networks. As explored in the preceding introduction (IMS Part 1), IMS serves as a standardized and open architectural framework defined by the 3rd Generation Partnership Project (3GPP). Its role in facilitating seamless communication services, including voice, video, messaging, and data, highlights its pivotal position in modern network infrastructures. Building upon the foundational knowledge established in IMS Part 1, this section will delve into the IMS registration.</p>"},{"location":"blog/20231206/20231206/#interaction-and-flow-of-registration","title":"Interaction and flow of Registration","text":""},{"location":"blog/20231206/20231206/#procedures-related-to-proxy-cscf-discovery","title":"Procedures related to Proxy-CSCF discovery","text":"<p>P-CSCF(Proxy-Call Session Control Function) is the initial point of contact for UE when establishing communication sessions. Therefore, P-CSCF discovery is a crucial step in IMS architecture. It involves the process of determining the network address of P-CSCF that the UE(User Equipment) should contact during the initiation of the communication session. </p> <p>The Proxy-CSCF discovery shall be performed using the following mechanisms:</p> <ul> <li>During the establishment of connectivity to the IP-Connectivity Access Network, provided that the IP-Connectivity Access Network supports such procedures.</li> <li>Alternatively, the P-CSCF discovery may take place after the IP connectivity has been established. To enable P-CSCF discovery after the establishment of IP connectivity, the IP-Connectivity Access Network shall provide the following P-CSCF discovery option to the UE:<ul> <li>Utilizing DHCP to furnish the UE with the domain name and/or IP address of a Proxy-CSCF, along with the address of a Domain Name Server (DNS) capable of resolving the Proxy-CSCF name</li> <li>The UE may be configured (e.g., during initial provisioning or via a 3GPP IMS Management Object (MO), or in the ISIM) to be aware of the fully qualified domain name (FQDN) of the P-CSCF or its IP address. If the domain name is known, DNS resolution is employed to obtain the IP address.</li> </ul> </li> </ul>"},{"location":"blog/20231206/20231206/#dhcpdns-procedure-for-p-cscf-discovery","title":"DHCP/DNS procedure for P-CSCF discovery","text":"<p>When DNS is employed to retrieve the IP address of the P-CSCF, the name-address resolution mechanism is permitted to take the load information of the P-CSCFs. This load information, obtained through network management procedures, is factored in when determining the address of the P-CSCF for the UE.</p> <p></p> <ol> <li> <p>Initiate the establishment of an IP-Connectivity Access Network bearer, utilizing the procedures available in the IP-Connectivity Access Network, if it is not already in place.</p> </li> <li> <p>The UE initiates a request to a DHCP server, seeking the domain name and/or IP address of the P-CSCF, along with the IP addresses of DNS servers. This may involve multiple DHCP Query/Response message exchanges to obtain the necessary information.</p> </li> <li> <p>The UE conducts a DNS query to retrieve a list of IP addresses for the P-CSCF(s), from which one is selected. If the response lacks IP addresses, an additional DNS query becomes necessary to resolve a FQDN to an IP address.</p> <ul> <li>If the UE is aware of multiple P-CSCF addresses, the selection process is determined based on the home operator's configured policy for P-CSCF selection. The policy dictates the criteria or rules according to which one P-CSCF address is chosen over others in such scenarios.</li> <li>Depending on the policy set by the home operator, the UE chooses the Home Proxy-CSCF by using a preconfigured Home P-CSCF FQDN. This selection can be made without P-CSCF discovery procedure.</li> </ul> </li> </ol>"},{"location":"blog/20231206/20231206/#assigning-a-serving-cscf-for-a-user","title":"Assigning a Serving-CSCF for a user","text":"<p>When an UE attaches itself and becomes available for access to IMS services through explicit registration within the IMS, a S-CSCF (Serving-Call Session Control Function)shall be assigned to serve the UE. The S-CSCF plays a central role in call control and service execution for the registered UE within the IMS network.</p> <p>The assignment of a S-CSCF is carried out within the I-CSCF (Interrogating-Call Session Control Function). The selection of the S-CSCF requires the following information:</p> <ol> <li> <p>Required capabilities for user services: </p> <ul> <li>Provided by the HSS (Home Subscriber Server), this information outlines the necessary capabilities for the user's services.</li> </ul> </li> <li> <p>Operator preference on a per-user basis: </p> <ul> <li>Also provided by the HSS, this information reflects the operator's preferences specific to each user.</li> </ul> </li> <li> <p>Capabilities of individual S-CSCFs in the home network: </p> <ul> <li>This internal information within the operator's network, pertaining to the capabilities of individual S-CSCFs, may influence the S-CSCF selection.</li> </ul> </li> <li> <p>Topological (i.e. P-CSCF) information of where the user is located</p> <ul> <li>This internal information within the operator's network, concerning the topological details of the user's location, may be utilized in the S-CSCF selection process. The P-CSCF name is received in the registration request.</li> </ul> </li> <li> <p>Topological information of where the S-CSCF is located</p> <ul> <li>Another internal aspect within the operator's network, this information regarding the topological details of the S-CSCF's location may play a role in S-CSCF selection. </li> </ul> </li> <li> <p>Availability of S-CSCFs</p> <ul> <li>Internal to the operator's network, information about the availability of S-CSCFs may be considered in the S-CSCF selection process.</li> </ul> </li> </ol>"},{"location":"blog/20231206/20231206/#registration-flow","title":"Registration Flow:","text":"<ol> <li> <p>UE to P-CSCF:</p> <ul> <li>After establishing IP connectivity, the UE, such as a mobile device, initiates IM registration by sending a SIP (Session Initiation Protocol) REGISTER request to the P-CSCF. This flow includes essential details such as the Public User Identity, Private User Identity, home network domain name, UE IP address, Instance Identifier, and GRUU (Globally Routable User Agent URI) Support Indication.</li> <li>Upon receiving the Register information flow, the P-CSCF examines the \"home domain name\" to identify the entry point to the home network, which is the I-CSCF. </li> </ul> </li> <li> <p>P-CSCF to I-CSCF:</p> <ul> <li>The P-CSCF forwards the Register information flow to the I-CSCF, including details such as the P-CSCF address/name, Public User Identity, Private User Identity, P-CSCF network identifier, and UE IP address. </li> </ul> </li> <li> <p>I-CSCF to HSS:</p> <ul> <li>The I-CSCF initiates the Cx-Query/Cx-Select-Pull information flow, sending relevant information to the HSS to perform user authentication and retrieve the user's location information. This flow includes the Public User Identity, Private User Identity, and P-CSCF network identifier.<ul> <li>The HSS verifies if the user is already registered and assesses whether the user is permitted to register in the specified P-CSCF network based on user subscription and operator limitations/restrictions.</li> </ul> </li> <li>Upon receiving Cx-Query Resp/Cx-Select-Pull Resp from the HSS, which includes the S-CSCF name or capabilities, the I-CSCF constructs a name from the capabilities, if necessary. The registration attempt is rejected if the HSS checking is unsuccessful.</li> </ul> </li> <li> <p>I-CSCF to S-CSCF:</p> <ul> <li> <p>The I-CSCF, using the S-CSCF name, determines the address of the S-CSCF through a name-address resolution mechanism. The load information of the S-CSCFs is considered in the resolution process. The I-CSCF also identifies the name of a suitable home network contact point, potentially based on information received from the HSS. The I-CSCF then sends the register information flow (P-CSCF address/name, Public User Identity, Private User Identity, P-CSCF network identifier, UE IP address) to the selected S-CSCF.</p> </li> <li> <p>The S-CSCF rejects the registration if the number of registered contact addresses for a Public User Identity exceeds the configured limit. The S-CSCF stores the P-CSCF address/name supplied by the visited network, representing the address/name that the home network uses to forward subsequent terminating session signaling to the UE. The S-CSCF stores the P-CSCF Network ID information.</p> </li> </ul> </li> <li> <p>S-CSCF to HSS:</p> <ul> <li>The S-CSCF communicates with the HSS to retrieve user profiles and perform tasks like registration and authentication.<ul> <li>The S-CSCF sends Cx-Put/Cx-Pull (Public User Identity, Private User Identity, S-CSCF name) to the HSS.</li> <li>The HSS stores the S-CSCF name for the user and returns the information flow Cx-Put Resp/Cx-Pull Resp (user information) to the S-CSCF. The user information includes one or more names/addresses that can be used to access the platforms used for service control while the user is registered. Security information may also be sent for use within the S-CSCF.</li> </ul> </li> </ul> </li> <li> <p>S-CSCF to AS (Application Server):</p> <ul> <li>The S-CSCF may interact with Application Servers for additional services.</li> </ul> </li> <li> <p>S-CSCF to TAS (Telephony Application Server):</p> <ul> <li>The S-CSCF interfaces with the TAS for services related to MMTel (MultiMedia Telephony) supplementary services.</li> </ul> </li> <li> <p>S-CSCF to MGCF (Media Gateway Control Function):</p> <ul> <li>The S-CSCF may communicate with the MGCF for signaling purposes.</li> </ul> </li> </ol>"},{"location":"blog/20231206/20231206/#conclusion","title":"Conclusion","text":"<p>IMS registration is a fundamental process in the IMS that establishes connectivity for UE to access advanced multimedia and voice services over IP networks. The IMS operates as a standardized and open architectural framework defined by the 3GPP. Through standardized protocols, IMS ensures secure and seamless communication services, making it a crucial framework in modern telecommunications.</p>"},{"location":"blog/20231206/20231206/#reference","title":"Reference","text":"<p>3GPP TS 22.228: \"Service requirements for the Internet Protocol (IP) multimedia core network subsystem (IMS) - Stage 1\"</p> <p>3GPP TS 23.218: \"IP Multimedia (IM) session handling; IM call model; Stage 2\"</p> <p>3GPP TS 23.228: \"IP Multimedia Subsystem (IMS) - Stage 2\"</p> <p>3GPP TS 29.228: \"IP Multimedia (IM) Subsystem Cx and Dx Interfaces; Signalling flows and message contents\"</p>"},{"location":"blog/20231206/20231206/#about","title":"About","text":"<p>Hello, I am TzuChieh Huang. My ongoing research focuses on VoNR (Voice over New Radio). Feel free to reach out and share any inquiries or point out errors in the article. I welcome corrections and value your feedback. Please don't hesitate to contact me via email to contribute your insights.</p> <p>Note</p> <p>If you are interested in supporting free5GC, we welcome your donation. Please visit this link for more details.</p>"},{"location":"blog/20231213/20231213/","title":"Article Sharing: Evaluating Dedicated Slices of Different Configurations in 5G Core","text":"<p>Note</p> <p>Author:Leon Sawada(\u6fa4\u7530\u535a\u4e45) Date: 2023/12/13</p>"},{"location":"blog/20231213/20231213/#overview","title":"Overview","text":"<p>Network slicing is a new concept born after the emergence of 5G. Network slicing and edge computing (Multi-access Edge) are both key technologies in 5G networks. Network slicing uses virtualization technology to cut the network into multiple virtual end-to-end networks, and the equipment, access, transmission, and core network between each virtual network are all independent. Dynamic demand, resource adjustment, and improved network flexibility can also reduce the construction cost of hardware resources and network construction time, and achieve hardware resource sharing. Since one of the characteristics of network slicing is its flexibility, this article verifies this very well. In this article, the author uses free5GC, ETSI NFV MANO framework, and other tools, and designs three different slices to show how different configurations of dedicated slices will affect the performance of the 5G core. Finally, discussed which slice should be used in different situations to provide the best service to users.</p>"},{"location":"blog/20231213/20231213/#nfv-mano","title":"NFV MANO","text":"<p>The management and scheduling of the core network mainly uses NFV MANO (Management and Orchestration) technology, which is an architecture proposed by the European Telecom Standards Institute (ETSI) and later adopted by 3GPP to manage 5G core network virtualization. Network function (Virtual Network Function, VNF) specification, NFV MANO allows the core network to adopt a fully virtualized VNF design and better schedule various network slicing functions. MANO of the 5G core network has the ability to manage and schedule VNFs belonging to different slices for different slice services. As shown in the figure, NFV MANO can manage and schedule VNFs of the 5G core network such as AMF, NSSF, NRF, AUSF, and PCF, SMF, UDM, UPF, etc. This will also be paired with the core network in free5GC that we will only use. As you can see: NFV Orchestrator (NFVO), VNF Management (VNFM), and Virtualized Infrastructure Managers (VIM) are three major components in the MANO architecture framework.</p> <p>*NFV Orchestrator: Responsible for supporting new network services (NS) suites and virtual network functions (VNF). Nuclear submarine life cycle management. Global resource management. Review and approve requests for Network Functions Virtualization Infrastructure (NFVI) resources.</p> <p>*VNF Manager: Controls the life cycle management of VNF instances. Performs the function of coordinating and coordinating configuration and event reporting between the NFV infrastructure (NFVI) and network element/network management systems.</p> <p>*Virtualization Infrastructure Manager (VIM): Monitors and manages NFVI compute, storage, and network resources.</p> <p> Figure 1. NFV MANO architecture</p> <p>According to the definition of 3GPP, network slices are composed of multiple network slice sub-networks such as core network, access network, and transport network. NFV MANO plays an important role in mapping each network slice network to network services.</p>"},{"location":"blog/20231213/20231213/#free5gc","title":"free5GC","text":"<p>free5GC is an open-source project for fifth-generation (5G) mobile networks. The ultimate goal of this project is to implement the 5G Core Network (5GC) defined in 3GPP Release 15 (R15) and later.</p> <p>As shown in the figure, NYCU free5GC provides all the functions of a 5G network and is divided into the control plane and the user plane. The control plan includes NSSF, NRF, UDM, PCF, NEF, AUSF, AMF, SMF, UDR, and AF. In the user plane, there is only one network function called UPF. The separation of the user plane and the control plane allows each aircraft to be deployed and evolved independently. NYCU free5GC has also modulated its functional design to make the deployment of network functions in an NFV environment more flexible and efficient.</p> <p> Figure 2. free5GC architecture</p> <p>In addition to free5GC, use MANO open source including OpenStack and Tacker. OpenStack is an open-source cloud operating system that virtualizes resources such as storage, computing, and networking. Most of these virtualized resources are deployed in the cloud as Infrastructure-as-a-service (IaaS). OpenStack provides a web-based interface dashboard. This dashboard allows us to efficiently configure, manage and monitor our virtualization resources. Tacker is an OpenStack project that provides NFVO and VNFM functionality to configure, deploy, manage, and schedule NS and VNFs on NFV infrastructure platforms such as OpenStack. The Tacker API can be used not only by NFV Orchestrator but also by OSS/BSS to deploy VNFs.</p>"},{"location":"blog/20231213/20231213/#three-different-types-of-slice","title":"Three different types of slice","text":""},{"location":"blog/20231213/20231213/#free5gc-stage-3-with-upf-dedicated-slices","title":"free5GC Stage 3 with UPF Dedicated Slices","text":"<p>The image below shows the architecture of free5GC Stage 3, each dedicated slice consisting of only UPF. It uses three dedicated slices to handle three different types of test traffic. Each dedicated slice is connected to a specific data network (DN) server. These UPFs in different dedicated slices share the same SMF in the common slice.</p> <p> Figure 3. free5GC with different configurations of dedicated slices</p> <p>Three traffic generators are provided to simulate the packets that will be sent to the 5GC by the 5G UEs and RAN. Each traffic generator will transmit two types of packets: UDP and ICMP (Internet Control Message Protocol). Each traffic generator Each traffic generator sends UDP packets at different rates: high, medium, and low. All traffic generators send both UDP packets and ICMP packets. This can estimate the throughput of UDP traffic and calculate the response time of ICMP packets. Each network cutter routes packets to a different data network (DN) server. (DN) servers so that can verify successful transmission through the selected UPF.</p> <p>Firstly, the UE will be connected to the RAN within the traffic generator. Secondly, the traffic generator transmits the NGAP Initial UE message to the AMF. This message carries the registration request and the UE information (including UE address IP, SST (Slice/Service Type), and SD (Slice Differentiator)). Thirdly, AMF requests UE authentication from AUSF. If the UE is a valid user, the AUSF accepts the request and transmits the response to the AMF. After that, the AMF transmits the UE information to the NSSF, which then provides a list of available SMFs to the AMF based on the information received. Next, AMF will select a suitable SMF for UE and create a smContext for SMF to establish a new session. Finally, the SMF will select a suitable UPF and establish a PDU (Protocol Data Unit) session between the UE and the selected UPF.</p> <p> Figure 4. Registration workflow of free5GC Stage 3</p> <p>After the registration is complete, the UE can start transmitting packets to its DN server. The transmission workflow is shown in the following figure. First, the UE sends UDP packets and ICMP packets to the UPF through its PDU session. Second, the UPF will forward these packets to a specific DN. Third, the DN will calculate the throughput of the UDP packets received from the UPF. Fourth, when the DN receives an ICMP packet, it will send the ICMP response back to the UPF. Finally, the UPF will forward this ICMP response to the UE; this will allow the UE to calculate the ICMP response time.</p> <p> Figure 5. Transmission workflow</p>"},{"location":"blog/20231213/20231213/#free5gc-stage-3-with-smfupf-dedicated-slices","title":"free5GC Stage 3 with SMF/UPF Dedicated Slices","text":"<p>The architecture of this slice is similar to the previous one, as shown in part b of the figure. Each dedicated slice is composed of SMF and UPF It also uses three dedicated slices to handle different data rate requirements, each connected to a specific DN server. All VNFs use the same resources as the previous VNF. Unlike the previous one, we move the SMF from the common slice to the dedicated slice. Each UPF connects to an SMF in the same dedicated slice and both need to share resources. The traffic generators and DN servers are the same as those used in the previous architecture. The registration workflow is also similar to Fig. 4; the only difference is that in the last step, the SMFs do not need to select the UPFs because the UPFs have already been assigned to each SMF. The SMFs only need to set up PDU sessions between the UEs and the UPFs. After the registration is completed, the transmission workflow is also the same as the previous architecture, as shown in the above figure.</p> <p> Figure 3.free5GC with different configurations of dedicated slices</p>"},{"location":"blog/20231213/20231213/#free5gc-stage-2-with-upf-dedicated-slice","title":"free5GC Stage 2 with UPF Dedicated Slice","text":"<p>The architecture of this slice, with each dedicated shard consisting only of UPFs, is the same as that shown in Figure 3 part(a). The only difference is that the VNF version in this architecture is free5GC Stage 2. VNFs in Stage 2 are less optimized than in Stage 3 The traffic generator and DN server are also the same as in free5GC Stage 3. However, the registration workflow is very different from Stage 3. This is because, in free5GC Stage 2, the NSSF is not utilized to select a dedicated and exclusive slice to serve the requesting UE. It is assumed that the UE will deliver the traffic directly to the allocated slice as shown in Fig. 6. First, the UE will connect to the RAN within the traffic generator. Second, the traffic generator will send a registration request and assign the UPF. Third, the AMF requests the UE authentication from the AUSF. If the UE is a valid user, the AUSF accepts the request and transmits the response to the AMF. Next, the AMF transmits the UE message to the SMF. Finally, the SMF locates the UPF specified by the UE and establishes a PDU session between the UE and the UPF. The transmission workflow in Stage 2 is the same as that in Stage 3, as shown in Fig. 5.</p> <p> Figure 6. Registration workflow of free5GC Stage 2</p>"},{"location":"blog/20231213/20231213/#experiment","title":"Experiment","text":"<p>There are two sumptions: 1st, all the dedicated slices are allocated with the same amount of resources, i.e., to use the same number of vCPU and the same amount of memory and storage. 2nd, all three systems under evaluation are allocated the same amount of resources. We use two identical rack servers, one for OpenStack and one for Tacker. Follow the ETSI MANO framework to build this slicing environment.</p> <p>For the first assumption, the specification of VNFs is divided into two parts:  common slice and dedicated slice. For the common slice, the specifications of all VNFs in the common slice are the same for different systems. As shown in Table 2. For the dedicated slices, we show the VNFs with different specifications in Table 3. Three traffic generators and three DN servers are configured with 2 vCPUs, 1 GB RAM, and 10 GB disks, and mirrored with Ubuntu 18.04.</p> <p> Table 1. Specification of implementation environment</p> <p> Table 2. Specification of VNF in a common slice for the first assumption</p> <p> Table 3. Specification of VNF in the dedicated slice for the first assumption</p> <p>For the second assumption, the specification of VNFs is also divided into two parts: common slices and dedicated slices. For common slices, the resource specifications of VNFs other than SMFs are the same as in Table 2. On the other hand, the resource specifications of SMFs in different configurations are shown in Table 4. Correspondingly, the resource specifications of UPFs in different configurations are shown in Table 5.</p> <p> Table 4. Specification of SMF for second assumption</p> <p> Table 5. Specification of UPF for second assumption</p>"},{"location":"blog/20231213/20231213/#result-and-conclusion","title":"Result and conclusion","text":"<p>Figures 7 and 8 show the average throughput results for three different systems at three UDP packet data rates: low (80 Mbps), medium (200 Mbps), and high (400 Mbps).</p> <p> Figure 7. Average throughput under the first assumption</p> <p> Figure 8. Average throughput under the second assumption</p> <p>Based on the graph, we can see that under the first assumption, free5GC Stage 3 with UPF-specific cuts provides higher throughput than free5GC Stage 3 with SMF/UPF-specific cuts because the former has more vCPU resources than the latter. Compared with free5GC Stage 2, the free5GC Stage 3 system is more optimized.</p> <p>Figures 9 and 10 show the average response time of the three different systems under the two assumptions. As the design of our proposed system is more complicated than that of the comparator system, the average response time becomes more modest. Under the second assumption, both systems have similar response times. However, under the first assumption, the response time of free5GC Stage 3 with UPF-specific slice is shorter because UPF has more vCPU resources.</p> <p> Figure 9. Average response time under the first assumption</p> <p> Figure 10. Average response time under the second assumption</p> <p>Figures 11 and 12 show the average CPU utilization of the two free5GC Stage 3 systems at the three data rates. Under the second assumption, there is no difference in CPU usage between the two free5GC Stage 3 systems. However, under the first assumption, the CPU usage rate is almost the same even if the number of vCPUs used in the UPF is different. However, in both assumptions, if we send more packets from the traffic generator, the CPU usage rate will be higher. This is because CPU usage depends only on the number of packets transmitted. On the other hand, the CPU usage of free5GC Stage 3 with the UPF dedicated cutter is slightly higher than that of free5GC Stage 3 with the SMF/UPF dedicated cutter, because the use of more vCPU resources results in more competitive conditions among CPUs.</p> <p> Figure 11. Average response time under the second assumption</p> <p> Figure 12. Average CPU utilization under the first assumption</p> <p>Figures 13 and Figures 14 show the average registration time in our proposed system. In free5GC Stage 3 with SMF/UPF dedicated slices, SMF does not require the choice of UPF, and thus the registration time is lower under both assumptions. Even though we provide more powerful SMF and UPF dedicated slices in free5GC Stage 3 under the second assumption, the registration process still takes longer. This is because SMF takes extra time to select UPF.</p> <p> Figure 13. Average registration time under the first assumption</p> <p> Figure 14. Average registration time under the second assumption</p> <p>Based on these results lead to the following conclusions: Under the first assumption, moving the SMF from the common slice to the dedicated slice will shorten the registration time, but it will deteriorate the performance of the UPF because fewer resources are allocated to the UPF than before. However, under the second assumption, only the registration time is affected; the performance of the UPF is not affected. This is because the functions in the control plane are no longer involved in the operation when the transfer starts. Therefore, if a large number of connections are required in a short period, moving the SMF from the common slice to the dedicated slice will be a better choice because the registration time of the system is shorter; it can handle a large number of registrations more efficiently. In addition, if users want to get better throughput and shorter response time under the first assumption, it is recommended to keep the SMF in the common slice so that more resources can be allocated to the UPF for better performance. Therefore we know we need to use different network slices based on different scenarios, which is the best proof of the convenience of network slicing.</p> <p>Network slicing is a crucial concept in 5G networks, allowing virtual network functions to form interconnected network services, with dedicated slices being evaluated to determine the best-performing configuration based on various factors. Fuchun Joseph Lin and Yu-Herng Chai described evaluating dedicated slices of different configurations in the 5G core. The text discusses the creation of a common slice and three dedicated slices in a network architecture. The performance of these systems is evaluated based on throughput, response time, CPU utilization, and registration time. The deployment of dedicated slices is experimented with using open-source projects. Moving the SMF from the common slice to the dedicated slice is recommended for handling a large number of connections efficiently. Different resource allocations to dedicated slices are also considered. The performance of the three systems is compared based on registration time, response time, throughput, resource cost, and CPU utilization. The testbed is built using the ETSI NFV MANO framework, free5GC, OpenStack, and Tacker. The goal is to evaluate the performance of different configurations of 5G core dedicated slices. The response time of free5GC Stage 3 with UPF dedicated slice is shorter under the first assumption, while a more powerful SMF in free5GC Stage 3 still takes longer during registration under the second assumption.</p>"},{"location":"blog/20231213/20231213/#about","title":"About","text":"<p>Leon Sawada</p> <p>NYCU CS Graduate student, today I introduce an article written by my professor Fuchun Joseph Lin. I hope this article could help you understand more about the attributes of different network slices.</p>"},{"location":"blog/20231213/20231213/#reference","title":"Reference","text":"<p>What Is NFV MANO -SDxCentral Studios</p> <p>free5GC Offical website</p> <p>Li, X., et al. (2017) Network Slicing for 5G: Challenges and Opportunities. IEEE Internet Computing, 21, 20-27</p> <p>V. K. Choyi, A. Abdel-Hamid, Y. Shah, S. Ferdi, and A. Brusilovsky, \"Network slice selection, assignment and routing within 5G Networks,\" 2016 IEEE Conference on Standards for Communications and Networking (CSCN), Berlin, Germany, 2016, pp. 1-7, doi: 10.1109/CSCN.2016.7784887.</p> <p>Liao, C.W., Lin, F.J. and Sato, Y. (2020) Evaluating NFV-enabled Network Slicing for 5G Core. 2020 21st Asia-Pacific Network Operations and Management Symposium (APNOMS), Daegu, Korea (South), 22-25 September 2020, 401-404. </p> <p>Chai, Y.-H. and Lin, F.J. (2021) Evaluating Dedicated Slices of Different Configurations in 5G Core. Journal of Computer and Communications, 9, 55-72</p> <p>Note</p> <p>If you are interested in supporting free5GC, we welcome your donation. Please visit this link for more details.</p>"},{"location":"blog/20240103/20240103/","title":"UE-initiated PLR Measurement Procedure in PMFP Procedure","text":"<p>Note</p> <p>Author: Samuel Lin Date: 2024/01/03</p>"},{"location":"blog/20240103/20240103/#introduction","title":"Introduction","text":"<p>Performance measurement function protocol (PMFP) procedures are performed between a performance measurement function (PMF) in a UE and a PMF in the UPF.</p> <p>The PMF can measure Round-Trip Time (RTT) and Packet Loss Rate (PLR) by exchanging information through PMFP messages to perform these calculations.</p> <p>In this document, we solely introduce the UE-initiated Packet Loss Rate (PLR) Measurement Procedure.</p> <p></p>"},{"location":"blog/20240103/20240103/#description","title":"Description","text":"<p>Counting start:</p> <ul> <li>[1-4] UE initiates measurement by sending a <code>PMFP PLR Count Request message</code> to the UPF. UE and UPF commence respective packet counting processes.</li> </ul> <p>Reporting and Potential Restart:</p> <ul> <li>[5, 6-2] UE sends a <code>PMFP PLR Report Request message</code> to request UPF's counted packets and may optionally request counting restart.</li> <li>[7-2, 8] UPF responds with a <code>PMFP PLR Report Response message</code> containing counted packets and potentially restarts counting if requested and accepted.</li> </ul> <p>PLR Calculation and Procedure Termination:</p> <ul> <li>[6-1, 7-1] Procedure terminates if restart is not requested or not accepted.</li> <li>[9] UE calculates the UL PLR (Uplink PLR) based on local and reported packet counts.</li> <li>[10-14] Counting can be restarted multiple times upon mutual agreement between UE and UPF, enabling continuous measurement.</li> </ul>"},{"location":"blog/20240103/20240103/#key-considerations","title":"Key Considerations","text":"<p>Message Transport: All PMFP messages are transported over the same QoS flow on the same access.</p> <p>PLR Calculation: UE derives the UL PLR using its own transmitted packet count and the UPF's reported received packet count.</p> <p>Compliance: The procedure adheres to 3GPP specifications for packet loss management.</p>"},{"location":"blog/20240103/20240103/#additional-notes","title":"Additional Notes","text":"<p>QoS Flow Selection: The specific QoS flow for message transmission is contingent upon the measurement type (default or non-default QoS rule).</p> <p>Continuous Measurement: The restart capability facilitates ongoing packet loss monitoring.</p>"},{"location":"blog/20240103/20240103/#conclusion","title":"Conclusion","text":"<p>This UE-initiated PLR measurement procedure provides a standardized and coordinated approach to assess UL packet loss within 5G networks. Its adherence to 3GPP specifications ensures interoperability and consistency across network implementations.</p> <p>Note</p> <p>The network-initiated PLR measurement procedure is to enable UPF to measure the PLR of DL traffic access to the UE through the MA PDU session. The process is the same as the UE-initiated PLR measurement, except that the objects are reversed.</p>"},{"location":"blog/20240103/20240103/#reference","title":"Reference","text":"<ul> <li>3GPP TS 24.193: 5G System; Access Traffic Steering, Switching and Splitting (ATSSS); Stage 3</li> <li>3GPP TS 23.501: System architecture for the 5G System (5GS)</li> </ul>"},{"location":"blog/20240103/20240103/#about","title":"About","text":"<p>Hello, I am Samuel Lin. I have just started making contributions to the free5GC core network. This post is my first blog, so if there are any inquiries or identification of errors within, we welcome discussion and correction. Your feedback is invaluable, so please don't hesitate to reach out via email to share your insights.</p>"},{"location":"blog/20240103/20240103/#connect-with-me","title":"Connect with Me","text":"<ul> <li>Linkedin: https://www.linkedin.com/in/pin-fan-lin-464201290/</li> <li>Github: https://github.com/pf-lin</li> </ul>"},{"location":"blog/20240103/20240103/#appendix","title":"Appendix","text":"<p>Additionally, I have provided the graph with the network-initiated PLR measurement procedure.</p> <p></p> <p>Note</p> <p>If you are interested in supporting free5GC, we welcome your donation. Please visit this link for more details.</p>"},{"location":"blog/20240110/20240110/","title":"PacketRusher: A new UE/gNB simulator and CP/UP load tester","text":"<p>Note</p> <p>Author: Michael Chien (newb1er) Date: 2024/1/10</p>"},{"location":"blog/20240110/20240110/#introduction","title":"Introduction","text":"<p>PacketRusher is an innovative open-source project developed by Hewlett Packard, drawing inspiration from my5G-RANTester and leveraging multiple libraries created by free5GC. Its primary objective is to establish automated and high-performance UE/RAN testing suites.</p> <p>In this blog, we will guide you through the setup process and some experiment results.</p>"},{"location":"blog/20240110/20240110/#quick-start","title":"Quick Start","text":""},{"location":"blog/20240110/20240110/#overview","title":"Overview","text":"<p>We are going to create two VMs here. We run free5GC core on one machine and run PacketRusher on the other.</p> <p>Here is the VM spec,</p> <ul> <li>Platform: VirtualBox</li> <li>OS: Ubuntu 20.04</li> <li>CPUs: 2</li> <li>RAM: 2048</li> </ul> <p>and the host spec,</p> <ul> <li>OS: Ubuntu 22.04</li> <li>CPU: Intel Core i5-12400</li> <li>RAM: 32GB</li> </ul>"},{"location":"blog/20240110/20240110/#free5gc-setup","title":"free5GC setup","text":"<p>You can follow the tutorials to install free5GC. Here, we will create a VM and run CP and UP on the same VM.</p>"},{"location":"blog/20240110/20240110/#packetrusher-setup","title":"PacketRusher Setup","text":"<p>They provides a very thorough installation guide on their wiki. Please follow the official instructions in case of any updates.</p> <p>We will lead you through installation that helps you get hand-on experice more quickly. First, create a new VM that runs Ubuntu 20.04. Then, follow the instruction below to install all the dependencies.</p> <pre><code>sudo apt install build-essential linux-headers-generic make git wget tar linux-modules-extra-$(uname -r)\n\nsudo rm -rf /usr/local/go\n# PacketRusher requires Go 1.20 or newer version, \n# we choose 1.21.3 as it's the latest patch version at the moment.\n# Kindly refer to the official Golang changelog should you \n# seek additional information on new features or bug fixes.\nwget https://go.dev/dl/go1.21.3.linux-amd64.tar.gz -O - | sudo tar -C /usr/local -zxvf -\necho \"export PATH=$PATH:/usr/local/go/bin\" &gt;&gt; $HOME/.profile\nsource $HOME/.profile\n</code></pre> <p>After that, we can now clone the repo and build the PacketRusher.</p> <pre><code>git clone https://github.com/HewlettPackard/PacketRusher\ncd PacketRusher\nPACKETRUSHER=$PWD\n\n# Install gtp5g kernel module\ncd $PACKETRUSHER/lib/gtp5g &amp;&amp; make clean &amp;&amp; make &amp;&amp; sudo make install\n\n# build PacketRusher binary\ncd $PACKETRUSHER &amp;&amp; go mod download &amp;&amp; go build cmd/packetrusher.go\n</code></pre>"},{"location":"blog/20240110/20240110/#packetrusher-gnbue-config","title":"PacketRusher gNB/UE config","text":"<p>All the configuration about gNodeB and UE is located in <code>$PACKETRUSHER/config/config.yml</code> file.</p> <p>Here is the example,</p> <pre><code>gnodeb:\n  controlif:\n    ip: \"192.168.56.11\"\n    port: 9487\n  dataif:\n    ip: \"192.168.56.11\"\n    port: 2152\n  plmnlist:\n    mcc: \"208\"\n    mnc: \"93\"\n    tac: \"000001\"\n    gnbid: \"000008\"\n  slicesupportlist:\n    sst: \"01\"\n    sd: \"010203\" # optional, can be removed if not used\n\nue:\n  msin: \"0000000003\"\n  key: \"8baf473f2f8fd09487cccbd7097c6862\"\n  opc: \"8e27b6af0e692e750f32667a3b14605d\"\n  amf: \"8000\"\n  sqn: \"000000000023\"\n  dnn: \"internet\"\n  routingindicator: \"0000\"\n  hplmn:\n    mcc: \"208\"\n    mnc: \"93\"\n  snssai:\n    sst: 01\n    sd: \"010203\" # optional, can be removed if not used\n  integrity:\n    nia0: false\n    nia1: false\n    nia2: true\n    nia3: false\n  ciphering:\n    nea0: true\n    nea1: false\n    nea2: true\n    nea3: false\namfif:\n  ip: \"192.168.56.10\"\n  port: 38412\nlogs:\n    level: 4\n</code></pre> <p>Feel free to customize the configuration to suit your preferences. Make sure it corresponds to your 5GC config.</p>"},{"location":"blog/20240110/20240110/#register-a-set-of-gnb-and-ue","title":"Register a set of gNB and UE","text":"<p>Now, we are ready to rock! Go ahead and runs this command,</p> <pre><code># Make sure to run PacketRusher as root\n# because it will create a gtp5g tunnel.\nsudo ./packetrusher ue\n</code></pre> <p>Now a new GTP tunnel is created and a new PDU session has established. Open another shell and ping google DNS.</p> <pre><code># You can find VRF name on the output of `./packetrusher ue`\nsudo ip vrf exec &lt;vrf_name&gt; ping 8.8.8.8\n</code></pre>"},{"location":"blog/20240110/20240110/#experiment","title":"Experiment","text":""},{"location":"blog/20240110/20240110/#multi-ue-registration-load-test","title":"Multi-UE Registration Load Test","text":""},{"location":"blog/20240110/20240110/#bandwidth-test","title":"Bandwidth Test","text":"<p>We use iperf3 to perform this test.</p> <p>iperf3 server runs on the VM-5GC.</p> <p>iperf3 client send traffic through the GTP tunnel we just created on VM-RAN/UE.</p> <p>The GTP-U tunnel traffic is forwarded by VirtualBox host-only NICs.</p> <pre><code># `iperf3 -c 192.168.56.10`\n\n[ ID]   Interval        Transfer     Bitrate         Retr\n[  6]   0.00-10.00 sec  2.17 GBytes  1.86 Gbits/sec  679             sender\n[  6]   0.00-10.00 sec  2.17 GBytes  1.86 Gbits/sec                  receive\n</code></pre>"},{"location":"blog/20240110/20240110/#about","title":"About","text":"<p>Hey there, I'm Michael! I hopped on board with the free5GC team last summer, diving into the exciting world of 5G. This is my first shot of sharing my experiences, and I'm stoked about it. Any advise or discussion are welcome!</p> <p> </p>"},{"location":"blog/20240119/20240119/","title":"Registration procedures","text":"<p>Note</p> <p>Author: Tim Lin (tim1207) Author: Donald Shih (donald1218) Date: 2024/1/19</p>"},{"location":"blog/20240119/20240119/#introduction","title":"Introduction","text":"<p>The purpose of registration procedures is to allow UEs to register for specific service access rights in 5G. They can be divided into four main type:</p> <p>1. Initial Registration is a mandatory procedure that UEs must execute when they are first powered on. After completing this procedure, the core network will allocate the corresponding resources to the UE. If the UE is in the Idle state (CM-Idle) for a long period of time, causing the core network to lose the UE Context, the UE must also initiate this procedure. 2. Mobility Registration is a procedure that UEs must initiate when they move to a new Tracking Area (TA) that is not included in the UE's TAI List. This procedure is used to update the TA information. 3. Periodic Registration is similar to the Periodic TAU in 4G. 4. Emergency Registration is a procedure that UEs can use to register for emergency services, even if they do not have a valid 5G subscription.</p>"},{"location":"blog/20240119/20240119/#registration-procedure-with-new-amf","title":"Registration Procedure with New AMF","text":""},{"location":"blog/20240119/20240119/#description","title":"Description","text":"<ul> <li> <p>[1] The UE initiates a Registration Request to the (R)AN, which includes an (R)AN message.  </p> <ul> <li>AN message has:  <ul> <li>Registration Type </li> <li>SUCI or 5G-GUTI or PEI</li> <li>Last visited TAI (if available)</li> <li>Security parameters</li> <li>Requested NSSAI</li> <li>Mapping of Requested NSSAI</li> <li>PDU Session status</li> <li>List of PDU Sessions To Be Activated</li> </ul> </li> </ul> </li> <li> <p>[2] The base station selects the AMF that will service the UE based on the GUAMI information.If the UE does not provide a GUAMI, the core network uses the Requested NSSAI to find an AMF that supports those needs.</p> </li> <li> <p>[3] Ran will send N2 Message to New AMF:</p> <ul> <li>N2 Message with :<ul> <li>N2 parameters</li> <li>Registration Request</li> <li>UE Policy Container <p>If the Registration type is Periodic Registration Update, then steps 4 to 20 may be omitted.</p> </li> </ul> </li> </ul> </li> <li> <p>[4] [Conditional] In step 4, the following actions are taken depending on the deployment status of UDSF:  </p> <ul> <li> <p>UDSF is deployed: The new AMF does not need to get data from the old AMF. Instead, the new AMF can call the Nudsf_UnstructuredDataManagement_Query service to directly retrieve the UE's SUPI and UE context from the UDSF.</p> </li> <li> <p>UDSF is not deployed: The new AMF will invoke the Namf_Communication_UEContextTransfer message provided by the old AMF, to request the UE's SUPI and UE context.</p> </li> </ul> </li> <li> <p>[5] [Conditional] </p> <ul> <li> <p>UDSF is deployed: The UDSF responds to the new AMF for the Nudsf_Unstructured_Data_Management_Query invocation with the related contexts.</p> </li> <li> <p>UDSF is not deployed: Old AMF responds to the new AMF for the Namf_Communication_UEContextTransfer invocation by including the UE's SUPI and UE Context.</p> <ul> <li>UE Context with :<ul> <li>information about established PDU Session(s)</li> <li>information about active NGAP UE-TNLA bindings to N3IWF</li> <li>information about AM Policy Association</li> </ul> </li> </ul> </li> </ul> </li> <li> <p>[6] [Conditional] If the SUCI is not provided by the UE, and it is not retrieved from the old AMF, then the new AMF will send an Identity Request message to the UE to obtain the SUCI.</p> </li> <li> <p>[7] [Conditional] The UE uses the HPLMN-provided public key and SUPI to derive the SUCI. The UE then includes the SUCI in the Identity Response message to the new AMF.</p> </li> </ul> <p></p>"},{"location":"blog/20240119/20240119/#description_1","title":"Description","text":"<ul> <li> <p>[8] UEs can initiate UE authentication by calling AUSF. In this example, the AMF will use the SUPI or SUCI to select the AUSF.</p> </li> <li> <p>[9] Authentication and Security Due to the complexity of this section of the process, it will be described in detail in another section.</p> </li> <li> <p>[10] [Conditional] If the conversion of AMF is completed, New AMF will call Namf_Communication_RegistrationCompleteNotify to notify Old AMF registration is completed.</p> <p>If the S-NSSAIs used in the old Registration Area cannot be served in the target Registration Area, the new AMF determines which PDU Session cannot be supported in the new Registration Area.The new AMF invokes the Namf_Communication_RegistrationCompleteNotify service operation to notify the old AMF.Then the new AMF modifies the PDU Session Status.  </p> <p>If new AMF received in the UE context transfer in step 2 the information about the AM Policy Association, It will inform the old AMF that the AM Policy Association in the UE context is no longer in use.</p> </li> <li> <p>[11] [Conditional] If the PEI is not provided by the UE nor obtained from Old AMF, New AMF will obtain the PEI by sending an Identity Request message to the UE to initiate the Identity Request procedure.</p> </li> <li> <p>[12] [Optional] The new AMF initiates ME identity check by invoking the N5g-eir_EquipmentIdentityCheck_Get service operation</p> </li> </ul> <p></p>"},{"location":"blog/20240119/20240119/#description_2","title":"Description","text":"<ul> <li> <p>[13] If Step 14 is to be executed, New AMF will select the UDM based on the SUPI and the UDM will select a UDR Instance.</p> </li> <li> <p>[14a] If the AMF changes, or the SUPI provided by the UE is invalid, or the UE registers to the same AMF but this AMF is already registered for non-3GPP access, the new AMF is registered with the UDM using Nudm_UECM_Registration, and subscribes to be notified when the UDM deregisters this AMF, the UDM stores the AMF identity assciated to the Access Type, and the UDM can store the information in the UDR via Nudr_DM_Update.</p> </li> <li> <p>[14b] The AMF retrieves the SMF Selection Subscription data and Access and Mobility Subscription data and UE context using Nudm_SDM_Get, and the UDM retrieves that information from the UDR via Nudr_DM_Query.</p> </li> <li> <p>[14c] After receiving a successful response, AMF calls Nudm_SDM_Subscribe to subscribe to the notification when the requested data has been modified, and UDM can subscribe to the UDR via Nudr_DM_Subscribe.</p> </li> <li> <p>[14d] [Conditional] After the UDM stores the Access type information, it causes the UDM to initiate a Nudm_UECM_DeregistrationNotification to the Old AMF so that the Old AMF deletes the corresponding UE context.      </p> <ul> <li> <p>If the UDM indicates the deletion reason is Initial Registration, the old AMF will send a Nsmf_PDUSession_ReleaseSMContext message to all the SMFs associated with the UE to notify them that the UE has deregistered from the old AMF. The SMFs will then release the PDU sessions after receiving this notification.</p> </li> <li> <p>If the Old AMF has an N2 connection against that UE, the Old AMF will perform an (R)AN Release indicating that the UE has locally released the RRC Connection for the NG-RAN.</p> </li> </ul> </li> <li> <p>[14e] The Old AMF unsubscribes with the UDM for subscription data using Nudm_SDM_unsubscribe.</p> </li> </ul> <p></p>"},{"location":"blog/20240119/20240119/#description_3","title":"Description","text":"<ul> <li> <p>[15] The New AMF can be contacted to the (V-)PCF using the PCF ID in the UE context received in Step 5.</p> </li> <li> <p>[16] [Optional] If the New AMF contacts (V-)PCF using the PCF ID in the UE context received in Step 5. the New AMF shall put the PCF ID(s) in the call to Npcf_AMPolicyControl Create operation.</p> </li> <li> <p>[17] [Conditional]</p> <ul> <li>Nsmf_PDUSession_UpdateSMContext The AMF invokes the Nsmf_PDUSession_UpdateSMContext in the following scenario(s):<ul> <li>If the registration request in Step 1 contains List Of PDU Sessions To Be Activated, the AMF sends an Nsmf_PDUSession_UpdateSMContext request to the SMFs associated with the PDU Session(s) to activate the User Plane connections of these PDU Session(s). </li> </ul> </li> <li>Nsmf_PDUSession_ReleaseSMContext The AMF invokes the Nsmf_PDUSession_ReleaseSMContext service operation towards the SMF in the following scenario:<ul> <li>If any PDU Session status indicates that it has been released on the UE side, the AMF will use this to notify the SMF to release the resources associated with that PDU Session.</li> </ul> </li> </ul> </li> <li> <p>[18-19] If the AMF has changed and the Old AMF indicates a pre-existing NGAP UE association to the N3IWF, the New AMF creates an NGAP UE association to the N3IWF to which the UE is already connected and automatically releases the previous NGAP UE associations of the Old AMF and the N3IWF , and N3IWF will response to AMF.</p> </li> <li> <p>[20] [Optional] If the Old AMF previously initiated a Policy Association for the PCF and the Old AMF did not transfer the PCF ID(s) to the New AMF, the Old AMF performs an AMF-initiated Policy Association Termination to remove the association with the PCF.</p> </li> <li> <p>[21] The AMF sends a Registration Accept message to the UE indicating that the registration request has been accepted. If the AMF assigns a new 5G-GUTI, it will include the 5G-GUTI.</p> </li> <li> <p>[22] [Conditional] After receiving any of [Configured NSSAI for the Serving PLMN], [Mapping Of Configured NSSAI] and Network Slicing Subscription Change Indication in Step 21, the UE sends a Registration Complete message (to confirm whether the new 5G-GUTI is allocated) to the AMF. sends a Registration Complete message (to confirm whether the new 5G-GUTI has been allocated).</p> <ul> <li>If the List Of PDU Sessions To Be Activated is not included in the Registration Request, the AMF releases the signalling connection with the UE.</li> <li>If Follow-on request is included in the Registration Request, AMF shall not release the signalling connection after completing the registration process.</li> <li>If AMF knows that there is a pending signalling in AMF or between UE and 5GC, AMF shall not release the signalling connection immediately after completing the registration process.</li> </ul> </li> <li> <p>[23] [Conditional] The AMF also uses Nudm_SDM_Info to confirm to the UDM that the UE has received and acted upon the Network Slicing Subscription Change Indication (see Step 21 and step 22).</p> <ul> <li>If the Access and Mobility Subscription data provided by the UDM to the AMF in Step 14b includes Steering of Roaming information with an indication that the UDM is requesting to receive an acknowledgement of that information from the UE, the AMF uses Nudm_SDM_Info to provide a UE acknowledgement to the UDM. AMF uses Nudm_SDM_Info to provide a UE acknowledgement to the UDM.</li> </ul> </li> <li> <p>[24] [Conditional] This step occurs after Step 14a will send Homogeneous Support of IMS Voice over PS Sessions to the UDM using Nudm_UECM_Update.  </p> <ul> <li>If the AMF has evaluated the support of IMS Voice over PS Sessions, see TS 23.501.</li> <li>If the AMF determines that it needs to update the Homogeneous Support of IMS Voice over PS Sessions, see TS 23.501.</li> </ul> </li> </ul>"},{"location":"blog/20240119/20240119/#reference","title":"Reference","text":"<ul> <li>3GPP TS 23.502: Registration Management procedures</li> </ul>"},{"location":"blog/20240119/20240119/#about","title":"About","text":"<p>Thank you for reading.We are members of the free5GC team who joined last year. This post is our first blog.If you find any errors in the article or have any questions about the content, don't hesitate to reach out via email to share your insights.</p>"},{"location":"blog/20240119/20240119/#connect-with-me","title":"Connect with Me","text":"<ul> <li>Linkedin: Donald</li> <li>Github: https://github.com/donald1218</li> <li>Linkedin: Tim</li> <li>Github: https://github.com/tim1207</li> </ul>"},{"location":"guide/","title":"Index","text":""},{"location":"guide/#user-guide","title":"User Guide","text":""},{"location":"guide/#information","title":"Information","text":"<ul> <li>Hardware tested</li> <li>Supported features</li> </ul>"},{"location":"guide/#roadmap","title":"Roadmap","text":"<p>Here are the features on the roadmap. These items are planned to be supported in the near future:</p> <ul> <li>Charging Function (CHF)</li> <li>OAuth on SBA</li> <li>Session AMBR in Data Plane</li> <li>Network Exposure Function (NEF)</li> </ul> <p>If you're interested in more details, please visit the GitHub Dashboard</p>"},{"location":"guide/#free5gc-installation-guide","title":"free5GC Installation Guide","text":"<p>Note</p> <p>If you have to develop a new feature on free5GC, please check the links below to install the free5GC. Otherwise, for normal use/test purposes, we recommend you use the free5GC Compose to launch the free5GC without complicated configuration settings.</p>"},{"location":"guide/#recommended-free5gc-compose","title":"[Recommended] free5GC compose","text":"<ul> <li>Installing free5GC Core Network with free5GC-Compose</li> </ul>"},{"location":"guide/#advanced-build-free5gc-from-scratch","title":"[Advanced] Build free5GC from scratch","text":"<p>For people who are not familiar with virtual machines and Linux installation, here are some example demonstrations:</p> <ul> <li>Creating a Ubuntu VM using VirtualBox</li> <li>Creating and Configuring a free5GC VM</li> <li>Build and Install free5GC from source code and Test free5GC</li> <li>Installing a UE/RAN Simulator</li> <li>Installing a N3IWUE</li> <li>free5GC Simple Apps</li> <li>All of tutorial videos are available at our Youtube channel:<ul> <li>English</li> <li>Chinese</li> <li>Environment setup of multiple SMF, DNN, and UPF</li> </ul> </li> </ul>"},{"location":"guide/#configuration","title":"Configuration","text":"<ul> <li>Environment</li> <li>Basic</li> <li>SMF</li> <li>Webconsole</li> <li>Select UPF based on S-NSSAI</li> <li>Select nearby UPF according to the connected gNodeB</li> <li>ULCL</li> <li>Netns5g - A free5gc and UERANSIM deployment using Linux network namespaces</li> </ul>"},{"location":"guide/#deployment","title":"Deployment","text":"<p>For Container deployment:</p> <ul> <li>free5GC Compose (Docker Compose)</li> <li>Towards5gs-helm (Kubernetes)</li> </ul>"},{"location":"guide/#others","title":"Others","text":"<ul> <li>Release Note</li> <li>Trouble Shooting</li> <li>Appendix</li> </ul>"},{"location":"guide/0-compose/","title":"0 compose","text":"<p>free5GC compose is a docker compose version of free5GC for stage 3. It's inspired by free5gc-docker-compose and also reference to docker-free5gc.</p>"},{"location":"guide/0-compose/#prerequisites","title":"Prerequisites","text":"<ul> <li>GTP5G kernel module: needed to run the UPF</li> <li>Docker Engine: needed to run the Free5GC containers</li> <li>Docker Compose v2: needed to bootstrap the free5GC stack</li> </ul> <p>Note: AVX for MongoDB: some HW does not support MongoDB releases above<code>4.4</code> due to use of the new AVX instructions set. To verify if your CPU is compatible you can check CPU flags by running <code>grep avx /proc/cpuinfo</code>. A workaround is suggested here.</p>"},{"location":"guide/0-compose/#start-free5gc","title":"Start free5GC","text":"<p>Because we need to create tunnel interface, we need to use privileged container with root permission.</p>"},{"location":"guide/0-compose/#pull-docker-images-from-docker-hub","title":"Pull docker images from Docker Hub","text":"<pre><code>docker compose pull\n</code></pre>"},{"location":"guide/0-compose/#optional-build-docker-images-from-local-sources","title":"[Optional] Build docker images from local sources","text":"<pre><code># Clone the project\ngit clone https://github.com/free5gc/free5gc-compose.git\ncd free5gc-compose\n\n# clone free5gc sources\ncd base\ngit clone --recursive -j `nproc` https://github.com/free5gc/free5gc.git\ncd ..\n\n# Build the images\nmake all\ndocker compose -f docker-compose-build.yaml build\n\n# Alternatively you can build specific NF image e.g.:\nmake amf\ndocker compose -f docker-compose-build.yaml build free5gc-amf\n</code></pre> <p>Note:</p> <p>Dangling images may be created during the build process. It is advised to remove them from time to time to free up disk space.</p> <pre><code>docker rmi $(docker images -f \"dangling=true\" -q)\n</code></pre>"},{"location":"guide/0-compose/#run-free5gc","title":"Run free5GC","text":"<p>You can create free5GC containers based on local images or docker hub images:</p> <pre><code># use local images\ndocker compose -f docker-compose-build.yaml up\n# use images from docker hub\ndocker compose up # add -d to run in background mode\n</code></pre> <p>Destroy the established container resource after testing:</p> <pre><code># Remove established containers (local images)\ndocker compose -f docker-compose-build.yaml rm\n# Remove established containers (remote images)\ndocker compose rm\n</code></pre>"},{"location":"guide/0-compose/#troubleshooting","title":"Troubleshooting","text":"<p>Sometimes, you need to drop data from DB:</p> <pre><code>docker exec -it mongodb mongo\n&gt; use free5gc\n&gt; db.dropDatabase()\n&gt; exit # (Or Ctrl-D)\n</code></pre> <p>You can see logs for each service using <code>docker logs</code> command. For example, to access the logs of the SMF you can use:</p> <pre><code>docker logs smf\n</code></pre> <p>Please refer to the wiki for more troubleshooting information.</p>"},{"location":"guide/0-compose/#integration-with-external-gnbue-simulators","title":"Integration with external gNB/UE simulators","text":"<p>The integration with the UERANSIM eNB/UE simulator is documented here. </p> <p>You can also refer to this issue to find out how you can configure the UPF to forward traffic between the UERANSIM to the DN (eg. internet) in a docker environment.</p> <p>This issue provides detailed steps that might be useful.</p>"},{"location":"guide/0-compose/#integration-of-webui-with-nginx-reverse-proxy","title":"Integration of WebUI with Nginx reverse proxy","text":"<p>Here you can find helpful guidelines on the integration of Nginx reverse proxy to set it in front of the WebUI: https://github.com/free5gc/free5gc-compose/issues/55#issuecomment-1146648600</p>"},{"location":"guide/0-compose/#vagrant-box-option","title":"Vagrant Box Option","text":"<p>For Linux kernel version below 5.4 you can setup a working environment using a vagrant box: https://github.com/abousselmi/vagrant-free5gc Please refer to GTP5G kernel module for more information.</p>"},{"location":"guide/0-compose/#ulcl-configuration","title":"ULCL Configuration","text":"<p>You can check the following informations below:</p> <ul> <li>ulcl-example branch, or</li> <li>patch file</li> </ul>"},{"location":"guide/1-vm-en/","title":"1 vm en","text":""},{"location":"guide/1-vm-en/#ubuntu-virtual-machine-installation-demo","title":"Ubuntu Virtual Machine Installation Demo","text":"<p>In this demo, we will</p> <ul> <li>Install VirtualBox</li> <li>Create a Ubuntu Server VM using VirtualBox</li> <li>Use SSH to connect to the Ubuntu VM to install free5GC stage 3</li> <li>Update and upgrade Ubuntu</li> </ul>"},{"location":"guide/1-vm-en/#1-install-virtualbox","title":"1. Install VirtualBox","text":"<p>Search <code>virtualbox download</code>, or visit virtualbox.org to download and install VirtualBox (currently 7.0.12) for your operational system. </p> <p>Once VirtualBox is installed, launch it and see if you have something like this: </p>"},{"location":"guide/1-vm-en/#2-download-ubuntu-server","title":"2. Download Ubuntu Server","text":"<p>Search <code>ubuntu server download</code> on the web and download the latest Ubuntu Server 20.04 LTS, or visit ubuntu.com, choose Manual Installation Option to download the <code>.iso</code> file (currently 20.04.6 LTS) </p> <p>You should have downloaded a <code>.iso image</code> file with a name like <code>ubuntu-20.04.6-live-server-amd64.iso</code>, probably in your download directory. </p>"},{"location":"guide/1-vm-en/#3-create-a-ubuntu-server-vm","title":"3. Create a Ubuntu Server VM","text":"<p>Launch VirtualBox and create your first Ubuntu VM using the downloaded .iso image file. We use Ubuntu Server instead of Ubuntu Desktop because we only need a basic server machine without too many unnecessary functionalities. The resulting overhead to your host machine is smaller, and the VM starts up faster too.</p> <p>Tips</p> <ul> <li>Name the first VM using a generic name as ubuntu, <code>ubuntu-server</code>, or <code>ubuntu-20.04</code>.</li> <li>You can pick 1 or 2 (or more) CPUs, and about 2048MB memory, although you can change them later.</li> <li>In addition to the default NAT network interface, add also another \u201cHost-only\u201d network interface.</li> </ul> <p>Refer to the videos Creating VM, Setting up VM.</p>"},{"location":"guide/1-vm-en/#31-start-installing-ubuntu","title":"3.1 Start Installing Ubuntu","text":"<p>Some notes about installing Ubuntu:</p> <ul> <li>It's recommended that you choose short username and password for ease of typing later</li> <li>Not choosing LVM will make it a little bit easier later if you want to extend your disk space</li> <li>Choose to include SSH Server</li> <li>Let the security update complete</li> </ul> <p>Refer to videos Install Ubuntu 1, Install Ubuntu 2.</p>"},{"location":"guide/1-vm-en/#32-log-in-to-ubuntu","title":"3.2 Log in to Ubuntu","text":"<p>Reboot after Ubuntu installation is finished then wait a little bit for some initialization steps to complete. Then log in with your username and password. </p> <p>First try the <code>ifconfig</code> command\uff1a <pre><code>ubuntu@ubuntu:~$ ifconfig\nCommand 'ifconfig' not found, but can be installed with:\nsudo apt install net-tools\nubuntu@ubuntu:~$\n</code></pre></p> <p>If some messages like above show, it means <code>ifconfig</code> has not been installed yet. (<code>ifconfig</code> is no longer installed by defaults in newer Ubuntu, and is replaced by more versatile ip command, but we will use it here for simplicity).</p> <p>Follow its suggestion and install <code>ifconfig</code>: <pre><code>ubuntu@ubuntu:~$ sudo apt install net-tools\n</code></pre> The image below shows the installation result: </p> <p>Run <code>ifconfig</code> again to check the network interfaces: </p> <p>Your display may look different, but take notes about the IP address of the Host-only interface card. The example above shows <code>192.168.56.101</code>. You can SSH from your host machine into this Ubuntu VM using the IP later. (The other IP address, <code>10.0.2.15</code> is the IP address of the NAT interface card, which means that the apps in your host machine cannot access it).</p> <p>Finally, check if the VM has internet access using: <pre><code>ubuntu@ubuntu:~$ ping google.com\n</code></pre></p> <p></p> <p>Refer to the first part of the video Ping, SSH, and Upgrade.</p>"},{"location":"guide/1-vm-en/#4-connect-to-the-ubuntu-vm-using-ssh","title":"4. Connect to the Ubuntu VM using SSH","text":"<p>Launch your favorite SSH client from the host machine. Some operational systems (Mac, Ubuntu, some Windows) have SSH clients preinstalled. If you are using Windows, you can also download third-party SSH clients, by for example, searching \u201cwindows ssh download\u201d on the web.</p> <p>The benefit of using SSH is that you can easily copy and paste commands from your machine to Ubuntu VM for execution, and vice versa. You can also create multiple SSH connections with the Ubuntu VM for control and monitoring at the same time.</p> <p>Below it's possible to see some examples on a Mac host machine. Suppose the Host-only network IP is <code>192.168.56.101</code>, and the username is <code>ubuntu</code>: <pre><code>ssh 192.168.56.101 -l ubuntu\n</code></pre> The first time you connect to the VM, your SSH client may show some message asking you for confirmation. Enter yes: </p> <p>Tips</p> <p>If somehow SSH shows some warning messages telling you the machine has potential security risk, you may have to remove an entry in the file <code>&lt;your home directory&gt;/.ssh/known_hosts</code> related the the IP address.</p> <p>If you log in successfully, you will enter a command line interface: </p> <p>Repeat the basic commands such as <code>ping</code>, <code>ifconfig</code> to see if the VM is working properly. If so, we can access the Ubuntu VM \u201cremotely\u201d from now on.</p> <p> </p>"},{"location":"guide/1-vm-en/#5-update-and-upgrade-your-ubuntu","title":"5. Update and Upgrade your Ubuntu","text":"<p>Let also update and upgrade the Ubuntu VM right now to make sure it is up-to-date with proper security updates. <pre><code>sudo apt update\nsudo apt upgrade\n</code></pre></p>"},{"location":"guide/2-config-vm-en/","title":"2 config vm en","text":""},{"location":"guide/2-config-vm-en/#creating-a-free5gc-vm-and-setting-up-network","title":"Creating a free5GC VM and Setting up Network","text":"<p>In this demo we will exercise:</p> <ul> <li>Cloning an existing VM, and install free5GC on it</li> <li>Setting up the networking for the free5GC VM</li> </ul> <p>Tips</p> <p>Refer to video Clone VM and Change IP.</p>"},{"location":"guide/2-config-vm-en/#1-check-up-an-existing-vm-for-cloning","title":"1. Check up an existing VM for Cloning","text":"<p>Launch VirtualBox, and make sure the Ubuntu VM (ubuntu) we created before can boot up, then:</p> <ul> <li>Log in into the VM using SSH from the host machine, and check if the VM has internet access</li> <li>Make sure you have done <code>sudo apt update</code> and <code>sudo apt upgrade</code> (or you can do it again)</li> <li>Shutdown the VM. You can:</li> <li>use command <code>sudo shutdown -P now</code>, or</li> <li>click the \u201cClose Window\u201d of the Ubuntu VM terminal and choose the middle option (better not force to turn off the machine power)</li> <li>later if you just want to reboot, enter <code>sudo shutdown -r now</code></li> </ul>"},{"location":"guide/2-config-vm-en/#2-create-a-free5gc-vm","title":"2. Create a free5GC VM","text":"<p>First let\u2019s clone a new VM:</p> <ul> <li>Select an existing VM (ubuntu) and click the buttons on the right: / Snapshopts / Clone.</li> <li>Name the new VM <code>free5gc</code>.</li> <li>The MAC address rule: Create new MAC addresses for all network cards.</li> <li>Choose the Link cloning option (or you can also choose to complete clone the VM if you like).</li> </ul> <p>After the new VM is created:</p> <ul> <li>Start up the new free5gc VM, and use the same username and password to log in.</li> <li>In the Ubuntu terminal, issue <code>ping</code> and <code>ifconfig</code> again to make sure it has internet access, and also make note of the IP address of the Host-only network interface.<ul> <li>for example the IP could still be <code>192.168.56.101</code>, and the interface name is <code>enp0s8</code>.</li> </ul> </li> <li>Log in into free5gc VM using SSH, and make sure all things working properly.</li> </ul>"},{"location":"guide/2-config-vm-en/#3-change-hostname","title":"3. Change hostname","text":"<p>The cloned free5gc VM still has host name <code>ubuntu</code> (or the name you gave it in the original VM). Let\u2019s rename the VM to <code>free5gc</code>. You can do this by editing the file <code>/etc/hostname</code> (using <code>vi</code> or <code>nano</code>): <pre><code>sudo nano /etc/hostname\n# or \nsudo vi /etc/hostname\n</code></pre> In the file, change ubuntu into <code>free5gc</code>\u3002If you are using nano \uff0cyou can press <code>Ctrl-O</code> to save the file, then <code>Ctrl-X</code> to exit.</p> <p>Let\u2019s also change the file <code>/etc/hosts</code> by replacing the ubuntu inside into <code>free5gc</code>: <pre><code>sudo nano /etc/hosts\n</code></pre></p> <p>New content of the file <code>/etc/hosts</code> looks like this: <pre><code>127.0.0.1 localhost\n127.0.1.1 free5gc\n...\n</code></pre></p> <p>The changes will take effect after next reboot.</p>"},{"location":"guide/2-config-vm-en/#4-setting-static-ip-address","title":"4. Setting Static IP Address","text":"<p>The Host-only network interface, by default, gets its IP address through DHCP. The cloned free5gc VM seems to have trouble obtaining new IP address. We can change the host-only interface to use static IP address instead, which can save a lot of trouble later.</p> <p>Here let\u2019s fix the static IP address as <code>192.168.56.101</code>: <pre><code>$ cd /etc/netplan\n$ ls\n00-installer-config.yaml\n$ cat 00-installer-config.yaml\n</code></pre> The original content of the file <code>00-installer-config.yaml</code> looks like: <pre><code># This is the network config written by 'subiquity'\nnetwork:\n  ethernets:\n    enp0s3:\n      dhcp4: true\n    enp0s8:\n      dhcp4: true\n  version: 2\n</code></pre> meaning the VM has two network interfaces. Using <code>ifconfig</code> we know that <code>enp0s8</code> is the name of the Host-only network interface. We can edit the file: <pre><code>sudo nano 00-installer-config.yaml\n</code></pre> and change it into: <pre><code># This is the network config written by 'subiquity'\nnetwork:\n  ethernets:\n    enp0s3:\n      dhcp4: true\n    enp0s8:\n      dhcp4: no\n      addresses: [192.168.56.101/24]\n  version: 2\n</code></pre> First check if the new content is correct: <pre><code>sudo netplan try\n</code></pre> Press enter to exit, if successful. The apply tne new interface setting: <pre><code>sudo netplan apply\n</code></pre> Run <code>ifconfig</code> to see if the network setting has been changed correctly: <pre><code>enp0s3: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500\n        inet 10.0.2.15  netmask 255.255.255.0  broadcast 10.0.2.255\n        inet6 fe80::a00:27ff:fec4:254f  prefixlen 64  scopeid 0x20&lt;link&gt;\n        ether 08:00:27:c4:25:4f  txqueuelen 1000  (Ethernet)\n        RX packets 2  bytes 1180 (1.1 KB)\n        RX errors 0  dropped 0  overruns 0  frame 0\n        TX packets 18  bytes 1894 (1.8 KB)\n        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0\n\nenp0s8: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500\n        inet 192.168.56.101  netmask 255.255.255.0  broadcast 192.168.56.255\n        inet6 fe80::a00:27ff:fe7e:ada6  prefixlen 64  scopeid 0x20&lt;link&gt;\n        ether 08:00:27:7e:ad:a6  txqueuelen 1000  (Ethernet)\n        RX packets 8420  bytes 531867 (531.8 KB)\n        RX errors 0  dropped 0  overruns 0  frame 0\n        TX packets 10887  bytes 823487 (823.4 KB)\n        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0\n\nlo: flags=73&lt;UP,LOOPBACK,RUNNING&gt;  mtu 65536\n        inet 127.0.0.1  netmask 255.0.0.0\n        inet6 ::1  prefixlen 128  scopeid 0x10&lt;host&gt;\n        loop  txqueuelen 1000  (Local Loopback)\n        RX packets 6621  bytes 596035 (596.0 KB)\n        RX errors 0  dropped 0  overruns 0  frame 0\n        TX packets 6621  bytes 596035 (596.0 KB)\n        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0\n</code></pre> We can also check the routing table, just to have a grasp of what is going on regarding the network setting: <pre><code>$ route -n\nKernel IP routing table\nDestination     Gateway         Genmask         Flags Metric Ref    Use Iface\n0.0.0.0         10.0.2.2        0.0.0.0         UG    100    0        0 enp0s3\n10.0.2.0        0.0.0.0         255.255.255.0   U     0      0        0 enp0s3\n10.0.2.2        0.0.0.0         255.255.255.255 UH    100    0        0 enp0s3\n192.168.56.0    0.0.0.0         255.255.255.0   U     0      0        0 enp0s8\n</code></pre></p> <p>For the display above, we learn that the Host-only network <code>192.168.56.0/24</code> does not have internet access by itself (even though we can access it using SSH from the host machine). Internet access is through the NAT network <code>10.0.2.0/24</code>, with the gateway being <code>10.0.2.2</code> (provided by VirtualBox). Now we can SSH into free5gc VM using <code>192.168.56.101</code>: <pre><code>ssh 192.168.56.101 -l ubuntu\n</code></pre> This is also how we interact with free5gc VM from now on.</p>"},{"location":"guide/3-install-free5gc/","title":"3 install free5gc","text":""},{"location":"guide/3-install-free5gc/#installation","title":"Installation","text":""},{"location":"guide/3-install-free5gc/#a-prerequisites","title":"A. Prerequisites","text":"<p>1. Linux Kernel Version</p> <ul> <li>In order to use the UPF element, you must use the <code>5.0.0-23-generic</code> or <code>5.4.x</code> version of the Linux kernel.  free5gc uses the gtp5g kernel module, which has been tested and compiled against that kernel versions only. If you installed Ubuntu 20.04, the version should be like 5.4.x. To determine the version of the Linux kernel you are using:</li> </ul> <pre><code>$ uname -r\n5.4.0-65-generic\n</code></pre> <p>You will not be able to run most of the tests in Test page unless you deploy a UPF.</p> <p>2. Golang Version</p> <ul> <li>As noted above, free5gc is built and tested with Go 1.18.10</li> <li> <p>To check the version of Go on your system, from a command prompt: <pre><code>go version\n</code></pre></p> </li> <li> <p>If another version of Go is installed, remove the existing version and install Go 1.18.10:</p> </li> </ul> <pre><code># this assumes your current version of Go is in the default location:\nsudo rm -rf /usr/local/go\nwget https://dl.google.com/go/go1.18.10.linux-amd64.tar.gz\nsudo tar -C /usr/local -zxvf go1.18.10.linux-amd64.tar.gz\n</code></pre> <ul> <li>If Go is not installed on your system:</li> </ul> <pre><code>wget https://dl.google.com/go/go1.18.10.linux-amd64.tar.gz\nsudo tar -C /usr/local -zxvf go1.18.10.linux-amd64.tar.gz\nmkdir -p ~/go/{bin,pkg,src}\n# The following assume that your shell is bash:\necho 'export GOPATH=$HOME/go' &gt;&gt; ~/.bashrc\necho 'export GOROOT=/usr/local/go' &gt;&gt; ~/.bashrc\necho 'export PATH=$PATH:$GOPATH/bin:$GOROOT/bin' &gt;&gt; ~/.bashrc\necho 'export GO111MODULE=auto' &gt;&gt; ~/.bashrc\nsource ~/.bashrc\n</code></pre> <ul> <li>Further information and installation instructions for <code>golang</code> are available at the official golang site.</li> </ul> <p>3. Control-plane Supporting Packages</p> <pre><code>sudo apt -y update\nsudo apt -y install mongodb wget git\nsudo systemctl start mongodb\n</code></pre> <ul> <li>WARNING: MongoDB 5.0+ requires a CPU with AVX support. Or downgrade your MongoDB to 4.4</li> <li>see this post on MongoDB's official forum</li> <li>see also docker-library/mongo#485 (comment)</li> </ul> <p>Note: If you are using Ubuntu 22.04.x and you face issues, please, check this appendix section</p> <p>4. User-plane Supporting Packages</p> <pre><code>sudo apt -y update\nsudo apt -y install git gcc g++ cmake autoconf libtool pkg-config libmnl-dev libyaml-dev\n</code></pre> <p>5. Linux Host Network Settings</p> <pre><code>sudo sysctl -w net.ipv4.ip_forward=1\nsudo iptables -t nat -A POSTROUTING -o &lt;dn_interface&gt; -j MASQUERADE\nsudo iptables -A FORWARD -p tcp -m tcp --tcp-flags SYN,RST SYN -j TCPMSS --set-mss 1400\nsudo systemctl stop ufw\nsudo systemctl disable ufw # prevents the firewall to wake up after a OS reboot\n</code></pre> <p>Note: In Ubuntu Server 20.04 and 22.04 the dn_interface may be called <code>enp0s3</code> or <code>enp0s4</code> by default. Use the command <code>ip a</code> to help to figure it out</p>"},{"location":"guide/3-install-free5gc/#b-install-control-plane-elements","title":"B. Install Control Plane Elements","text":"<ol> <li> <p>Clone the free5GC repository</p> <ul> <li> <p>To install the latest stable build (v3.3.0):</p> <pre><code>cd ~\ngit clone --recursive -b v3.3.0 -j `nproc` https://github.com/free5gc/free5gc.git\ncd free5gc\n</code></pre> </li> <li> <p>(Alternatively) to install the latest nightly build:</p> <pre><code>cd ~/free5gc\ngit checkout main\ngit submodule sync\ngit submodule update --init --jobs `nproc`\ngit submodule foreach git checkout main\ngit submodule foreach git pull --jobs `nproc`\n</code></pre> </li> </ul> </li> <li> <p>Compile network function services in <code>free5gc</code></p> <ul> <li> <p>To do so individually (e.g., AMF only):</p> <pre><code>cd ~/free5gc\nmake amf\n</code></pre> </li> <li> <p>To build all network functions:</p> <pre><code>cd ~/free5gc\nmake\n</code></pre> </li> </ul> </li> </ol>"},{"location":"guide/3-install-free5gc/#c-install-user-plane-function-upf","title":"C. Install User Plane Function (UPF)","text":"<ol> <li> <p>As noted above, the GTP kernel module used by the UPF requires that you use Linux kernel version <code>5.0.0-23-generic</code> or <code>5.4.x</code>.  To verify your version:</p> <pre><code>uname -r\n</code></pre> </li> <li> <p>Retrieve the 5G GTP-U kernel module using <code>git</code> and build it</p> <pre><code>git clone -b v0.8.3 https://github.com/free5gc/gtp5g.git\ncd gtp5g\nmake\nsudo make install\n</code></pre> </li> <li> <p>Build the UPF (you may skip this step if you built all network functions above):</p> <ul> <li> <p>to build using make:</p> <pre><code>cd ~/free5gc\nmake upf\n</code></pre> </li> </ul> </li> <li> <p>Customize the UPF as desired. The UPF configuration file in <code>run.sh</code> is <code>free5gc/config/upfcfg.yaml</code>.</p> </li> </ol>"},{"location":"guide/3-install-free5gc/#d-install-webconsole","title":"D. Install WebConsole","text":"<ol> <li> <p>Before building WebConsole, install nodejs and yarn packages first:</p> <pre><code>sudo apt remove cmdtest\nsudo apt remove yarn\ncurl -sS https://dl.yarnpkg.com/debian/pubkey.gpg | sudo apt-key add -\necho \"deb https://dl.yarnpkg.com/debian/ stable main\" | sudo tee /etc/apt/sources.list.d/yarn.list\nsudo apt update\nsudo apt install -y nodejs yarn\n</code></pre> </li> <li> <p>Build WebConsole</p> <ul> <li> <p>to build using make:</p> <pre><code>cd ~/free5gc\nmake webconsole\n</code></pre> </li> <li> <p>(Alternatively) to build manually:</p> <pre><code>cd ~/free5gc/webconsole/frontend\nyarn install\nyarn build\nrm -rf ../public\ncp -R build ../public\ncd ..\ngo build -o bin/webconsole server.go\n</code></pre> </li> </ul> </li> </ol> <p>Note: 2GB or more of OS memory is recommended. WebConsole may be failed to build if memory is less then 1GB.</p>"},{"location":"guide/4-test-free5gc/","title":"4 test free5gc","text":""},{"location":"guide/4-test-free5gc/#test-free5gc","title":"Test free5GC","text":"<p>Start a Wireshark capture on any core-connected interface, applying the filter <code>'pfcp||icmp||gtp'</code>.</p> <p>In order to run the tests, first do this:</p> <pre><code>cd ~/free5gc\nmake upf\nchmod +x ./test.sh\n</code></pre> <p>The tests are all run from within <code>~/free5gc</code>.</p> <p>a. TestRegistration</p> <pre><code>./test.sh TestRegistration\n</code></pre> <p>b. TestGUTIRegistration</p> <pre><code>./test.sh TestGUTIRegistration\n</code></pre> <p>c. TestServiceRequest</p> <pre><code>./test.sh TestServiceRequest\n</code></pre> <p>d. TestXnHandover</p> <pre><code>./test.sh TestXnHandover\n</code></pre> <p>e. TestDeregistration</p> <pre><code>./test.sh TestDeregistration\n</code></pre> <p>f. TestPDUSessionReleaseRequest</p> <pre><code>./test.sh TestPDUSessionReleaseRequest\n</code></pre> <p>g. TestPaging</p> <pre><code>./test.sh TestPaging\n</code></pre> <p>h. TestN2Handover</p> <pre><code>./test.sh TestN2Handover\n</code></pre> <p>i. TestNon3GPP</p> <pre><code>./test.sh TestNon3GPP\n</code></pre> <p>j. TestReSynchronization</p> <pre><code>./test.sh TestReSynchronization\n</code></pre> <p>k. TestULCL</p> <pre><code>./test_ulcl.sh TestRequestTwoPDUSessions\n</code></pre>"},{"location":"guide/5-install-ueransim/","title":"5 install ueransim","text":""},{"location":"guide/5-install-ueransim/#installing-ueransim-a-ueran-simulator","title":"Installing UERANSIM - a UE/RAN Simulator","text":"<p>In this demo we will practice:</p> <ul> <li>Installing UERANSIM</li> <li>Configuring free5GC and UERANSIM</li> <li>Running UERANSIM against free5GC</li> </ul>"},{"location":"guide/5-install-ueransim/#1-install-ueramsim-vm","title":"1. Install ueramsim VM","text":"<p>Repeat the steps of cloning <code>free5gc</code> VM from the base VM, create a new VM for the UERANSIM simulator:</p> <ul> <li>Name the VM <code>ueransim</code>, and create new MAC addresses for all network cards.</li> <li>Make sure the VM has internet access and can log in using SSH.</li> <li>Change the hostname to <code>ueransim</code>.</li> <li>Make the Host-only network interface have static IP address <code>192.168.56.102</code>.</li> <li>Reboot the ueransim VM, as well as the free5gc VM.</li> <li>You can ping <code>192.168.56.101</code> from the ueransim VM, and also <code>ping 192.168.56.102</code> from the free5gc VM.</li> </ul>"},{"location":"guide/5-install-ueransim/#2-install-ueransim","title":"2. Install UERANSIM","text":"<p>Search \u201cueransim\u201d on the web, and get the web site. On the web site, review what the UERANSIM open-source project is about, then browse into the installation page.</p> <p>To download UERANSIM: <pre><code>cd ~\ngit clone https://github.com/aligungr/UERANSIM\ncd UERANSIM\ngit checkout 3a96298\n</code></pre></p> <p>Update and upgrade ueransim VM first: <pre><code>sudo apt update\nsudo apt upgrade\n</code></pre></p> <p>Install required tools: <pre><code>sudo apt install make\nsudo apt install g++\nsudo apt install libsctp-dev lksctp-tools\nsudo apt install iproute2\nsudo snap install cmake --classic\n</code></pre></p> <p>Build UERANSIM: <pre><code>cd ~/UERANSIM\nmake\n</code></pre></p>"},{"location":"guide/5-install-ueransim/#3-install-free5gc-webconsole","title":"3. Install free5GC WebConsole","text":"<p>free5GC provides a simple web tool WebConsole to help creating and managing UE registrations to be used by various 5G network functions (NF). To build WebConsole we need Node.js and Yarn.</p> <p>First SSH into free5gc (<code>192.168.56.101</code>)\uff0cand remove obsolete tools that may exists: <pre><code>sudo apt remove cmdtest\nsudo apt remove yarn\n</code></pre></p> <p>Then install <code>Node.js</code> and <code>Yarn</code>: <pre><code>curl -sS https://dl.yarnpkg.com/debian/pubkey.gpg | sudo apt-key add -\necho \"deb https://dl.yarnpkg.com/debian/ stable main\" | sudo tee /etc/apt/sources.list.d/yarn.list\nsudo apt-get update\nsudo apt-get install -y nodejs yarn\n</code></pre></p> <p>To build WebConsole: <pre><code>cd ~/free5gc\nmake webconsole\n</code></pre></p>"},{"location":"guide/5-install-ueransim/#4-use-webconsole-to-add-an-ue","title":"4. Use WebConsole to Add an UE","text":"<p>First start up the WebConsole server: <pre><code>cd ~/free5gc/webconsole\n./bin/webconsole\n</code></pre></p> <p>The screen shows the port number <code>:5000</code> at the end. Open your web browser from your host machine, and enter the URL <code>http://192.168.56.101:5000</code></p> <ul> <li>On the login page, enter username <code>admin</code> and password <code>free5gc</code>.</li> <li>Once logged in, widen the page until you see \u201cSubscribers\u201d on the left-hand side column.</li> <li>Click on the <code>Subscribers</code> tab and then on the <code>New Subscriber</code> button<ul> <li>Scroll down to <code>Operator Code Type</code> and change it from \"OPc\" to \"OP\".</li> <li>Leave the other fields unchanged. This registration data is used for ease of testing and actual use later.</li> <li>Scroll all the way down and click on <code>Submit</code>.</li> </ul> </li> <li>Once the data shows up on the \"Subscribers\" table, you can press <code>Ctrl-C</code> on the terminal to kill the WebConsole process on the free5gc VM</li> </ul>"},{"location":"guide/5-install-ueransim/#5-setting-free5gc-and-ueransim-parameters","title":"5. Setting free5GC and UERANSIM Parameters","text":"<p>In free5gc VM, we need to edit three files:</p> <ul> <li><code>~/free5gc/config/amfcfg.yaml</code></li> <li><code>~/free5gc/config/smfcfg.yaml</code></li> <li><code>~/free5gc/config/upfcfg.yaml</code></li> </ul> <p>First SSH into free5gc VM, and change <code>~/free5gc/config/amfcfg.yaml</code>: <pre><code>cd ~/free5gc\nnano config/amfcfg.yaml\n</code></pre></p> <p>Replace ngapIpList IP from <code>127.0.0.1</code> to <code>192.168.56.101</code>, namely from: <pre><code>...\n  ngapIpList:  # the IP list of N2 interfaces on this AMF\n  - 127.0.0.1\n</code></pre> into: <pre><code>...\n  ngapIpList:  # the IP list of N2 interfaces on this AMF\n  - 192.168.56.101  # 127.0.0.1\n</code></pre></p> <p>Next edit <code>~/free5gc/config/smfcfg.yaml</code>: <pre><code>nano config/smfcfg.yaml\n</code></pre> and in the entry inside <code>userplaneInformation / upNodes / UPF / interfaces / endpoints</code>, change the IP from <code>127.0.0.8</code> to <code>192.168.56.101</code>, namely from: <pre><code>...\n  interfaces: # Interface list for this UPF\n   - interfaceType: N3 # the type of the interface (N3 or N9)\n     endpoints: # the IP address of this N3/N9 interface on this UPF\n       - 127.0.0.8\n</code></pre> into: <pre><code>...\n  interfaces: # Interface list for this UPF\n   - interfaceType: N3 # the type of the interface (N3 or N9)\n     endpoints: # the IP address of this N3/N9 interface on this UPF\n       - 192.168.56.101  # 127.0.0.8\n</code></pre> Finally, edit <code>~/free5gc/config/upfcfg.yaml</code>\uff0cand chage gtpu IP from <code>127.0.0.8</code> into <code>192.168.56.101</code>, namely from: <pre><code>...\n  gtpu:\n    forwarder: gtp5g\n    # The IP list of the N3/N9 interfaces on this UPF\n    # If there are multiple connection, set addr to 0.0.0.0 or list all the addresses\n    ifList:\n      - addr: 127.0.0.8\n        type: N3\n</code></pre> into: <pre><code>...\n  gtpu:\n    forwarder: gtp5g\n    # The IP list of the N3/N9 interfaces on this UPF\n    # If there are multiple connection, set addr to 0.0.0.0 or list all the addresses\n    ifList:\n      - addr: 192.168.56.101  # 127.0.0.8\n        type: N3\n</code></pre></p>"},{"location":"guide/5-install-ueransim/#6-setting-ueransim","title":"6. Setting UERANSIM","text":"<p>In the ueransim VM, there are two files related to free5GC\uff1a</p> <ul> <li><code>~/UERANSIM/config/free5gc-gnb.yaml</code></li> <li><code>~/UERANSIM/config/free5gc-ue.yaml</code></li> </ul> <p>The second file is for UE, which we don\u2019t have to change if the data inside is consistent with the (default) registration data we set using WebConsole previously.</p> <p>First SSH into ueransim, and edit the file <code>~/UERANSIM/config/free5gc-gnb.yaml</code>, and change the ngapIp IP, as well as the gtpIp IP, from <code>127.0.0.1</code> to <code>192.168.56.102</code>\uff0cand also change the IP in amfConfigs into <code>192.168.56.101</code>, that is, from: <pre><code>...\n  ngapIp: 127.0.0.1   # gNB's local IP address for N2 Interface (Usually same with local IP)\n  gtpIp: 127.0.0.1    # gNB's local IP address for N3 Interface (Usually same with local IP)\n\n  # List of AMF address information\n  amfConfigs:\n    - address: 127.0.0.1\n</code></pre> into: <pre><code>...\n  ngapIp: 192.168.56.102  # 127.0.0.1   # gNB's local IP address for N2 Interface (Usually same with local IP)\n  gtpIp: 192.168.56.102  # 127.0.0.1    # gNB's local IP address for N3 Interface (Usually same with local IP)\n\n  # List of AMF address information\n  amfConfigs:\n    - address: 192.168.56.101  # 127.0.0.1\n</code></pre> Next we examine the file <code>~/UERANSIM/config/free5gc-ue.yaml</code>\uff0cand see if the settings is consistent with those in free5GC (via WebConsole), for example: <pre><code># IMSI number of the UE. IMSI = [MCC|MNC|MSISDN] (In total 15 or 16 digits)\nsupi: 'imsi-208930000000003'\n# Mobile Country Code value\nmcc: '208'\n# Mobile Network Code value (2 or 3 digits)\nmnc: '93'\n\n# Permanent subscription key\nkey: '8baf473f2f8fd09487cccbd7097c6862'\n# Operator code (OP or OPC) of the UE\nop: '8e27b6af0e692e750f32667a3b14605d'\n# This value specifies the OP type and it can be either 'OP' or 'OPC'\nopType: 'OP'\n\n...\n\n# Initial PDU sessions to be established\nsessions:\n  - type: 'IPv4'\n    apn: 'internet'\n    slice:\n      sst: 0x01\n      sd: 0x010203\n\n# List of requested S-NSSAIs by this UE\nslices:\n  - sst: 0x01\n    sd: 0x010203\n\n...\n</code></pre> The data appear to be the same as what we set in WebConsole.</p>"},{"location":"guide/5-install-ueransim/#7-testing-ueransim-against-free5gc","title":"7. Testing UERANSIM against free5GC","text":"<p>SSH into free5gc. If you have rebooted free5gc, remember to run: <pre><code>sudo sysctl -w net.ipv4.ip_forward=1\nsudo iptables -t nat -A POSTROUTING -o &lt;dn_interface&gt; -j MASQUERADE\nsudo systemctl stop ufw\n</code></pre></p> <p>Note: In Ubuntu Server 20.04 and 22.04 the dn_interface may be called <code>enp0s3</code> or <code>enp0s4</code> by default. Use the command <code>ip a</code> to help to figure it out</p> <p>In addition, execute the following command: <pre><code>sudo iptables -I FORWARD 1 -j ACCEPT\n</code></pre></p> <p>Tip: As per the information on the appendix page, it's possible to use a script to reload the config above automatically after reboot</p> <p>Also, make sure you have make proper changes to the free5GC configuration files, then run <code>./run.sh</code>: <pre><code>cd ~/free5gc\n./run.sh\n</code></pre></p> <p>At this time free5GC has been started.</p> <p>Next, prepare three additional SSH terminals from your host machine (if you know how to use <code>tmux</code>, you can use just one).</p> <p>In terminal 1: SSH into ueransim, make sure UERANSIM is built, and configuration files have been changed correctly, then execute <code>nr-gnb</code>: <pre><code>cd ~/UERANSIM\nbuild/nr-gnb -c config/free5gc-gnb.yaml\n</code></pre></p> <p>In terminal 2, SSH into ueransim, and execute <code>nr-ue</code> with admin right: <pre><code>cd ~/UERANSIM\nsudo build/nr-ue -c config/free5gc-ue.yaml # for multiple-UEs, use -n and -t for number and delay\n</code></pre></p> <p>In terminal 3, SSH into ueransim, and ping <code>192.168.56.101</code> to see free5gc is alive. Then, use ifconfig to see if the tunnel <code>uesimtun0</code> has been created (by nr-ue): <pre><code>$ ifconfig\n\nenp0s3: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500\n        inet 10.0.2.15  netmask 255.255.255.0  broadcast 10.0.2.255\n        inet6 fe80::a00:27ff:fe65:1472  prefixlen 64  scopeid 0x20&lt;link&gt;\n        ether 08:00:27:65:14:72  txqueuelen 1000  (Ethernet)\n        RX packets 80  bytes 32423 (32.4 KB)\n        RX errors 0  dropped 0  overruns 0  frame 0\n        TX packets 90  bytes 12860 (12.8 KB)\n        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0\n\nenp0s8: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500\n        inet 192.168.56.102  netmask 255.255.255.0  broadcast 192.168.56.255\n        inet6 fe80::a00:27ff:fe5e:be64  prefixlen 64  scopeid 0x20&lt;link&gt;\n        ether 08:00:27:5e:be:64  txqueuelen 1000  (Ethernet)\n        RX packets 1515  bytes 130490 (130.4 KB)\n        RX errors 0  dropped 0  overruns 0  frame 0\n        TX packets 1010  bytes 206670 (206.6 KB)\n        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0\n\nlo: flags=73&lt;UP,LOOPBACK,RUNNING&gt;  mtu 65536\n        inet 127.0.0.1  netmask 255.0.0.0\n        inet6 ::1  prefixlen 128  scopeid 0x10&lt;host&gt;\n        loop  txqueuelen 1000  (Local Loopback)\n        RX packets 3445  bytes 174416 (174.4 KB)\n        RX errors 0  dropped 0  overruns 0  frame 0\n        TX packets 3445  bytes 174416 (174.4 KB)\n        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0\n\nuesimtun0: flags=4305&lt;UP,POINTOPOINT,RUNNING,NOARP,MULTICAST&gt;  mtu 1500\n        inet 60.60.0.1  netmask 255.255.255.255  destination 60.60.0.1\n        inet6 fe80::2034:d00:a76:84b7  prefixlen 64  scopeid 0x20&lt;link&gt;\n        unspec 00-00-00-00-00-00-00-00-00-00-00-00-00-00-00-00  txqueuelen 500  (UNSPEC)\n        RX packets 3  bytes 252 (252.0 B)\n        RX errors 0  dropped 0  overruns 0  frame 0\n        TX packets 13  bytes 732 (732.0 B)\n        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0\n</code></pre></p> <p>Now use <code>ping</code>: <pre><code>ping -I uesimtun0 google.com\n</code></pre> If <code>ping</code> gets replies, then free5GC is running properly. Congratulations!</p>"},{"location":"guide/6-simple-app/","title":"6 simple app","text":""},{"location":"guide/6-simple-app/#free5gc-simple-apps","title":"free5GC Simple Apps","text":"<p>In this demo we will use free5GC together with UERANSIM to exercise on some simple network applications:</p> <ul> <li><code>ping</code> + <code>tcpdump</code></li> <li><code>wget</code> and <code>curl</code></li> </ul>"},{"location":"guide/6-simple-app/#ping-tcpdump","title":"ping + tcpdump","text":"<p>First start up free5GC and ueransim VMs. This requires one SSH terminal for free5gc, and two for ueransim.</p> <p>Open another SSH terminal and log in into ueransim: <pre><code>ssh 192.168.56.102 -l ubuntu\n</code></pre> Use <code>ifconfig</code> to check if <code>uesimtun0</code> tunnel has been created, and use ping to check if we can <code>ping</code> through it\uff1a <pre><code>$ ping google.com\nPING google.com (172.217.27.142) 56(84) bytes of data.\n64 bytes from tsa03s02-in-f14.1e100.net (172.217.27.142): icmp_seq=1 ttl=63 time=3.98 ms\n64 bytes from tsa03s02-in-f14.1e100.net (172.217.27.142): icmp_seq=2 ttl=63 time=3.87 ms\n64 bytes from tsa03s02-in-f14.1e100.net (172.217.27.142): icmp_seq=3 ttl=63 time=4.06 ms\n^C\n--- google.com ping statistics ---\n3 packets transmitted, 3 received, 0% packet loss, time 2003ms\nrtt min/avg/max/mdev = 3.872/3.970/4.060/0.076 ms\n</code></pre></p> <pre><code>$ ping -I uesimtun0 google.com\nPING google.com (172.217.27.142) from 60.60.0.1 uesimtun0: 56(84) bytes of data.\n64 bytes from tsa03s02-in-f14.1e100.net (172.217.27.142): icmp_seq=1 ttl=61 time=5.85 ms\n64 bytes from tsa03s02-in-f14.1e100.net (172.217.27.142): icmp_seq=2 ttl=61 time=4.87 ms\n64 bytes from tsa03s02-in-f14.1e100.net (172.217.27.142): icmp_seq=3 ttl=61 time=4.76 ms\n^C\n--- google.com ping statistics ---\n3 packets transmitted, 3 received, 0% packet loss, time 2004ms\nrtt min/avg/max/mdev = 4.760/5.160/5.847/0.487 ms\n</code></pre> <p>Also use <code>route -n</code> to observe if current routing table shows some routing rules regarding the two network interfaces <code>enp0s3</code> and <code>enp0s8</code>: <pre><code>$ route -n\nKernel IP routing table\nDestination     Gateway         Genmask         Flags Metric Ref    Use Iface\n0.0.0.0         10.0.2.2        0.0.0.0         UG    100    0        0 enp0s3\n10.0.2.0        0.0.0.0         255.255.255.0   U     0      0        0 enp0s3\n10.0.2.2        0.0.0.0         255.255.255.255 UH    100    0        0 enp0s3\n192.168.56.0    0.0.0.0         255.255.255.0   U     0      0        0 enp0s8\n</code></pre></p> <p>The network <code>10.0.2.0/24</code> and its <code>enp0s3</code> interface are related to VirtualBox NAT network card. We can bring down this interface: <pre><code>$ sudo ifconfig enp0s3 down\n$ route -n\nKernel IP routing table\nDestination     Gateway         Genmask         Flags Metric Ref    Use Iface\n192.168.56.0    0.0.0.0         255.255.255.0   U     0      0        0 enp0s8\n</code></pre> As shown aboe we have only Host-only network <code>192.168.56.0/24</code> left. Run <code>ping</code> again: <pre><code>$ ping 8.8.8.8\nping: connect: Network is unreachable\n</code></pre></p> <p>And see that it can not ping through, but runing: <pre><code>$ ping -I uesimtun0 8.8.8.8\nPING 8.8.8.8 (8.8.8.8) from 60.60.0.1 uesimtun0: 56(84) bytes of data.\n64 bytes from 8.8.8.8: icmp_seq=1 ttl=61 time=7.17 ms\n64 bytes from 8.8.8.8: icmp_seq=2 ttl=61 time=5.41 ms\n64 bytes from 8.8.8.8: icmp_seq=3 ttl=61 time=5.15 ms\n^C\n--- 8.8.8.8 ping statistics ---\n3 packets transmitted, 3 received, 0% packet loss, time 2005ms\nrtt min/avg/max/mdev = 5.150/5.907/7.165/0.895 ms\n</code></pre></p> <p>shows some responses, since we ask <code>ping</code> to go through the free5GC core network. To make <code>ping 8.8.8.8</code> in addition to <code>ping -I uesimtun0 8.8.8.8</code> work, we can set the <code>uesimtun0</code> interface (IP <code>60.60.0.1</code>) as the new default gateway: <pre><code>$ sudo ip r add default dev uesimtun0\n$ route -n\nKernel IP routing table\nDestination     Gateway         Genmask         Flags Metric Ref    Use Iface\n0.0.0.0         0.0.0.0         0.0.0.0         U     0      0        0 uesimtun0\n192.168.56.0    0.0.0.0         255.255.255.0   U     0      0        0 enp0s8\n</code></pre> Now traffic not for the <code>192.168.56.0/24</code> network will go to <code>uesimtun0</code>, and <code>ping 8.8.8.8</code> works this time: <pre><code>$ ping 8.8.8.8\nPING 8.8.8.8 (8.8.8.8) 56(84) bytes of data.\n64 bytes from 8.8.8.8: icmp_seq=1 ttl=61 time=5.02 ms\n64 bytes from 8.8.8.8: icmp_seq=2 ttl=61 time=6.31 ms\n64 bytes from 8.8.8.8: icmp_seq=3 ttl=61 time=5.41 ms\n^C\n--- 8.8.8.8 ping statistics ---\n3 packets transmitted, 3 received, 0% packet loss, time 2004ms\nrtt min/avg/max/mdev = 5.017/5.581/6.312/0.541 ms\n...\n</code></pre></p> <p>Note that normally we are using ueransim to simulate \u201cterminal\u201d UE device, not as a network device or proxy, therefore the above two routing rules suffice.</p> <p>Now if we still want to run: <pre><code>$ ping google.com\nping: google.com: Temporary failure in name resolution\n</code></pre></p> <p>we will get unresolved domain name. To solve this, we can modify the file <code>/etc/resolv.conf</code>: <pre><code>sudo nano /etc/resolv.conf\n</code></pre></p> <p>and change the nameserver IP to <code>8.8.8.8</code>: <pre><code>nameserver 8.8.8.8\n</code></pre></p> <p>After the change, we can see <code>ping</code> getting responses: <pre><code>$ ping google.com\nPING google.com (216.58.200.46) 56(84) bytes of data.\n64 bytes from tsa01s08-in-f46.1e100.net (216.58.200.46): icmp_seq=1 ttl=61 time=5.19 ms\n64 bytes from tsa01s08-in-f46.1e100.net (216.58.200.46): icmp_seq=2 ttl=61 time=50.4 ms\n64 bytes from tsa01s08-in-f46.1e100.net (216.58.200.46): icmp_seq=3 ttl=61 time=5.66 ms\n^C\n--- google.com ping statistics ---\n3 packets transmitted, 3 received, 0% packet loss, time 2004ms\nrtt min/avg/max/mdev = 5.191/20.423/50.414/21.207 ms\n</code></pre></p> <p>We can also examine the network traffic happening underneath in the scenario above. First we open another SSH terminal into ueransim, and run the following command: <pre><code>$ sudo tcpdump -n -i any host 60.60.0.1 or 192.168.56.101\ntcpdump: verbose output suppressed, use -v or -vv for full protocol decode\nlistening on any, link-type LINUX_SLL (Linux cooked v1), capture size 262144 bytes\n</code></pre></p> <p>then run <code>ping 8.8.8.8</code> again, wait for a couple seconds, then <code>Ctrl-C</code> to exit. We see the data packets actually going in and out <code>uesimtun0</code>. <pre><code>$ sudo tcpdump -n -i any host 60.60.0.1 or 192.168.56.101\ntcpdump: verbose output suppressed, use -v or -vv for full protocol decode\nlistening on any, link-type LINUX_SLL (Linux cooked v1), capture size 262144 bytes\n10:24:56.138729 IP 192.168.56.101.38412 &gt; 192.168.56.102.38740: sctp (1) [HB REQ]\n10:24:56.138783 IP 192.168.56.102.38740 &gt; 192.168.56.101.38412: sctp (1) [HB ACK]\n10:24:58.456532 IP 60.60.0.1 &gt; 8.8.8.8: ICMP echo request, id 33, seq 1, length 64\n10:24:58.457416 IP 192.168.56.102.2152 &gt; 192.168.56.101.2152: UDP, length 100\n10:24:58.462136 IP 192.168.56.101.2152 &gt; 192.168.56.102.2152: UDP, length 92\n10:24:58.462324 IP 8.8.8.8 &gt; 60.60.0.1: ICMP echo reply, id 33, seq 1, length 64\n10:24:59.458823 IP 60.60.0.1 &gt; 8.8.8.8: ICMP echo request, id 33, seq 2, length 64\n10:24:59.459031 IP 192.168.56.102.2152 &gt; 192.168.56.101.2152: UDP, length 100\n10:24:59.464214 IP 192.168.56.101.2152 &gt; 192.168.56.102.2152: UDP, length 92\n10:24:59.464396 IP 8.8.8.8 &gt; 60.60.0.1: ICMP echo reply, id 33, seq 2, length 64\n10:25:00.461293 IP 60.60.0.1 &gt; 8.8.8.8: ICMP echo request, id 33, seq 3, length 64\n10:25:00.462178 IP 192.168.56.102.2152 &gt; 192.168.56.101.2152: UDP, length 100\n10:25:00.474941 IP 192.168.56.101.2152 &gt; 192.168.56.102.2152: UDP, length 92\n10:25:00.475561 IP 8.8.8.8 &gt; 60.60.0.1: ICMP echo reply, id 33, seq 3, length 64\n10:25:01.463946 IP 60.60.0.1 &gt; 8.8.8.8: ICMP echo request, id 33, seq 4, length 64\n10:25:01.464523 IP 192.168.56.102.2152 &gt; 192.168.56.101.2152: UDP, length 100\n10:25:01.469297 IP 192.168.56.101.2152 &gt; 192.168.56.102.2152: UDP, length 92\n10:25:01.470314 IP 8.8.8.8 &gt; 60.60.0.1: ICMP echo reply, id 33, seq 4, length 64\n</code></pre></p>"},{"location":"guide/6-simple-app/#wget","title":"wget","text":"<p>Simply look for any web page for file download on the web. For example, if we choose Golang web site as an example, we may find the URL: <pre><code>https://golang.org/dl/go1.15.8.darwin-amd64.pkg\n</code></pre> Using the same network settings is the previous exercise, just <pre><code>wget https://golang.org/dl/go1.15.8.darwin-amd64.pkg\n</code></pre> And see if you can download a Golang 1.15.8 install file.</p>"},{"location":"guide/6-simple-app/#ptt-ssh-bbsupttcc","title":"ptt (<code>ssh bbsu@ptt.cc</code>)","text":"<p>You can actually use SSH in the ueransim VM to access remote site. For example, you can SSH to a well-known terminal-based BBS site in Taiwan: <pre><code>ssh bbsu@ppt.cc\n</code></pre></p>"},{"location":"guide/6-simple-app/#youtube","title":"Youtube","text":"<p>You can also use Youtube as an example app. To achieve this goal, you can install a desktop VM with graphical UI, such as Ubuntu Desktop, and follow the same procedure to install and start up UERANSIM, then access Youtube through <code>uesimtun0</code> and free5GC.</p> <p>To reduce resource consumption on your host machine, you may install Lubuntu (at https://lubuntu.me), a more light-weight Ubuntu desktop distro instead. But since viewing free5GC YouTube Channel requires quite sime CPU consumption, you may have to set at least 2 CPUs and 2048 MB memory for the VM.</p> <p>Refer to videos Access Youtube on Lubuntu (1, 2, 3, 4 and 5).</p>"},{"location":"guide/Appendix/","title":"Appendix","text":""},{"location":"guide/Appendix/#appendix","title":"Appendix","text":""},{"location":"guide/Appendix/#appendix-a-oam","title":"Appendix A: OAM","text":"<ol> <li>Run the OAM server <pre><code>cd webconsole\ngo run server.go\n</code></pre></li> <li>Access the OAM by <pre><code>URL: http://localhost:5000\nUsername: admin\nPassword: free5gc\n</code></pre></li> <li>Now you can see the information of currently registered UEs (e.g. Supi, connected state, etc.) in the core network at the tab \"DASHBOARD\" of free5GC webconsole</li> </ol> <p>Note: You can add the subscribers here too</p>"},{"location":"guide/Appendix/#appendix-b-orchestrator","title":"Appendix B: Orchestrator","text":"<p>Please refer to free5gmano</p>"},{"location":"guide/Appendix/#appendix-c-iptv","title":"Appendix C: IPTV","text":"<p>Please refer to free5GC/IPTV</p>"},{"location":"guide/Appendix/#appendix-d-system-environment-cleaning","title":"Appendix D: System Environment Cleaning","text":"<p>The below commands may be helpful for development purposes.</p> <ol> <li>Remove POSIX message queues<ul> <li><code>ls /dev/mqueue/</code></li> <li><code>rm /dev/mqueue/*</code></li> </ul> </li> <li>Remove gtp5g tunnels (using tools in libgtp5gnl)<ul> <li><code>cd ./src/upf/lib/libgtp5gnl/tools</code></li> <li><code>./gtp5g-tunnel list pdr</code></li> <li><code>./gtp5g-tunnel list far</code></li> </ul> </li> <li>Remove gtp5g devices (using tools in libgtp5gnl)<ul> <li><code>cd ./src/upf/lib/libgtp5gnl/tools</code></li> <li><code>sudo ./gtp5g-link del {Dev-Name}</code></li> </ul> </li> </ol>"},{"location":"guide/Appendix/#appendix-e-change-kernel-version","title":"Appendix E: Change Kernel Version","text":"<ol> <li>Check the previous kernel version: <code>uname -r</code></li> <li>Search specific kernel version and install, take <code>5.0.0-23-generic</code> for example <pre><code>sudo apt search 'linux-image-5.0.0-23-generic'\nsudo apt install 'linux-image-5.0.0-23-generic'\nsudo apt install 'linux-headers-5.0.0-23-generic'\n</code></pre></li> <li>Update initramfs and grub <pre><code>sudo update-initramfs -u -k all\nsudo update-grub\n</code></pre></li> <li>Reboot, enter grub and choose kernel version <code>5.0.0-23-generic</code> <pre><code>sudo reboot\n</code></pre></li> </ol>"},{"location":"guide/Appendix/#optional-remove-kernel-image","title":"Optional: Remove Kernel Image","text":"<pre><code>sudo apt remove 'linux-image-5.0.0-23-generic'\nsudo apt remove 'linux-headers-5.0.0-23-generic'\n</code></pre>"},{"location":"guide/Appendix/#appendix-f-program-the-sim-card","title":"Appendix F: Program the SIM Card","text":"<p>Install packages: <pre><code>sudo apt-get install pcscd pcsc-tools libccid python-dev swig python-setuptools python-pip libpcsclite-dev\nsudo pip install pycrypto\n</code></pre></p> <p>Download PySIM <pre><code>git clone git://git.osmocom.org/pysim.git\n</code></pre></p> <p>Change to pyscard folder and install <pre><code>cd &lt;pyscard-path&gt;\nsudo /usr/bin/python setup.py build_ext install\n</code></pre></p> <p>Verify your reader is ready</p> <pre><code>sudo pcsc_scan\n</code></pre> <p>Check whether your reader can read the SIM card <pre><code>cd &lt;pysim-path&gt;\n./pySim-read.py \u2013p 0\n</code></pre></p> <p>Program your SIM card information <pre><code>./pySim-prog.py -p 0 -x 208 -y 93 -t sysmoUSIM-SJS1 -i 208930000000003 --op=8e27b6af0e692e750f32667a3b14605d -k 8baf473f2f8fd09487cccbd7097c6862 -s 8988211000000088313 -a 23605945\n</code></pre></p> <p>You can get your SIM card from sysmocom.</p>"},{"location":"guide/Appendix/#appendix-g-install-mongodb-70x-on-ubuntu-server-220403","title":"Appendix G: Install MongoDB 7.0.x on Ubuntu Server 22.04.03","text":"<p>Check that the system CPU supports AVX instructions as it's required since MongoDB 5.0. If not (i.e. the command below returns empty output), use MongoDB 4.4.x (see step 3 from installation prerequisites instructions)</p> <pre><code>grep --color avx /proc/cpuinfo\n</code></pre> <p>Before you begin the installation, update the package manager database and make sure MongoDB prerequisites are installed <pre><code>sudo apt update\nsudo apt install gnupg curl\n</code></pre> Add MongoDB public GPG key <pre><code>curl -fsSL https://pgp.mongodb.com/server-7.0.asc | \\\n   sudo gpg -o /usr/share/keyrings/mongodb-server-7.0.gpg --dearmor\n</code></pre> Note: if you are installing a version other than 7.0, remember, change it on the command above</p> <p>Create the APT list entry file using the command below <pre><code>echo \"deb [ arch=amd64,arm64 signed-by=/usr/share/keyrings/mongodb-server-7.0.gpg ] https://repo.mongodb.org/apt/ubuntu jammy/mongodb-org/7.0 multiverse\" | sudo tee /etc/apt/sources.list.d/mongodb-org-7.0.list\n</code></pre></p> <p>Refresh the package database then install MongoDB</p> <pre><code>sudo apt update\nsudo apt install -y mongodb-org\n</code></pre> <p>For detailed instructions on how to freeze the installed version or install a specific version of MongoDB, please, check the reference below or follow this direct URL</p> <p>Don't forget to load the DB service using</p> <pre><code>sudo systemctl start mongod\n</code></pre> <p>Reference: MongoDB official website</p>"},{"location":"guide/Appendix/#appendix-h-using-the-reload_host_configsh-script","title":"Appendix H: Using the <code>reload_host_config.sh</code> script","text":"<p>The script was designed to help reapplying the configurations after a VM reboot</p> <p>Its usage is fairly simple, just run</p> <pre><code>./reload_host_config.sh &lt;dn_interface&gt;\n</code></pre> <p>For example, if your DN interface (e.g. free5GC's VM LAN interface) is named <code>enp0s4</code>, the command above will be</p> <pre><code>./reload_host_config.sh enp0s4\n</code></pre> <p>If you are unsure regarding the name of the interface, run <code>ip a</code> (see the image below) to help to figure it out</p> <p></p> <p>An example of the expected output is depicted above</p>"},{"location":"guide/Configuration/","title":"Configuration","text":""},{"location":"guide/Configuration/#configuration","title":"Configuration","text":""},{"location":"guide/Configuration/#sbi-configuration","title":"SBI Configuration","text":"<p>There are registerIP and bindingIP design on every NF's sbi interface.</p> <p></p> <p>This is due to some orchestration, such as Kubernetes or OpenStack, has the design of service IP mapping.</p> <p></p> <p>Use Kubernetes as an example. K8s has the service type that enable users to define the service IP outside the pod. But the service IP may be different from the IP assigned inside the pod. Therefore, if we register the binding IP inside the pod to NRF, NRF cannot know which service IP outside the pod has attached. As the result, we need to separate registerIP from bindingIP in this scenario.</p> <p>If you are not sure what IP you should set, just configure it as the same IP address.</p>"},{"location":"guide/Configuration/#sample-configuration","title":"Sample configuration","text":"<p>We provide a sample config to connect to outer ran under <code>/sample/ran_attach_config/</code>. The architecture is as following.</p> <p></p> <p>As the result, user's RAN IP must set to 192.168.0.0/24 subnet or let the routing route to this subnet.</p> <p>Notice: If user wants to use the setting, aware to set 192.168.0.1 to your host as well.</p>"},{"location":"guide/Configuration/#smf-configuration","title":"SMF Configuration","text":""},{"location":"guide/Configuration/#a-configure-smf-with-s-nssai","title":"A. Configure SMF with S-NSSAI","text":"<ol> <li>Configure NF Registration SMF S-NSSAI in <code>smfcfg.yaml</code></li> </ol>"},{"location":"guide/Configuration/#b-configure-uplink-classifier-ulcl-information-in-smf","title":"B. Configure Uplink Classifier (ULCL) information in SMF","text":"<ol> <li>Configure UE routing path in <code>uerouting.yaml</code></li> </ol> <ul> <li>DestinationIP and DestinationPort will be the packet destination.</li> <li>UPF field will be the packet datapath when it match the destination above.</li> </ul> <p>For more detail of SMF config, please refer to here.</p>"},{"location":"guide/Environment/","title":"Environment","text":""},{"location":"guide/Environment/#recommended-environment","title":"Recommended Environment","text":"<p>free5gc has been tested against the following environment:</p> <ul> <li>Software<ul> <li>OS: Ubuntu 20.04.6 LTS</li> <li>gcc 9.4.0</li> <li>go 1.18.10 linux/amd64</li> <li>kernel version 5.4.0-169-generic</li> </ul> </li> </ul> <p>Note: The listed kernel version is required for the UPF element.</p> <ul> <li> <p>Minimum Hardware</p> <ul> <li>CPU: Intel i5 processor</li> <li>RAM: 4GB</li> <li>Hard drive: 160GB</li> <li>NIC: Any 1Gbps Ethernet card supported in the Linux kernel</li> </ul> </li> <li> <p>Recommended Hardware</p> <ul> <li>CPU: Intel i7 processor</li> <li>RAM: 8GB</li> <li>Hard drive: 160GB</li> <li>NIC: Any 10Gbps Ethernet card supported in the Linux kernel</li> </ul> </li> </ul> <p>This guide assumes that you will run all 5GC elements on a single machine.</p>"},{"location":"guide/SMF-Config/","title":"SMF Config","text":""},{"location":"guide/SMF-Config/#smf-config-ulcl-config","title":"SMF Config / ULCL Config","text":"<p>This document explains the detail of SMF config. Also provide some examples about conversion between config file and real User Plane topology</p> <p>ULCL limitation: The branching UPF now can't connect to the Internet.  It only serves as a Intranet in the UPF topology. (Please refers to the topology of example 2)</p>"},{"location":"guide/SMF-Config/#sbi","title":"SBI","text":"Field meaning scheme The protocol for SBI registerIPv4 IP used to register to NRF bindingIPv4 IP used to bind the service port SMF bind the SBI service to this port"},{"location":"guide/SMF-Config/#pfcp","title":"PFCP","text":"Field meaning addr The IP address of N4 interface on the SMF (PFCP)"},{"location":"guide/SMF-Config/#userplane-information","title":"Userplane Information","text":"Field meaning userplane_information Includes topology and information of RAN and UPFs which are controlled by this SMF up_nodes The node in the user plane topology. Includes gNodeB, I-UPF and A-UPF links The edge in the user plane topology type Indicate it is RAN or specific kind of  UPF node_id The PFCP IPv4 address for UPF <p>Note: up_resource_ip serves as default user plane IP for the UPF. In this version, UPF will determine its user plane IP by itself. So setting up_resource_ip in SMF config won't affect real config in user plane.</p>"},{"location":"guide/SMF-Config/#amf-config","title":"AMF Config","text":"<p>To understand whole PDU session config, we must take a step forward to understand the AMF config.</p> Field meaning NGAPIPList The IP list of N2 interfaces on the AMF SBI Same meaning with SMF/SBI."},{"location":"guide/SMF-Config/#example-1","title":"Example 1","text":""},{"location":"guide/SMF-Config/#smf-config","title":"SMF Config","text":"<ul> <li>sbi:<ul> <li>scheme: http</li> <li>registerIPv4: 127.0.0.2</li> <li>bindingIPv4: 127.0.0.2</li> <li>port: 8000</li> </ul> </li> <li>pfcp:<ul> <li>addr: 10.200.200.1</li> </ul> </li> <li>userplane_information:<ul> <li>up_nodes:<ul> <li>gNB1:<ul> <li>type: AN</li> </ul> </li> <li>UPF:<ul> <li>type: UPF</li> <li>node_id: 10.200.200.102</li> </ul> </li> </ul> </li> <li>links:<ul> <li>A: gNB1</li> <li>B: UPF</li> </ul> </li> </ul> </li> </ul>"},{"location":"guide/SMF-Config/#amf-config_1","title":"AMF Config","text":"<ul> <li>ngapIpList:<ul> <li>127.0.0.1</li> </ul> </li> <li>sbi:<ul> <li>scheme: http</li> <li>registerIPv4: 127.0.0.18</li> <li>bindingIPv4: 127.0.0.18</li> <li>port: 8000</li> </ul> </li> </ul>"},{"location":"guide/SMF-Config/#representing-topology","title":"Representing Topology","text":""},{"location":"guide/SMF-Config/#example-2","title":"Example 2","text":""},{"location":"guide/SMF-Config/#smf-config_1","title":"SMF Config","text":"<ul> <li>sbi:<ul> <li>scheme: https</li> <li>registerIPv4: 127.0.0.2</li> <li>bindingIPv4: 127.0.0.2</li> <li>port: 29502</li> </ul> </li> <li>pfcp:<ul> <li>addr: 10.200.200.1</li> </ul> </li> <li>userplane_information:<ul> <li>up_nodes:<ul> <li>gNB1:<ul> <li>type: AN</li> </ul> </li> <li>BranchingUPF:<ul> <li>type: UPF</li> <li>node_id: 10.200.200.102</li> </ul> </li> <li>AnchorUPF1:<ul> <li>type: UPF</li> <li>node_id: 10.200.200.101</li> </ul> </li> <li>AnchorUPF2:<ul> <li>type: UPF</li> <li>node_id: 10.200.200.103</li> </ul> </li> <li>links:</li> <li>A: gNB1     B: BranchingUPF</li> <li>A: BranchingUPF     B: AnchorUPF1</li> <li>A: BranchingUPF     B: AnchorUPF2</li> </ul> </li> </ul> </li> </ul>"},{"location":"guide/SMF-Config/#amf-config_2","title":"AMF Config","text":"<ul> <li>ngapIpList:<ul> <li>127.0.0.1</li> </ul> </li> <li>sbi:<ul> <li>scheme: https</li> <li>registerIPv4: 127.0.0.18</li> <li>bindingIPv4: 127.0.0.18</li> <li>port: 8000</li> </ul> </li> </ul>"},{"location":"guide/SMF-Config/#representing-topology_1","title":"Representing Topology","text":""},{"location":"guide/Trouble_Shooting/","title":"Trouble Shooting","text":""},{"location":"guide/Trouble_Shooting/#trouble-shooting","title":"Trouble Shooting","text":""},{"location":"guide/Trouble_Shooting/#1-error-sctp-failed-to-connect-given-amf-n3iwfngap","title":"1. <code>ERROR: [SCTP] Failed to connect given AMF    N3IWF=NGAP</code>","text":"<p>This error occured when N3IWF was started before AMF finishing initialization. This error usually appears when you run the TestNon3GPP in the first time.</p> <p>Rerun the test should be fine. If it still not be solved, larger the sleeping time in line 110 of <code>test.sh</code>.</p>"},{"location":"guide/Trouble_Shooting/#2-testnon3gpp","title":"2. TestNon3GPP","text":"<p>TestNon3GPP will modify the <code>config/amfcfg.conf</code>. So, if you had killed the TestNon3GPP test before it finished, you might need to copy <code>config/amfcfg.conf.bak</code> back to <code>config/amfcfg.conf</code> to let other tests pass.</p> <p><code>cp config/amfcfg.conf.bak config/amfcfg.conf</code></p>"},{"location":"guide/Trouble_Shooting/#3-db-on-tls-to-h2c","title":"3. DB on TLS to H2C","text":"<p>If you meet any problems about https or mogodb, it maybe couse our new version from v3.0.1 to v3.0.2 has change http to H2C verion. Try the command below.</p> <p><code>mongo --eval \"db.NfProfile.drop()\" free5gc</code></p>"},{"location":"guide/Trouble_Shooting/#4-mqcreate-error-creating-message-queue-too-many-open-files-upfutil-upf","title":"4. <code>MQCreate() Error creating message queue: Too many open files UPF=Util</code> (UPF)","text":"<p>Remove POSIX message queues</p> <pre><code>ls /dev/mqueue/\nrm /dev/mqueue/*\n</code></pre>"},{"location":"guide/Trouble_Shooting/#5-remove-gtp-devices-using-tools-in-libgtp5gnl-upf","title":"5. Remove gtp devices (using tools in libgtp5gnl) (UPF)","text":"<pre><code>cd lib/libgtp5gnl/tools\nsudo ./gtp5g-link del {Dev-Name}\n</code></pre>"},{"location":"guide/Trouble_Shooting/#6-upf-cli-run-error-open-gtp5g-open-link-create-file-exists","title":"6. <code>UPF Cli Run Error: open Gtp5g: open link: create: file exists</code>","text":"<pre><code>sudo ip link del upfgtp\n</code></pre>"},{"location":"guide/Trouble_Shooting/#7-smf-cannot-communicate-with-upf-upf-cannot-start-after-a-reboot-or-crash","title":"7. SMF cannot communicate with UPF / UPF cannot start after a reboot or crash","text":"<p>The message below shows up on the logs:</p> <pre><code>[WARN][SMF][Main] Failed to setup an association with UPF[127.0.0.8], error:Request Transaction [1]: retry-out\n</code></pre> <p>Verify on the logs if you got this message:</p> <pre><code>[ERRO][UPF][Main] UPF Cli Run Error: open Gtp5g: open link: create: operation not supported\n</code></pre> <p>If yes, then try to load the GTP module on the system:</p> <pre><code>modprobe gtp5g\n</code></pre> <p>If this outputs an error like this:</p> <pre><code>modprobe: FATAL: Module gtp5g not found in directory /lib/modules/5.4.0-xxx-generic\n</code></pre> <p>Reinstall the GTP-U kernel module using: <pre><code>cd ~\ngit clone -b v0.8.3 https://github.com/free5gc/gtp5g.git\ncd ~/gtp5g\nsudo make\nsudo make install\n</code></pre></p> <p>Then, once running the core <code>run.sh</code> script, you should obtain the message on the logs:</p> <pre><code>[INFO][SMF][Main] Received PFCP Association Setup Accepted Response from UPF[127.0.0.8]\n</code></pre> <p>and it should work as normal</p> <p>After that, if it's required to reload the module, just run <code>modprobe gtp5g</code> again</p> <p>Note: The symptoms described above may happen if the host machine updated it's kernel version recently</p> <p>References: Free5GC Forum and Install Guide</p>"},{"location":"guide/Trouble_Shooting/#8-decode-http2-packet-in-wireshark","title":"8. Decode HTTP/2 packet in Wireshark","text":"<ol> <li> <p>Run Network Function</p> <p>Check has XXFsslkey.log</p> </li> <li> <p>Edit &gt;&gt; Preference &gt;&gt; Protocols &gt;&gt; SSL (TLS)</p> <p></p> </li> <li> <p>Add keylog</p> <p></p> </li> <li> <p>Filter http2</p> <p></p> </li> </ol>"},{"location":"guide/Trouble_Shooting/#9-decode-h2c-http2-clear-text-without-tls","title":"9. Decode H2C (HTTP2 clear text without TLS)","text":"<p>The similar reason as NEA0 NAS message. Althrough H2C is clear text, wirshark still considers these packets as the normal TCP packets and does not decode them by HTTP2.</p> <p>To see the details of H2C packets, do the following configuration.</p> <ol> <li> <p>Analyze \u2192 Decode As\u2026</p> <p></p> </li> <li> <p>click Add button to add the decode rules</p> <p></p> <p>Decode the packets from the TCP ports listened by each NF as HTTP2 packets.</p> </li> </ol>"},{"location":"guide/Trouble_Shooting/#10-to-clear-all-iptables-rules","title":"10. To clear all iptables rules","text":"<p>If something went wrong, it's possible to reset iptables' rules back using: <pre><code>sudo iptables -P INPUT ACCEPT\nsudo iptables -P FORWARD ACCEPT\nsudo iptables -P OUTPUT ACCEPT\nsudo iptables -t nat -F\nsudo iptables -t mangle -F\nsudo iptables -F\nsudo iptables -X\n</code></pre></p> <p>Then remember to add back the rules required by the free5GC.</p>"},{"location":"guide/features/","title":"Features","text":""},{"location":"guide/features/#free5gc-specification","title":"free5GC Specification","text":"<ul> <li>3GPP TS 23.501/23.502-Rel-15</li> <li>5G Standalone (SA) supported</li> <li>Serviced-Based Interface (SBI) supported<ul> <li>Namf, Nsmf, Nausf, Nudm, Nudr, Nnssf, Nnrf, Npcf</li> </ul> </li> <li>N1, N2, N3, N4, N6, N9, interfaces supported</li> <li>5G SA Network Functions supported:<ul> <li>AMF: Access and Mobility Management Function<ul> <li>Registration Management, Connection Management, Reachability Management, Mobility Management, and Authentication</li> </ul> </li> <li>SMF: Session Management Function<ul> <li>Session Management, IP Assigning/Management</li> </ul> </li> <li>UPF: User Plane Function<ul> <li>Support multiple UPF and ULCL (uplink classifier)</li> <li>Session and Service Continuity (SSC) mode 1</li> <li>Packet Routing/Forwarding</li> </ul> </li> <li>CHF: Charging Function (will be supported in release v3.3.1)<ul> <li>Online/Offline Charging</li> <li>Webconsole acts as BD (Billing Domain)</li> <li>Flow-Based Charging on PDU Session</li> </ul> </li> <li>AUSF: Authentication Server Function</li> <li>NRF: NF Repository Function</li> <li>UDM: Unified Data Management</li> <li>UDR: Unified Data Repository</li> <li>PCF: Policy and Charging Function</li> <li>NSSF: Network Slice Selection Function</li> <li>N3IWF: Non-3GPP Interworking Function</li> <li>N3IWUE: Non-3GPP Interworking User Equipment</li> </ul> </li> </ul>"},{"location":"guide/features/#supported-features","title":"Supported features","text":"<ul> <li>Registration<ul> <li>Initial Registration</li> <li>Periodic Registration</li> <li>Mobility Registration</li> <li>Registration without authentication, due to RAN did the AMF reselection</li> </ul> </li> <li>NAS Reroute when serving AMF can not handle UE registration with unmatch NSSAI</li> <li>Authentication<ul> <li>5G-AKA</li> <li>EAP-AKA'</li> </ul> </li> <li>NAS Security<ul> <li>Ciphering: NEA0, NEA1, NEA2, NEA3</li> <li>Integrity: NIA0, NIA1, NIA2, NIA3</li> </ul> </li> <li>Deregistration:<ul> <li>UE-initiated Deregistration</li> </ul> </li> <li>Service Request:<ul> <li>UE triggered Service Request</li> <li>Network Triggered Service Request</li> </ul> </li> <li>AN Release</li> <li>PDU Session Establishment</li> <li>PDU Session Modification (v3.3.0)</li> <li>Converged Charging (CHF has been published, all of the functions will be enabled in the incoming release)<ul> <li>Billing Domain (webconsole)</li> <li>ABMF, RF, and CGF built-in CHF</li> <li>Flow-based Charging (FBC)</li> </ul> </li> <li>PDU Session Release</li> <li>Handover<ul> <li>N2 Handover (Indirect mode not supported)</li> <li>Xn Handover</li> </ul> </li> <li>QoS<ul> <li>Control Plane only:<ol> <li>5QI, ARP, GBR, MBR of QoS Flow (v3.3.0)</li> <li>Session-AMBR supported</li> </ol> </li> </ul> </li> <li>Collection and reporting of usage data over N4 interface<ul> <li>Volume measurement periodically</li> </ul> </li> <li>UP Security</li> <li>Multiple UPFs and ULCL (Uplink Classifier)</li> <li>Multiple Slice and DNN</li> <li>Dynamic/Static IPv4 address allocation</li> </ul>"},{"location":"guide/hardware/","title":"Hardware","text":""},{"location":"guide/hardware/#hardware-tested","title":"Hardware Tested","text":"<p>Some 5G UE and gNodeB hardware have been tested with free5GC by partners or community members:</p> <ul> <li> <p>5G UE (Support 5G SA):</p> <ul> <li>APAL 5G Dongle</li> <li>APAL 5G MiFi</li> <li>Samsung S21 5G</li> <li>Huawei P40 5G (forum link)</li> <li>Huawei Mate30 5G (forum link)</li> </ul> </li> <li> <p>gNodeB:</p> <ul> <li>Alpha gNodeB</li> <li>Compal gNodeB</li> <li>FII gNodeB</li> <li>ITRI gNodeB</li> <li>Lions gNodeB</li> <li>Amarisoft gNodeB (forum link)</li> <li>Nokia gNodeB (forum link)</li> <li>Nokia (AMIA AirScale Indoor Subrack 473098A)</li> <li>OpenAirInterface</li> <li>Open Source RAN Project - srsRAN</li> </ul> </li> </ul> <p>Reports of tested hardware not listed above on Github issue or free5GC forum are welcome.</p> <p>PS: if you don't have any hardware available, we suggest to use UERANSIM to simulate.</p> <p>(Refer to Advanced environment setup section)</p>"},{"location":"guide/n3iwue-installation/","title":"N3iwue installation","text":""},{"location":"guide/n3iwue-installation/#installing-n3iwue","title":"Installing N3IWUE","text":"<p>In this demo we will practice:</p> <ul> <li>Installing N3IWUE</li> <li>Configuring free5GC and N3IWUE</li> <li>Running N3IWUE to connect free5GC</li> </ul>"},{"location":"guide/n3iwue-installation/#1-install-n3iwue-vm","title":"1. Install N3IWUE VM","text":"<p>Repeat the steps of cloning <code>free5gc</code> VM from the base VM, create a new VM for the N3IWUE:</p> <ul> <li>You can refer to Installing free5gc to install free5gc VM.</li> <li>Name the VM <code>N3IWUE</code>, and create new MAC addresses for all network cards.</li> <li>Make sure the VM has internet access and can log in using SSH.</li> <li>Change the hostname to <code>N3IWUE</code>.</li> <li>Make the Host-only network interface have static IP address <code>192.168.56.103</code>.</li> <li>Reboot the N3IWUE VM, as well as the free5gc VM.</li> <li>You can ping <code>192.168.56.101</code> from the N3IWUE VM, and also <code>ping 192.168.56.103</code> from the free5gc VM.</li> </ul>"},{"location":"guide/n3iwue-installation/#2-install-n3iwue","title":"2. Install N3IWUE","text":"<p>Go to N3IWUE GitHub Repo.</p> <p>To download N3IWUE in home directory: <pre><code>cd ~\ngit clone https://github.com/free5gc/n3iwue.git\ncd ..\n</code></pre></p> <p>Update and upgrade the VM of N3IWUE: <pre><code>sudo apt update\nsudo apt upgrade\n</code></pre></p> <p>Install required tools: <pre><code>sudo apt install make\nsudo apt install libsctp-dev lksctp-tools\nsudo apt install iproute2\n</code></pre></p> <p>Install Golang (use <code>1.21.6</code> version in this demonstrate): <pre><code>wget https://dl.google.com/go/go1.21.6.linux-amd64.tar.gz\nsudo tar -C /usr/local -zxvf go1.21.6.linux-amd64.tar.gz\nmkdir -p ~/go/{bin,pkg,src}\necho 'export GOPATH=$HOME/go' &gt;&gt; ~/.bashrc\necho 'export GOROOT=/usr/local/go' &gt;&gt; ~/.bashrc\necho 'export PATH=$PATH:$GOPATH/bin:$GOROOT/bin' &gt;&gt; ~/.bashrc \necho 'export GO111MODULE=auto' &gt;&gt; ~/.bashrc\nsource ~/.bashrc\n\n# check your go installation\ngo version\n</code></pre></p> <p>Build N3IWUE <pre><code>cd ~/n3iwue\nmake\n</code></pre></p>"},{"location":"guide/n3iwue-installation/#3-use-webconsole-to-add-ue","title":"3. Use WebConsole to Add UE","text":"<p>Open your web browser from your host machine, and enter the URL <code>http://192.168.56.101:5000</code></p> <ul> <li>On the login page, enter username <code>admin</code> and password <code>free5gc</code>.</li> <li>Once logged in, widen the page until you see \u201cSubscribers\u201d on the left-hand side column.</li> <li>Click on the <code>Subscribers</code> tab and then on the <code>New Subscriber</code> button<ul> <li>Scroll down to <code>Operator Code Type</code> and change it from \"OPc\" to \"OP\".</li> <li>Make sure the following config between <code>n3iwue/config/n3ue.yaml</code> and <code>Subscriber</code> you create are the same:<ul> <li>PLMNID (ex. 208930000001234)</li> <li>K</li> <li>SQN</li> <li>OP value (choose OP instead of OPC)</li> </ul> </li> <li>Scroll all the way down and click on <code>Submit</code>.</li> </ul> </li> </ul>"},{"location":"guide/n3iwue-installation/#4-setting-n3iwf-config","title":"4. Setting N3IWF Config","text":"<p>In free5gc VM, we need to edit N3IWF config file <code>~/free5gc/config/n3iwfcfg.yaml</code></p> <p>Replace IKEBindAddress from <code>172.16.2.100</code> to <code>192.168.56.101</code>, namely from: <pre><code>  IKEBindAddress: 172.16.2.100 # Nwu interface  IP address (IKE) on this N3IWF\n</code></pre> into: <pre><code>  IKEBindAddress: 192.168.56.101 # Nwu interface  IP address (IKE) on this N3IWF\n</code></pre></p>"},{"location":"guide/n3iwue-installation/#5-setting-n3iwue","title":"5. Setting N3IWUE","text":"<p>To let N3IWUE knows where is the N3IWF is, we need to edit the UE config file <code>~/n3iwue/config/n3ue.yaml</code> in N3IWUE VM</p> <p>Replace these parameters: <pre><code>N3IWFInformation:\n  IPSecIfaceAddr: 10.0.1.1 # IP address of Nwu interface (IKE) on N3IWF\n\nN3UEInformation:\n  IPSecIfaceName: ens38 # Name of Nwu interface (IKE) on this N3UE\n  IPSecIfaceAddr: 10.0.1.4 # IP address of Nwu interface (IKE) on this N3UE\n</code></pre> into: <pre><code>N3IWFInformation:\n  IPSecIfaceAddr: 192.168.56.101 # IP address of Nwu interface (IKE) on N3IWF\n\nN3UEInformation:\n  IPSecIfaceName: enp0s8 # Name of Nwu interface (IKE) on this N3UE (your interface name)\n  IPSecIfaceAddr: 192.168.56.103 # IP address of Nwu interface (IKE) on this N3UE\n</code></pre></p>"},{"location":"guide/n3iwue-installation/#6-testing-n3iwue-with-free5gc","title":"6. Testing N3IWUE with free5GC","text":"<p>SSH into free5gc. If you have rebooted free5gc, remember to run: <pre><code>sudo sysctl -w net.ipv4.ip_forward=1\nsudo iptables -t nat -A POSTROUTING -o &lt;dn_interface&gt; -j MASQUERADE\n# e.g. sudo iptables -t nat -A POSTROUTING -o enp0s3 -j MASQUERADE\nsudo systemctl stop ufw\nsudo systemctl disable ufw\n</code></pre> Tip: Set <code>net.ipv4.ip_forward=1</code> in <code>/etc/sysctl.conf</code> to enable packet forwarding permanently</p> <p>In free5gc VM: <pre><code>cd ~/free5gc\n./run.sh -n3iwf\n</code></pre> In N3IWUE VM: <pre><code>cd ~/n3iwue\n./run.sh\n</code></pre></p>"},{"location":"guide/n3iwue-installation/#7-result","title":"7. Result","text":"<p>Success: N3IWUE can ping data network through N3IWF </p>"},{"location":"guide/Webconsole/Create-Subscriber-via-webconsole/","title":"Create Subscriber via webconsole","text":""},{"location":"guide/Webconsole/Create-Subscriber-via-webconsole/#create-subscriber-via-webconsole","title":"Create Subscriber via Webconsole","text":""},{"location":"guide/Webconsole/Create-Subscriber-via-webconsole/#1-install-webconsole","title":"1. Install Webconsole","text":"<p>If Webconsole isn't installed yet, please, follow the instructions from GitHub page.</p>"},{"location":"guide/Webconsole/Create-Subscriber-via-webconsole/#2-optional-delete-mongodb-database","title":"2. (Optional) Delete MongoDB database","text":"<p>If another version of free5GC was ran before, you have to delete MongoDB. <pre><code>$ mongo --eval \"db.dropDatabase()\" free5gc\n</code></pre></p>"},{"location":"guide/Webconsole/Create-Subscriber-via-webconsole/#3-run-webconsole-server","title":"3. Run Webconsole server","text":"<pre><code>$ cd ~/free5gc/webconsole\n$ go run server.go\n</code></pre>"},{"location":"guide/Webconsole/Create-Subscriber-via-webconsole/#4-open-webconsole","title":"4. Open Webconsole","text":"<p>Enter URL: <code>&lt;Webconsole server's IP&gt;:5000</code> in browser</p> <p></p> <p>Default credential: <pre><code>Username: admin\nPassword: free5gc\n</code></pre></p>"},{"location":"guide/Webconsole/Create-Subscriber-via-webconsole/#5-add-new-subscriber","title":"5. Add new subscriber","text":"<p>Click <code>SUBSCRIBERS</code> -&gt; <code>CREATE</code></p> <p></p> <p>Edit the Subscriber's data and click <code>CREATE</code>, here you can configure the </p> <ul> <li>Network Slicing configuration <ul> <li>SST/SD</li> <li>DNN configuration<ul> <li>AMBR</li> <li>Default 5QI</li> <li>Flow configuration<ul> <li>IP Filter</li> <li>Precedence</li> <li>5QI</li> <li>Uplink GBR/MBR</li> <li>Downlink GBR/MBR</li> <li>Flow-Based Charging Config</li> </ul> </li> </ul> </li> </ul> </li> </ul> <p> </p> <p>Check that the new subscriber was added successfully</p> <p></p>"},{"location":"membership/","title":"Index","text":""},{"location":"membership/#sponsorship-info","title":"Sponsorship Info","text":""},{"location":"membership/#sponsorship-tiers","title":"Sponsorship Tiers","text":"<p>free5GC is a nonprofit organization dedicated to developing innovative and next-generation features for open-source code of the 5G Core (5GC) Network under Apache 2.0 license. We are tirelessly working on the development of R16, R17, and so on, towards 6G. Your generous support and sponsorship will sustain our technology development and the operation of the community. Your company/organization logo will be displayed on the free5GC website and listed as the sponsorship you participate. Here are the sponsorship tiers we offer.</p> <ul> <li>Sponsor \u2013 donation under US $17,000 </li> <li>Bronze Sponsor \u2013 donation from US 34,000</li> <li>Silver Sponsor \u2013 donation from US 68,000</li> <li>Gold Sponsor \u2013 donation from US 102,000</li> <li>Platinum Sponsor \u2013 donation for more than US $102,000</li> </ul> <p>You can now support free5GC with your credit card. Simply follow the two-step instructions provided here and use the link. (Download instruction PDF). Donations made in the US can be tax-deductible.</p> <p>Sponsors who can read Chinese can use this link to donate.</p> <p>Your generosity is appreciated.</p> <p>Tips</p> <ul> <li>You don\u2019t need to donate to use free5GC. You can download free5GC from https://github.com/free5gc/free5gc.</li> <li>The license of free5GC follows Apache 2.0. That is, anyone can use free5GC for commercial purposes for free. We will not charge any license fee.</li> <li>If you have any questions or problems regarding donation and sponsorship, please email us at free5GC.org@gmail.com.</li> </ul>"},{"location":"support/","title":"Index","text":""},{"location":"support/#technical-support","title":"Technical Support","text":"<p>If you encounter the usage problem on free5GC, please join our official forum forum.free5gc.org and initiate a new discussion.</p> <p>Otherwise, you can raise the issue on our GitHub repository for reporting the bugs/suggestions (related to vulnerability/functionality/deployment/testing), or create the pull request for contributing to our community!</p> <p>Tips</p> <p>If your problem can not be solved via the platforms listed above, please send an email directly to <code>free5GC.org@gmail.com</code>. Thanks.</p>"}]}